/*! For license information please see c__DocEditMode.889475ca.async.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[1201,20,32,97,135,155,485,495,533,666,781,809,813,872,887,1023,1116,1239],{1012:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(a=o.key,i=void 0,i=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(a,"string"),"symbol"===n(i)?i:String(i)),o)}var a,i}function a(e,t){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},a(e,t)}function i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,o=c(e);if(t){var a=c(this).constructor;r=Reflect.construct(o,arguments,a)}else r=o.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}e.exports=function(e){for(var t=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(u,e);var t,r,n,c=i(u);function u(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),c.apply(this,arguments)}return t=u,r&&o(t.prototype,r),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}(e),r=arguments.length,n=new Array(r>1?r-1:0),c=1;c<r;c++)n[c-1]=arguments[c];return n.forEach((function(e){!function(e,t){Object.getOwnPropertyNames(t).forEach((function(r){if("constructor"!==r){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n)}}))}(t.prototype,e.prototype)})),t}},1013:function(e,t,r){"use strict";r.d(t,"f",(function(){return o})),r.d(t,"b",(function(){return a})),r.d(t,"a",(function(){return i})),r.d(t,"e",(function(){return c})),r.d(t,"d",(function(){return u})),r.d(t,"c",(function(){return l}));var n=r(489).i18n,o={disabled:0,enable:1},a={System:"System",SelfQuestion:"SelfQuestion",Searching:"Searching",Generating:"Generating",AIAnswer:"AIAnswer",Operate:"Operate",AIQuestion:"AIQuestion",LinkOperate:"LinkOperate"},i={PENDING:0,SUCCESS:1,FAILED:2},c={Insert:0,Update:1,Delete:2},u=(function(){var e=n();e("正在进行知识库搜索"),e("已为你在你的小记和个人知识库内匹配到信息源"),e("并未匹配到信息源"),e("大模型正在回答你..."),e("这个问题有点难，请稍候..."),e("答案如下")}(),function(){var e=n();e("正在进行知识库搜索"),e("已为你在知识库内匹配到信息源"),e("并未匹配到信息源"),e("大模型正在回答你..."),e("这个问题有点难，请稍候..."),e("答案如下")}(),function(){var e=n();return{isChitChat:e("对不起，我只能回答知识库相关的问题哦"),infosecScanFailed:e("作为一个人工智能语言模型，这个问题超出我目前的学习范围了，您可以问我其他问题，我将尽力为您解答"),hasNoChunks:e("根据现有的知识库，无法回答该问题。"),default:e("换个话题吧，我更擅长回答团队知识库内的问题哦！为你找到如下文档可能能解决你的问题"),exception:e("抱歉发生了未知错误，请再问一次哦"),limited:e("提问过于频繁，请稍候再试")}}()),l={Note:"Note",Doc:"Doc"}},1223:function(e,t,r){"use strict";r.d(t,"c",(function(){return g})),r.d(t,"f",(function(){return w})),r.d(t,"k",(function(){return E})),r.d(t,"m",(function(){return S})),r.d(t,"e",(function(){return x})),r.d(t,"h",(function(){return A})),r.d(t,"j",(function(){return L})),r.d(t,"d",(function(){return C})),r.d(t,"i",(function(){return R})),r.d(t,"a",(function(){return D})),r.d(t,"b",(function(){return M})),r.d(t,"l",(function(){return F})),r.d(t,"g",(function(){return G}));var n=r(1001),o=r.n(n),a=r(150),i=r(148),c=r(458),u=r(238),l=r(116),s=r(1471);function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){h(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==f(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===f(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function m(){m=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof b?t:b,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:A(e,r,c)}),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var p="suspendedStart",h="suspendedYield",y="executing",v="completed",g={};function b(){}function w(){}function _(){}var E={};l(E,i,(function(){return this}));var O=Object.getPrototypeOf,S=O&&O(O(N([])));S&&S!==r&&n.call(S,i)&&(E=S);var k=_.prototype=b.prototype=Object.create(E);function x(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,c){var u=d(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==f(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=p;return function(a,i){if(o===y)throw new Error("Generator is already running");if(o===v){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var l=d(t,r,n);if("normal"===l.type){if(o=n.done?v:h,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=v,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=d(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(f(t)+" is not iterable")}return w.prototype=_,o(k,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(j.prototype),l(j.prototype,c,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(k),l(k,u,"Generator"),l(k,i,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function y(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function v(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){y(a,n,o,i,c,"next",e)}function c(e){y(a,n,o,i,c,"throw",e)}i(void 0)}))}}function g(e,t){return b.apply(this,arguments)}function b(){return b=v(m().mark((function e(t,r){var n,o,a=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>2&&void 0!==a[2]?a[2]:{useOriginResp:!1},e.next=3,c.a.templates.v2.useTemplate({template_id:r.id,book_id:t.id,doc_id:n.docId},{useOriginResp:n.useOriginResp});case 3:return o=e.sent,Object(l.spmClick)(s.a.TEMPLATE_USAGE,{id:r.id,type:r.type,format:r.format,name:r.name,platform:n.isDesktop?"desktop":"pc"}),e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)}))),b.apply(this,arguments)}function w(e){return _.apply(this,arguments)}function _(){return(_=v(m().mark((function e(t){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.a.templates.v2.destroy({id:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e,t){return O.apply(this,arguments)}function O(){return(O=v(m().mark((function e(t,r){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.a.templates.v2.findOne({id:t,usage:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t){return k.apply(this,arguments)}function k(){return(k=v(m().mark((function e(t,r){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.a.templates.v2.update({id:t,name:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e,t,r,n,o){return j.apply(this,arguments)}function j(){return j=v(m().mark((function e(t,r,n,o,i){var u,l,s,f=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=f.length>5&&void 0!==f[5]?f[5]:null,l=f.length>6&&void 0!==f[6]&&f[6],s={target_id:t,target_type:r,template_type:n,format:a.TYPE_FORMAT_MAP[o],type:o,name:i,in_edit:l},null!==u&&(s.doc_id=u),e.next=6,c.a.templates.v2.create(s);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)}))),j.apply(this,arguments)}function A(e){var t={lakesheet:"https://gw.alipayobjects.com/zos/bmw-prod/766284e3-a150-4438-a294-171a15cf216b.svg",laketable:"https://gw.alipayobjects.com/mdn/prod_resource/afts/img/A*W_NeRqkOsJsAAAAAAAAAAAAAARQnAQ",lake:"https://gw.alipayobjects.com/zos/bmw-prod/7c85db16-e017-4002-b37c-77dcf275d31f.svg",lakemind:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*R1-oT6osRqQAAAAAAAAAAAAAARQnAQ",lakeboard:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*R1-oT6osRqQAAAAAAAAAAAAAARQnAQ",lakeshow:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*-GRzR6CgSGUAAAAAAAAAAAAAARQnAQ"};return e.cover?e.cover:t[e.format]||t.lake}function L(e,t){return T.apply(this,arguments)}function T(){return(T=v(m().mark((function e(t,r){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.a.docs.findOne({book_id:r,id:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e,t,r){return P.apply(this,arguments)}function P(){return(P=v(m().mark((function e(t,r,n){var o,a,i,l,s;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(t,r);case 2:if(o=e.sent,a="/go/doc/".concat(o.id,"/edit"),"doc_toc"!==(null==n?void 0:n.create_from)){e.next=12;break}return i=o.id,e.next=8,c.a.docs.addToCatalog({ids:[i],book_id:t.id,target_node_uuid:n.toc_node_uuid,action:"prependChild"});case 8:return(l=new URLSearchParams).set("toc_node_uuid",n.toc_node_uuid),u.b.changeHref("".concat(a,"?").concat(l.toString())),e.abrupt("return");case 12:return s=o.id,e.next=15,c.a.docs.addToCatalog({ids:[s],book_id:t.id,target_node_uuid:null,action:"prependChild"});case 15:u.b.changeHref(a);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.book_id,r=e.group_id,n=e.include_personal,o=e.official_channel,i=[],c={limit:e.limit,format:e.format,include_types:""};return t&&(i.push(a.TEMPLATE_TYPE_MAP.BOOK),c.book_id=t),r&&(i.push(a.TEMPLATE_TYPE_MAP.GROUP),c.group_id=r),o&&(i.push(a.TEMPLATE_TYPE_MAP.OFFICIAL),c.official_channel=o),n&&i.push(a.TEMPLATE_TYPE_MAP.PERSONAL),i.length&&(c.include_types=i.join(",")),c}function R(){return I.apply(this,arguments)}function I(){return I=v(m().mark((function e(){var t,r,n,o,i,u=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},r=u.length>1&&void 0!==u[1]?u[1]:{},e.next=4,c.a.templates.v2.find(N(t));case 4:return n=e.sent,o=new URLSearchParams(window.location.search),i=o.has("isSupportTable"),r.isDesktop&&!i&&(n.data=n.data.filter((function(e){return e.format!==a.TYPE_FORMAT_MAP.Table}))),Array.isArray(n.meta.official)&&(n.meta.official=n.meta.official.map((function(e){return p(p({},e),{},{name:"en-us"!==r.locale?e.name_zh:e.name_en})}))),e.abrupt("return",n);case 10:case"end":return e.stop()}}),e)}))),I.apply(this,arguments)}function D(e){var t;return!(null==e||null===(t=e.abilities)||void 0===t||!t.create_doc)}function M(e){var t;return Boolean("Group"===(null==e?void 0:e.type)&&(null==e||null===(t=e.abilities)||void 0===t?void 0:t.read_private))}function F(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return{book_id:D(e)?e.id:void 0,group_id:M(t)?t.id:void 0,include_personal:r}}function G(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.filter((function(e){return!!i.MIXING_BOOK_TYPES.includes(e.type)}));return o()(t)?r:r.filter((function(e){return e.user_id===t.id}))}},1225:function(e,t,r){"use strict";r.r(t);var n=r(0);t.default=e=>n.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},e,{className:["larkui-icon","larkui-icon-home",e.className].filter(Boolean).join(" ")}),n.createElement("path",{d:"M12.734 14.844H7.266a.703.703 0 1 0 0 1.406h5.468a.703.703 0 1 0 0-1.406Zm0-2.813H7.266a.703.703 0 1 0 0 1.406h5.468a.703.703 0 1 0 0-1.406Zm5.698-4.433-8.02-5.616A.698.698 0 0 0 10 1.855a.698.698 0 0 0-.412.127l-8.02 5.616a.702.702 0 1 0 .807 1.15l.125-.086v8.799a.703.703 0 1 0 1.406 0V7.678L10 3.41l6.094 4.268v9.783a.703.703 0 1 0 1.406 0V8.662l.125.088a.704.704 0 0 0 .807-1.152Zm-5.698 1.62H7.266a.703.703 0 1 0 0 1.407h5.468a.703.703 0 1 0 0-1.406Z",fill:"currentColor",fillRule:"nonzero"}))},1226:function(e,t,r){"use strict";r.r(t);var n=r(0);t.default=e=>n.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},e,{className:["larkui-icon","larkui-icon-user",e.className].filter(Boolean).join(" ")}),n.createElement("path",{d:"M16.004 15.508a6.5 6.5 0 0 0-1.397-2.07 6.5 6.5 0 0 0-2.878-1.678 5.362 5.362 0 0 0 2.076-1.293 5.346 5.346 0 0 0 1.576-3.803 5.337 5.337 0 0 0-1.576-3.803 5.346 5.346 0 0 0-3.803-1.576 5.337 5.337 0 0 0-3.803 1.576 5.346 5.346 0 0 0-1.576 3.803c0 1.436.559 2.787 1.576 3.803a5.362 5.362 0 0 0 2.076 1.293 6.5 6.5 0 0 0-2.879 1.678 6.5 6.5 0 0 0-1.908 4.607.703.703 0 1 0 1.407 0c0-1.365.53-2.649 1.496-3.613a5.076 5.076 0 0 1 3.613-1.496c1.365 0 2.648.53 3.613 1.496a5.076 5.076 0 0 1 1.496 3.613.703.703 0 1 0 1.407 0 6.552 6.552 0 0 0-.516-2.537ZM10 10.637a3.977 3.977 0 0 1-3.973-3.973A3.977 3.977 0 0 1 10 2.691a3.977 3.977 0 0 1 3.973 3.973A3.976 3.976 0 0 1 10 10.637Z",fill:"currentColor",fillRule:"nonzero"}))},1241:function(e,t,r){"use strict";r(1347);var n=r(726);r(1341);t.a=n.a},1244:function(e,t,r){"use strict";r(650);var n=r(319),o=(r(60),r(14)),a=(r(498),r(100)),i=r(0),c=r.n(i),u=r(2),l=r.n(u),s=r(1225),f=r(1326),d=r(1226),p=r(1212),h=r(1210),m=r(230);r(1339);function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return v(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function g(e){var t,r,u=e.isOfficial,l=e.isDesktop,v=e.newTemplateName,g=e.onSetNewTemplateName,b=e.onSetSelectedScope,w=e.group,_=e.organization,E=l?w&&Object(m.f)(w):w&&Object(m.f)(w)&&(null===(t=w.abilities)||void 0===t?void 0:t.read_private),O=!!_,S=y(Object(i.useState)(E||O||u?0:1),2),k=S[0],x=S[1];r=E?[{header:__("本知识库可用"),icon:c.a.createElement(s.default,{width:20,height:20}),desc:__("仅在本知识库中可以使用"),type:0},{header:__("本团队可用"),icon:c.a.createElement(f.default,{width:20,height:20}),desc:__("成员在团队中新建文档时均可使用"),type:2},{header:__("仅自己可用"),icon:c.a.createElement(d.default,{width:20,height:20}),desc:__("可以在你参与的所有知识库中使用"),type:3}]:[{header:__("本知识库可用"),icon:c.a.createElement(s.default,{width:20,height:20}),desc:__("仅在本知识库中可以使用"),type:0},{header:__("仅自己可用"),icon:c.a.createElement(d.default,{width:20,height:20}),desc:__("可以在你参与的所有知识库中使用"),type:3}];var j=[{header:__("官方模板"),icon:c.a.createElement("img",{src:"https://gw.alipayobjects.com/mdn/prod_resource/afts/img/A*KnODQ5KXlh4AAAAAAAAAAABjAQAAAQ/original",alt:"语雀logo",height:20}),desc:__("所有知识库中都可以使用"),type:1}];u&&(r=j);var A=r[k];Object(i.useEffect)((function(){return b(r[k].type)}),[]);var L=c.a.createElement(a.a,null,r.map((function(e,t){var n=c.a.createElement("div",{"data-testid":"dropdown-item-".concat(e.type),className:"template-scope-menu-item"},c.a.createElement("div",{className:"template-scope-icon"},e.icon),c.a.createElement("div",{className:"template-scope-text"},c.a.createElement("h4",null,e.header),c.a.createElement("p",null,e.desc)),t===k&&c.a.createElement("div",{className:"template-scope-more-icon"},c.a.createElement(p.default,{width:20})));return c.a.createElement(a.a.Item,{key:e.header,onClick:function(){x(t),b(r[t].type)}},n)})));return c.a.createElement("div",{"data-testid":"creator-view",className:"template-creator-content"},c.a.createElement("p",null,__("模板名称")),c.a.createElement(o.a,{value:v||"",onChange:function(e){return g(e.target.value)},onFocus:function(e){return e.target.setSelectionRange(0,e.target.value.length)}}),c.a.createElement("p",null,__("可用范围")),c.a.createElement(n.a,{trigger:["click"],overlay:L},c.a.createElement("div",{"data-testid":"dropdown-trigger",className:"template-scope"},c.a.createElement("div",{className:"template-scope-icon"},A.icon),c.a.createElement("div",{className:"template-scope-text"},c.a.createElement("h4",null,A.header),c.a.createElement("p",null,A.desc)),c.a.createElement("div",{className:"template-scope-more-icon"},c.a.createElement(h.default,null)))))}g.defaultProps={isOfficial:!1},g.propTypes={newTemplateName:l.a.string,onSetNewTemplateName:l.a.func,onSetSelectedScope:l.a.func,isOfficial:l.a.bool,isDesktop:l.a.bool,group:l.a.object,organization:l.a.object},t.a=g},1248:function(e,t,r){"use strict";r(2964);var n=r(1262);r(1355);t.a=n.a},1250:function(e,t,r){"use strict";var n=r(3),o=r(0),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494z"}}]},name:"file",theme:"outlined"},i=r(17),c=function(e,t){return o.createElement(i.a,Object(n.a)(Object(n.a)({},e),{},{ref:t,icon:a}))};c.displayName="FileOutlined";t.a=o.forwardRef(c)},1252:function(e,t,r){"use strict";t.a={container:"index-module_container_bP9wV",userInfo:"index-module_userInfo_yk3wr",userInfoOnlyAvatar:"index-module_userInfoOnlyAvatar_d7S6E",userInfoOnlyAvatarExpand:"index-module_userInfoOnlyAvatarExpand_FbWOP",avatar:"index-module_avatar_y3R5A",loadingPlaceholder:"index-module_loadingPlaceholder_lV33B",value:"index-module_value_f2Swu",clearIcon:"index-module_clearIcon_86YPU",empty:"index-module_empty_An6D-",emptyImg:"index-module_emptyImg_txqYL",assigneeIds:"index-module_assigneeIds_ClfM1",transitionName:"index-module_transitionName_A13Iu",hidden:"index-module_hidden_1yhPl"}},1253:function(e,t,r){"use strict";r.d(t,"a",(function(){return g})),r.d(t,"d",(function(){return b})),r.d(t,"b",(function(){return w})),r.d(t,"c",(function(){return _}));r(1010);var n=r(712),o=(r(139),r(44)),a=(r(151),r(29)),i=(r(143),r(67)),c=r(329),u=r(0),l=r(5),s=r.n(l),f=r(46),d=r(628),p=r(1420),h=r(1345),m=r(436);function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function v(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==y(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===y(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var g=function(e){var t=e.item,r=e.size,n=void 0===r?20:r;if(null!=t&&t.icon)return React.createElement("img",{src:t.icon,width:n});switch(null==t?void 0:t.type){case"Book":case"Field":return React.createElement(f.b,{name:d.b.getName("Book",t),style:d.b.getStyle(t),className:"book-icon",width:20});case"Group":return React.createElement(p.a,{group:t,size:22,iconSize:20,radius:4});default:return null}},b=function(e){var t=e.isDisabled,r=e.isSelected,n=e.item,o=e.onClick,a=(null==t?void 0:t(n))||!1,u=r(n);return React.createElement(i.a,{title:a?__("默认助手，无法取消常用"):u?__("取消常用"):__("设为常用")},React.createElement(c.a,{onClick:o,type:"iconButton",className:s()(v({},m.a.disabledPin,a))},React.createElement(f.b,{name:u?"pin":"pin-outlined",size:16})))},w=function(e){var t=e.item,r=e.isSelected,n=e.isDisabled,i=e.onClick,u=e.iconSize,l=void 0===u?20:u;return t?React.createElement("div",{className:s()(m.a.listItem,"list-item"),style:{display:"block",height:"auto",padding:"12px 0"}},React.createElement(o.a,{gutter:16,align:"middle"},React.createElement(a.a,{span:4},React.createElement(g,{item:t,size:l})),React.createElement(a.a,{span:18},React.createElement(c.a,{style:{flex:"auto"}},React.createElement(c.a,{variant:"title",className:m.a.title},t.title||t.name,t.producer_name&&React.createElement(c.a,{variant:"caption-small",className:m.a.link},__("{name}提供",{name:React.createElement("a",{target:"_blank",href:t.producer_url},t.producer_name)}))),t.description&&React.createElement(c.a,{variant:"caption-small"},t.description))),React.createElement(a.a,{span:2},React.createElement(b,{item:t,isSelected:r,isDisabled:n,onClick:i})))):null},_=function(e){var t,r=e.onChange,o=e.searcher,a=e.minWidth,i=e.isSelected,c=e.isDisabled,l={group:__("团队"),book:"知识库"},f=Object(u.useMemo)((function(){return o.searchVal?React.createElement(h.a,{text:__("不存在该{type}",{type:l[e.type]}),minWidth:a}):null}),[o]);return React.createElement(n.a,{className:s()(m.a.userList,"ant-dropdown-menu"),direction:"vertical"},React.createElement(h.b,{spinning:o.loading,minWidth:a},!(null!==(t=o.state)&&void 0!==t&&t.length)&&!o.typing&&!o.loading&&f,((null==o?void 0:o.state)||[]).slice(0,20).map((function(e,t){return React.createElement(React.Fragment,null,React.createElement("div",{key:"".concat(e.id,"_").concat(e.type),className:s()(m.a.item),style:{minWidth:a}},React.createElement(w,{item:e,isSelected:i,isDisabled:c,onClick:function(){null==r||r(e),o.setLocalValue(e),o.clear(),o.setVisible(!1)}})),t<(null==o?void 0:o.state.length)-1&&React.createElement("div",{className:m.a.divider}))}))))}},1326:function(e,t,r){"use strict";r.r(t);var n=r(0);t.default=e=>n.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},e,{className:["larkui-icon","larkui-icon-team",e.className].filter(Boolean).join(" ")}),n.createElement("path",{d:"M17.057 12.45c.086-.446.13-.905.13-1.376A7.19 7.19 0 0 0 13 4.541a3.008 3.008 0 0 0-6 0 7.19 7.19 0 0 0-4.057 7.908 3.011 3.011 0 0 0-1.693 2.707 3.007 3.007 0 0 0 5.13 2.13 7.147 7.147 0 0 0 3.62.976c1.32 0 2.555-.356 3.62-.977a3.007 3.007 0 0 0 5.13-2.129c0-1.19-.691-2.218-1.693-2.707ZM10 3.163a1.601 1.601 0 1 1 0 3.203 1.601 1.601 0 0 1 0-3.203ZM4.258 16.758a1.601 1.601 0 1 1 0-3.203 1.601 1.601 0 0 1 0 3.203Zm8.476-1.602a3 3 0 0 0 .147.932 5.755 5.755 0 0 1-2.881.767 5.755 5.755 0 0 1-2.88-.767 3.01 3.01 0 0 0-2.8-3.94A5.784 5.784 0 0 1 7.25 5.986a3.01 3.01 0 0 0 5.498 0 5.784 5.784 0 0 1 2.932 6.162 3.01 3.01 0 0 0-2.948 3.008Zm3.008 1.602a1.601 1.601 0 1 1 0-3.203 1.601 1.601 0 0 1 0 3.203Z",fill:"currentColor",fillRule:"nonzero"}))},1333:function(e,t,r){"use strict";r.r(t);r(650);var n=r(319),o=(r(498),r(100)),a=(r(41),r(9)),i=r(0),c=r.n(i),u=r(2),l=r.n(u),s=r(5),f=r.n(s),d=r(46),p=r(59),h=r(24),m=r(1458),y=r(22),v="index-module_belongs_A3uam",g="index-module_meta_Jn6WP",b="index-module_truncation_g-6vp";function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function _(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return E(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return E(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function O(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==w(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==w(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===w(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var S={};S.Login=function(e){var t,r=e.goto,n=e.registerWithScene,o=r?"/login?goto=".concat(encodeURIComponent(r)):"/login",u=null===(t=document.querySelector('meta[name="pagename"]'))||void 0===t?void 0:t.getAttribute("content"),l=p.a.genCreateFromKey(h.CREATE_FROM.official_website_top_button);return n&&(o="/"===window.location.pathname||"/about"===window.location.pathname?"/login?register_with_scene=true&defaultType=org&register_from=".concat(l):"/login?register_with_scene=true&register_from=".concat(l)),Object(i.useEffect)((function(){Object(m.b)()}),[]),c.a.createElement(c.a.Fragment,null,"doc_read"===u?c.a.createElement(a.a,{onClick:function(e){y.g&&(e.preventDefault(),e.stopPropagation(),window.YuqueDesktopAppJSBridge.logout())},href:o,size:e.size,type:"primary","data-aspm-click":"d65962"},__("免费使用")):c.a.createElement(a.a,{onClick:function(e){y.g&&(e.preventDefault(),e.stopPropagation(),window.YuqueDesktopAppJSBridge.logout())},href:o,size:e.size,type:"primary","data-aspm-click":"d65962"},__("登录 / 注册")))},S.Login.propTypes={size:l.a.oneOf(["small","large"]),goto:l.a.string},S.Job=function(e){var t=e.user,r=e.truncation;if(t)return c.a.createElement("span",{className:f()(g,O({},b,r))},c.a.createElement(d.b,{name:"user-job",width:16,height:16}),c.a.createElement("span",null,t.job_title||__("未填写")))},S.Job.propTypes={user:l.a.object.isRequired,truncation:l.a.bool},S.Location=function(e){var t=e.user,r=e.truncation,n=e.size,o=void 0===n?16:n;return t=t||{},c.a.createElement("span",{className:f()(g,O({},b,r))},c.a.createElement(d.b,{name:"user-location",width:o,height:o}),c.a.createElement("span",null,t.location||__("未填写")))},S.Location.propTypes={size:l.a.object.number,user:l.a.object.isRequired,truncation:l.a.bool},S.Department=function(e){var t,r=e.user,n=e.truncation;if(r)return c.a.createElement("div",null,null!==(t=r.departments)&&void 0!==t&&t.length?r.departments.map((function(e){return c.a.createElement("span",{className:f()(g,O({},b,n))},c.a.createElement(d.b,{name:"department",width:16,height:16}),c.a.createElement("span",null,e))})):c.a.createElement("span",{className:f()(g,O({},b,n))},c.a.createElement(d.b,{name:"department",width:16,height:16}),c.a.createElement("span",null,r.department||__("未填写"))))},S.Department.propTypes={user:l.a.object.isRequired,truncation:l.a.bool},S.Link=function(e){var t=e.user,r=e.className;return c.a.createElement("a",{href:"/".concat(t.login),title:t.name,className:r},t.name)},S.Link.propTypes={user:l.a.object.isRequired,className:l.a.string},S.Name=function(e){var t=e.user,r=e.className;return c.a.createElement("span",{title:t.name,className:r},t.name)},S.Name.propTypes={user:l.a.object.isRequired,className:l.a.string};var k=function(e){var t=e.belongs,r=e.onChange,a=_(Object(i.useState)(__("管理员")),2),u=a[0],l=a[1];return c.a.createElement(n.a,{trigger:["click"],overlay:c.a.createElement(o.a,{className:"dashboard-dropdown-menu",selectedKeys:[]},t.map((function(e,t){return c.a.createElement(o.a.Item,{key:e.type},c.a.createElement("a",{href:"#",onClick:function(t){t.preventDefault(),function(e){r(e.type),l(e.text)}(e)}},e.text))})))},c.a.createElement("span",null,u,c.a.createElement("span",{className:f()("larkicon","larkicon-arrow-down",v)})))};k.propTypes={belongs:l.a.array.isRequired,onChange:l.a.func.isRequired},S.BelongMenu=k;t.default=S},1337:function(e,t,r){"use strict";r(2923);var n=r(1249);r(1505);t.a=n.a},1339:function(e,t,r){},1343:function(e,t,r){var n=r(2927),o=r(226),a=r(2928);e.exports=function(e){return o(e)?a(e):n(e)}},1344:function(e,t,r){"use strict";r.d(t,"c",(function(){return u})),r.d(t,"b",(function(){return l}));var n=r(0);function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=i(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){u=!0,a=e},f:function(){try{c||null==r.return||r.return()}finally{if(u)throw a}}}}function a(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function u(e){if(null!=e&&e.addEventListener){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];e.addEventListener.apply(e,a(r))}}function l(e){if(null!=e&&e.removeEventListener){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];e.removeEventListener.apply(e,a(r))}}var s=["mousedown","touchstart"];t.a=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s,a=Object(n.useRef)(t);Object(n.useEffect)((function(){a.current=t}),[t]),Object(n.useEffect)((function(){var t,n=function(t){var r=e.current;r&&!r.contains(t.target)&&a.current(t)},i=o(r);try{for(i.s();!(t=i.n()).done;){var c=t.value;u(document,c,n)}}catch(e){i.e(e)}finally{i.f()}return function(){var e,t=o(r);try{for(t.s();!(e=t.n()).done;){var a=e.value;l(document,a,n)}}catch(e){t.e(e)}finally{t.f()}}}),[r,e])}},1345:function(e,t,r){"use strict";r.d(t,"b",(function(){return l})),r.d(t,"a",(function(){return s}));r(279);var n=r(138),o=r(0),a=r(1252),i=r(1382),c=r(280),u=["https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*Pqd6T57ZpDMAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*3q2oSIsgEvYAAAAAAAAAAAAAARQnAQ"],l=function(e){var t=e.children,r=e.spinning,i=e.minWidth,c=o.Children.toArray(t).filter(o.isValidElement);return React.createElement(n.a,{spinning:r},c.length?c:React.createElement("div",{className:a.a.loadingPlaceholder,style:{minWidth:null!=i?i:290}}))},s=function(e){var t=e.text,r=e.minWidth;return React.createElement("div",{className:a.a.empty,style:{minWidth:r}},React.createElement(c.a,{className:a.a.emptyImg,src:u[0],darkSrc:u[1]}),React.createElement(i.a,{variant:"caption"},t))}},1382:function(e,t,r){"use strict";var n=r(329);r.d(t,"a",(function(){return n.a}))},1420:function(e,t,r){"use strict";var n=r(1421);r.d(t,"a",(function(){return n.a}))},1421:function(e,t,r){"use strict";var n=r(0),o=r.n(n),a=r(5),i=r.n(a),c=r(952),u=r(649),l=r(628),s=r(230),f=r(140);t.a=function(e){var t=window.appData.isPublicCloud,r=e.group,n=e.size,a=e.showOrgLabel,d=void 0!==a&&a,p=e.iconSize,h=e.radius,m=e.className,y=null==r?void 0:r.organization,v=(null==r?void 0:r.iconMap)||f.d;s.c.isPublicPage(r)&&(v[0]=f.f[0]);var g=l.b.getName("User",r)||v[0];return o.a.createElement("div",{className:i()("group-avatar",m),style:{width:"".concat(n,"px"),height:"".concat(n,"px")}},t&&d&&y&&o.a.createElement("span",{className:"lock"},o.a.createElement(u.c,{src:y.logo,size:n>32?20:13,radius:100})),r?o.a.createElement(c.a,{src:r.avatar||r.avatar_url||r.avatarUrl,size:n,className:i()({"group-type-default":g}),name:r.name,icon:g,iconSize:p||Math.floor(.9*n),radius:h}):o.a.createElement("span",{className:"default-group-avatar"},o.a.createElement("span",{className:"larkicon larkicon-group-avatar"})))}},1471:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n={TEMPLATE_USAGE:"c100045.d210978"}},150:function(e,t,r){e.exports=r(270)},1509:function(e,t,r){"use strict";r(2925);var n=r(976);r(1508);t.a=n.a},1513:function(e,t,r){"use strict";r.d(t,"b",(function(){return W}));r(73);var n=r(31),o=r(0),a=r.n(o),i=r(1238),c=r(98),u=r(5),l=r.n(u),s=r(1445),f=(r(41),r(9)),d=r(280),p="Activity-module_contentHtml_YXsAJ",h="Activity-module_title_qmKTC",m="Activity-module_bg_nXCHP",y="Activity-module_normalContainer_HmMNc",v="Activity-module_content_fRHS0",g="Activity-module_normalFooter_d7pbA",b="Activity-module_footerRight_4r2hD",w="Activity-module_buttonItem_ivUR7",_="Activity-module_otherLink_ImlX+",E="Activity-module_qrCodeContainer_I0s58",O="Activity-module_qrContent_88ama",S="Activity-module_qrContentHtml_qC4nd",k="Activity-module_qrFooter_sNSWT",x="Activity-module_qrImageContainer_KFTaP",j="Activity-module_qrImage_6pU6j",A="Activity-module_qrInfo_s5zGr";var L=function(e){var t=e.content,r=e.openUrl,n=e.onContainerClick,o=t.image,i=t.title,u=t.desc,s=t.otherButton,L=t.mainButton,T=t.viceButton,C=t.type,P=t.qrCodeImage;return C===c.a.qrCode?a.a.createElement("div",{className:E},a.a.createElement(d.a,{className:m,darkAlpha:.7,src:o,blurLoading:!0}),a.a.createElement("div",{className:l()(v,O),onClick:n},a.a.createElement("p",{className:h},t.title),a.a.createElement("div",{className:l()(p,S),dangerouslySetInnerHTML:{__html:u}})),a.a.createElement("div",{className:k},a.a.createElement("div",{className:x},a.a.createElement("img",{src:P,className:j})),a.a.createElement("p",{className:A},__("手机扫描二维码立刻查看")))):a.a.createElement("div",{className:y},a.a.createElement(d.a,{className:m,darkAlpha:.7,src:o,blurLoading:!0}),a.a.createElement("div",{className:v,onClick:n},a.a.createElement("p",{className:h},i),a.a.createElement("div",{className:p,dangerouslySetInnerHTML:{__html:u}})),a.a.createElement("div",{className:g},a.a.createElement("div",{className:b},a.a.createElement(f.a,{className:w,type:"primary",onClick:function(){r(L)}},null==L?void 0:L.title),T.title&&a.a.createElement(f.a,{className:w,onClick:function(){r(T)}},T.title)),s.title&&a.a.createElement("div",{className:_,onClick:function(){r(s)}},s.title)))},T={contentHtml:"Announcement-module_contentHtml_-L1wW",title:"Announcement-module_title_wB2-b",bg:"Announcement-module_bg_cRpBE",announcementContainer:"Announcement-module_announcementContainer_Ezu+h",bgImage:"Announcement-module_bgImage_QnLn6",iconImage:"Announcement-module_iconImage_9oXmv",announcementBodyContainer:"Announcement-module_announcementBodyContainer_xU05v",noIconTitle:"Announcement-module_noIconTitle_AwV3Z",announcementContentHtml:"Announcement-module_announcementContentHtml_sqbVd",announcementFooterContainer:"Announcement-module_announcementFooterContainer_cc+8b",buttonItem:"Announcement-module_buttonItem_4fd5R"};function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function P(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==C(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==C(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===C(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var N=function(e){var t,r=e.content,n=e.openUrl,o=e.onContainerClick,i=r.imageType,u=r.image,s=r.title,p=r.mainButton,h=r.viceButton,m=r.desc;return a.a.createElement("div",{className:T.announcementContainer},i!==c.b.none&&u&&a.a.createElement(d.a,{className:l()((t={},P(t,T.iconImage,i===c.b.icon),P(t,T.bgImage,i===c.b.bg),t)),blurLoading:i===c.b.bg,darkAlpha:.7,src:u}),a.a.createElement("div",{className:T.announcementBodyContainer},a.a.createElement("p",{className:l()(T.title,P({},T.noIconTitle,i===c.b.none))},s),a.a.createElement("div",{className:T.content,onClick:o},a.a.createElement("div",{className:"".concat(T.contentHtml," ").concat(T.announcementContentHtml),dangerouslySetInnerHTML:{__html:m}}))),a.a.createElement("div",{className:T.announcementFooterContainer},a.a.createElement(f.a,{className:T.buttonItem,type:"primary",onClick:function(){n(p)}},null==p?void 0:p.title),h.title&&a.a.createElement(f.a,{className:T.buttonItem,onClick:function(){n(h)}},h.title)))},R={closeContainer:"ActivityContent-module_closeContainer_4EyYi",close:"ActivityContent-module_close_qIdFs",lightCloseIcon:"ActivityContent-module_lightCloseIcon_w+ar9"};function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function D(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==I(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==I(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===I(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var M=function(e){var t=e.tip,r=e.read,n=e.onCancel,o=t.content,i=o.popupType===c.e.announcement&&o.imageType!==c.b.bg,u=function(e){"close"===e.target.getAttribute("data-action")&&(null==r||r())},f=function(e){var t,r,o=e.url,a=e.openType,i=void 0===a?c.d.href:a;(null==n||n(),o&&i!==c.d.close)&&(window.appData.isDesktopApp?null===(t=(r=window).openExternalLink)||void 0===t||t.call(r,o,!0):i!==c.d.open?window.location.href=o:window.open(o))};return a.a.createElement("div",{className:R.container,"data-testid":"tip-modal"},o.popupType===c.e.activity?a.a.createElement(L,{content:o,openUrl:f,onContainerClick:u}):a.a.createElement(N,{content:o,openUrl:f,onContainerClick:u}),a.a.createElement("div",{className:R.closeContainer,"data-testid":"tip-modal-close",onClick:function(){return null==r?void 0:r()}},a.a.createElement("span",{className:l()(R.close,D({},R.lightCloseIcon,i)),"data-aspm-click":"d188273"},a.a.createElement(s.default,{width:12,height:12}))))},F="index-module_modal_BOc7H";function G(e){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(e)}function U(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function B(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?U(Object(r),!0).forEach((function(t){q(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function q(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==G(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==G(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===G(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var V=/Macaca UI Robot/,z=function(e){return V.test(window.navigator.userAgent)||!e?null:Object(i.a)(e)},H=function(e){return e.popupType===c.e.announcement?452:424};var W=function(e){var t=e.tip,r=z(null==t?void 0:t.content);if(!r)return null;n.a.destroyAll();var o=H(r),i=function(){var t;c.destroy(),null===(t=e.read)||void 0===t||t.call(e)},c=n.a.info({className:F,width:o,title:null,icon:null,centered:!0,maskClosable:!0,onCancel:function(){var t;null===(t=e.read)||void 0===t||t.call(e)}});c.update({content:a.a.createElement(M,{tip:B(B({},t),{},{content:r}),read:i,onCancel:i})})};t.a=function(e){var t=e.visible,r=e.tip,o=z(null==r?void 0:r.content);if(!o)return null;var i=H(o),c=function(){var t,r;null===(t=e.read)||void 0===t||t.call(e),null===(r=e.onCancel)||void 0===r||r.call(e)};return a.a.createElement(n.a,{zIndex:1509,width:i,visible:t,footer:null,closable:!1,centered:!0,maskClosable:!0,className:F,onCancel:c},a.a.createElement(M,{tip:B(B({},r),{},{content:o}),onCancel:c,read:c}))}},1514:function(e,t,r){"use strict";r(41);var n=r(9),o=(r(456),r(203)),a=(r(1453),r(1327)),i=(r(37),r(10)),c=r(0),u=r.n(c),l=r(2),s=r.n(l),f=r(1408),d=r(181),p=r(5),h=r.n(p),m=r(46),y="index-module_coverUploaderWrapper_JM8NQ",v="index-module_miniCoverUploaderWrapper_VBkGu",g="index-module_cropper_FJZMe",b="index-module_miniCropperWrapper_kKArf",w="index-module_miniCropper_x-fcL",_="index-module_placeholderWrapper_I8JnT",E="index-module_miniPlaceholderWrapper_CXNui",O="index-module_placeholder_fRP2-",S="index-module_placeholderImg_RI3Xy",k="index-module_preview_0S38r",x="index-module_uploadWrapper_Lddj1",j="index-module_miniUploadWrapper_kA5F2",A="index-module_uploadAction_IvY3J",L="index-module_miniUploadAction_zkhyc",T="index-module_uploadBtn_3NoLt",C="index-module_clearBtn_Jvd1P",P="index-module_btnRemove_ewCeL",N="index-module_btnRemoveIcon_Kaa0G";function R(e){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R(e)}function I(){return I=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},I.apply(this,arguments)}function D(){D=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==R(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(R(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function M(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function F(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){M(a,n,o,i,c,"next",e)}function c(e){M(a,n,o,i,c,"throw",e)}i(void 0)}))}}function G(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,H(n.key),n)}}function U(e,t){return U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},U(e,t)}function B(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=V(e);if(t){var o=V(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===R(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return q(e)}(this,r)}}function q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function V(e){return V=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},V(e)}function z(e,t,r){return(t=H(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function H(e){var t=function(e,t){if("object"!==R(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==R(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===R(t)?t:String(t)}var W=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&U(e,t)}(p,e);var t,r,l,s=B(p);function p(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),z(q(t=s.call(this,e)),"onSubmit",F(D().mark((function e(){var r,n,o,a,c,u,l,s,f;return D().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.cropper){e.next=14;break}return e.prev=1,e.next=4,t.handleUpload();case 4:return r=e.sent,e.abrupt("return",null==r?void 0:r.url);case 8:e.prev=8,e.t0=e.catch(1),null!==(n=e.t0.xhr)&&void 0!==n&&n.response&&(a=JSON.parse(e.t0.xhr.response),c=window.__member_message_ref&&(null===(o=window.__member_message_ref.current)||void 0===o?void 0:o.getMessage(a.code,{isOwner:!0},a))||{},u=c.msg,l=c.alwaysOpen,s=c.level,f=c.callback,u?f(i.a[s||"info"](u,l?0:void 0)):i.a.error(__("封面上传失败，请重试"))),console.error(e.t0);case 12:e.next=15;break;case 14:return e.abrupt("return",t.state.cover);case 15:case"end":return e.stop()}}),e,null,[[1,8]])})))),z(q(t),"getUploadProps",(function(){return{beforeUpload:function(e){var r=t.props.fileSizeLimit;if(e.size/1024/1024>r)return i.a.error(__("图片大小不能超过 {size}M",{size:r})),!1;var n=new FileReader;return n.addEventListener("load",(function(){t.setState({cover:n.result}),t.coverRef.current.focus(),"function"==typeof t.props.beforeUpload&&t.props.beforeUpload(n.result)}),!1),e&&n.readAsDataURL(e),!1},showUploadList:!1,accept:"image/*"}})),z(q(t),"handleUpload",(function(){if(t.cropper){var e=t.cropper.getCroppedCanvas({imageSmoothingQuality:"high"});if(!e)throw new Error("can not get cropper");return new Promise((function(r,n){e.toBlob((function(e){var o=new FormData;t.props.attachable_type&&o.append("attachable_type",t.props.attachable_type),t.props.attachable_id&&o.append("attachable_id",t.props.attachable_id),o.append("file",e,"image.png"),o.append("ocr","off"),Object(d.ajax)({url:"/api/upload/attach",method:"POST",data:o,dataType:"json",processData:!1,success:function(e){r(e.data)},error:function(e){n(e)}})}),"image/png",1)}))}})),z(q(t),"handleRemoveImg",(function(){t.setState({cover:""});var e=t.props.onRemove;e&&"function"==typeof e&&e()})),z(q(t),"renderCropper",(function(){var e=t.props,r=e.miniMode,n=e.cropperStyle,i=e.aspectRatio,c=e.previewKey,l=e.placeholder,s=e.cropperClassName,f=e.getCropper,d=e.cropperCheckCrossOrigin,m=e.cropperCrossOrigin,y=t.state.cover,v=n.containerWidth,_=n.containerHeight,E=n.cropWidth;return r?u.a.createElement("div",{className:b},u.a.createElement("div",{className:h()(w,s)},u.a.createElement(o.a.Dragger,I({},t.getUploadProps(),{openFileDialogOnClick:!y}),y?u.a.createElement(a.a,{ref:function(e){t.cropper=e,f(t.cropper)},checkCrossOrigin:d,crossOrigin:m,src:y,containerWidth:263,containerHeight:_,aspectRatio:i,preview:c?".".concat(c):".image-preview",cropWidth:E}):u.a.createElement(p.MiniPlaceholder,{placeholder:l})))):u.a.createElement("div",{className:h()(g,s),"data-testid":"cover-uploader-cropper"},u.a.createElement(o.a.Dragger,I({},t.getUploadProps(),{openFileDialogOnClick:!y}),y?u.a.createElement(a.a,{ref:function(e){t.cropper=e,f(t.cropper)},checkCrossOrigin:d,crossOrigin:m,src:y,containerWidth:v,containerHeight:_,aspectRatio:i,preview:c?".".concat(c):".image-preview",cropWidth:E}):u.a.createElement(p.Placeholder,{placeholder:l})))})),z(q(t),"renderUploader",(function(){var e=t.props,r=e.miniMode,a=e.previewClassName,i=e.previewKey,c=e.buttonSize,l=t.state.cover;return r?u.a.createElement("div",{className:j},u.a.createElement("div",{className:L},u.a.createElement(o.a,t.getUploadProps(),l?u.a.createElement(n.a,{className:T},__("重新上传")):u.a.createElement(n.a,null,u.a.createElement(f.default,null),u.a.createElement("span",{className:"text"},__("上传图片")))),l&&u.a.createElement(n.a,{className:C,onClick:t.handleRemoveImg},__("清除")))):u.a.createElement("div",{className:x},l&&u.a.createElement("div",{className:h()("image-preview",k,a,i),"data-testid":"cover-uploader-previewKey"}),u.a.createElement("div",{className:A},u.a.createElement(o.a,t.getUploadProps(),l?u.a.createElement(n.a,{size:c},__("重新上传")):u.a.createElement(n.a,{size:c},u.a.createElement(f.default,null),u.a.createElement("span",{className:"text"},__("上传图片")))),l&&u.a.createElement("span",{className:P,onClick:t.handleRemoveImg},u.a.createElement("span",{className:N},u.a.createElement(m.b,{name:"icon-delete",width:16})),u.a.createElement("span",null,__("清除")))))}));var r=e.defaultPreviewImage,l=e.cover;return t.state={cover:l||r},t.coverRef=Object(c.createRef)(),t.cropper=null,t}return t=p,(r=[{key:"componentDidUpdate",value:function(e){e.cover!==this.props.cover&&this.setState({cover:this.props.cover})}},{key:"componentWillUnmount",value:function(){this.coverRef=null,this.cropper=null}},{key:"render",value:function(){var e=this.props.miniMode;return u.a.createElement("div",{className:h()(e?v:y,this.props.className),ref:this.coverRef,tabIndex:"-1"},this.renderCropper(),this.renderUploader())}}])&&G(t.prototype,r),l&&G(t,l),Object.defineProperty(t,"prototype",{writable:!1}),p}(c.Component);W.Placeholder=function(e){var t=e.placeholder;return u.a.createElement("div",{className:_},u.a.createElement("div",{className:O},u.a.createElement("div",{className:S}),u.a.createElement("p",null,t||__("添加封面有助于吸引读者"))))},W.MiniPlaceholder=function(e){var t=e.placeholder;return u.a.createElement("div",{className:E},u.a.createElement("div",{className:O},u.a.createElement("div",{className:S}),u.a.createElement("p",null,t||__("添加封面有助于吸引读者"))))},W.Placeholder.propTypes={placeholder:s.a.string},W.propTypes={cover:s.a.string,beforeUpload:s.a.func,aspectRatio:s.a.number,cropperStyle:s.a.shape({containerWidth:s.a.number,containerHeight:s.a.number,cropWidth:s.a.number}),defaultPreviewImage:s.a.string,fileSizeLimit:s.a.number,cropperClassName:s.a.string,previewClassName:s.a.string,previewKey:s.a.string,onRemove:s.a.func,placeholder:s.a.string,attachable_type:s.a.string,attachable_id:s.a.number,miniMode:s.a.bool,getCropper:s.a.func,cropperCheckCrossOrigin:s.a.bool,cropperCrossOrigin:s.a.oneOf(["anonymous","use-credentials"]),buttonSize:s.a.oneOf(["large","middle","small"])},W.defaultProps={cropperStyle:{containerWidth:240,containerHeight:150,cropWidth:400},aspectRatio:1.6,fileSizeLimit:20,getCropper:function(){},cropperCheckCrossOrigin:!0,buttonSize:"middle"};t.a=W},1519:function(e,t,r){"use strict";var n=r(58),o=r.n(n),a=r(86),i=r.n(a),c=r(83),u=r.n(c),l=r(1020),s=r.n(l),f=r(175),d=r.n(f),p=r(135),h=r.n(p),m=r(0),y=r(5),v=r.n(y),g=r(1562),b=(r(2933),r(1522),["options","block","size","className","onChange","multiple"]),w=["icon","label"];function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){u()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var O=function(e){var t=e.className,r=e.options,n=e.value,o=e.defaultValue,a=void 0===o?[]:o,i=e.onChange,c=m.useState(n||a),l=d()(c,2),f=l[0],p=l[1],h=function(e){var t,r=e.target.value;t=f.includes(r)?f.filter((function(e){return e!==r})):[].concat(s()(f),[r]),p(t),null==i||i(t)};return m.createElement("div",{className:v()("rc-segmented",t)},m.createElement("div",{className:"rc-segmented-group"},r.map((function(e){return m.createElement("label",{className:v()("rc-segmented-item",u()({},"rc-segmented-item-selected",f.includes(e.value))),key:e.value},m.createElement("input",{className:"rc-segmented-item-input",type:"checkbox",value:e.value,checked:f.includes(e.value),onChange:h}),m.createElement("div",{className:"rc-segmented-item-label"},e.label))}))))},S=m.forwardRef((function(e,t){var r=e.options,n=e.block,a=e.size,c=e.className,l=e.onChange,s=e.multiple,f=i()(e,b),d=m.useMemo((function(){return r.map((function(e){if(function(e){return!("object"!==h()(e)||null==e||!e.icon)}(e)){var t=e,r=t.icon,n=void 0===r?void 0:r,o=t.label;return E(E({},i()(t,w)),{},{label:m.createElement("div",{className:"larkui-segmented-label"},m.createElement("span",null,n),o&&m.createElement("span",null,o))})}return e}))}),[r]);return s?m.createElement(O,{value:e.value,defaultValue:e.defaultValue,className:v()("larkui-segmented","larkui-segmented-".concat(a),"larkui-segemented-multiple",c,u()({},"larkui-segmented-block",n)),options:d,onChange:function(e){return null==l?void 0:l(e)}}):m.createElement(g.a,o()({},f,{className:v()("larkui-segmented","larkui-segmented-".concat(a),c,u()({},"larkui-segmented-block",n)),options:d,onChange:function(e){return null==l?void 0:l(e)},ref:t}))}));t.a=S},1525:function(e,t,r){"use strict";r(720);var n=r(464);r(1541);t.a=n.a},1527:function(e,t,r){var n=r(2926),o=r(335),a=r(336),i=r(226),c=r(1343),u=r(333),l=Math.ceil;e.exports=function(e,t){var r=(t=void 0===t?" ":o(t)).length;if(r<2)return r?n(t,e):t;var s=n(t,l(e/c(t)));return i(t)?a(u(s),0,e).join(""):s.slice(0,e)}},1529:function(e,t,r){"use strict";var n=r(3),o=r(0),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M328 544h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}},{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"minus-square",theme:"outlined"},i=r(17),c=function(e,t){return o.createElement(i.a,Object(n.a)(Object(n.a)({},e),{},{ref:t,icon:a}))};c.displayName="MinusSquareOutlined";t.a=o.forwardRef(c)},1530:function(e,t,r){"use strict";var n=r(3),o=r(0),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M328 544h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}},{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"plus-square",theme:"outlined"},i=r(17),c=function(e,t){return o.createElement(i.a,Object(n.a)(Object(n.a)({},e),{},{ref:t,icon:a}))};c.displayName="PlusSquareOutlined";t.a=o.forwardRef(c)},1531:function(e,t,r){"use strict";var n=r(3),o=r(0),a={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M840.4 300H183.6c-19.7 0-30.7 20.8-18.5 35l328.4 380.8c9.4 10.9 27.5 10.9 37 0L858.9 335c12.2-14.2 1.2-35-18.5-35z"}}]},name:"caret-down",theme:"filled"},i=r(17),c=function(e,t){return o.createElement(i.a,Object(n.a)(Object(n.a)({},e),{},{ref:t,icon:a}))};c.displayName="CaretDownFilled";t.a=o.forwardRef(c)},1532:function(e,t,r){"use strict";var n=r(3),o=r(0),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 444H820V330.4c0-17.7-14.3-32-32-32H473L355.7 186.2a8.15 8.15 0 00-5.5-2.2H96c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h698c13 0 24.8-7.9 29.7-20l134-332c1.5-3.8 2.3-7.9 2.3-12 0-17.7-14.3-32-32-32zM136 256h188.5l119.6 114.4H748V444H238c-13 0-24.8 7.9-29.7 20L136 643.2V256zm635.3 512H159l103.3-256h612.4L771.3 768z"}}]},name:"folder-open",theme:"outlined"},i=r(17),c=function(e,t){return o.createElement(i.a,Object(n.a)(Object(n.a)({},e),{},{ref:t,icon:a}))};c.displayName="FolderOpenOutlined";t.a=o.forwardRef(c)},1533:function(e,t,r){"use strict";var n=r(3),o=r(0),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 298.4H521L403.7 186.2a8.15 8.15 0 00-5.5-2.2H144c-17.7 0-32 14.3-32 32v592c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V330.4c0-17.7-14.3-32-32-32zM840 768H184V256h188.5l119.6 114.4H840V768z"}}]},name:"folder",theme:"outlined"},i=r(17),c=function(e,t){return o.createElement(i.a,Object(n.a)(Object(n.a)({},e),{},{ref:t,icon:a}))};c.displayName="FolderOutlined";t.a=o.forwardRef(c)},1545:function(e,t,r){var n=r(1527),o=r(1343),a=r(1198),i=r(117);e.exports=function(e,t,r){e=i(e);var c=(t=a(t))?o(e):0;return t&&c<t?n(t-c,r)+e:e}},1558:function(e,t,r){"use strict";var n=r(3),o=r(0),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M890.5 755.3L537.9 269.2c-12.8-17.6-39-17.6-51.7 0L133.5 755.3A8 8 0 00140 768h75c5.1 0 9.9-2.5 12.9-6.6L512 369.8l284.1 391.6c3 4.1 7.8 6.6 12.9 6.6h75c6.5 0 10.3-7.4 6.5-12.7z"}}]},name:"up",theme:"outlined"},i=r(17),c=function(e,t){return o.createElement(i.a,Object(n.a)(Object(n.a)({},e),{},{ref:t,icon:a}))};c.displayName="UpOutlined";t.a=o.forwardRef(c)},1569:function(e,t,r){"use strict";var n=r(3),o=r(0),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"},i=r(17),c=function(e,t){return o.createElement(i.a,Object(n.a)(Object(n.a)({},e),{},{ref:t,icon:a}))};c.displayName="EditOutlined";t.a=o.forwardRef(c)},1570:function(e,t,r){"use strict";var n=r(3),o=r(0),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2L263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"}}]},name:"copy",theme:"outlined"},i=r(17),c=function(e,t){return o.createElement(i.a,Object(n.a)(Object(n.a)({},e),{},{ref:t,icon:a}))};c.displayName="CopyOutlined";t.a=o.forwardRef(c)},1571:function(e,t,r){"use strict";var n=r(3),o=r(0),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 170h-60c-4.4 0-8 3.6-8 8v518H310v-73c0-6.7-7.8-10.5-13-6.3l-141.9 112a8 8 0 000 12.6l141.9 112c5.3 4.2 13 .4 13-6.3v-75h498c35.3 0 64-28.7 64-64V178c0-4.4-3.6-8-8-8z"}}]},name:"enter",theme:"outlined"},i=r(17),c=function(e,t){return o.createElement(i.a,Object(n.a)(Object(n.a)({},e),{},{ref:t,icon:a}))};c.displayName="EnterOutlined";t.a=o.forwardRef(c)},1581:function(e,t,r){var n=r(1527),o=r(1343),a=r(1198),i=r(117);e.exports=function(e,t,r){e=i(e);var c=(t=a(t))?o(e):0;return t&&c<t?e+n(t-c,r):e}},1858:function(e,t,r){"use strict";r.r(t);var n=r(0);t.default=e=>n.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 256 256",xmlns:"http://www.w3.org/2000/svg"},e,{className:["larkui-icon","larkui-icon-information",e.className].filter(Boolean).join(" ")}),n.createElement("path",{d:"M128.5 15.5c62.408 0 113 50.592 113 113s-50.592 113-113 113-113-50.592-113-113 50.592-113 113-113Zm0 20c-51.362 0-93 41.638-93 93s41.638 93 93 93 93-41.638 93-93-41.638-93-93-93ZM131 113c5.523 0 10 4.477 10 10v62c0 5.523-4.477 10-10 10s-10-4.477-10-10v-52h-6c-5.523 0-10-4.477-10-10s4.477-10 10-10h16Zm-3-44c7.732 0 14 6.268 14 14s-6.268 14-14 14-14-6.268-14-14 6.268-14 14-14Z",fill:"currentColor",fillRule:"nonzero"}))},1859:function(e,t,r){"use strict";r.r(t);var n=r(0);t.default=e=>n.createElement("svg",Object.assign({viewBox:"64 64 896 896",fill:"currentColor",width:"1em",height:"1em",xmlns:"http://www.w3.org/2000/svg"},e,{className:["larkui-icon","larkui-icon-antd-warning",e.className].filter(Boolean).join(" ")}),n.createElement("path",{d:"M464 720a48 48 0 1 0 96 0 48 48 0 1 0-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8zm475.7 440-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z"}))},1861:function(e,t,r){"use strict";r.r(t);var n=r(0);t.default=e=>n.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 14 14",xmlns:"http://www.w3.org/2000/svg"},e,{className:["larkui-icon","larkui-icon-warning",e.className].filter(Boolean).join(" ")}),n.createElement("path",{d:"M7 0a7 7 0 0 1 7 7 7 7 0 0 1-7 7 7 7 0 0 1-7-7 7 7 0 0 1 7-7Zm.438 10.938a.437.437 0 1 0-.875-.001.437.437 0 0 0 .875 0Zm0-1.75V3.061a.437.437 0 1 0-.875 0v6.126a.437.437 0 1 0 .875 0Z",fill:"#FAAD14",fillRule:"evenodd"}))},1863:function(e,t,r){"use strict";r.r(t);var n=r(0);t.default=e=>n.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},e,{className:["larkui-icon","larkui-icon-icon-public",e.className].filter(Boolean).join(" ")}),n.createElement("g",{fill:"none",fillRule:"evenodd"},n.createElement("path",{d:"M0 0h16v16H0z"}),n.createElement("path",{d:"M8 1.487a6.513 6.513 0 1 1 0 13.026A6.513 6.513 0 0 1 8 1.487Zm5.005 8.765-.029.003c-.223.042-.491.213-.875.54l-.53.465-.196.166-.082.066-.144.107c-.044.03-.086.056-.126.078l-.12.06-.13.049a1.162 1.162 0 0 1-.447.08c-.578-.011-.863-.24-1.08-.693l-.073-.163c-.075-.18-.091-.199-.169-.22-.359-.094-1.08.61-1.212 1.37-.054.315-.008.488.204.797l.155.216c.083.112.151.21.21.302a5.489 5.489 0 0 0 4.644-3.223ZM8.46 2.532l.022.046c.108.26.139.533.055.775-.062.181-.15.31-.293.462l-.266.261c-.068.07-.08.097-.08.122.002.058.09.132.35.234l.2.072.255.08.317.09c1.615.442 1.65 2.616-.231 3.395-1.288.534-2.074.239-2.707-.647L5.92 7.18l-.145-.221c-.222-.315-.835-.451-1.057-.3l-.005.009-.045.114-.051.152-.068.216-.1.348-.099.308c-.226.66-.454.9-1.005.865-.335-.022-.581-.148-.823-.39a5.486 5.486 0 0 0 4.543 5.126c-.289-.46-.382-.85-.283-1.422.221-1.283 1.432-2.465 2.484-2.187.408.108.617.316.79.672l.127.293c.032.069.05.075.117.076l.064-.001.062-.02.071-.03.079-.048.096-.07.124-.1.256-.22.231-.204c.819-.725 1.394-1.052 2.065-.914a5.488 5.488 0 0 0-4.889-6.701Zm-1.323.047c-2.224.355-4 2.04-4.49 4.211a.497.497 0 0 1 .025.028l.099.125.222.303c.132.181.229.291.304.349l.022.015.017-.033.051-.127.057-.172.132-.452.092-.296c.131-.391.242-.56.475-.719.7-.475 1.937-.2 2.471.558l.235.358c.402.61.705.744 1.547.395 1.007-.417.993-1.283.354-1.457l-.204-.057-.367-.113c-.913-.302-1.29-.622-1.306-1.27-.01-.377.11-.6.394-.889l.204-.199.07-.075a.157.157 0 0 0 .026-.042c.018-.053-.26-.413-.43-.441Z",fill:"currentColor",fillRule:"nonzero"})))},1864:function(e,t,r){"use strict";r.r(t);var n=r(0);t.default=e=>n.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},e,{className:["larkui-icon","larkui-icon-icon-lock",e.className].filter(Boolean).join(" ")}),n.createElement("defs",null,n.createElement("path",{id:"2932495269a",d:"M0 0h20v20H0z"})),n.createElement("g",{fill:"none",fillRule:"evenodd"},n.createElement("mask",{id:"2932495269b",fill:"#fff"},n.createElement("use",{xlinkHref:"#2932495269a"})),n.createElement("g",{mask:"url(#2932495269b)",fill:"#FFF",fillRule:"nonzero"},n.createElement("path",{d:"M10 1.172a4.219 4.219 0 0 1 4.219 4.219l-.001 1.874h1.407c1.036 0 1.875.84 1.875 1.876v7.812c0 1.036-.84 1.875-1.875 1.875H4.375A1.875 1.875 0 0 1 2.5 16.953V9.141c0-1.036.84-1.875 1.875-1.875l1.406-.001V5.39A4.219 4.219 0 0 1 10 1.17Zm5.64 7.657H4.376a.313.313 0 0 0-.312.296v7.828c0 .167.131.304.296.312h11.266a.313.313 0 0 0 .312-.296V9.14a.313.313 0 0 0-.296-.312ZM10 10.78a1.406 1.406 0 0 1 .782 2.575v1.175a.781.781 0 1 1-1.563 0l-.001-1.175A1.405 1.405 0 0 1 10 10.781Zm.044-8.046H10a2.656 2.656 0 0 0-2.656 2.612v1.919h5.312V5.39a2.656 2.656 0 0 0-2.612-2.656Z"}))))},1865:function(e,t,r){"use strict";r.r(t);var n=r(0);t.default=e=>n.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 256 256",xmlns:"http://www.w3.org/2000/svg"},e,{className:["larkui-icon","larkui-icon-icon-qrcode2",e.className].filter(Boolean).join(" ")}),n.createElement("g",{fill:"none",fillRule:"evenodd"},n.createElement("path",{d:"M0 0h256v256H0z"}),n.createElement("path",{d:"M122.353 133.647v73.412c0 9.353-7.588 16.941-16.941 16.941h-56.47C39.587 224 32 216.412 32 207.059v-56.47c0-9.354 7.588-16.942 16.941-16.942h73.412Zm45.176-.224L167.52 160l22.56-.001v-26.576H224v33.92l-29.185-.016v20.672L224 188v33.92h-33.92v-29.921h-22.513v29.921h-33.92V188l29.168-.001.001-20.703-29.169.01v-33.883h33.882Zm-62.794 17.842H49.618v55.117h55.117v-55.117ZM105.412 32c9.353 0 16.94 7.588 16.94 16.941v73.412h-73.41c-9.354 0-16.942-7.588-16.942-16.941v-56.47C32 39.587 39.588 32 48.941 32h56.47Zm101.647 0C216.412 32 224 39.588 224 48.941v56.47c0 9.354-7.588 16.942-16.941 16.942h-73.412V48.94c0-9.353 7.588-16.941 16.941-16.941h56.47ZM104.735 49.618H49.618v55.117h55.117V49.618Zm101.647 0h-55.117v55.117h55.117V49.618Z",fill:"currentColor",fillRule:"nonzero"})))},1871:function(e,t,r){"use strict";r.r(t);var n=r(0);t.default=e=>n.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 256 256",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},e,{className:["larkui-icon","larkui-icon-review-arrow-up",e.className].filter(Boolean).join(" ")}),n.createElement("defs",null,n.createElement("path",{id:"779936003a",d:"M0 0h256v256H0z"})),n.createElement("g",{transform:"matrix(1 0 0 -1 0 256)",fill:"none",fillRule:"evenodd"},n.createElement("mask",{id:"779936003b",fill:"#fff"},n.createElement("use",{xlinkHref:"#779936003a"})),n.createElement("path",{d:"M181.1 118.925 135 165.096a9.889 9.889 0 0 1-14 0l-46.1-46.17c-3.866-3.873-3.866-10.15 0-14.022a9.892 9.892 0 0 1 7-2.904h92.2c5.468 0 9.9 4.439 9.9 9.915a9.922 9.922 0 0 1-2.9 7.01Z",fill:"currentColor",fillRule:"nonzero",mask:"url(#779936003b)"})))},1873:function(e,t,r){"use strict";r.r(t);var n=r(0);t.default=e=>n.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 256 256",xmlns:"http://www.w3.org/2000/svg"},e,{className:["larkui-icon","larkui-icon-new-tab-outlined",e.className].filter(Boolean).join(" ")}),n.createElement("g",{fill:"currentColor",fillRule:"evenodd"},n.createElement("rect",{transform:"rotate(45 150.929 105.071)",x:140.929,y:20.071,width:20,height:170,rx:10}),n.createElement("path",{d:"M83.705 28c5.523 0 10 4.477 10 10 0 5.43-4.327 9.848-9.72 9.996l-.28.004H58c-5.43 0-9.848 4.327-9.996 9.72L48 58v140c0 5.43 4.327 9.848 9.72 9.996L58 208h140c5.43 0 9.848-4.327 9.996-9.72L208 198v-22.997c0-5.522 4.477-10 10-10 5.43 0 9.848 4.327 9.996 9.72l.004.28V198c0 16.403-13.164 29.731-29.504 29.996L198 228H58c-16.403 0-29.731-13.164-29.996-29.504L28 198V58c0-16.403 13.164-29.731 29.504-29.996L58 28h25.705ZM198.047 28c16.403 0 29.732 13.164 29.996 29.504l.004.496v50c0 5.523-4.477 10-10 10-5.429 0-9.847-4.327-9.996-9.72l-.004-.28V58c0-5.43-4.326-9.848-9.72-9.996l-.28-.004h-50c-5.522 0-10-4.477-10-10 0-5.43 4.327-9.848 9.72-9.996l.28-.004h50Z",fillRule:"nonzero"})))},1874:function(e,t,r){"use strict";r.r(t);var n=r(0);t.default=e=>n.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 256 256",xmlns:"http://www.w3.org/2000/svg"},e,{className:["larkui-icon","larkui-icon-import",e.className].filter(Boolean).join(" ")}),n.createElement("path",{d:"M198 28c16.403 0 29.731 13.146 29.996 29.463l.004.496v20.194c0 5.515-4.477 9.986-10 9.986-5.43 0-9.848-4.32-9.996-9.706l-.004-.28V57.96c0-5.422-4.327-9.835-9.72-9.983l-.28-.004H58c-5.43 0-9.848 4.321-9.996 9.707l-.004.28v139.807c0 5.421 4.327 9.834 9.72 9.982l.28.004h140c5.43 0 9.848-4.321 9.996-9.707l.004-.28v-20.15c0-5.515 4.477-9.986 10-9.986 5.43 0 9.848 4.32 9.996 9.707l.004.28v20.15c0 16.38-13.164 29.69-29.504 29.954l-.496.004H58c-16.403 0-29.731-13.146-29.996-29.463l-.004-.495V57.959c0-16.38 13.164-29.69 29.504-29.955L58 28h140Zm-79.03 49.72c3.92-3.695 10.093-3.625 13.927.209 3.905 3.905 3.905 10.237 0 14.142l-26.124 26.123L209.388 118l.28.003c5.394.138 9.729 4.549 9.74 9.978.01 5.523-4.459 10.008-9.982 10.019l-102.485.194 26.333 26.333.21.215c3.694 3.92 3.625 10.093-.21 13.927-3.905 3.905-10.236 3.905-14.142 0l-29.345-29.346-.348-.353c-11.367-11.741-11.25-30.474.348-42.073l28.968-28.968Z",fill:"currentColor",fillRule:"nonzero"}))},1875:function(e,t,r){"use strict";r.r(t);var n=r(0);t.default=e=>n.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 256 256",xmlns:"http://www.w3.org/2000/svg"},e,{className:["larkui-icon","larkui-icon-expand",e.className].filter(Boolean).join(" ")}),n.createElement("path",{d:"M50 116c5.43 0 9.848 4.327 9.996 9.72L60 126v63.158c0 3.7 2.937 6.714 6.607 6.838l.235.004H130c5.523 0 10 4.477 10 10 0 5.43-4.327 9.848-9.72 9.996L130 216H66.842c-14.676 0-26.601-11.778-26.838-26.398l-.004-.444V126c0-5.523 4.477-10 10-10Zm139.658-75.5c14.676 0 26.601 11.778 26.838 26.398l.004.444V130.5c0 5.523-4.477 10-10 10-5.43 0-9.848-4.327-9.996-9.72l-.004-.28V67.342c0-3.7-2.937-6.714-6.607-6.838l-.235-.004H126.5c-5.523 0-10-4.477-10-10 0-5.43 4.327-9.848 9.72-9.996l.28-.004h63.158Z",fill:"currentColor",fillRule:"nonzero"}))},1877:function(e,t,r){"use strict";r.r(t);var n=r(0);t.default=e=>n.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 256 256",xmlns:"http://www.w3.org/2000/svg"},e,{className:["larkui-icon","larkui-icon-editor-mention",e.className].filter(Boolean).join(" ")}),n.createElement("g",{fill:"currentColor",fillRule:"nonzero"},n.createElement("path",{d:"M126.176 69.924c20.217-3.751 43.414 7.895 50.835 23.78 2.337 5.003.176 10.955-4.828 13.292-4.917 2.298-10.75.25-13.168-4.571l-.124-.256c-3.529-7.554-17.731-14.684-29.067-12.58-6.744 1.25-14.801 5.795-21.456 12.497-7.497 7.55-12.556 17.05-14.134 27.418-1.586 10.42-.485 18 2.721 23.807 2.581 4.673 6.59 8.417 12.855 12.37 3.404 2.148 10.347 2.486 17.518.248 7.854-2.452 14.36-7.386 17.748-13.726l.204-.39c2.507-4.92 8.53-6.877 13.45-4.37 4.92 2.508 6.877 8.53 4.37 13.45-11.8 23.156-45.16 33.569-63.964 21.702-8.869-5.597-15.224-11.53-19.688-19.616-5.46-9.885-7.205-21.907-4.986-36.483 4.334-28.481 27.828-52.14 51.714-56.572Z"}),n.createElement("path",{d:"M133.072 18.737c24.705.303 47.9 7.613 64.769 21.918 17.012 14.425 24.756 34.704 24.65 57.85-.08 17.544-4.865 36.077-11.702 49.385-5.818 11.324-16.494 22.142-27.87 28.853-5.863 3.458-11.686 5.684-17.07 6.298-7.316.835-13.975-1.319-18.238-7.049-2.774-3.728-3.868-8.593-3.593-15.03l.044-.848.028-.43.066-.876.04-.445.089-.903.104-.922.058-.468.126-.95.069-.482.148-.98c.052-.33.106-.662.163-.998l.176-1.019c.062-.342.125-.689.191-1.038l.205-1.059.218-1.078.232-1.1.245-1.12.259-1.142.271-1.162.285-1.184.45-1.817.32-1.25.51-1.936.543-1.993.38-1.36.395-1.386.41-1.411.425-1.436.44-1.462.686-2.24.476-1.526.49-1.55.506-1.576.786-2.412.819-2.469.852-2.526.586-1.716.908-2.622.94-2.68.974-2.736 1.007-2.795 1.04-2.852 1.073-2.91 1.107-2.967 1.14-3.025 1.172-3.082 1.206-3.141.822-2.126 1.262-3.237c2.012-5.144 7.813-7.682 12.956-5.67 5.143 2.013 7.681 7.814 5.669 12.957l-1.607 4.13-1.169 3.033-1.136 2.975-.74 1.952-1.082 2.88-1.051 2.825-1.351 3.677-.976 2.692-.944 2.635-.912 2.578-.59 1.687-.576 1.662-.837 2.445-.805 2.388-.773 2.33-.498 1.523-.483 1.497-.469 1.47-.454 1.447-.655 2.12-.42 1.383-.404 1.357-.39 1.33-.56 1.95-.354 1.267-.34 1.242-.326 1.216-.312 1.19-.321 1.258-.325 1.316-.306 1.277-.285 1.24-.265 1.2-.246 1.162-.225 1.123a96.766 96.766 0 0 0-.3 1.611l-.176 1.025c-.028.168-.055.334-.08.498l-.146.966-.127.925a45.088 45.088 0 0 0-.286 2.922 28.11 28.11 0 0 0-.056 1.486v.412l.095-.015c2.139-.364 5.03-1.499 8.218-3.333l.417-.243c8.244-4.863 16.229-12.955 20.243-20.767 5.437-10.582 9.426-26.035 9.492-40.337.08-17.644-5.5-32.256-17.586-42.504-13-11.024-31.719-16.924-52.078-17.173-18.416-.225-36.035 4.346-45.923 11.44-.537.386-1.068.77-1.593 1.15l-1.557 1.141a225.894 225.894 0 0 0-5.174 3.931l-1.403 1.11C66.312 66.192 58.396 74.544 51.843 85.03c-11.245 17.996-15.712 39.438-11.739 66.021 3.818 25.55 17.285 43.182 38.353 54.378 16.423 8.727 36.69 12.926 54.815 12.926 27.741 0 58.302-13.292 75.24-32.426 3.661-4.135 9.981-4.52 14.116-.86 4.136 3.662 4.52 9.981.86 14.117-20.799 23.494-56.838 39.169-90.216 39.169-21.176 0-44.612-4.855-64.2-15.265-26.447-14.054-43.95-36.971-48.748-69.083-4.677-31.295.79-57.543 14.559-79.576 9.083-14.535 19.999-25.327 35.361-36.84l1.634-1.214c.55-.406 1.105-.813 1.667-1.221l1.701-1.229c13.686-9.819 35.437-15.462 57.826-15.189Z"})))},243:function(e,t,r){"use strict";r(2932);var n=r(1254);r(662);t.a=n.a},2926:function(e,t){var r=Math.floor;e.exports=function(e,t){var n="";if(!e||t<1||t>9007199254740991)return n;do{t%2&&(n+=e),(t=r(t/2))&&(e+=e)}while(t);return n}},2927:function(e,t,r){var n=r(640)("length");e.exports=n},2928:function(e,t){var r="\\ud800-\\udfff",n="["+r+"]",o="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",a="\\ud83c[\\udffb-\\udfff]",i="[^"+r+"]",c="(?:\\ud83c[\\udde6-\\uddff]){2}",u="[\\ud800-\\udbff][\\udc00-\\udfff]",l="(?:"+o+"|"+a+")"+"?",s="[\\ufe0e\\ufe0f]?",f=s+l+("(?:\\u200d(?:"+[i,c,u].join("|")+")"+s+l+")*"),d="(?:"+[i+o+"?",o,c,u,n].join("|")+")",p=RegExp(a+"(?="+a+")|"+d+f,"g");e.exports=function(e){for(var t=p.lastIndex=0;p.test(e);)++t;return t}},2929:function(e,t,r){"use strict";var n=r(1507),o=r(4),a=r(6),i=r(7),c=r(0),u=r(88),l=r(5),s=r.n(l),f=r(1545),d=r.n(f),p=r(1228),h=r(183),m=r(666),y=r(171),v=r(386),g=r(1362),b=r(1361),w=10,_=20;function E(e){var t=e.fullscreen,r=e.validRange,n=e.generateConfig,o=e.locale,a=e.prefixCls,u=e.value,l=e.onChange,s=e.divRef,f=n.getYear(u||n.getNow()),d=f-w,p=d+_;r&&(d=n.getYear(r[0]),p=n.getYear(r[1])+1);for(var h=o&&"年"===o.year?"年":"",m=[],y=d;y<p;y++)m.push({label:"".concat(y).concat(h),value:y});return c.createElement(v.a,{size:t?void 0:"small",options:m,value:f,className:"".concat(a,"-year-select"),onChange:function(e){var t=n.setYear(u,e);if(r){var o=Object(i.a)(r,2),a=o[0],c=o[1],s=n.getYear(t),f=n.getMonth(t);s===n.getYear(c)&&f>n.getMonth(c)&&(t=n.setMonth(t,n.getMonth(c))),s===n.getYear(a)&&f<n.getMonth(a)&&(t=n.setMonth(t,n.getMonth(a)))}l(t)},getPopupContainer:function(){return s.current}})}function O(e){var t=e.prefixCls,r=e.fullscreen,n=e.validRange,o=e.value,a=e.generateConfig,u=e.locale,l=e.onChange,s=e.divRef,f=a.getMonth(o||a.getNow()),d=0,p=11;if(n){var h=Object(i.a)(n,2),m=h[0],y=h[1],g=a.getYear(o);a.getYear(y)===g&&(p=a.getMonth(y)),a.getYear(m)===g&&(d=a.getMonth(m))}for(var b=u.shortMonths||a.locale.getShortMonths(u.locale),w=[],_=d;_<=p;_+=1)w.push({label:b[_],value:_});return c.createElement(v.a,{size:r?void 0:"small",className:"".concat(t,"-month-select"),value:f,options:w,onChange:function(e){l(a.setMonth(o,e))},getPopupContainer:function(){return s.current}})}function S(e){var t=e.prefixCls,r=e.locale,n=e.mode,o=e.fullscreen,a=e.onModeChange;return c.createElement(g.a,{onChange:function(e){var t=e.target.value;a(t)},value:n,size:o?void 0:"small",className:"".concat(t,"-mode-switch")},c.createElement(b.a,{value:"month"},r.month),c.createElement(b.a,{value:"year"},r.year))}var k=function(e){var t=e.prefixCls,r=e.fullscreen,n=e.mode,o=e.onChange,i=e.onModeChange,u=c.useRef(null),l=Object(a.default)(Object(a.default)({},e),{onChange:o,fullscreen:r,divRef:u});return c.createElement("div",{className:"".concat(t,"-header"),ref:u},c.createElement(E,l),"month"===n&&c.createElement(O,l),c.createElement(S,Object(a.default)({},l,{onModeChange:i})))};var x=function(e){function t(t,r){return t&&r&&e.getYear(t)===e.getYear(r)}function r(r,n){return t(r,n)&&e.getMonth(r)===e.getMonth(n)}function n(t,n){return r(t,n)&&e.getDate(t)===e.getDate(n)}return function(l){var f=l.prefixCls,v=l.className,g=l.style,b=l.dateFullCellRender,w=l.dateCellRender,_=l.monthFullCellRender,E=l.monthCellRender,O=l.headerRender,S=l.value,x=l.defaultValue,j=l.disabledDate,A=l.mode,L=l.validRange,T=l.fullscreen,C=void 0===T||T,P=l.onChange,N=l.onPanelChange,R=l.onSelect,I=c.useContext(y.b),D=I.getPrefixCls,M=I.direction,F=D("picker",f),G="".concat(F,"-calendar"),U=e.getNow(),B=Object(u.a)((function(){return S||e.getNow()}),{defaultValue:x,value:S}),q=Object(i.a)(B,2),V=q[0],z=q[1],H=Object(u.a)("month",{value:A}),W=Object(i.a)(H,2),Y=W[0],K=W[1],Q=c.useMemo((function(){return"year"===Y?"month":"date"}),[Y]),Z=c.useCallback((function(t){return!!L&&(e.isAfter(L[0],t)||e.isAfter(t,L[1]))||!!(null==j?void 0:j(t))}),[j,L]),J=function(e,t){null==N||N(e,t)},X=function(e){K(e),J(V,e)},$=function(e){!function(e){z(e),n(e,V)||(("date"===Q&&!r(e,V)||"month"===Q&&!t(e,V))&&J(e,Y),null==P||P(e))}(e),null==R||R(e)},ee=c.useCallback((function(t){return b?b(t):c.createElement("div",{className:s()("".concat(F,"-cell-inner"),"".concat(G,"-date"),Object(o.a)({},"".concat(G,"-date-today"),n(U,t)))},c.createElement("div",{className:"".concat(G,"-date-value")},d()(String(e.getDate(t)),2,"0")),c.createElement("div",{className:"".concat(G,"-date-content")},w&&w(t)))}),[b,w]),te=c.useCallback((function(t,n){if(_)return _(t);var a=n.shortMonths||e.locale.getShortMonths(n.locale);return c.createElement("div",{className:s()("".concat(F,"-cell-inner"),"".concat(G,"-date"),Object(o.a)({},"".concat(G,"-date-today"),r(U,t)))},c.createElement("div",{className:"".concat(G,"-date-value")},a[e.getMonth(t)]),c.createElement("div",{className:"".concat(G,"-date-content")},E&&E(t)))}),[_,E]);return c.createElement(h.a,{componentName:"Calendar",defaultLocale:function(){var e=l.locale,t=Object(a.default)(Object(a.default)({},m.a),e);return t.lang=Object(a.default)(Object(a.default)({},t.lang),(e||{}).lang),t}},(function(t){var r;return c.createElement("div",{className:s()(G,(r={},Object(o.a)(r,"".concat(G,"-full"),C),Object(o.a)(r,"".concat(G,"-mini"),!C),Object(o.a)(r,"".concat(G,"-rtl"),"rtl"===M),r),v),style:g},O?O({value:V,type:Y,onChange:$,onTypeChange:X}):c.createElement(k,{prefixCls:G,value:V,generateConfig:e,mode:Y,fullscreen:C,locale:t.lang,validRange:L,onChange:$,onModeChange:X}),c.createElement(p.a,{value:V,prefixCls:F,locale:t.lang,generateConfig:e,dateRender:ee,monthCellRender:function(e){return te(e,t.lang)},onSelect:$,mode:Q,picker:Q,disabledDate:Z,hideHeader:!0}))}))}}(n.a);t.a=x},2934:function(e,t,r){"use strict";var n=r(6),o=r(3),a=r(36),i=r(39),c=r(70),u=r(47),l=r(48),s=r(4),f=r(0),d=r.n(f),p=r(27),h=r(25),m={animating:!1,autoplaying:null,currentDirection:0,currentLeft:null,currentSlide:0,direction:1,dragging:!1,edgeDragged:!1,initialized:!1,lazyLoadedList:[],listHeight:null,listWidth:null,scrolling:!1,slideCount:null,slideHeight:null,slideWidth:null,swipeLeft:null,swiped:!1,swiping:!1,touchObject:{startX:0,startY:0,curX:0,curY:0},trackStyle:{},trackWidth:0,targetSlide:0},y=r(454),v=r.n(y),g=r(5),b=r.n(g);function w(e,t,r){return Math.max(t,Math.min(e,r))}var _=function(e){["onTouchStart","onTouchMove","onWheel"].includes(e._reactName)||e.preventDefault()},E=function(e){for(var t=[],r=O(e),n=S(e),o=r;o<n;o++)e.lazyLoadedList.indexOf(o)<0&&t.push(o);return t},O=function(e){return e.currentSlide-k(e)},S=function(e){return e.currentSlide+x(e)},k=function(e){return e.centerMode?Math.floor(e.slidesToShow/2)+(parseInt(e.centerPadding)>0?1:0):0},x=function(e){return e.centerMode?Math.floor((e.slidesToShow-1)/2)+1+(parseInt(e.centerPadding)>0?1:0):e.slidesToShow},j=function(e){return e&&e.offsetWidth||0},A=function(e){return e&&e.offsetHeight||0},L=function(e){var t,r,n,o,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t=e.startX-e.curX,r=e.startY-e.curY,n=Math.atan2(r,t),(o=Math.round(180*n/Math.PI))<0&&(o=360-Math.abs(o)),o<=45&&o>=0||o<=360&&o>=315?"left":o>=135&&o<=225?"right":!0===a?o>=35&&o<=135?"up":"down":"vertical"},T=function(e){var t=!0;return e.infinite||(e.centerMode&&e.currentSlide>=e.slideCount-1||e.slideCount<=e.slidesToShow||e.currentSlide>=e.slideCount-e.slidesToShow)&&(t=!1),t},C=function(e,t){var r={};return t.forEach((function(t){return r[t]=e[t]})),r},P=function(e,t){var r=function(e){for(var t=e.infinite?2*e.slideCount:e.slideCount,r=e.infinite?-1*e.slidesToShow:0,n=e.infinite?-1*e.slidesToShow:0,o=[];r<t;)o.push(r),r=n+e.slidesToScroll,n+=Math.min(e.slidesToScroll,e.slidesToShow);return o}(e),n=0;if(t>r[r.length-1])t=r[r.length-1];else for(var o in r){if(t<r[o]){t=n;break}n=r[o]}return t},N=function(e){var t=e.centerMode?e.slideWidth*Math.floor(e.slidesToShow/2):0;if(e.swipeToSlide){var r,n=e.listRef,o=n.querySelectorAll&&n.querySelectorAll(".slick-slide")||[];if(Array.from(o).every((function(n){if(e.vertical){if(n.offsetTop+A(n)/2>-1*e.swipeLeft)return r=n,!1}else if(n.offsetLeft-t+j(n)/2>-1*e.swipeLeft)return r=n,!1;return!0})),!r)return 0;var a=!0===e.rtl?e.slideCount-e.currentSlide:e.currentSlide;return Math.abs(r.dataset.index-a)||1}return e.slidesToScroll},R=function(e,t){return t.reduce((function(t,r){return t&&e.hasOwnProperty(r)}),!0)?null:console.error("Keys Missing:",e)},I=function(e){var t,r;R(e,["left","variableWidth","slideCount","slidesToShow","slideWidth"]);var n=e.slideCount+2*e.slidesToShow;e.vertical?r=n*e.slideHeight:t=U(e)*e.slideWidth;var a={opacity:1,transition:"",WebkitTransition:""};if(e.useTransform){var i=e.vertical?"translate3d(0px, "+e.left+"px, 0px)":"translate3d("+e.left+"px, 0px, 0px)",c=e.vertical?"translate3d(0px, "+e.left+"px, 0px)":"translate3d("+e.left+"px, 0px, 0px)",u=e.vertical?"translateY("+e.left+"px)":"translateX("+e.left+"px)";a=Object(o.a)(Object(o.a)({},a),{},{WebkitTransform:i,transform:c,msTransform:u})}else e.vertical?a.top=e.left:a.left=e.left;return e.fade&&(a={opacity:1}),t&&(a.width=t),r&&(a.height=r),window&&!window.addEventListener&&window.attachEvent&&(e.vertical?a.marginTop=e.left+"px":a.marginLeft=e.left+"px"),a},D=function(e){R(e,["left","variableWidth","slideCount","slidesToShow","slideWidth","speed","cssEase"]);var t=I(e);return e.useTransform?(t.WebkitTransition="-webkit-transform "+e.speed+"ms "+e.cssEase,t.transition="transform "+e.speed+"ms "+e.cssEase):e.vertical?t.transition="top "+e.speed+"ms "+e.cssEase:t.transition="left "+e.speed+"ms "+e.cssEase,t},M=function(e){if(e.unslick)return 0;R(e,["slideIndex","trackRef","infinite","centerMode","slideCount","slidesToShow","slidesToScroll","slideWidth","listWidth","variableWidth","slideHeight"]);var t,r,n=e.slideIndex,o=e.trackRef,a=e.infinite,i=e.centerMode,c=e.slideCount,u=e.slidesToShow,l=e.slidesToScroll,s=e.slideWidth,f=e.listWidth,d=e.variableWidth,p=e.slideHeight,h=e.fade,m=e.vertical;if(h||1===e.slideCount)return 0;var y=0;if(a?(y=-F(e),c%l!=0&&n+l>c&&(y=-(n>c?u-(n-c):c%l)),i&&(y+=parseInt(u/2))):(c%l!=0&&n+l>c&&(y=u-c%l),i&&(y=parseInt(u/2))),t=m?n*p*-1+y*p:n*s*-1+y*s,!0===d){var v,g=o&&o.node;if(v=n+F(e),t=(r=g&&g.childNodes[v])?-1*r.offsetLeft:0,!0===i){v=a?n+F(e):n,r=g&&g.children[v],t=0;for(var b=0;b<v;b++)t-=g&&g.children[b]&&g.children[b].offsetWidth;t-=parseInt(e.centerPadding),t+=r&&(f-r.offsetWidth)/2}}return t},F=function(e){return e.unslick||!e.infinite?0:e.variableWidth?e.slideCount:e.slidesToShow+(e.centerMode?1:0)},G=function(e){return e.unslick||!e.infinite?0:e.slideCount},U=function(e){return 1===e.slideCount?1:F(e)+e.slideCount+G(e)},B=function(e){return e.targetSlide>e.currentSlide?e.targetSlide>e.currentSlide+q(e)?"left":"right":e.targetSlide<e.currentSlide-V(e)?"right":"left"},q=function(e){var t=e.slidesToShow,r=e.centerMode,n=e.rtl,o=e.centerPadding;if(r){var a=(t-1)/2+1;return parseInt(o)>0&&(a+=1),n&&t%2==0&&(a+=1),a}return n?0:t-1},V=function(e){var t=e.slidesToShow,r=e.centerMode,n=e.rtl,o=e.centerPadding;if(r){var a=(t-1)/2+1;return parseInt(o)>0&&(a+=1),n||t%2!=0||(a+=1),a}return n?t-1:0},z=function(){return!("undefined"==typeof window||!window.document||!window.document.createElement)},H=function(e){var t,r,n,o,a;return n=(a=e.rtl?e.slideCount-1-e.index:e.index)<0||a>=e.slideCount,e.centerMode?(o=Math.floor(e.slidesToShow/2),r=(a-e.currentSlide)%e.slideCount==0,a>e.currentSlide-o-1&&a<=e.currentSlide+o&&(t=!0)):t=e.currentSlide<=a&&a<e.currentSlide+e.slidesToShow,{"slick-slide":!0,"slick-active":t,"slick-center":r,"slick-cloned":n,"slick-current":a===(e.targetSlide<0?e.targetSlide+e.slideCount:e.targetSlide>=e.slideCount?e.targetSlide-e.slideCount:e.targetSlide)}},W=function(e,t){return e.key+"-"+t},Y=function(e){var t,r=[],n=[],a=[],i=d.a.Children.count(e.children),c=O(e),u=S(e);return d.a.Children.forEach(e.children,(function(l,s){var f,p={message:"children",index:s,slidesToScroll:e.slidesToScroll,currentSlide:e.currentSlide};f=!e.lazyLoad||e.lazyLoad&&e.lazyLoadedList.indexOf(s)>=0?l:d.a.createElement("div",null);var h=function(e){var t={};return void 0!==e.variableWidth&&!1!==e.variableWidth||(t.width=e.slideWidth),e.fade&&(t.position="relative",e.vertical?t.top=-e.index*parseInt(e.slideHeight):t.left=-e.index*parseInt(e.slideWidth),t.opacity=e.currentSlide===e.index?1:0,e.useCSS&&(t.transition="opacity "+e.speed+"ms "+e.cssEase+", visibility "+e.speed+"ms "+e.cssEase)),t}(Object(o.a)(Object(o.a)({},e),{},{index:s})),m=f.props.className||"",y=H(Object(o.a)(Object(o.a)({},e),{},{index:s}));if(r.push(d.a.cloneElement(f,{key:"original"+W(f,s),"data-index":s,className:b()(y,m),tabIndex:"-1","aria-hidden":!y["slick-active"],style:Object(o.a)(Object(o.a)({outline:"none"},f.props.style||{}),h),onClick:function(t){f.props&&f.props.onClick&&f.props.onClick(t),e.focusOnSelect&&e.focusOnSelect(p)}})),e.infinite&&!1===e.fade){var v=i-s;v<=F(e)&&i!==e.slidesToShow&&((t=-v)>=c&&(f=l),y=H(Object(o.a)(Object(o.a)({},e),{},{index:t})),n.push(d.a.cloneElement(f,{key:"precloned"+W(f,t),"data-index":t,tabIndex:"-1",className:b()(y,m),"aria-hidden":!y["slick-active"],style:Object(o.a)(Object(o.a)({},f.props.style||{}),h),onClick:function(t){f.props&&f.props.onClick&&f.props.onClick(t),e.focusOnSelect&&e.focusOnSelect(p)}}))),i!==e.slidesToShow&&((t=i+s)<u&&(f=l),y=H(Object(o.a)(Object(o.a)({},e),{},{index:t})),a.push(d.a.cloneElement(f,{key:"postcloned"+W(f,t),"data-index":t,tabIndex:"-1",className:b()(y,m),"aria-hidden":!y["slick-active"],style:Object(o.a)(Object(o.a)({},f.props.style||{}),h),onClick:function(t){f.props&&f.props.onClick&&f.props.onClick(t),e.focusOnSelect&&e.focusOnSelect(p)}})))}})),e.rtl?n.concat(r,a).reverse():n.concat(r,a)},K=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(){var e;Object(a.a)(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return e=t.call.apply(t,[this].concat(o)),Object(s.a)(Object(c.a)(e),"node",null),Object(s.a)(Object(c.a)(e),"handleRef",(function(t){e.node=t})),e}return Object(i.a)(r,[{key:"render",value:function(){var e=Y(this.props),t=this.props,r={onMouseEnter:t.onMouseEnter,onMouseOver:t.onMouseOver,onMouseLeave:t.onMouseLeave};return d.a.createElement("div",Object(n.default)({ref:this.handleRef,className:"slick-track",style:this.props.trackStyle},r),e)}}]),r}(d.a.PureComponent),Q=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(){return Object(a.a)(this,r),t.apply(this,arguments)}return Object(i.a)(r,[{key:"clickHandler",value:function(e,t){t.preventDefault(),this.props.clickHandler(e)}},{key:"render",value:function(){for(var e,t=this.props,r=t.onMouseEnter,n=t.onMouseOver,a=t.onMouseLeave,i=t.infinite,c=t.slidesToScroll,u=t.slidesToShow,l=t.slideCount,s=t.currentSlide,f=(e={slideCount:l,slidesToScroll:c,slidesToShow:u,infinite:i}).infinite?Math.ceil(e.slideCount/e.slidesToScroll):Math.ceil((e.slideCount-e.slidesToShow)/e.slidesToScroll)+1,p={onMouseEnter:r,onMouseOver:n,onMouseLeave:a},h=[],m=0;m<f;m++){var y=(m+1)*c-1,v=i?y:w(y,0,l-1),g=v-(c-1),_=i?g:w(g,0,l-1),E=b()({"slick-active":i?s>=_&&s<=v:s===_}),O={message:"dots",index:m,slidesToScroll:c,currentSlide:s},S=this.clickHandler.bind(this,O);h=h.concat(d.a.createElement("li",{key:m,className:E},d.a.cloneElement(this.props.customPaging(m),{onClick:S})))}return d.a.cloneElement(this.props.appendDots(h),Object(o.a)({className:this.props.dotsClass},p))}}]),r}(d.a.PureComponent),Z=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(){return Object(a.a)(this,r),t.apply(this,arguments)}return Object(i.a)(r,[{key:"clickHandler",value:function(e,t){t&&t.preventDefault(),this.props.clickHandler(e,t)}},{key:"render",value:function(){var e={"slick-arrow":!0,"slick-prev":!0},t=this.clickHandler.bind(this,{message:"previous"});!this.props.infinite&&(0===this.props.currentSlide||this.props.slideCount<=this.props.slidesToShow)&&(e["slick-disabled"]=!0,t=null);var r={key:"0","data-role":"none",className:b()(e),style:{display:"block"},onClick:t},a={currentSlide:this.props.currentSlide,slideCount:this.props.slideCount};return this.props.prevArrow?d.a.cloneElement(this.props.prevArrow,Object(o.a)(Object(o.a)({},r),a)):d.a.createElement("button",Object(n.default)({key:"0",type:"button"},r)," ","Previous")}}]),r}(d.a.PureComponent),J=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(){return Object(a.a)(this,r),t.apply(this,arguments)}return Object(i.a)(r,[{key:"clickHandler",value:function(e,t){t&&t.preventDefault(),this.props.clickHandler(e,t)}},{key:"render",value:function(){var e={"slick-arrow":!0,"slick-next":!0},t=this.clickHandler.bind(this,{message:"next"});T(this.props)||(e["slick-disabled"]=!0,t=null);var r={key:"1","data-role":"none",className:b()(e),style:{display:"block"},onClick:t},a={currentSlide:this.props.currentSlide,slideCount:this.props.slideCount};return this.props.nextArrow?d.a.cloneElement(this.props.nextArrow,Object(o.a)(Object(o.a)({},r),a)):d.a.createElement("button",Object(n.default)({key:"1",type:"button"},r)," ","Next")}}]),r}(d.a.PureComponent),X=r(525),$=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e){var i;Object(a.a)(this,r),i=t.call(this,e),Object(s.a)(Object(c.a)(i),"listRefHandler",(function(e){return i.list=e})),Object(s.a)(Object(c.a)(i),"trackRefHandler",(function(e){return i.track=e})),Object(s.a)(Object(c.a)(i),"adaptHeight",(function(){if(i.props.adaptiveHeight&&i.list){var e=i.list.querySelector('[data-index="'.concat(i.state.currentSlide,'"]'));i.list.style.height=A(e)+"px"}})),Object(s.a)(Object(c.a)(i),"componentDidMount",(function(){if(i.props.onInit&&i.props.onInit(),i.props.lazyLoad){var e=E(Object(o.a)(Object(o.a)({},i.props),i.state));e.length>0&&(i.setState((function(t){return{lazyLoadedList:t.lazyLoadedList.concat(e)}})),i.props.onLazyLoad&&i.props.onLazyLoad(e))}var t=Object(o.a)({listRef:i.list,trackRef:i.track},i.props);i.updateState(t,!0,(function(){i.adaptHeight(),i.props.autoplay&&i.autoPlay("playing")})),"progressive"===i.props.lazyLoad&&(i.lazyLoadTimer=setInterval(i.progressiveLazyLoad,1e3)),i.ro=new X.default((function(){i.state.animating?(i.onWindowResized(!1),i.callbackTimers.push(setTimeout((function(){return i.onWindowResized()}),i.props.speed))):i.onWindowResized()})),i.ro.observe(i.list),document.querySelectorAll&&Array.prototype.forEach.call(document.querySelectorAll(".slick-slide"),(function(e){e.onfocus=i.props.pauseOnFocus?i.onSlideFocus:null,e.onblur=i.props.pauseOnFocus?i.onSlideBlur:null})),window.addEventListener?window.addEventListener("resize",i.onWindowResized):window.attachEvent("onresize",i.onWindowResized)})),Object(s.a)(Object(c.a)(i),"componentWillUnmount",(function(){i.animationEndCallback&&clearTimeout(i.animationEndCallback),i.lazyLoadTimer&&clearInterval(i.lazyLoadTimer),i.callbackTimers.length&&(i.callbackTimers.forEach((function(e){return clearTimeout(e)})),i.callbackTimers=[]),window.addEventListener?window.removeEventListener("resize",i.onWindowResized):window.detachEvent("onresize",i.onWindowResized),i.autoplayTimer&&clearInterval(i.autoplayTimer),i.ro.disconnect()})),Object(s.a)(Object(c.a)(i),"componentDidUpdate",(function(e){if(i.checkImagesLoad(),i.props.onReInit&&i.props.onReInit(),i.props.lazyLoad){var t=E(Object(o.a)(Object(o.a)({},i.props),i.state));t.length>0&&(i.setState((function(e){return{lazyLoadedList:e.lazyLoadedList.concat(t)}})),i.props.onLazyLoad&&i.props.onLazyLoad(t))}i.adaptHeight();var r=Object(o.a)(Object(o.a)({listRef:i.list,trackRef:i.track},i.props),i.state),n=i.didPropsChange(e);n&&i.updateState(r,n,(function(){i.state.currentSlide>=d.a.Children.count(i.props.children)&&i.changeSlide({message:"index",index:d.a.Children.count(i.props.children)-i.props.slidesToShow,currentSlide:i.state.currentSlide}),e.autoplay===i.props.autoplay&&e.autoplaySpeed===i.props.autoplaySpeed||(!e.autoplay&&i.props.autoplay?i.autoPlay("playing"):i.props.autoplay?i.autoPlay("update"):i.pause("paused"))}))})),Object(s.a)(Object(c.a)(i),"onWindowResized",(function(e){i.debouncedResize&&i.debouncedResize.cancel(),i.debouncedResize=v()((function(){return i.resizeWindow(e)}),50),i.debouncedResize()})),Object(s.a)(Object(c.a)(i),"resizeWindow",(function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(Boolean(i.track&&i.track.node)){var t=Object(o.a)(Object(o.a)({listRef:i.list,trackRef:i.track},i.props),i.state);i.updateState(t,e,(function(){i.props.autoplay?i.autoPlay("update"):i.pause("paused")})),i.setState({animating:!1}),clearTimeout(i.animationEndCallback),delete i.animationEndCallback}})),Object(s.a)(Object(c.a)(i),"updateState",(function(e,t,r){var n=function(e){var t,r=d.a.Children.count(e.children),n=e.listRef,a=Math.ceil(j(n)),i=e.trackRef&&e.trackRef.node,c=Math.ceil(j(i));if(e.vertical)t=a;else{var u=e.centerMode&&2*parseInt(e.centerPadding);"string"==typeof e.centerPadding&&"%"===e.centerPadding.slice(-1)&&(u*=a/100),t=Math.ceil((a-u)/e.slidesToShow)}var l=n&&A(n.querySelector('[data-index="0"]')),s=l*e.slidesToShow,f=void 0===e.currentSlide?e.initialSlide:e.currentSlide;e.rtl&&void 0===e.currentSlide&&(f=r-1-e.initialSlide);var p=e.lazyLoadedList||[],h=E(Object(o.a)(Object(o.a)({},e),{},{currentSlide:f,lazyLoadedList:p})),m={slideCount:r,slideWidth:t,listWidth:a,trackWidth:c,currentSlide:f,slideHeight:l,listHeight:s,lazyLoadedList:p=p.concat(h)};return null===e.autoplaying&&e.autoplay&&(m.autoplaying="playing"),m}(e);e=Object(o.a)(Object(o.a)(Object(o.a)({},e),n),{},{slideIndex:n.currentSlide});var a=M(e);e=Object(o.a)(Object(o.a)({},e),{},{left:a});var c=I(e);(t||d.a.Children.count(i.props.children)!==d.a.Children.count(e.children))&&(n.trackStyle=c),i.setState(n,r)})),Object(s.a)(Object(c.a)(i),"ssrInit",(function(){if(i.props.variableWidth){var e=0,t=0,r=[],n=F(Object(o.a)(Object(o.a)(Object(o.a)({},i.props),i.state),{},{slideCount:i.props.children.length})),a=G(Object(o.a)(Object(o.a)(Object(o.a)({},i.props),i.state),{},{slideCount:i.props.children.length}));i.props.children.forEach((function(t){r.push(t.props.style.width),e+=t.props.style.width}));for(var c=0;c<n;c++)t+=r[r.length-1-c],e+=r[r.length-1-c];for(var u=0;u<a;u++)e+=r[u];for(var l=0;l<i.state.currentSlide;l++)t+=r[l];var s={width:e+"px",left:-t+"px"};if(i.props.centerMode){var f="".concat(r[i.state.currentSlide],"px");s.left="calc(".concat(s.left," + (100% - ").concat(f,") / 2 ) ")}return{trackStyle:s}}var p=d.a.Children.count(i.props.children),h=Object(o.a)(Object(o.a)(Object(o.a)({},i.props),i.state),{},{slideCount:p}),m=F(h)+G(h)+p,y=100/i.props.slidesToShow*m,v=100/m,g=-v*(F(h)+i.state.currentSlide)*y/100;return i.props.centerMode&&(g+=(100-v*y/100)/2),{slideWidth:v+"%",trackStyle:{width:y+"%",left:g+"%"}}})),Object(s.a)(Object(c.a)(i),"checkImagesLoad",(function(){var e=i.list&&i.list.querySelectorAll&&i.list.querySelectorAll(".slick-slide img")||[],t=e.length,r=0;Array.prototype.forEach.call(e,(function(e){var n=function(){return++r&&r>=t&&i.onWindowResized()};if(e.onclick){var o=e.onclick;e.onclick=function(){o(),e.parentNode.focus()}}else e.onclick=function(){return e.parentNode.focus()};e.onload||(i.props.lazyLoad?e.onload=function(){i.adaptHeight(),i.callbackTimers.push(setTimeout(i.onWindowResized,i.props.speed))}:(e.onload=n,e.onerror=function(){n(),i.props.onLazyLoadError&&i.props.onLazyLoadError()}))}))})),Object(s.a)(Object(c.a)(i),"progressiveLazyLoad",(function(){for(var e=[],t=Object(o.a)(Object(o.a)({},i.props),i.state),r=i.state.currentSlide;r<i.state.slideCount+G(t);r++)if(i.state.lazyLoadedList.indexOf(r)<0){e.push(r);break}for(var n=i.state.currentSlide-1;n>=-F(t);n--)if(i.state.lazyLoadedList.indexOf(n)<0){e.push(n);break}e.length>0?(i.setState((function(t){return{lazyLoadedList:t.lazyLoadedList.concat(e)}})),i.props.onLazyLoad&&i.props.onLazyLoad(e)):i.lazyLoadTimer&&(clearInterval(i.lazyLoadTimer),delete i.lazyLoadTimer)})),Object(s.a)(Object(c.a)(i),"slideHandler",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=i.props,n=r.asNavFor,a=r.beforeChange,c=r.onLazyLoad,u=r.speed,l=r.afterChange,s=i.state.currentSlide,f=function(e){var t=e.waitForAnimate,r=e.animating,n=e.fade,a=e.infinite,i=e.index,c=e.slideCount,u=e.lazyLoad,l=e.currentSlide,s=e.centerMode,f=e.slidesToScroll,d=e.slidesToShow,p=e.useCSS,h=e.lazyLoadedList;if(t&&r)return{};var m,y,v,g=i,b={},_={},O=a?i:w(i,0,c-1);if(n){if(!a&&(i<0||i>=c))return{};i<0?g=i+c:i>=c&&(g=i-c),u&&h.indexOf(g)<0&&(h=h.concat(g)),b={animating:!0,currentSlide:g,lazyLoadedList:h,targetSlide:g},_={animating:!1,targetSlide:g}}else m=g,g<0?(m=g+c,a?c%f!=0&&(m=c-c%f):m=0):!T(e)&&g>l?g=m=l:s&&g>=c?(g=a?c:c-1,m=a?0:c-1):g>=c&&(m=g-c,a?c%f!=0&&(m=0):m=c-d),!a&&g+d>=c&&(m=c-d),y=M(Object(o.a)(Object(o.a)({},e),{},{slideIndex:g})),v=M(Object(o.a)(Object(o.a)({},e),{},{slideIndex:m})),a||(y===v&&(g=m),y=v),u&&(h=h.concat(E(Object(o.a)(Object(o.a)({},e),{},{currentSlide:g})))),p?(b={animating:!0,currentSlide:m,trackStyle:D(Object(o.a)(Object(o.a)({},e),{},{left:y})),lazyLoadedList:h,targetSlide:O},_={animating:!1,currentSlide:m,trackStyle:I(Object(o.a)(Object(o.a)({},e),{},{left:v})),swipeLeft:null,targetSlide:O}):b={currentSlide:m,trackStyle:I(Object(o.a)(Object(o.a)({},e),{},{left:v})),lazyLoadedList:h,targetSlide:O};return{state:b,nextState:_}}(Object(o.a)(Object(o.a)(Object(o.a)({index:e},i.props),i.state),{},{trackRef:i.track,useCSS:i.props.useCSS&&!t})),d=f.state,p=f.nextState;if(d){a&&a(s,d.currentSlide);var m=d.lazyLoadedList.filter((function(e){return i.state.lazyLoadedList.indexOf(e)<0}));c&&m.length>0&&c(m),!i.props.waitForAnimate&&i.animationEndCallback&&(clearTimeout(i.animationEndCallback),l&&l(s),delete i.animationEndCallback),i.setState(d,(function(){n&&i.asNavForIndex!==e&&(i.asNavForIndex=e,n.innerSlider.slideHandler(e)),p&&(i.animationEndCallback=setTimeout((function(){var e=p.animating,t=Object(h.a)(p,["animating"]);i.setState(t,(function(){i.callbackTimers.push(setTimeout((function(){return i.setState({animating:e})}),10)),l&&l(d.currentSlide),delete i.animationEndCallback}))}),u))}))}})),Object(s.a)(Object(c.a)(i),"changeSlide",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=function(e,t){var r,n,a,i,c=e.slidesToScroll,u=e.slidesToShow,l=e.slideCount,s=e.currentSlide,f=e.targetSlide,d=e.lazyLoad,p=e.infinite;if(r=l%c!=0?0:(l-s)%c,"previous"===t.message)i=s-(a=0===r?c:u-r),d&&!p&&(i=-1==(n=s-a)?l-1:n),p||(i=f-c);else if("next"===t.message)i=s+(a=0===r?c:r),d&&!p&&(i=(s+c)%l+r),p||(i=f+c);else if("dots"===t.message)i=t.index*t.slidesToScroll;else if("children"===t.message){if(i=t.index,p){var h=B(Object(o.a)(Object(o.a)({},e),{},{targetSlide:i}));i>t.currentSlide&&"left"===h?i-=l:i<t.currentSlide&&"right"===h&&(i+=l)}}else"index"===t.message&&(i=Number(t.index));return i}(Object(o.a)(Object(o.a)({},i.props),i.state),e);if((0===r||r)&&(!0===t?i.slideHandler(r,t):i.slideHandler(r),i.props.autoplay&&i.autoPlay("update"),i.props.focusOnSelect)){var n=i.list.querySelectorAll(".slick-current");n[0]&&n[0].focus()}})),Object(s.a)(Object(c.a)(i),"clickHandler",(function(e){!1===i.clickable&&(e.stopPropagation(),e.preventDefault()),i.clickable=!0})),Object(s.a)(Object(c.a)(i),"keyHandler",(function(e){var t=function(e,t,r){return e.target.tagName.match("TEXTAREA|INPUT|SELECT")||!t?"":37===e.keyCode?r?"next":"previous":39===e.keyCode?r?"previous":"next":""}(e,i.props.accessibility,i.props.rtl);""!==t&&i.changeSlide({message:t})})),Object(s.a)(Object(c.a)(i),"selectHandler",(function(e){i.changeSlide(e)})),Object(s.a)(Object(c.a)(i),"disableBodyScroll",(function(){window.ontouchmove=function(e){(e=e||window.event).preventDefault&&e.preventDefault(),e.returnValue=!1}})),Object(s.a)(Object(c.a)(i),"enableBodyScroll",(function(){window.ontouchmove=null})),Object(s.a)(Object(c.a)(i),"swipeStart",(function(e){i.props.verticalSwiping&&i.disableBodyScroll();var t=function(e,t,r){return"IMG"===e.target.tagName&&_(e),!t||!r&&-1!==e.type.indexOf("mouse")?"":{dragging:!0,touchObject:{startX:e.touches?e.touches[0].pageX:e.clientX,startY:e.touches?e.touches[0].pageY:e.clientY,curX:e.touches?e.touches[0].pageX:e.clientX,curY:e.touches?e.touches[0].pageY:e.clientY}}}(e,i.props.swipe,i.props.draggable);""!==t&&i.setState(t)})),Object(s.a)(Object(c.a)(i),"swipeMove",(function(e){var t=function(e,t){var r=t.scrolling,n=t.animating,a=t.vertical,i=t.swipeToSlide,c=t.verticalSwiping,u=t.rtl,l=t.currentSlide,s=t.edgeFriction,f=t.edgeDragged,d=t.onEdge,p=t.swiped,h=t.swiping,m=t.slideCount,y=t.slidesToScroll,v=t.infinite,g=t.touchObject,b=t.swipeEvent,w=t.listHeight,E=t.listWidth;if(!r){if(n)return _(e);a&&i&&c&&_(e);var O,S={},k=M(t);g.curX=e.touches?e.touches[0].pageX:e.clientX,g.curY=e.touches?e.touches[0].pageY:e.clientY,g.swipeLength=Math.round(Math.sqrt(Math.pow(g.curX-g.startX,2)));var x=Math.round(Math.sqrt(Math.pow(g.curY-g.startY,2)));if(!c&&!h&&x>10)return{scrolling:!0};c&&(g.swipeLength=x);var j=(u?-1:1)*(g.curX>g.startX?1:-1);c&&(j=g.curY>g.startY?1:-1);var A=Math.ceil(m/y),C=L(t.touchObject,c),P=g.swipeLength;return v||(0===l&&("right"===C||"down"===C)||l+1>=A&&("left"===C||"up"===C)||!T(t)&&("left"===C||"up"===C))&&(P=g.swipeLength*s,!1===f&&d&&(d(C),S.edgeDragged=!0)),!p&&b&&(b(C),S.swiped=!0),O=a?k+P*(w/E)*j:u?k-P*j:k+P*j,c&&(O=k+P*j),S=Object(o.a)(Object(o.a)({},S),{},{touchObject:g,swipeLeft:O,trackStyle:I(Object(o.a)(Object(o.a)({},t),{},{left:O}))}),Math.abs(g.curX-g.startX)<.8*Math.abs(g.curY-g.startY)||g.swipeLength>10&&(S.swiping=!0,_(e)),S}}(e,Object(o.a)(Object(o.a)(Object(o.a)({},i.props),i.state),{},{trackRef:i.track,listRef:i.list,slideIndex:i.state.currentSlide}));t&&(t.swiping&&(i.clickable=!1),i.setState(t))})),Object(s.a)(Object(c.a)(i),"swipeEnd",(function(e){var t=function(e,t){var r=t.dragging,n=t.swipe,a=t.touchObject,i=t.listWidth,c=t.touchThreshold,u=t.verticalSwiping,l=t.listHeight,s=t.swipeToSlide,f=t.scrolling,d=t.onSwipe,p=t.targetSlide,h=t.currentSlide,m=t.infinite;if(!r)return n&&_(e),{};var y=u?l/c:i/c,v=L(a,u),g={dragging:!1,edgeDragged:!1,scrolling:!1,swiping:!1,swiped:!1,swipeLeft:null,touchObject:{}};if(f)return g;if(!a.swipeLength)return g;if(a.swipeLength>y){var b,w;_(e),d&&d(v);var E=m?h:p;switch(v){case"left":case"up":w=E+N(t),b=s?P(t,w):w,g.currentDirection=0;break;case"right":case"down":w=E-N(t),b=s?P(t,w):w,g.currentDirection=1;break;default:b=E}g.triggerSlideHandler=b}else{var O=M(t);g.trackStyle=D(Object(o.a)(Object(o.a)({},t),{},{left:O}))}return g}(e,Object(o.a)(Object(o.a)(Object(o.a)({},i.props),i.state),{},{trackRef:i.track,listRef:i.list,slideIndex:i.state.currentSlide}));if(t){var r=t.triggerSlideHandler;delete t.triggerSlideHandler,i.setState(t),void 0!==r&&(i.slideHandler(r),i.props.verticalSwiping&&i.enableBodyScroll())}})),Object(s.a)(Object(c.a)(i),"touchEnd",(function(e){i.swipeEnd(e),i.clickable=!0})),Object(s.a)(Object(c.a)(i),"slickPrev",(function(){i.callbackTimers.push(setTimeout((function(){return i.changeSlide({message:"previous"})}),0))})),Object(s.a)(Object(c.a)(i),"slickNext",(function(){i.callbackTimers.push(setTimeout((function(){return i.changeSlide({message:"next"})}),0))})),Object(s.a)(Object(c.a)(i),"slickGoTo",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e=Number(e),isNaN(e))return"";i.callbackTimers.push(setTimeout((function(){return i.changeSlide({message:"index",index:e,currentSlide:i.state.currentSlide},t)}),0))})),Object(s.a)(Object(c.a)(i),"play",(function(){var e;if(i.props.rtl)e=i.state.currentSlide-i.props.slidesToScroll;else{if(!T(Object(o.a)(Object(o.a)({},i.props),i.state)))return!1;e=i.state.currentSlide+i.props.slidesToScroll}i.slideHandler(e)})),Object(s.a)(Object(c.a)(i),"autoPlay",(function(e){i.autoplayTimer&&clearInterval(i.autoplayTimer);var t=i.state.autoplaying;if("update"===e){if("hovered"===t||"focused"===t||"paused"===t)return}else if("leave"===e){if("paused"===t||"focused"===t)return}else if("blur"===e&&("paused"===t||"hovered"===t))return;i.autoplayTimer=setInterval(i.play,i.props.autoplaySpeed+50),i.setState({autoplaying:"playing"})})),Object(s.a)(Object(c.a)(i),"pause",(function(e){i.autoplayTimer&&(clearInterval(i.autoplayTimer),i.autoplayTimer=null);var t=i.state.autoplaying;"paused"===e?i.setState({autoplaying:"paused"}):"focused"===e?"hovered"!==t&&"playing"!==t||i.setState({autoplaying:"focused"}):"playing"===t&&i.setState({autoplaying:"hovered"})})),Object(s.a)(Object(c.a)(i),"onDotsOver",(function(){return i.props.autoplay&&i.pause("hovered")})),Object(s.a)(Object(c.a)(i),"onDotsLeave",(function(){return i.props.autoplay&&"hovered"===i.state.autoplaying&&i.autoPlay("leave")})),Object(s.a)(Object(c.a)(i),"onTrackOver",(function(){return i.props.autoplay&&i.pause("hovered")})),Object(s.a)(Object(c.a)(i),"onTrackLeave",(function(){return i.props.autoplay&&"hovered"===i.state.autoplaying&&i.autoPlay("leave")})),Object(s.a)(Object(c.a)(i),"onSlideFocus",(function(){return i.props.autoplay&&i.pause("focused")})),Object(s.a)(Object(c.a)(i),"onSlideBlur",(function(){return i.props.autoplay&&"focused"===i.state.autoplaying&&i.autoPlay("blur")})),Object(s.a)(Object(c.a)(i),"render",(function(){var e,t,r,a=b()("slick-slider",i.props.className,{"slick-vertical":i.props.vertical,"slick-initialized":!0}),c=Object(o.a)(Object(o.a)({},i.props),i.state),u=C(c,["fade","cssEase","speed","infinite","centerMode","focusOnSelect","currentSlide","lazyLoad","lazyLoadedList","rtl","slideWidth","slideHeight","listHeight","vertical","slidesToShow","slidesToScroll","slideCount","trackStyle","variableWidth","unslick","centerPadding","targetSlide","useCSS"]),l=i.props.pauseOnHover;if(u=Object(o.a)(Object(o.a)({},u),{},{onMouseEnter:l?i.onTrackOver:null,onMouseLeave:l?i.onTrackLeave:null,onMouseOver:l?i.onTrackOver:null,focusOnSelect:i.props.focusOnSelect&&i.clickable?i.selectHandler:null}),!0===i.props.dots&&i.state.slideCount>=i.props.slidesToShow){var s=C(c,["dotsClass","slideCount","slidesToShow","currentSlide","slidesToScroll","clickHandler","children","customPaging","infinite","appendDots"]),f=i.props.pauseOnDotsHover;s=Object(o.a)(Object(o.a)({},s),{},{clickHandler:i.changeSlide,onMouseEnter:f?i.onDotsLeave:null,onMouseOver:f?i.onDotsOver:null,onMouseLeave:f?i.onDotsLeave:null}),e=d.a.createElement(Q,s)}var p=C(c,["infinite","centerMode","currentSlide","slideCount","slidesToShow","prevArrow","nextArrow"]);p.clickHandler=i.changeSlide,i.props.arrows&&(t=d.a.createElement(Z,p),r=d.a.createElement(J,p));var h=null;i.props.vertical&&(h={height:i.state.listHeight});var m=null;!1===i.props.vertical?!0===i.props.centerMode&&(m={padding:"0px "+i.props.centerPadding}):!0===i.props.centerMode&&(m={padding:i.props.centerPadding+" 0px"});var y=Object(o.a)(Object(o.a)({},h),m),v=i.props.touchMove,g={className:"slick-list",style:y,onClick:i.clickHandler,onMouseDown:v?i.swipeStart:null,onMouseMove:i.state.dragging&&v?i.swipeMove:null,onMouseUp:v?i.swipeEnd:null,onMouseLeave:i.state.dragging&&v?i.swipeEnd:null,onTouchStart:v?i.swipeStart:null,onTouchMove:i.state.dragging&&v?i.swipeMove:null,onTouchEnd:v?i.touchEnd:null,onTouchCancel:i.state.dragging&&v?i.swipeEnd:null,onKeyDown:i.props.accessibility?i.keyHandler:null},w={className:a,dir:"ltr",style:i.props.style};return i.props.unslick&&(g={className:"slick-list"},w={className:a}),d.a.createElement("div",w,i.props.unslick?"":t,d.a.createElement("div",Object(n.default)({ref:i.listRefHandler},g),d.a.createElement(K,Object(n.default)({ref:i.trackRefHandler},u),i.props.children)),i.props.unslick?"":r,i.props.unslick?"":e)})),i.list=null,i.track=null,i.state=Object(o.a)(Object(o.a)({},m),{},{currentSlide:i.props.initialSlide,slideCount:d.a.Children.count(i.props.children)}),i.callbackTimers=[],i.clickable=!0,i.debouncedResize=null;var u=i.ssrInit();return i.state=Object(o.a)(Object(o.a)({},i.state),u),i}return Object(i.a)(r,[{key:"didPropsChange",value:function(e){for(var t=!1,r=0,n=Object.keys(this.props);r<n.length;r++){var o=n[r];if(!e.hasOwnProperty(o)){t=!0;break}if("object"!==Object(p.a)(e[o])&&"function"!=typeof e[o]&&e[o]!==this.props[o]){t=!0;break}}return t||d.a.Children.count(this.props.children)!==d.a.Children.count(e.children)}}]),r}(d.a.Component),ee=r(3792),te=r.n(ee),re={accessibility:!0,adaptiveHeight:!1,afterChange:null,appendDots:function(e){return d.a.createElement("ul",{style:{display:"block"}},e)},arrows:!0,autoplay:!1,autoplaySpeed:3e3,beforeChange:null,centerMode:!1,centerPadding:"50px",className:"",cssEase:"ease",customPaging:function(e){return d.a.createElement("button",null,e+1)},dots:!1,dotsClass:"slick-dots",draggable:!0,easing:"linear",edgeFriction:.35,fade:!1,focusOnSelect:!1,infinite:!0,initialSlide:0,lazyLoad:null,nextArrow:null,onEdge:null,onInit:null,onLazyLoadError:null,onReInit:null,pauseOnDotsHover:!1,pauseOnFocus:!1,pauseOnHover:!0,prevArrow:null,responsive:null,rows:1,rtl:!1,slide:"div",slidesPerRow:1,slidesToScroll:1,slidesToShow:1,speed:500,swipe:!0,swipeEvent:null,swipeToSlide:!1,touchMove:!0,touchThreshold:5,useCSS:!0,useTransform:!0,variableWidth:!1,vertical:!1,waitForAnimate:!0},ne=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e){var n;return Object(a.a)(this,r),n=t.call(this,e),Object(s.a)(Object(c.a)(n),"innerSliderRefHandler",(function(e){return n.innerSlider=e})),Object(s.a)(Object(c.a)(n),"slickPrev",(function(){return n.innerSlider.slickPrev()})),Object(s.a)(Object(c.a)(n),"slickNext",(function(){return n.innerSlider.slickNext()})),Object(s.a)(Object(c.a)(n),"slickGoTo",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return n.innerSlider.slickGoTo(e,t)})),Object(s.a)(Object(c.a)(n),"slickPause",(function(){return n.innerSlider.pause("paused")})),Object(s.a)(Object(c.a)(n),"slickPlay",(function(){return n.innerSlider.autoPlay("play")})),n.state={breakpoint:null},n._responsiveMediaHandlers=[],n}return Object(i.a)(r,[{key:"media",value:function(e,t){var r=window.matchMedia(e),n=function(e){e.matches&&t()};r.addListener(n),n(r),this._responsiveMediaHandlers.push({mql:r,query:e,listener:n})}},{key:"componentDidMount",value:function(){var e=this;if(this.props.responsive){var t=this.props.responsive.map((function(e){return e.breakpoint}));t.sort((function(e,t){return e-t})),t.forEach((function(r,n){var o;o=0===n?te()({minWidth:0,maxWidth:r}):te()({minWidth:t[n-1]+1,maxWidth:r}),z()&&e.media(o,(function(){e.setState({breakpoint:r})}))}));var r=te()({minWidth:t.slice(-1)[0]});z()&&this.media(r,(function(){e.setState({breakpoint:null})}))}}},{key:"componentWillUnmount",value:function(){this._responsiveMediaHandlers.forEach((function(e){e.mql.removeListener(e.listener)}))}},{key:"render",value:function(){var e,t,r=this;(e=this.state.breakpoint?"unslick"===(t=this.props.responsive.filter((function(e){return e.breakpoint===r.state.breakpoint})))[0].settings?"unslick":Object(o.a)(Object(o.a)(Object(o.a)({},re),this.props),t[0].settings):Object(o.a)(Object(o.a)({},re),this.props)).centerMode&&(e.slidesToScroll,e.slidesToScroll=1),e.fade&&(e.slidesToShow,e.slidesToScroll,e.slidesToShow=1,e.slidesToScroll=1);var a=d.a.Children.toArray(this.props.children);a=a.filter((function(e){return"string"==typeof e?!!e.trim():!!e})),e.variableWidth&&(e.rows>1||e.slidesPerRow>1)&&(console.warn("variableWidth is not supported in case of rows > 1 or slidesPerRow > 1"),e.variableWidth=!1);for(var i=[],c=null,u=0;u<a.length;u+=e.rows*e.slidesPerRow){for(var l=[],s=u;s<u+e.rows*e.slidesPerRow;s+=e.slidesPerRow){for(var f=[],p=s;p<s+e.slidesPerRow&&(e.variableWidth&&a[p].props.style&&(c=a[p].props.style.width),!(p>=a.length));p+=1)f.push(d.a.cloneElement(a[p],{key:100*u+10*s+p,tabIndex:-1,style:{width:"".concat(100/e.slidesPerRow,"%"),display:"inline-block"}}));l.push(d.a.createElement("div",{key:10*u+s},f))}e.variableWidth?i.push(d.a.createElement("div",{key:u,style:{width:c}},l)):i.push(d.a.createElement("div",{key:u},l))}if("unslick"===e){var h="regular slider "+(this.props.className||"");return d.a.createElement("div",{className:h},a)}return i.length<=e.slidesToShow&&(e.unslick=!0),d.a.createElement($,Object(n.default)({style:this.props.style,ref:this.innerSliderRefHandler},e),i)}}]),r}(d.a.Component);t.a=ne},2965:function(e,t,r){"use strict";var n=r(3),o=r(0),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M869 487.8L491.2 159.9c-2.9-2.5-6.6-3.9-10.5-3.9h-88.5c-7.4 0-10.8 9.2-5.2 14l350.2 304H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h585.1L386.9 854c-5.6 4.9-2.2 14 5.2 14h91.5c1.9 0 3.8-.7 5.2-2L869 536.2a32.07 32.07 0 000-48.4z"}}]},name:"arrow-right",theme:"outlined"},i=r(17),c=function(e,t){return o.createElement(i.a,Object(n.a)(Object(n.a)({},e),{},{ref:t,icon:a}))};c.displayName="ArrowRightOutlined";t.a=o.forwardRef(c)},2966:function(e,t,r){"use strict";var n=r(3),o=r(0),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"},i=r(17),c=function(e,t){return o.createElement(i.a,Object(n.a)(Object(n.a)({},e),{},{ref:t,icon:a}))};c.displayName="ArrowLeftOutlined";t.a=o.forwardRef(c)},2967:function(e,t,r){"use strict";var n=r(3),o=r(0),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3z"}}]},name:"star",theme:"filled"},i=r(17),c=function(e,t){return o.createElement(i.a,Object(n.a)(Object(n.a)({},e),{},{ref:t,icon:a}))};c.displayName="StarFilled";t.a=o.forwardRef(c)},2968:function(e,t,r){"use strict";var n=r(3),o=r(0),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M955.7 856l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zM480 416c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v184c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V416zm32 352a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"warning",theme:"filled"},i=r(17),c=function(e,t){return o.createElement(i.a,Object(n.a)(Object(n.a)({},e),{},{ref:t,icon:a}))};c.displayName="WarningFilled";t.a=o.forwardRef(c)},3323:function(e,t,r){var n=r(427),o=r(268),a=r(632),i=r(506),c=r(3310),u=r(799),l=a((function(e){var t=u(e);return c(t)&&(t=void 0),i(n(e,1,c,!0),o(t,2))}));e.exports=l},3358:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(0),o=r.n(n),a=r(267),i=Object(a.b)((function(){return Promise.all([r.e(0),r.e(1),r.e(2),r.e(3),r.e(1196)]).then(r.bind(null,3571))}),{suspense:!0});function c(e){return o.a.createElement(i,e,e.children)}},3359:function(e,t,r){"use strict";r.d(t,"a",(function(){return y}));r(143);var n=r(67),o=r(0),a=r.n(o),i=r(11),c=r(46),u=r(185),l=r(230),s=r(228),f=r(238),d=["group","size","placement","getPopupContainer"];function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},p.apply(this,arguments)}function h(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var m=function(e){var t,r,o,s=e.group,m=e.size,y=e.placement,v=e.getPopupContainer,g=h(e,d);y=y||"top",m=m||14;var b=(null===(t=window.appData)||void 0===t?void 0:t.organization)||(null===(r=window.appData)||void 0===r?void 0:r.currentOrganization)||s.organization||{id:s.organization_id},w=Object(u.c)({type:"group",target:s,group:s,org:b}),_=Object(u.d)({privacy:w,type:"group",organization:b,group:s});return a.a.createElement(n.a,{title:a.a.createElement("span",null,_,!Object(l.h)(s)&&(null===(o=s.abilities)||void 0===o?void 0:o.manage)&&a.a.createElement("a",{onClick:function(e){e.stopPropagation(),f.b.windowOpen("/".concat(s.login,"/settings/permission"))},style:{marginLeft:12}},__("切换公开性"))),getPopupContainer:v,placement:y},a.a.createElement("span",{className:"name-lock"},a.a.createElement(c.b,p({},g,{name:w!==i.PRIVACY.private?"icon-public":(null==s||s.extend_private,i.EXTEND_PRIVATE.BIND_DEPARTMENTS,"permission-private"),width:m,height:m}))))},y=function(e){return a.a.createElement(s.a,{withFallbackUI:!0,noMessage:!0,fallbackUI:function(){return a.a.createElement("span",{"data-test-id":"group-access-scope"})}},a.a.createElement(m,e))}},3377:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(a=o.key,i=void 0,i=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(a,"string"),"symbol"===n(i)?i:String(i)),o)}var a,i}var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.__=t}var t,r,n;return t=e,(r=[{key:"_stringify",value:function(e){return null==e||"number"==typeof e&&isNaN(e)?e="":"string"!=typeof e&&(e=String(e)),e}}])&&o(t.prototype,r),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.BaseValidatorClass=a},3407:function(e,t,r){"use strict";t.a={contentArea:"index-module_contentArea_0xSfa",switchTitle:"index-module_switchTitle_qW8aM",switchButton:"index-module_switchButton_xHUSN",tip:"index-module_tip_eCtT0"}},3460:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(a=o.key,i=void 0,i=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(a,"string"),"symbol"===n(i)?i:String(i)),o)}var a,i}var a=r(1026),i=r(457),c=r(1012),u=r(3377).BaseValidatorClass,l=r(3529).MobileValidatorClass,s=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z$/,f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,(r=[{key:"httpURL",value:function(e){e=this._stringify(e);try{var t=new URL(e);if("https:"!==t.protocol&&"http:"!==t.protocol)throw new Error("protocol error")}catch(e){return this.__("请输入正确的 HTTP(s) URL 地址")}}},{key:"alphanumeric",value:function(e){if(!(e=this._stringify(e))||!a.isAlphanumeric(e))return this.__("必须都是字符和数字")}},{key:"numeric",value:function(e){if(!(e=this._stringify(e))||!a.isNumeric(e))return this.__("必须都是数字字符")}},{key:"decimal",value:function(e){if(!(e=this._stringify(e))||!a.isDecimal(e))return this.__("必须是小数或者整数")}},{key:"mobileCode",value:function(e,t){if("string"!=typeof e)return this.__("必须是字符串");if(!a.isNumeric(e))return this.__("必须都是数字字符");var r=t&&t.min||4;return e.length<r?this.__("至少 {s} 个数字",{s:r}):void 0}},{key:"IP",value:function(e){if(!(e=this._stringify(e))||!a.isIP(e))return this.__("必须是 IP v4 或者 v6 格式")}},{key:"IPv4",value:function(e){if(!(e=this._stringify(e))||!a.isIP(e,4))return this.__("必须是 IP v4 格式")}},{key:"IPv6",value:function(e){if(!(e=this._stringify(e))||!a.isIP(e,6))return this.__("必须是 IP v6 格式")}},{key:"bookPublic",value:function(e){if("number"!=typeof e){if(!(e=this._stringify(e))||!a.isNumeric(e))return this.__("public 参数只允许是 0、1 或者 2");e=parseInt(e)}var t=i.book.PUBLIC;if(e!==t.public&&e!==t.private&&e!==t.intranet)return this.__("public 参数只允许是 0、1 或者 2")}},{key:"starType",value:function(e){if(e){var t=["Book","Design"];return t.includes(e)?void 0:this.__("type 参数只允许为 {s}",{s:t.join(", ")})}}},{key:"searchPage250",value:function(e){if("number"!=typeof e){if(!(e=this._stringify(e))||!a.isNumeric(e))return this.__("只允许是正整数并且要小于等于 250");e=parseInt(e)}if(e<1||e>250||isNaN(e))return this.__("只允许是正整数并且要小于等于 250")}},{key:"isEmail",value:function(e){return e=this._stringify(e),a.isEmail(e)}},{key:"isUser",value:function(e){return e=this._stringify(e),/^[A-Za-z0-9][A-Za-z0-9\-_\.]{1,64}$/.test(e)}},{key:"isoDate",value:function(e){if(!e||!s.test(e))return this.__("必须是符合 ISO Date 格式的字符串")}},{key:"looseUrl",value:function(e){e=this._stringify(e);var t=this.__("请输入正确的 URL 地址");if(!e)return t;if(!/^\//.test(e)){if(/^\s*javascript:\/\//i.test(e))return t;try{new URL(e)}catch(e){return t}}}},{key:"stringArr",value:function(e,t){if(e&&t.values&&(e=e.split(",").map((function(e){return e.trim()})),e.some((function(e){return!t.values.includes(e)}))))return this.__("必须是 {type} 其中的值",{type:t.values.join("、")})}}])&&o(t.prototype,r),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),d=c.apply(void 0,[u].concat([l,f]));t.Validator=d,"undefined"!=typeof window&&"function"==typeof window.__&&(t.validator=new d(window.__))},3462:function(e,t,r){"use strict";var n=r(0);t.a=function(e,t){Object(n.useEffect)((function(){if(!t){var r=window.appData.siteName||__("语雀");document.title="".concat(e," · ").concat(r)}}),[e])}},3464:function(e,t,r){"use strict";var n=r(82),o=r.n(n),a={_bookGrayscaleConfig:null,getDefaultDocumentFormat:function(e,t,r){return t=t||"",r=r||{},o.a.DOC_DEFAULT_FORMAT[e]||o.a.FORMAT.LAKE}};t.a=a},3478:function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));r(999);var n=r(651),o=r(0),a=r.n(o),i=r(3309),c=r(455),u=r(11),l=r(238),s=r(3407);function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function d(){d=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof b?t:b,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:A(e,r,c)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var h="suspendedStart",m="suspendedYield",y="executing",v="completed",g={};function b(){}function w(){}function _(){}var E={};l(E,i,(function(){return this}));var O=Object.getPrototypeOf,S=O&&O(O(N([])));S&&S!==r&&n.call(S,i)&&(E=S);var k=_.prototype=b.prototype=Object.create(E);function x(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,c){var u=p(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==f(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=h;return function(a,i){if(o===y)throw new Error("Generator is already running");if(o===v){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var l=p(t,r,n);if("normal"===l.type){if(o=n.done?v:m,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=v,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(f(t)+" is not iterable")}return w.prototype=_,o(k,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(j.prototype),l(j.prototype,c,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(k),l(k,u,"Generator"),l(k,i,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function p(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}var h=function(e){e.type;var t=e.checked,r=e.organization,o=e.onChangePermission,f=a.a.useMemo((function(){var e=null!=r&&r.id?c.a.ORG:c.a.PERSON;return Object(l.a)()?e:c.a.INTERNAL}),[r]),h=function(){var e,t=(e=d().mark((function e(t){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t?f===c.a.PERSON?u.PRIVACY.public:u.PRIVACY.intranet:u.PRIVACY.private,o(r);case 2:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){p(a,n,o,i,c,"next",e)}function c(e){p(a,n,o,i,c,"throw",e)}i(void 0)}))});return function(e){return t.apply(this,arguments)}}();return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:s.a.contentArea},a.a.createElement("span",{className:s.a.switchTitle},i.p[f]),a.a.createElement("div",{className:s.a.switchButton},a.a.createElement(n.a,{size:"small",onChange:h,checked:t}))))}},3481:function(e,t,r){"use strict";r.d(t,"a",(function(){return y}));var n=r(0),o=r(966),a=r(228),i=function(e){var t=e.loader,r=n.useRef(null);return function(){return r.current?Promise.resolve(r.current):t().then((function(e){return r.current=e,r.current})).catch((function(e){return console.error(e.stack)}))}},c={modal:"styles-module_modal_8nT+9"};function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function l(){l=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function f(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var a=t&&t.prototype instanceof b?t:b,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:A(e,r,c)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",m="suspendedYield",y="executing",v="completed",g={};function b(){}function w(){}function _(){}var E={};f(E,i,(function(){return this}));var O=Object.getPrototypeOf,S=O&&O(O(N([])));S&&S!==r&&n.call(S,i)&&(E=S);var k=_.prototype=b.prototype=Object.create(E);function x(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,c){var l=p(e[o],e,a);if("throw"!==l.type){var s=l.arg,f=s.value;return f&&"object"==u(f)&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(f).then((function(e){s.value=e,i(s)}),(function(e){return r("throw",e,i,c)}))}c(l.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=h;return function(a,i){if(o===y)throw new Error("Generator is already running");if(o===v){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var l=p(t,r,n);if("normal"===l.type){if(o=n.done?v:m,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=v,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(u(t)+" is not iterable")}return w.prototype=_,o(k,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:w,configurable:!0}),w.displayName=f(_,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,f(e,s,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(j.prototype),f(j.prototype,c,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(d(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(k),f(k,s,"Generator"),f(k,i,(function(){return this})),f(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){d(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function d(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==u(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===u(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return m(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function y(e){var t=e.loader,r=e.name,u=h(o.a.useModal(),2),s=u[0],d=u[1],m=i({loader:t}),y=function(){var e,t=(e=l().mark((function e(t,o){var i,u;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m();case 2:if(i=e.sent){e.next=6;break}return console.error("SelectorComponent for ".concat(r," load failed")),e.abrupt("return");case 6:return u=new Promise((function(e){var r=s.info({}),u=function(){var e,n;r.destroy(),null==t||null===(e=t.onClose)||void 0===e||e.call(t),null==o||null===(n=o.afterClose)||void 0===n||n.call(o)},l=f(f({},t),{},{onSelect:function(t){e(t),u()},onClose:function(){e(void 0),u()}});r.update(f(f({className:c.modal,icon:null,centered:!0,cancelText:""},o),{},{content:n.createElement(a.a,null,n.createElement(i,l))}))})),e.next=9,u;case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){p(a,n,o,i,c,"next",e)}function c(e){p(a,n,o,i,c,"throw",e)}i(void 0)}))});return function(e,r){return t.apply(this,arguments)}}();return{loadSelector:function(){return m()},showSelector:y,contextHolder:d}}},3482:function(e,t,r){"use strict";r(3203);var n=r(1526);r(3180);t.a=n.a},3488:function(e,t,r){"use strict";var n=r(0),o=r.n(n),a=r(2),i=r.n(a),c=r(5),u=r.n(c),l=r(1420),s=r(230),f=r(3359),d="index-module_groupName_DppYx",p="index-module_groupNameText_XYhrt",h="index-module_groupNameScope_qP0XF",m=function(e){var t=e.group,r=e.size,n=e.nameStyleCls,a=e.linkStyleCls,i=e.showName,c=void 0===i||i,m=e.isLink,y=void 0===m||m,v=e.iconSize,g=e.radius,b=Object(s.e)(t)||Object(s.h)(t),w=c?o.a.createElement("a",{"data-testid":"group-name-link",href:"/".concat(t.login),title:t.name,className:u()(d,n)},o.a.createElement("span",{"data-testid":"group-name-text",className:u()(p,"group-name-text")},t.name),b&&o.a.createElement("span",{className:h},o.a.createElement(f.a,{group:t,size:16}))):null;return!y&&w&&(w=o.a.createElement("span",{title:t.name,className:u()(d,n)},o.a.createElement("span",{"data-testid":"group-name-text",className:u()(p,"group-name-text")},t.name),b&&o.a.createElement("span",{className:h},o.a.createElement(f.a,{group:t,size:16})))),o.a.createElement(o.a.Fragment,null,y?o.a.createElement("a",{"data-testid":"group-avatar-link",href:"/".concat(t.login),title:t.name,className:a},o.a.createElement(l.a,{group:t,size:r,iconSize:v,radius:g})):o.a.createElement(l.a,{group:t,size:r,iconSize:v,radius:g}),w)};m.propTypes={organization:i.a.object,group:i.a.object.isRequired,size:i.a.number,showName:i.a.bool,isLink:i.a.bool,nameStyleCls:i.a.string,iconSize:i.a.number,radius:i.a.number};t.a=m},3509:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(3481),o=function(){return Promise.all([r.e(0),r.e(1),r.e(9),r.e(1316)]).then(r.bind(null,3742)).then((function(e){return e.default}))};function a(){var e=Object(n.a)({loader:o,name:"TemplateSelector"}),t=e.loadSelector,r=e.showSelector;return{loadTemplateSelector:t,showTemplateSelector:function(e){return r(e,{width:e.isDesktop?1100:1140,maskClosable:!0,centered:!0})},contextHolder:e.contextHolder}}},3510:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return f})),r.d(t,"c",(function(){return d})),r.d(t,"b",(function(){return p})),r.d(t,"d",(function(){return s}));var n=r(500),o=(r(101),r(97),r(148));function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function i(e,t,r){return(t=c(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e){var t=function(e,t){if("object"!==a(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===a(t)?t:String(t)}function u(e){return n.ALL_PERMISSIONS.includes(e)}function l(e){return e===n.ROLE.noPermission?0-e:e}var s={gte:function(e,t){return!(!u(e)||!u(t))&&l(e)>=l(t)},gt:function(e,t){return!(!u(e)||!u(t))&&l(e)>l(t)},lt:function(e,t){return!(!u(e)||!u(t))&&l(e)<l(t)},lte:function(e,t){return!(!u(e)||!u(t))&&l(e)<=l(t)},eq:function(e,t){return!(!u(e)||!u(t))&&l(e)===l(t)},max:function(e,t){var r=[u(e),u(t)];if(r.every((function(e){return!!e})))return l(e)>l(t)?e:t;var n=r.indexOf(!0);return n<0?null:n>0?t:e}};function f(e,t,r){if(!e||!t)return null;var a=n.ALL_PERMISSIONS;if(null!=r&&(a=a.filter((function(e){return s.lte(e,r)}))),e.owner_type===n.OWNER_TYPE.User)return a=a.filter((function(e){return e!==n.ROLE.noPermission})),e.owner_id===t.user_id?{edit:!1,delete:!1}:{edit:!0,delete:!0,permissions:a};var i=o.PUBLIC_PRIVACY.includes(t.public),c=t.public===o.PUBLIC.public;return e.owner_type===n.OWNER_TYPE.GroupManager||e.owner_type===n.OWNER_TYPE.OrganizationOwner?{edit:!1,delete:!1}:e.owner_type===n.OWNER_TYPE.GroupMember?{edit:!0,delete:!1,permissions:a.filter((function(e){return i?e!==n.ROLE.noPermission:void 0!==e})),availableTargetPermission:i&&e.role===n.ROLE.noPermission?n.ROLE.readonly:e.role}:e.owner_type===n.OWNER_TYPE.OrganizationMember?{edit:i,delete:!1,permissions:a.filter((function(e){return i?e!==n.ROLE.noPermission:void 0!==e})),availableTargetPermission:i&&e.role===n.ROLE.noPermission?n.ROLE.readonly:i?e.role:n.ROLE.noPermission}:e.owner_type===n.OWNER_TYPE.GroupReadonlyMember?{edit:!i,delete:!1,permissions:i?[n.ROLE.readonly]:[n.ROLE.readonly,n.ROLE.noPermission],availableTargetPermission:i&&e.role===n.ROLE.noPermission?n.ROLE.readonly:e.role}:e.owner_type===n.OWNER_TYPE.OrganizationOutsourcer?{edit:!c&&i,delete:!1,permissions:c?[n.ROLE.readonly]:[n.ROLE.readonly,n.ROLE.noPermission].filter((function(e){return i?void 0!==e:e!==n.ROLE.readonly})),availableTargetPermission:c?n.ROLE.readonly:n.ROLE.noPermission}:{edit:!0,delete:!0,permissions:a}}function d(t,r){var o,a=function(e){return e};return void 0!==e.window&&"function"==typeof e.window.__&&(a=e.window.__),r&&(a=function(){for(var e,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(e=r.__).call.apply(e,[r].concat(n))}),(i(o={},n.ROLE.readonly,a("可阅读")),i(o,n.ROLE.edit,a("可编辑")),i(o,n.ROLE.manage,a("可管理")),i(o,n.ROLE.noPermission,a("无权限")),o)[t]}function p(t){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=o.inOrganization,c=o.ctx,u=o.isYuque,l=void 0===u||u,s=function(e,t){return e};void 0!==e.window&&"function"==typeof e.window.__&&(s=e.window.__),c&&(s=function(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=c.__).call.apply(e,[c].concat(r))});var f=s(!l||a?"团队":"知识小组");return(i(r={},n.OWNER_TYPE.User,s("用户")),i(r,n.OWNER_TYPE.GroupManager,s("{groupTypeName}管理员",{groupTypeName:f})),i(r,n.OWNER_TYPE.GroupMember,s("{groupTypeName}成员",{groupTypeName:f})),i(r,n.OWNER_TYPE.GroupReadonlyMember,s("{groupTypeName}只读成员",{groupTypeName:f})),i(r,n.OWNER_TYPE.OrganizationOwner,s("空间管理员")),i(r,n.OWNER_TYPE.OrganizationMember,s("空间成员")),i(r,n.OWNER_TYPE.OrganizationOutsourcer,s("空间外部联系人")),r)[t]}}).call(this,r(92))},3512:function(e,t,r){"use strict";r(650);var n=r(319),o=(r(41),r(9)),a=r(480),i=r(0),c=r(1420),u=r(140),l=(r(161),r(23)),s=r(5),f=r.n(s),d=r(1382),p=(r(279),r(138)),h=(r(456),r(203)),m=(r(1453),r(1327)),y=(r(37),r(10)),v=r(1408),g=r(46),b=r(329);function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var E=function(){var e=w(Object(i.useState)(),2),t=e[0],r=e[1],n=w(Object(i.useState)(),2),o=n[0],a=n[1],c=new FileReader;return c.addEventListener("load",(function(){r(c.result)}),!1),Object(i.useEffect)((function(){o&&c.readAsDataURL(o)}),[o]),{url:t,uploadFile:a}},O=r(181),S="index-module_iconListContainer_2kTPj",k="index-module_iconListHeader_zgb1B",x="index-module_iconListHeaderTab_Rb7UW",j="index-module_iconListHeaderTabActive_l9CpK",A="index-module_iconListContent_5acPP",L="index-module_iconListIconContainer_W2jPd",T="index-module_iconListIconContainerActive_m+9aX",C="index-module_groupIconBtn_1pBes",P="index-module_groupIconBtnLarge_PGNAs",N="index-module_uploader_uEToK",R="index-module_dragger_yzTL7",I="index-module_imageContainer_lklS2",D="index-module_uploaderContainer_Y0VkK",M="index-module_reupload_3agQP",F="index-module_uploaderFooter_F5A9k",G="index-module_previewContainer_s7urA",U="index-module_preview_8GFmF";function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function q(){return q=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},q.apply(this,arguments)}function V(){V=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==B(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(B(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function z(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function H(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){z(a,n,o,i,c,"next",e)}function c(e){z(a,n,o,i,c,"throw",e)}i(void 0)}))}}function W(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Y(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Y(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var K=function(e){var t=e.value,r=e.onChange,n=e.uploadUrl,a=e.hideDropdown,c=function(e){var t=e.uploadUrl,r=e.onChange,n=e.hideDropdown,o=Object(i.useRef)(),a=E(),c=a.url,u=a.uploadFile,l=Object(i.useRef)(),s=W(Object(i.useState)(!1),2),f=s[0],d=s[1],p=function(){var e=H(V().mark((function e(){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.current){e.next=2;break}return e.abrupt("return");case 2:if(void 0!==o.current.getCroppedCanvas()){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",new Promise((function(e,r){o.current.getCroppedCanvas().toBlob((function(n){var o=new FormData;o.append("file",n,"image.png"),Object(O.ajax)({url:t,method:"POST",data:o,dataType:"json",processData:!1,success:function(t){e(t.data.url)},error:function(e){r(e),y.a.error(__("上传失败"))}})}))})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),h=function(){var e=H(V().mark((function e(){var t;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d(!0),e.prev=1,e.next=4,p();case 4:t=e.sent,null==r||r(t),n();case 7:return e.prev=7,d(!1),e.finish(7);case 10:case"end":return e.stop()}}),e,null,[[1,,7,10]])})));return function(){return e.apply(this,arguments)}}();return{loading:f,localUrl:c,cropper:o,getUploadProps:function(){return{name:"file",showUploadList:!1,dataType:"json",accept:"image/*",beforeUpload:function(e){return e.size/1024/1024>20?(y.a.error(__("图片大小不能超过 {size}M",{size:20})),!1):(u(e),!1)}}},upload:p,preview:l,onOk:h}}({uploadUrl:n,onChange:r,hideDropdown:a}),u=c.loading,l=c.cropper,s=c.getUploadProps,f=c.localUrl,d=c.preview,w=c.onOk;return React.createElement("div",{className:N,"data-testid":"mocked-avatar-uploader"},f||t?React.createElement(p.a,{spinning:!1},React.createElement("div",{className:I},React.createElement("div",{className:D},React.createElement(m.a,{ref:l,src:f||t,containerWidth:window.h5?200:320,cropWidth:window.h5?200:320,aspectRatio:1,preview:d}),React.createElement(b.a,{ml:40,className:G},React.createElement("div",{className:U,ref:d}),React.createElement(b.a,{mt:16},__("预览")))),React.createElement(h.a,s(),React.createElement(o.a,{icon:React.createElement(v.default,null),className:M},__("重新上传"))),React.createElement("div",{className:F},React.createElement(o.a,{onClick:function(){return a()}},__("取消")),React.createElement(o.a,{type:"primary",onClick:w,loading:u},__("确定"))))):React.createElement(h.a.Dragger,q({},s(),{className:R}),React.createElement(o.a,{icon:React.createElement(g.b,{name:"avatar-upload",size:16})},__("上传头像")),React.createElement(b.a,{variant:"caption",fontSize:14,mt:12},__("在此上传或拖入头像"))))};K.defaultProps={uploadUrl:"/api/upload/avatar"};var Q=K;function Z(e){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Z(e)}function J(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==Z(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Z(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var X=function(e){var t=e.value,r=e.onChange,n=e.hideDropdown,o=e.avatar,a=e.setFieldsValue,i=e.iconMap||u.d;return React.createElement("div",{className:A},i.map((function(e){return React.createElement(d.a,{className:f()(L,J({},T,t===e&&!o)),type:"iconButton",onClick:function(){a({avatar:null}),null==r||r(e),n()}},React.createElement(g.b,{name:e,size:24}))})))};function $(e){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$(e)}function ee(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==$(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==$(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===$(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function te(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return re(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return re(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var ne=function(e){var t=te(Object(i.useState)(0),2),r=t[0],n=t[1],o=(null==e?void 0:e.iconMap)||u.d,a=[__("图标"),__("自定义")];return React.createElement("div",{className:f()(S,e.prefixCls)},React.createElement("div",{className:k},a.map((function(e,t){return React.createElement(d.a,{mr:8,className:f()(x,ee({},j,r===t)),onClick:function(){return n(t)},"data-testid":"GroupAvatarSelector-Tabs-".concat(t)},e)}))),React.createElement(l.a.Item,{noStyle:!0,shouldUpdate:function(e,t){return e.avatar!==t.avatar}},(function(t){var n=t.setFieldsValue,a=t.getFieldValue;return React.createElement(l.a.Item,{name:"scene",noStyle:!0,hidden:0!==r,initialValue:o[0]},React.createElement(X,{iconMap:o,setFieldsValue:n,hideDropdown:e.hideDropdown,avatar:a("avatar")}))})),React.createElement(l.a.Item,{name:"avatar",noStyle:!0,hidden:1!==r},React.createElement(Q,{hideDropdown:e.hideDropdown})))};function oe(e){return oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oe(e)}function ae(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ie(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(r),!0).forEach((function(t){ce(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ae(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ce(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==oe(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==oe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===oe(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ue(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return le(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return le(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function le(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}t.a=function(e){var t=e.getFieldValue,r=e.style,l=e.largeSize,s="publicPage"===e.type?u.f:u.d,f=Object(a.f)((function(e){return e.group})),d=t("scene")||s[0],p=t("avatar"),h=ue(Object(i.useState)(!1),2),m=h[0],y=h[1];return React.createElement(n.a,{overlay:React.createElement(ne,{iconMap:s,avatar:p,hideDropdown:function(){return y(!1)}}),trigger:["click"],visible:m,onVisibleChange:y},React.createElement(o.a,{"data-testid":"GroupAvatarSelector",className:l?P:C,style:r,icon:React.createElement(c.a,{group:ie(ie({},f),{},{avatar:p,scene:d,avatar_url:p,iconMap:s}),iconSize:l?38:27,size:38,radius:6})}))}},3514:function(e,t,r){"use strict";r(229);var n=r(34),o=r(0),a=r.n(o),i=r(2),c=r.n(i),u=r(222),l=r.n(u),s=r(1212),f=r(230),d=r(356),p=r(3488),h=r(3526),m="index-module_name_2g47z";function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return v(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var g=n.a.Option;function b(e){var t,r=e.current,i=e.disabled,c=e.groups,u=e.orgs,v=e.placeholder,b=e.size,w=e.loading,_=Object(f.h)()?__("知识小组"):__("团队"),E=y(Object(o.useState)(!1),2),O=E[0],S=E[1];function k(e,t){var r=t.type;return"User"===(null==t?void 0:t.type)&&(r="Group"),e.type===r&&e.id===t.id}function x(){S(!0)}return a.a.createElement("div",{className:"group-selector ".concat(e.className||""),"data-testid":"group-selector"},a.a.createElement(n.a,{size:b,showSearch:!0,disabled:i,loading:w,getPopupContainer:function(e){return e.parentNode},placeholder:v,dropdownMatchSelectWidth:!1,notFoundContent:a.a.createElement("div",{className:"blankslate"},a.a.createElement("span",null,Object(f.h)()?__("没有{groupTitle}信息",{create:a.a.createElement("a",{onClick:x},__("新建")),groupTitle:_}):__("没有{groupTitle}信息，快去{create}一个吧",{create:a.a.createElement("a",{onClick:x},__("新建")),groupTitle:_}))),value:r&&(t=r,null!=t&&t.id?"".concat("isNewOrg"in t?"organization":"group","-").concat(null==t?void 0:t.id):null),onChange:function(t,r){var n;(null!=c&&c.length||null!=u&&u.length)&&(null!=r&&null!==(n=r.value)&&void 0!==n&&n.startsWith("organization")&&(r.target.type="Organization"),e.onChange&&e.onChange(r.target))},filterOption:function(e,t){if(!t.target)return!1;var r=t.target,n=r.login,o=r.name,a=e.toLowerCase();return n.toLowerCase().indexOf(a)>=0||o.toLowerCase().indexOf(a)>=0},placement:"bottomLeft"},c&&c.length?l()(c,"id").map((function(e){return a.a.createElement(g,{"data-testid":"group-selector-".concat(e.login),key:"group-".concat(e.id),value:"group-".concat(e.id),target:e,title:e.name},a.a.createElement("div",{className:"group-selector-item"},a.a.createElement(p.a,{organization:e.organization,group:e,size:24,showCard:!1,nameStyleCls:m,isLink:!1})),k(r,e)&&a.a.createElement(s.default,null))})):null,null!=u&&u.length?u.map((function(e){return a.a.createElement(g,{key:"organization-".concat(e.id),value:"organization-".concat(e.id),title:e.name,target:e},a.a.createElement("div",{className:"group-selector-item"},a.a.createElement(d.g,{className:"group-selector-org-icon",src:e.logo||e.logo_url,size:24,radius:"2px"}),a.a.createElement(d.h,{organization:e,className:"group-selector-org-name"})),k(r,e)&&a.a.createElement(s.default,null))})):null),a.a.createElement(h.default,{isModalVisible:O,handleCancel:function(){S(!1)}}))}b.defaultProps={size:"middle",placeholder:__("请选择{groupTitle}",{groupTitle:Object(f.h)()?__("知识小组"):__("团队")}),groups:[],current:{},onChange:function(){}},b.propTypes={groups:c.a.arrayOf(c.a.object),current:c.a.shape({login:c.a.string,name:c.a.string}),onChange:c.a.func,className:c.a.string,placeholder:c.a.string,disabled:c.a.bool,size:c.a.string};t.a=b},3526:function(e,t,r){"use strict";r.r(t);r(37);var n=r(10),o=(r(73),r(31)),a=(r(60),r(14)),i=(r(41),r(9)),c=(r(161),r(23)),u=r(0),l=r.n(u),s=r(2),f=r.n(s),d=r(1726),p=r.n(d),h=r(3323),m=r.n(h),y=r(1619),v=r(3370),g=r(480),b=r(3373),w=r(3374),_=r(3375),E=b.a.LiteSearchSelector,O=function(e){var t,r,n={type:e.type,me:e.me},o=Object(u.useMemo)((function(){return w.a.create(n)}),[n]);return null!==(t=e.organization)&&void 0!==t&&t.id&&(r=l.a.createElement(_.a,null)),l.a.createElement(E,{type:e.type,userClassType:"normal",isLiteSearchSelector:!0,searchUser:o.searchUser,getDefaultUsers:e.getDefaultUsers||o.searchUsersByIds,checkValid:o.checkValid,onChange:e.onChange,initialValues:e.initialValues,notFoundContent:r})};O.propTypes={type:f.a.string,onChange:f.a.func,initialValues:f.a.array,getDefaultUsers:f.a.func};var S=Object(g.d)((function(e){return{organization:e.organization,me:e.me}}))(O),k=r(50),x=r(3478),j=r(11),A=r(3305),L=r(140),T=r(1404),C=r(22),P=r(3512),N=r(329),R={newGroupModal:"index-module_newGroupModal_An+Qw",title:"index-module_title_gTevv",titleDesc:"index-module_titleDesc_EmDkC",newGroupModalContent:"index-module_newGroupModalContent_LFB42",nameWrapper:"index-module_nameWrapper_OFOD6",avatarGroup:"index-module_avatarGroup_olnac",addMember:"index-module_addMember_i0kI8",addMemberBtn:"index-module_addMemberBtn_nvC2a",btnText:"index-module_btnText_6V0fp",submitBtn:"index-module_submitBtn_ZJkHv"};function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function M(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(Object(r),!0).forEach((function(t){F(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function F(e,t,r){return t=function(e){var t=function(e,t){if("object"!==I(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==I(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===I(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function G(e){return function(e){if(Array.isArray(e))return H(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||z(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(){U=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==I(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(I(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function B(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function q(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){B(a,n,o,i,c,"next",e)}function c(e){B(a,n,o,i,c,"throw",e)}i(void 0)}))}}function V(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||z(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(e,t){if(e){if("string"==typeof e)return H(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?H(e,t):void 0}}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var W=c.a.Item,Y=function(e){var t=e.isModalVisible,r=e.handleCancel,s=e.organization,f=V(Object(u.useState)(),2),d=f[0],h=f[1],g=V(Object(u.useState)(!0),2),b=g[0],w=g[1],_=V(Object(u.useState)(!1),2),E=_[0],O=_[1],I=V(Object(u.useState)(!1),2),D=I[0],M=I[1],F=V(Object(u.useState)([]),2),B=F[0],z=F[1],H=V(Object(u.useState)(j.PRIVACY.private),2),Y=H[0],K=H[1],Q=Object(u.useRef)(),Z=Object(u.useRef)(null),J=Object(u.useMemo)((function(){return B.map((function(e){return e.user_id||e.id}))}),[B]);Object(u.useEffect)((function(){var e;null===(e=Q.current)||void 0===e||e.focus()}),[]);var X=V(c.a.useForm(),1)[0],$=function(e){e&&e.preventDefault(),M((function(e){return!e}))};function ee(){return(ee=q(U().mark((function t(r){var o,a,i,c,u,l,f,h;return U().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.preventDefault(),O(!0),o=X.getFieldsValue(),B&&(o.members=B),a={name:d,description:o.description,avatar:o.avatar,public:Y,scene:o.scene||L.d[0]},null!=s&&s.id&&(a.organization_id=s.id),t.prev=6,t.next=9,k.a.groups.createGroup(a);case 9:if(i=t.sent){if(o.members)try{l=null===(u=o.members.find(A.a.isDepartment))||void 0===u?void 0:u.id,f=o.members.filter((function(e){return!A.a.isDepartment(e)})),h=p()({group_id:i.id,role:1,users:A.a.serializeUserPostBody(f),department_id:l}),k.a.groupUsers.create(h)}catch(e){n.a.error(e.message)}n.a.success(__("新建成功"),1e3),C.f?(Object(T.b)(),e.handleCancel()):window.location.href="/".concat(i.login),null===(c=e.handleSuccess)||void 0===c||c.call(e)}return O(!1),t.abrupt("return",i);case 15:t.prev=15,t.t0=t.catch(6),O(!1);case 18:case"end":return t.stop()}}),t,null,[[6,15]])})))).apply(this,arguments)}var te=Object(u.useCallback)(q(U().mark((function e(){return U().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",B);case 1:case"end":return e.stop()}}),e)}))),[B]),re=function(){var t=q(U().mark((function t(r){var n,o,a,i;return U().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=Z&&Z.current){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,Z.current.searchSelectorBiz.getRealUsers(r);case 4:n=t.sent,o=e.me,a=o.user_id||o.id,i=n.filter((function(e){return(e.user_id||e.id)!==a})),z((function(e){var t=e.findIndex(A.a.isDepartment);return[t,i.findIndex(A.a.isDepartment)].every((function(e){return e>-1}))&&e.splice(t,1),m()([].concat(G(e),G(i)),(function(e){return e.user_id||e.id}))})),$();case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return l.a.createElement(l.a.Fragment,null,l.a.createElement(o.a,{className:R.newGroupModal,title:l.a.createElement("div",{className:R.title},l.a.createElement("p",null,__("新建团队")),l.a.createElement("p",{className:R.titleDesc},__("和成员一起进行项目协作和知识管理"))),width:432,visible:t,onCancel:r,footer:[l.a.createElement(i.a,{className:R.submitBtn,key:"submit",type:"primary",disabled:b,loading:E,onClick:function(e){return ee.apply(this,arguments)}},__("新建"))]},l.a.createElement("div",{className:R.newGroupModalContent},l.a.createElement(c.a,{form:X,layout:"vertical",onValuesChange:function(e){X.setFieldsValue(e)}},l.a.createElement(W,{name:"name",colon:!1,label:__("基本信息")},l.a.createElement("div",{className:R.nameWrapper},l.a.createElement(W,{noStyle:!0,shouldUpdate:function(e,t){return e.scene!==t.scene||e.avatar!==t.avatar}},(function(e){var t=e.getFieldValue;return l.a.createElement(N.a,{mr:8,component:P.a,componentProps:{getFieldValue:t}})})),l.a.createElement(a.a,{type:"text",autoComplete:"off",maxLength:36,placeholder:__("团队名称"),onChange:function(e){h(e.target.value),e.target.value.trim()?w(!1):w(!0)},ref:Q}))),l.a.createElement(W,{colon:!1,name:"description"},l.a.createElement(a.a.TextArea,{className:"group-form-desc",autoComplete:"off",autoSize:{minRows:4},maxLength:100,placeholder:__("团队")+__("简介")})),l.a.createElement(W,{colon:!1,label:l.a.createElement("div",{className:R.addMember},l.a.createElement("div",{className:R.addMemberText},__("添加成员")),l.a.createElement("div",{onClick:$},l.a.createElement("div",{className:R.addMemberBtn},l.a.createElement(y.default,null),l.a.createElement("span",{className:R.btnText},__("批量添加"))))),name:"users"},!D&&l.a.createElement(S,{getDefaultUsers:window.appData.isYuque?null:te,type:"simple",initialValues:J,onChange:function(e){z(e)}})),l.a.createElement(W,{colon:!1,label:__("公开性")},l.a.createElement(x.a,{type:"group",checked:Y!==j.PRIVACY.private,onChangePermission:function(e){K(e)},organization:s}))))),D&&l.a.createElement(v.a,{ref:Z,type:"simpleWithRole",visible:D,title:__("批量添加"),roles:[{key:"member",label:__("成员"),value:2}],onCancel:$,onSubmit:re,initialValues:J,getDefaultUsers:window.appData.isYuque?null:te}))};Y.propTypes={isModalVisible:f.a.bool,handleCancel:f.a.func,handleSuccess:f.a.func,group:f.a.object,organization:f.a.object};t.default=function(e){var t=window.appData,r=t.me,n=t.organization,o=M(M({},e),{},{me:r,organization:n});return l.a.createElement(Y,o)}},3528:function(e,t,r){"use strict";t.a={mediaCard:"index-module_mediaCard_rJwhl",mediaCardImg:"index-module_mediaCardImg_+eTt+",descCard:"index-module_descCard_aQ1eH",mediaBody:"index-module_mediaBody_cUJQ1",actionsButtonWrapper:"index-module_actionsButtonWrapper_7+VwK",button:"index-module_button_D4dXO",mediaCardGarden:"index-module_mediaCardGarden_WYcpy",content:"index-module_content_Opxbi",header:"index-module_header_kVIJA",closeBtn:"index-module_closeBtn_pDaXe",placeholder:"index-module_placeholder_HMURl",collapse:"index-module_collapse_ZkO7Q",collapsePanel:"index-module_collapsePanel_IY3Mu",collapsePanelContent:"index-module_collapsePanelContent_WfYF7",collapsePanelActive:"index-module_collapsePanelActive_pQ2r3",collapseHeader:"index-module_collapseHeader_hqOMx",collapseHeaderArrow:"index-module_collapseHeaderArrow_974uk",closeWrapper:"index-module_closeWrapper_t5yVf",close:"index-module_close_Z0Z3-"}},3529:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(a=o.key,i=void 0,i=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(a,"string"),"symbol"===n(i)?i:String(i)),o)}var a,i}var a=r(1012),i=r(3377).BaseValidatorClass,c=/^(13\d|14\d|15[012356789]|16[567]|17[01235678]|18\d|19\d)\d{8}(\+\d+)?$/,u=/^\+[1-9]\d{0,2}? \d{1,20}$/,l=/^\+86 /,s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,(r=[{key:"chinaMobilePhone",value:function(e){if(!(e=this._stringify(e))||!c.test(e))return this.__("输入正确手机号")}},{key:"globalMobilePhone",value:function(e){return(e=this._stringify(e))&&u.test(e)?l.test(e)?this.__("中国手机号码不需要添加 +86"):void 0:this.__("必须是合法的手机号码")}},{key:"mobilePhone",value:function(e){if(this.globalMobilePhone(e))return l.test(e)?this.__("中国手机号码不需要添加 +86"):this.chinaMobilePhone(e)}},{key:"mobilePhoneForNonChinese",value:function(e){if(this.globalMobilePhone(e))return l.test(e)?this.__("中国手机号码不需要添加 +86"):this.chinaMobilePhone(e)?this.__("必须是合法的手机号码"):void 0}}])&&o(t.prototype,r),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.MobileValidatorClass=s,t.chinaMobilePhoneRE=c,t.globalMobilePhoneRE=u,t.MobileValidator=a.apply(void 0,[i].concat([s]))},3531:function(e,t,r){var n=r(1024).EventEmitter;t.EventEmitter=n,t.mixin=function(e){for(var t in n.prototype)e.prototype[t]=n.prototype[t]}},3532:function(e,t){t.doNothing=function(){},t.hasKeys=function(e){for(var t in e)return!0;return!1},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.isValidVersion=function(e){return null===e||t.isInteger(e)&&e>=0},t.isValidTimestamp=function(e){return t.isValidVersion(e)},t.MAX_SAFE_INTEGER=9007199254740991},3533:function(e,t,r){"use strict";var n=r(0),o=r.n(n),a=r(2),i=r.n(a),c=r(480),u=r(35),l=r(267),s=Object(l.b)((function(){return Promise.all([r.e(0),r.e(1),r.e(12),r.e(20),r.e(1288)]).then(r.bind(null,3751))}),{suspense:!0}),f=function(e){return o.a.createElement(s,e)};f.propTypes={onHistroyChange:i.a.func,onCancel:i.a.func,theme:i.a.string,embed:i.a.bool,isMiniType:i.a.bool,onSearch:i.a.func,location:i.a.object,onClose:i.a.func,isMobile:i.a.bool,sence:i.a.string,subSence:i.a.string,forceDisplay:i.a.bool,history:i.a.object,organization:i.a.object,group:i.a.object,book:i.a.object,doc:i.a.object,me:i.a.object,jumpToNewPage:i.a.bool},t.a=Object(c.d)((function(e){return{search:e.search,group:e.group,book:e.book,doc:e.doc,me:e.me,organization:e.organization}}))(Object(u.withRouter)(f))},3537:function(e,t,r){"use strict";t.a={revertLink:"index-module_revertLink_csROb"}},3570:function(e,t,r){"use strict";r(143);var n=r(67),o=(r(41),r(9)),a=r(0),i=r(329),c=r(1414),u="index-module_container_YifTz",l="index-module_titleContainer_E19Ts",s="index-module_content_u6ksX",f="index-module_close_xIF4s",d=function(e){var t=e.onReadGuide,r=e.sign,d=e.visible,p=e.arrowPointAtCenter,h=e.placement;return a.createElement(n.a,{overlayClassName:u,arrowPointAtCenter:p,destroyTooltipOnHide:!0,autoAdjustOverflow:!0,getPopupContainer:function(){return document.querySelector("#dragBarContainer")},title:a.createElement("div",{className:l},a.createElement("div",{className:s},a.createElement(i.a,{variant:"caption",mt:4,mb:4},__("知识库全新升级，来看看吧"))),a.createElement(o.a,{onClick:t,icon:a.createElement(c.default,{width:14,height:14}),type:"text",className:f})),placement:h,visible:d,align:{targetOffset:[0,4]}},r)},p={FEATURES:[{area:"GROUP_PAGE",enable:!0,type:"custom",tip_id:"feature_group_introduce",tip:__("功能说明"),createdAt:"2022-09-20"},{area:"WIKI_PAGE",enable:!0,type:"custom",tip_id:"feature_org_wiki_introduce",tip:__("功能说明"),createdAt:"2022-09-20"},{area:"GROUP_PAGE",enable:!0,type:"custom",tip_id:"feature_group_introduce",tip:__("功能说明"),createdAt:"2022-10-27"},{area:"GARDEN_PAGE",enable:!0,type:"custom",tip_id:"feature_garden_introduce",tip:__("功能说明"),createdAt:"2022-11-17"},{area:"DASHBOARD_BOOK_MENU",type:"custom",enable:!0,tip_id:"desktop_online_book_entry_tip",customRender:d,placement:"right",containerSelector:'[data-feature-guide-container="desktop_online_book_entry_tip"]',readTrigger:["click"],createdAt:"2023-06-26",styleFix:function(e){e.style.position="absolute",e.style.transform="translateY(-21px)",e.style.left="50px",e.style.zIndex=4},closeGuide:function(e){e.target.closest(".larkui-feature-guide")&&(e.preventDefault(),e.stopPropagation())}},{area:"DASHBOARD_BOOK_MENU_COLLAPSED",type:"custom",enable:!0,tip_id:"desktop_online_book_entry_tip_isCollapsed",customRender:d,placement:"right",containerSelector:'[data-feature-guide-container="desktop_online_book_entry_tip_isCollapsed"]',readTrigger:["click"],createdAt:"2023-06-26",styleFix:function(e){e.style.position="absolute",e.style.left="17px",e.style.top="-30px",e.style.zIndex=4},closeGuide:function(e){e.target.closest(".larkui-feature-guide")&&(e.preventDefault(),e.stopPropagation())}}]},h=r(50),m=r(201),y=p.FEATURES,v={readLiteFeatureGuide:function(e){if("function"==typeof navigator.sendBeacon){var t=new URLSearchParams;t.set("ctoken",Object(m.a)(window)),t.set("type",e.tip_id),navigator.sendBeacon("/api/mine/read_guide?".concat(t.toString()))}else h.a.mine.readGuide({type:e.tip_id});var r=e.containerSelector&&document.querySelector(e.containerSelector);if(r){var n=r.querySelector(".larkui-feature-guide");if(!n)return;n.style.display="none"}},readMiniFeatureGuide:function(e,t){var r=e.tip_id;h.a.mine.readGuide({type:r}),t({type:"guide/readFeatureGuide",payload:{tip_id:r}})},findFeatureGuide:function(e){var t=e.tip_id,r=e.type;return y.find((function(e){return e.tip_id===t&&e.type===r}))},needDisplayGuide:function(e){if("#guide"===window.location.hash)return!0;var t=window.appData.readTip;return!t||!t[e]}};v.FEATURES=y;t.a=v},3572:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(a=o.key,i=void 0,i=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(a,"string"),"symbol"===n(i)?i:String(i)),o)}var a,i}var a="x-yuque-pt-signature",i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.query=new URLSearchParams(window.location.search),this.isServify=!!this.get(a),this.viewport=this.get("viewport"),this.sidebar="0"===this.get("toc_sidebar")?"none":"toc",this.cards=this.get("cards").split(",").map((function(e){return e.trim()})).filter((function(e){return!!e})),this.thirdpartyCards=this.get("thirdparty_cards")?this.get("thirdparty_cards").split(",").map((function(e){return e.trim()})).filter((function(e){return!!e})):[],this.showTitle="0"!==this.get("title"),this.showHeader="0"!==this.get("header"),this.isEmbedMode=this.get("mode").startsWith("embed"),this.autoHeight=this.getAutoHeight(),this.editorType=this.get("editor_type"),this.editorMode=this.get("editor_mode"),this.language=this.get("language")||"zh-cn",this.pageMinWidth=this.get("page_min_width"),this.onchange="1"===this.get("onchange"),this.allowMention="0"!==this.get("mention"),this.allowResource="1"===this.get("resource"),this.watermark=this.get("watermark"),this.backgroundColor=this.get("background_color"),this.bodyBackgroundColor=this.get("body_background_color"),this.toolbarBackgroundColor=this.get("toolbar_background_color"),this.autoSaveInterval=this.getAutoSaveInterval(),this.saveToServer="0"!==this.get("save_to_server"),this.customUploadUrl=this.get("upload_url"),this.customUploadTypes=this.get("upload_types"),this.customMentionUrl=this.getMentionUrl(),this.customMentionOrigin=this.get("search_user_origin"),this.imageUploadUrl=this.getImageUploadUrl(),this.fileUploadUrl=this.getFileUploadUrl(),this.videoUploadUrl=this.getVideoUploadUrl(),this.videoUploadStatusUrl=this.getVideoUploadStatusUrl(),this.fullHTML="1"===this.query.get("full_html"),this.allowResizeVideo=!0,this.extraConfig=JSON.parse(this.query.get("extra_config")||"{}")}var t,r,n;return t=e,(r=[{key:"get",value:function(e){return this.query.get(e)||""}},{key:"getAutoHeight",value:function(){return!window.h5&&"0"!==this.get("auto_height")}},{key:"getAutoSaveInterval",value:function(){var e=this.get("auto_save_interval");return e&&!Number.isNaN(Number(e))?((e=Number(e))<60&&(e=60),1e3*e):null}},{key:"getMentionUrl",value:function(){var e=this.get("search_user_url");return this._joinCsrf(e)}},{key:"getImageUploadUrl",value:function(){return this.customUploadTypes&&this.customUploadTypes.includes("image")?"".concat(this._joinCsrf(this.customUploadUrl),"&type=image"):null}},{key:"getFileUploadUrl",value:function(){return this.customUploadTypes&&this.customUploadTypes.includes("attachment")?"".concat(this._joinCsrf(this.customUploadUrl),"&type=attachment"):null}},{key:"getVideoUploadUrl",value:function(){var e=this.get("upload_video_url");return e?this._joinCsrf(e):null}},{key:"getVideoUploadStatusUrl",value:function(){var e=this.get("upload_video_status_url");return e?this._joinCsrf(e):null}},{key:"_joinCsrf",value:function(e){var t=e.includes("?")?"&":"?";return"".concat(e).concat(t).concat(this._getCustomCsrf())}},{key:"_getCustomCsrf",value:function(){var e=this.get("upload_csrf_token_field"),t=this.get("upload_csrf_token_value");return e?"".concat(e,"=").concat(encodeURIComponent(t)):""}},{key:"isExtremeMode",value:function(){return"extreme"===this.editorMode}}])&&o(t.prototype,r),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();i.isServify=function(){var e=new URLSearchParams(window.location.search).get("from");if(!e)return!1;try{if(new URL(e).searchParams.get(a))return!0}catch(e){}return!1},i.SERVIFY_TAG_SRT=a,t.a=i},3574:function(e,t,r){"use strict";var n=r(50);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(){a=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},c="function"==typeof Symbol?Symbol:{},u=c.iterator||"@@iterator",l=c.asyncIterator||"@@asyncIterator",s=c.toStringTag||"@@toStringTag";function f(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,a=Object.create(o.prototype),c=new P(n||[]);return i(a,"_invoke",{value:A(e,r,c)}),a}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",m="suspendedYield",y="executing",v="completed",g={};function b(){}function w(){}function _(){}var E={};f(E,u,(function(){return this}));var O=Object.getPrototypeOf,S=O&&O(O(N([])));S&&S!==r&&n.call(S,u)&&(E=S);var k=_.prototype=b.prototype=Object.create(E);function x(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(a,i,c,u){var l=p(e[a],e,i);if("throw"!==l.type){var s=l.arg,f=s.value;return f&&"object"==o(f)&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){r("next",e,c,u)}),(function(e){r("throw",e,c,u)})):t.resolve(f).then((function(e){s.value=e,c(s)}),(function(e){return r("throw",e,c,u)}))}u(l.arg)}var a;i(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=h;return function(a,i){if(o===y)throw new Error("Generator is already running");if(o===v){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var l=p(t,r,n);if("normal"===l.type){if(o=n.done?v:m,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=v,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[u];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function r(){for(;++a<t.length;)if(n.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(o(t)+" is not iterable")}return w.prototype=_,i(k,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:w,configurable:!0}),w.displayName=f(_,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,f(e,s,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(j.prototype),f(j.prototype,l,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(d(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(k),f(k,s,"Generator"),f(k,u,(function(){return this})),f(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function i(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function c(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function c(e){i(a,n,o,c,u,"next",e)}function u(e){i(a,n,o,c,u,"throw",e)}c(void 0)}))}}function u(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var s={removeItem:function(e,t){var r=u(t),n=r.findIndex((function(t){return t.id===e.id}));return n>=0&&r.splice(n,1),r},removeItemById:function(e,t){var r=arguments;return c(a().mark((function o(){var i;return a().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return r.length>2&&void 0!==r[2]?r[2]:{},o.next=3,n.a.quickLinks.destroy({id:e});case 3:return i=t.find((function(t){return t.id===e})),o.abrupt("return",s.removeItem(i,u(t)));case 5:case"end":return o.stop()}}),o)})))()},removeItemByTarget:function(e,t){var r=arguments;return c(a().mark((function o(){var i,c;return a().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return i=r.length>2&&void 0!==r[2]?r[2]:{},o.next=3,n.a.quickLinks.destroyByTarget({target_id:e.id,target_type:i.targetType});case 3:return c=t.find((function(t){return t.target_id===e.id})),o.abrupt("return",s.removeItem(c,u(t)));case 5:case"end":return o.stop()}}),o)})))()},addItemByTarget:function(e,t){var r=arguments;return c(a().mark((function o(){var i,c,l,s,f,d,p;return a().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return c=(i=r.length>2&&void 0!==r[2]?r[2]:{}).type,l=i.targetType,s=void 0===l?"":l,f=i.refId,d="/go/".concat(s.toLowerCase(),"/").concat(e.id),o.next=5,n.a.quickLinks.create({title:e.name.substr(0,20),url:d,target_id:e.id,type:c,target_type:s,ref_id:f});case 5:return(p=o.sent).user=e.user,p.target=e,p.url=d,o.abrupt("return",[].concat(u(t),[p]));case 10:case"end":return o.stop()}}),o)})))()},sortItem:function(e,t,r){var n=u(e),o=n[t];return n.splice(t,1),n.splice(r,0,o),n}};t.a=s},3577:function(e,t,r){"use strict";r.d(t,"a",(function(){return w}));r(41);var n=r(9),o=(r(73),r(31)),a=(r(60),r(14)),i=(r(161),r(23)),c=r(0),u=r.n(c),l=r(2),s=r.n(l),f=r(320),d=r(951),p={nameVersion:"SaveAsVersion-module_nameVersion_VphI2"};function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function m(){m=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof b?t:b,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:A(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",y="executing",v="completed",g={};function b(){}function w(){}function _(){}var E={};l(E,i,(function(){return this}));var O=Object.getPrototypeOf,S=O&&O(O(N([])));S&&S!==r&&n.call(S,i)&&(E=S);var k=_.prototype=b.prototype=Object.create(E);function x(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==h(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=d;return function(a,i){if(o===y)throw new Error("Generator is already running");if(o===v){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?v:p,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=v,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(h(t)+" is not iterable")}return w.prototype=_,o(k,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(j.prototype),l(j.prototype,c,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(k),l(k,u,"Generator"),l(k,i,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function y(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return g(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return g(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function b(e){var t=e.version,r=v(i.a.useForm(),1)[0],n=function(){var n,o=(n=m().mark((function n(){var o,a;return m().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,r.validateFields();case 3:return o=n.sent,n.next=6,e.docVersionProxy.name({id:t.id,name:o.name});case 6:a=n.sent,e.onCreated(a),e.onCancel(),n.next=14;break;case 11:n.prev=11,n.t0=n.catch(0),console.log(n.t0);case 14:case"end":return n.stop()}}),n,null,[[0,11]])})),function(){var e=this,t=arguments;return new Promise((function(r,o){var a=n.apply(e,t);function i(e){y(a,r,o,i,c,"next",e)}function c(e){y(a,r,o,i,c,"throw",e)}i(void 0)}))});return function(){return o.apply(this,arguments)}}();return u.a.createElement(o.a,{"data-testid":"history-name-model",closable:!1,maskClosable:!1,onClose:e.onCancel,onCancel:e.onCancel,onOk:n,title:__("保存为版本"),getContainer:function(){var t;return(null===(t=e.getContainer)||void 0===t?void 0:t.call(e))||document.body},visible:!0},u.a.createElement(i.a,{"data-testid":"history-name-form",className:p.nameVersion,form:r,layout:"vertical"},u.a.createElement(i.a.Item,{label:__("版本名称"),name:"name",rules:[{required:!0,message:__("请输入版本名称")},{max:40,message:__("最多 40 个字符")}]},u.a.createElement(a.a,{placeholder:__("最多 40 个字符"),"data-testid":"version-name-input"}))))}function w(e){var t=v(Object(c.useState)(!1),2),r=t[0],o=t[1],a=Object(d.b)();return u.a.createElement(u.a.Fragment,null,a&&u.a.createElement(n.a,{"data-testid":"save-as-version",onClick:function(){o(!0)}},__("保存为版本")),r&&u.a.createElement(b,{getContainer:e.getContainer,version:e.version,onCreated:e.onCreated,docVersionProxy:e.docVersionProxy,onCancel:function(){o(!1)}}))}b.propTypes={version:s.a.object.isRequired,onCreated:s.a.func.isRequired,onCancel:s.a.func.isRequired,docVersionProxy:s.a.object.isRequired},w.propTypes={version:s.a.object.isRequired,onCreated:s.a.func.isRequired,docVersionProxy:s.a.object.isRequired};t.b=Object(f.b)(b,!1)},3583:function(e,t,r){var n=r(166);e.exports=function(e,t,r){for(var o=-1,a=e.length;++o<a;){var i=e[o],c=t(i);if(null!=c&&(void 0===u?c==c&&!n(c):r(c,u)))var u=c,l=i}return l}},3584:function(e,t,r){var n=new(r(3774));e.exports=n},3585:function(e,t){function r(e,t){this.code=e,this.message=t||"",Error.captureStackTrace?Error.captureStackTrace(this,r):this.stack=(new Error).stack}r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r.prototype.name="ShareDBError",r.CODES={ERR_APPLY_OP_VERSION_DOES_NOT_MATCH_SNAPSHOT:"ERR_APPLY_OP_VERSION_DOES_NOT_MATCH_SNAPSHOT",ERR_APPLY_SNAPSHOT_NOT_PROVIDED:"ERR_APPLY_SNAPSHOT_NOT_PROVIDED",ERR_CLIENT_ID_BADLY_FORMED:"ERR_CLIENT_ID_BADLY_FORMED",ERR_CONNECTION_SEQ_INTEGER_OVERFLOW:"ERR_CONNECTION_SEQ_INTEGER_OVERFLOW",ERR_CONNECTION_STATE_TRANSITION_INVALID:"ERR_CONNECTION_STATE_TRANSITION_INVALID",ERR_DATABASE_ADAPTER_NOT_FOUND:"ERR_DATABASE_ADAPTER_NOT_FOUND",ERR_DATABASE_DOES_NOT_SUPPORT_SUBSCRIBE:"ERR_DATABASE_DOES_NOT_SUPPORT_SUBSCRIBE",ERR_DATABASE_METHOD_NOT_IMPLEMENTED:"ERR_DATABASE_METHOD_NOT_IMPLEMENTED",ERR_DEFAULT_TYPE_MISMATCH:"ERR_DEFAULT_TYPE_MISMATCH",ERR_DOC_MISSING_VERSION:"ERR_DOC_MISSING_VERSION",ERR_DOC_ALREADY_CREATED:"ERR_DOC_ALREADY_CREATED",ERR_DOC_DOES_NOT_EXIST:"ERR_DOC_DOES_NOT_EXIST",ERR_DOC_TYPE_NOT_RECOGNIZED:"ERR_DOC_TYPE_NOT_RECOGNIZED",ERR_DOC_WAS_DELETED:"ERR_DOC_WAS_DELETED",ERR_INFLIGHT_OP_MISSING:"ERR_INFLIGHT_OP_MISSING",ERR_INGESTED_SNAPSHOT_HAS_NO_VERSION:"ERR_INGESTED_SNAPSHOT_HAS_NO_VERSION",ERR_MAX_SUBMIT_RETRIES_EXCEEDED:"ERR_MAX_SUBMIT_RETRIES_EXCEEDED",ERR_MESSAGE_BADLY_FORMED:"ERR_MESSAGE_BADLY_FORMED",ERR_MILESTONE_ARGUMENT_INVALID:"ERR_MILESTONE_ARGUMENT_INVALID",ERR_OP_ALREADY_SUBMITTED:"ERR_OP_ALREADY_SUBMITTED",ERR_OP_NOT_ALLOWED_IN_PROJECTION:"ERR_OP_NOT_ALLOWED_IN_PROJECTION",ERR_OP_SUBMIT_REJECTED:"ERR_OP_SUBMIT_REJECTED",ERR_OP_VERSION_MISMATCH_AFTER_TRANSFORM:"ERR_OP_VERSION_MISMATCH_AFTER_TRANSFORM",ERR_OP_VERSION_MISMATCH_DURING_TRANSFORM:"ERR_OP_VERSION_MISMATCH_DURING_TRANSFORM",ERR_OP_VERSION_NEWER_THAN_CURRENT_SNAPSHOT:"ERR_OP_VERSION_NEWER_THAN_CURRENT_SNAPSHOT",ERR_OT_OP_BADLY_FORMED:"ERR_OT_OP_BADLY_FORMED",ERR_OT_OP_NOT_PROVIDED:"ERR_OT_OP_NOT_PROVIDED",ERR_PROTOCOL_VERSION_NOT_SUPPORTED:"ERR_PROTOCOL_VERSION_NOT_SUPPORTED",ERR_QUERY_EMITTER_LISTENER_NOT_ASSIGNED:"ERR_QUERY_EMITTER_LISTENER_NOT_ASSIGNED",ERR_SNAPSHOT_READ_SILENT_REJECTION:"ERR_SNAPSHOT_READ_SILENT_REJECTION",ERR_SNAPSHOT_READS_REJECTED:"ERR_SNAPSHOT_READS_REJECTED",ERR_SUBMIT_TRANSFORM_OPS_NOT_FOUND:"ERR_SUBMIT_TRANSFORM_OPS_NOT_FOUND",ERR_TYPE_CANNOT_BE_PROJECTED:"ERR_TYPE_CANNOT_BE_PROJECTED",ERR_UNKNOWN_ERROR:"ERR_UNKNOWN_ERROR"},e.exports=r},3586:function(e,t,r){t.defaultType=r(3599).type,t.map={},t.register=function(e){e.name&&(t.map[e.name]=e),e.uri&&(t.map[e.uri]=e)},t.register(t.defaultType)},3588:function(e,t,r){"use strict";var n,o=r(58),a=r.n(o),i=r(83),c=r.n(i),u=r(86),l=r.n(u),s=r(0),f=r.n(s),d=r(2),p=r.n(d),h=r(5),m=r.n(h),y=(r(3183),["onSort","className"]);function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){c()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function b(e){var t,r,o=e.onSort,i=e.className,c=l()(e,y),u=Object(s.useRef)();function d(e){var t=e.target;if(t.classList.remove("placeholder"),Object.assign(t.style,{width:"",height:""}),!n.dropped){var r=parseInt(t.dataset.index,10);u.current.removeChild(t),u.current.insertBefore(t,u.current.children[r])}}function p(e){if(r!==e){r=e,u.current.classList.add("droppable");var n=u.current.children[r],o=u.current.querySelector(".placeholder")||document.createElement("div");o.classList.add("placeholder"),o!==n&&(u.current.insertBefore(o,n),t=null)}}function h(){r=null;var e=u.current.querySelector(".placeholder:empty");e&&e.remove(),u.current.classList.remove("droppable")}Object(s.useEffect)((function(){Array.from(u.current.querySelectorAll('[draggable="true"]'),(function(e,t){e.dataset.index=t}))}),[e.children]);var v={};return f.a.createElement("div",a()({},c,{className:m()("larkui-sortable",i),onDragStart:function(t){var r=t.target;if(r.parentNode===u.current){var o;t.stopPropagation();try{o=JSON.parse(r.dataset.drag)}catch(e){}var a=g(g({},o),{},{type:u.current.dataset.type,index:parseInt(r.dataset.index,10),rect:r.getBoundingClientRect(),origin:{x:t.clientX,y:t.clientY}});t.dataTransfer.setData("application/json",JSON.stringify(a)),n=a,t.dataTransfer.effectAllowed="move",t.dataTransfer.setDragImage(r,t.clientX-a.rect.x,t.clientY-a.rect.y),r.addEventListener("dragend",d,{once:!0}),e.onDragStart(),setTimeout((function(){r.classList.add("placeholder"),Object.assign(r.style,{width:"".concat(a.rect.width,"px"),height:"".concat(a.rect.height,"px")})}),1)}},onDragEnter:function(e){e.dataTransfer.dropEffect="move",t=null},onDragOver:function(e){var r=n;if(r&&r.type===u.current.dataset.type){e.preventDefault();var o=e.clientX-r.origin.x,a=e.clientY-r.origin.y,i={width:r.rect.width,height:r.rect.height,top:r.rect.top+a,right:r.rect.right+o,bottom:r.rect.bottom+a,left:r.rect.left+o},c=(e.clientY,v.clientY,e.clientX-v.clientX>0),l=(e.clientX,v.clientX,e.clientY-v.clientY>0);v={clientX:e.clientX,clientY:e.clientY},t||(t=Array.from(u.current.children,(function(e){return e.getBoundingClientRect()})));var s=t.reduce((function(e,t,r){if(i.top>t.bottom||i.right<t.left||i.bottom<t.top||i.left>t.right)return e;var n=Math.max(i.left,t.left),o=Math.max(i.top,t.top),a=(Math.min(i.right,t.right)-n)*(Math.min(i.bottom,t.bottom)-o);return a>e.area?{area:a,index:c||l?r+1:r}:e}),{area:0});s.area/(i.width*i.height)>=.3?p(s.index):p(t.length)}},onDragLeave:function(e){if(!e.currentTarget.contains(e.relatedTarget)){var t=e.currentTarget.getBoundingClientRect(),r=getComputedStyle(e.currentTarget).marginTop,n=Math.max(t.top,t.top-parseInt(r,10));e.clientX>=t.left&&e.clientX<=t.right&&e.clientY>=n&&e.clientY<=t.bottom||h()}},onDrop:function(e){e.preventDefault();var t=n;null!=t.index&&null!=r&&(t.dropped=!0,o(t,r)),h()},ref:u}),e.children)}b.defaultProps={onDragStart:function(){}},b.propTypes={children:p.a.array,className:p.a.string,onSort:p.a.func,onDragStart:p.a.func},t.a=b},3596:function(e,t,r){"use strict";r.r(t),r.d(t,"getAvailableGroups",(function(){return _}));r(73);var n=r(31),o=(r(37),r(10)),a=r(0),i=r.n(a),c=r(2),u=r.n(c),l=r(50),s=r(101),f=r(59),d=r(3659),p="index-module_newRepoModal_Z6mze",h="index-module_title_ECR9O";function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function y(){y=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof b?t:b,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:A(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",v="completed",g={};function b(){}function w(){}function _(){}var E={};l(E,i,(function(){return this}));var O=Object.getPrototypeOf,S=O&&O(O(N([])));S&&S!==r&&n.call(S,i)&&(E=S);var k=_.prototype=b.prototype=Object.create(E);function x(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==m(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===v){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?v:p,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=v,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(m(t)+" is not iterable")}return w.prototype=_,o(k,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(j.prototype),l(j.prototype,c,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(k),l(k,u,"Generator"),l(k,i,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return g(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return g(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function b(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function w(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){b(a,n,o,i,c,"next",e)}function c(e){b(a,n,o,i,c,"throw",e)}i(void 0)}))}}var _=function(){var e=w(y().mark((function e(){var t,r,n,o,a,i,c,u,d,p;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=window.appData,r=t.isYuque,n=t.organization,o=t.me,a=t.settings,i=f.a.isInOrg(),c=null==a?void 0:a.publication_enable_whitelist,u=!r&&((null==c?void 0:c.includes(null==o?void 0:o.id))||(null==c?void 0:c.includes("all"))),d={filterByAbility:"create_book",scene:"create_book"},i&&(d.organization_id=n.id),p=u?l.a.mine.publications:function(){return[]},e.next=9,Promise.all([l.a.mine.groups(d),p(d)]).then((function(e){var t=v(e,2),r=t[0],n=t[1],o=r.concat(n);return o=o.filter((function(e){var t;return e.group_user_role!==s.default.ROLE.readonly&&(null===(t=e.abilities)||void 0===t?void 0:t.createBook)}))}));case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),E=function(e){var t=e.isModalVisible,r=e.handleCancel,c=e.stackId,u=e.onBookCreated,l=e.belongTo,s=e.bookNameDefault,m=e.group,g=v(Object(a.useState)(t),2),b=g[0],E=g[1],O=f.a.isInOrg(),S=v(Object(a.useState)([]),2),k=S[0],x=S[1];return Object(a.useEffect)((function(){var e=function(){var e=w(y().mark((function e(){var t;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_();case 2:if(t=e.sent,!O||0!==(null==t?void 0:t.length)){e.next=7;break}return null==r||r(),o.a.warning(__("暂时无法操作，请先联系管理员，加入团队成员后才能进行知识协作")),e.abrupt("return");case 7:x(t);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[]),Object(a.useEffect)((function(){E(t)}),[t]),O&&0===k.length?null:i.a.createElement(i.a.Fragment,null,i.a.createElement(n.a,{className:p,title:i.a.createElement("div",{className:h},__("新建知识库")),width:424,visible:b,onCancel:function(){E(!1),null==r||r()},footer:null},i.a.createElement(d.a,{stackId:c,onBookCreated:u,onCancel:function(){E(!1),null==r||r()},belongTo:null!=m&&m.isWiki?[]:l,bookNameDefault:s,group:m,availableGroups:k})))};E.propTypes={isModalVisible:u.a.bool,handleCancel:u.a.func,stackId:u.a.string,onBookCreated:u.a.func,belongTo:u.a.array,bookNameDefault:u.a.string,group:u.a.object};t.default=E},3601:function(e,t,r){"use strict";r(73);var n=r(31),o=(r(41),r(9)),a=(r(279),r(138)),i=(r(37),r(10)),c=r(0),u=r.n(c),l=r(2),s=r.n(l),f=r(57),d=r.n(f),p=r(1424),h=r(362),m=r(380),y=r(458),v=r(238),g=r(1321),b=r.n(g),w=r(228),_=r(267),E=r(22),O=r(1431),S=r(962),k="DocExport-module_docExport_zwx9b",x="DocExport-module_title_eGdGG",j="DocExport-module_entry_qjwYu",A="DocExport-module_setting_yai1Y",L="DocExport-module_settingTitle_IjcSw",T="DocExport-module_settingUpload_3ymtX";function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function N(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach((function(t){R(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function R(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==C(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==C(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===C(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function I(){I=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(P([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==C(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function P(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(C(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=P,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:P(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function D(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function M(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){D(a,n,o,i,c,"next",e)}function c(e){D(a,n,o,i,c,"throw",e)}i(void 0)}))}}function F(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return G(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return G(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var U=Object(_.b)((function(){return Promise.all([r.e(12),r.e(24),r.e(1227)]).then(r.bind(null,4832))}),{suspense:!0}),B=S.a.STATUS,q=function(e){var t=e.bookId,r=e.exportParams,l=e.onCancel,s=e.wrapModal,f=void 0===s||s,g=function(e){var t=e.doc,r=e.bookId,n=e.exportParams,o=F(Object(c.useState)(t||null),2),a=o[0],i=o[1],l=F(Object(c.useState)(!1),2),s=l[0],f=l[1],p=F(Object(c.useState)(t?b.a.SUPPORTED_EXPORT_FORMATS[t.type]:[]),2),h=p[0],m=p[1],v=Object(c.useRef)();return Object(c.useEffect)((function(){var e=a&&("Mind"===a.type||"Board"===a.type),t=null,o=function(){var e=M(I().mark((function e(){var t;return I().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.doc_id){e.next=11;break}return f(!0),e.next=5,y.a.docs.findOne({id:n.toc_node_url,book_id:r});case 5:t=e.sent,i(t),f(!1),m(b.a.SUPPORTED_EXPORT_FORMATS[t.type]),e.next=12;break;case 11:m([b.a.THIRD_PARTY_FORMAT.LAKE]);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();if(a){if(!e)return;t=document.createElement("div"),document.body.appendChild(t),d.a.render(u.a.createElement(U,{height:"100%",width:"100%",onLoad:function(e){v.current=e},content:a.content}),t)}else o();return function(){t&&(document.body.removeChild(t),t=null)}}),[a]),{state:{currentDoc:a,loading:s,formats:h},lakeBoardEngineRef:v}}(e),w=g.state,_=w.currentDoc,C=w.loading,P=w.formats,R=g.lakeBoardEngineRef,D=F(Object(c.useState)(),2),G=D[0],q=D[1],V=F(Object(c.useState)(),2),z=V[0],H=V[1],W=F(Object(c.useState)(),2),Y=W[0],K=W[1],Q=F(Object(c.useState)(B.INIT),2),Z=Q[0],J=Q[1],X=F(Object(c.useState)(""),2),$=X[0],ee=X[1],te=Object(c.useRef)(),re={markdown:[[{label:__("导出 LaTeX 公式图片"),name:"latexType",default:!0,value:1},{label:__("导出 LaTeX 公式为 Markdown 语法"),name:"latexType",value:2}],{label:__("导出保持语雀的锚点"),name:"enableAnchor",value:1},{label:__("导出保持语雀的换行"),name:"enableBreak",value:1}],pdf:[{label:__("导出文档大纲"),default:!0,name:"enableToc",value:1}]},ne=function(){var e=M(I().mark((function e(n){var o,a,i,c,u,l;return I().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o={type:n,force:0},te.current&&(a=te.current.getValue())&&(o.options=JSON.stringify(a)),c=66e4/(i=5e3),u=0;case 5:if(!(u<c)){e.next=33;break}if(e.prev=6,"lakebook"!==n){e.next=13;break}return e.next=10,y.a.books.exports(N(N({},o),{},{id:t,title:r.toc_node_title,toc_node_uuid:r.toc_node_uuid,toc_node_url:r.toc_node_url,with_children:!0}));case 10:l=e.sent,e.next=17;break;case 13:if(!_){e.next=17;break}return e.next=16,y.a.docs.exports(N(N({},o),{},{id:_.id}));case 16:l=e.sent;case 17:if("success"!==l.state){e.next=19;break}return e.abrupt("return",l);case 19:if("error"!==l.state){e.next=23;break}if(!l.error){e.next=22;break}return e.abrupt("return",l.error);case 22:return e.abrupt("return",{error:l.message});case 23:return e.next=25,Object(h.a)(i);case 25:u++,e.next=31;break;case 28:return e.prev=28,e.t0=e.catch(6),e.abrupt("return",{error:e.t0.message});case 31:e.next=5;break;case 33:throw new Error("处理超时，请重试...");case 34:case"end":return e.stop()}}),e,null,[[6,28]])})));return function(t){return e.apply(this,arguments)}}(),oe=function(){var e=M(I().mark((function e(t){var r;return I().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!_||b.a.SUPPORTED_EXPORT_FORMATS[_.type]){e.next=2;break}return e.abrupt("return");case 2:return q(t),J(B.PROCESSING),K(null),e.prev=5,e.next=8,ne(t);case 8:if(!(r=e.sent).error){e.next=13;break}return J(B.ERROR),ee(r.error),e.abrupt("return");case 13:q(t),J(B.SUCCESS),K(r.url),v.b.download(r.url),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(5),J(B.ERROR),ee(e.t0.message);case 23:case"end":return e.stop()}}),e,null,[[5,19]])})));return function(t){return e.apply(this,arguments)}}(),ae=(_&&("Mind"===_.type||_.type),function(){var e=M(I().mark((function e(t,r){var n;return I().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:R.current&&(null===(n=R.current)||void 0===n||n.export(t,r));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),ie=function(e){var t=_&&("Mind"===_.type||"Board"===_.type);!t||_.content?(H(b.a.THIRD_PARTY_FORMAT[e.toUpperCase()]),!t||e!==b.a.THIRD_PARTY_FORMAT.JPG.key&&e!==b.a.THIRD_PARTY_FORMAT.PNG.key?("Show"!==(null==_?void 0:_.type)||"pdf"!==e)&&re[e]?(q(e),J(B.SETTING)):oe(e):ae(e,{filename:_.title})):i.a.warn(__("画板为空，请编辑发布后导出"))},ce=null;return Z===B.PROCESSING?ce=z?u.a.createElement("div",{className:A},u.a.createElement("h1",{className:L},__("导出 {type}",{type:z.name})),u.a.createElement(S.a.Processing,{tip:__("正在导出中...")})):null:Z===B.SUCCESS?ce=z?u.a.createElement("div",{className:A},u.a.createElement("h1",{className:L},__("导出 {type}",{type:z.name})),u.a.createElement(S.a.Success,{tip:__("文件生成成功"),action:u.a.createElement(m.a,{href:E.g?null:Y,desktopDisableHref:!0,target:"_blank",onClick:function(){v.b.download(Y)}},__("点击下载"))})):null:Z===B.ERROR?ce=u.a.createElement(S.a.Error,{tip:__("文件生成失败"),error:$,action:u.a.createElement(o.a,{icon:u.a.createElement(p.default,null),size:"small",onClick:function(){oe(G)}},__("重新生成"))}):Z===B.INIT&&(ce=u.a.createElement("div",{className:j},u.a.createElement("div",{className:x},__("导出文档")),u.a.createElement(a.a,{spinning:C},u.a.createElement(O.a,{mode:"export",types:P,onSelect:ie})))),ce=u.a.createElement("div",{className:k},ce,function(){if(!z||!_)return null;var e=re[z.key];return e?u.a.createElement("div",{className:A,style:{display:Z===B.SETTING?"block":"none"}},u.a.createElement("h1",{className:L},__("{type} 导出配置",{type:z.name})),u.a.createElement(S.a.AdvanceSetting,{wrappedComponentRef:te,target:_,type:z,settings:e,actions:u.a.createElement(o.a,{type:"primary",className:T,onClick:function(){return oe(G)}},__("导出"))})):null}()),u.a.createElement("div",null,f?u.a.createElement(n.a,{title:null,onCancel:l,visible:!0,footer:null,width:640,maskClosable:!1},ce):ce)};q.defaultProps={exportParams:{}},q.propTypes={doc:s.a.object,exportParams:s.a.object,bookId:s.a.number.isRequired,onCancel:s.a.func.isRequired,wrapModal:s.a.bool};t.a=Object(w.b)(q,!0)},3605:function(e,t,r){"use strict";var n=r(1321);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}var a={adaptDocToDocument:function(e){return{origin:"database",format:e.format,draft_version:e.draft_version,base_timestamp:e.content_updated_at,value:this.adaptBodyToContent(e)}},adaptBodyToContent:function(e){var t;return"object"===o(t=n.FORMATS_SAVE_TO_BODY_ASL.includes(e.format)?e.body_draft_asl||e.body_asl||"":e.body_draft||e.body||"")&&(t=JSON.stringify(t)),t.trim()},adaptCacheDataToDocument:function(e,t){if(!e)return null;try{var r=JSON.parse(e);return"object"!==o(r)?null:["lakesheet","spreadjs"].includes(t)&&r.doc?{origin:"cache",format:t,draft_version:r.doc.data.draft_version,value:r.doc.value}:{origin:"cache",format:t,draft_version:r.draft_version,base_timestamp:r.base_timestamp||null,value:r.content}}catch(e){throw e}},adaptChangeToCacheData:function(e,t){var r={draft_version:e.draft_version,base_timestamp:t,content:e.value};return JSON.stringify(r)},adapterDocumentContent:function(e){return"string"==typeof e.value?e.value:"object"===o(e.value)?JSON.stringify(e.value):""}};t.a=a},3607:function(e,t,r){"use strict";var n=r(0),o=r.n(n),a=r(35),i=r(3528);function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==c(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===c(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}t.a=function(e){var t,r=Object(a.useHistory)();return o.a.createElement("div",{className:i.a.actionsButtonWrapper},null==e||null===(t=e.actions)||void 0===t?void 0:t.map((function(t,n){return t.render?t.render(l(l({},e),{},{history:r})):o.a.createElement("div",{className:i.a.button,onClick:function(){return t.onClick(l(l({},e),{},{history:r}))},key:n},t.title)})))}},3610:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var n=r(0),o=r.n(n),a=r(455),i=r(238),c=r(11),u=r(3407),l=function(e){var t=e.organization,r=e.publicValue,n=o.a.useMemo((function(){var e=null!=t&&t.id?a.a.ORG:a.a.PERSON;return Object(i.a)()?e:a.a.INTERNAL}),[t]);return r===c.PRIVACY.private?null:o.a.createElement(o.a.Fragment,null,n===a.a.INTERNAL&&o.a.createElement("div",{className:u.a.tip,"data-testid":"ali-security-tip"},__("如涉及到公司敏感信息（包括L3、L4及部分L2级信息），请勿开启！")),n===a.a.PERSON&&o.a.createElement("div",{className:u.a.tip,"data-testid":"ali-security-tip"},__("开启后，互联网所有获得链接的人皆可访问知识库下的全部内容。你需对其合法合规性负责，遵守相关法律法规及语雀 {terms} 约定，违规内容可能无法被查看。",{terms:o.a.createElement("a",{href:"https://www.yuque.com/terms#ubab347c6",target:"_blank"},__("服务协议"))})))}},3614:function(e,t,r){var n=r(3583),o=r(3615),a=r(232);e.exports=function(e){return e&&e.length?n(e,a,o):void 0}},3615:function(e,t){e.exports=function(e,t){return e>t}},3616:function(e,t,r){var n=r(1198);e.exports=function(e){return"number"==typeof e&&e==n(e)}},3617:function(e,t,r){"use strict";r(3209);var n=r(1542);r(3185);t.a=n.a},3628:function(e,t,r){"use strict";r(143);var n=r(67),o=r(0),a=r.n(o),i=r(2),c=r.n(i),u=r(57),l=r.n(u),s=r(1414);function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){h(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==f(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===f(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return y(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return y(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function v(e,t){return a.a.createElement("span",{className:"larkui-feature-guide-sign",style:t,onClick:e,"data-testid":"feature-guide-sign"},a.a.createElement("span",{className:"larkui-feature-guide-sign-spirit-outer"}),a.a.createElement("span",{className:"larkui-feature-guide-sign-spirit-inner"}))}function g(e){var t=e.type,r=void 0===t?"lite":t,i=e.tip,c=e.enableMultiLines,u=e.guideSignContainerStyle,f=m(Object(o.useState)(!0),2),d=f[0],h=f[1];if(!d)return null;var y=document.querySelector(e.containerSelector);if(!y)return null;var g=function(){h(!1),e.onRead()},b=function(){var t=y.querySelector(".larkui-feature-guide");if(t)return t;(t=document.createElement("div")).classList.add("larkui-feature-guide");if(t.classList.add({lite:"larkui-feature-guide-lite",mini:"larkui-feature-guide-mini",custom:"larkui-feature-guide-custom"}[r]),t.setAttribute("data-testid","feature-guide"),["lite","custom"].includes(r)){y.style.position="relative";var n=y.getBoundingClientRect();switch(e.placement){case"right":t.style.left="".concat(n.width+2,"px");break;case"left":t.style.left="-14px";break;case"top":t.style.bottom="".concat((e.offsetY?parseInt(e.offsetY,10):0)+n.height,"px"),t.style.left="".concat(n.width/2-6,"px");break;default:t.style.left="".concat((n.width-12)/2,"px"),t.style.bottom=e.offsetY||"0"}e.styleFix&&e.styleFix(t)}var o=e.readTrigger||[],a=function t(r){r.target.closest(".larkui-feature-guide")&&(r.preventDefault(),r.stopPropagation()),h(!1),e.onRead(),o.forEach((function(r){y.removeEventListener(r,e.closeGuide||t)}))};return o.forEach((function(t){y.addEventListener(t,e.closeGuide||a)})),y.appendChild(t),t}(),w=v(g,u),_=c?"larkui-feature-guide-lite-close-multi-line":"larkui-feature-guide-lite-close";if("mini"===r)return l.a.createPortal(w,b);var E="center"!==e.placement&&"top"!==e.placement;return"custom"===r?l.a.createPortal(a.a.createElement(e.customRender,p(p({},e),{},{sign:w,visible:d,arrowPointAtCenter:E,portalDom:b,onReadGuide:g,setVisible:h})),b):"lite"===r?l.a.createPortal(a.a.createElement(n.a,{overlayClassName:"larkui-feature-guide-lite-tip",arrowPointAtCenter:E,autoAdjustOverflow:!1,defaultVisible:!0,title:a.a.createElement(a.a.Fragment,null,c?a.a.createElement("div",{className:"larkui-feature-guide-content",onClick:g},i):a.a.createElement("span",{className:"larkui-feature-guide-lite-content"},a.a.createElement("strong",null,i)),a.a.createElement("span",{onClick:g,className:_},a.a.createElement(s.default,{width:16,height:16}))),placement:e.placement,visible:d,align:{targetOffset:[0,4]}},w),b):void 0}g.Mini=function(){return a.a.createElement("span",{className:"larkui-feature-guide-mini","data-testid":"standalone-mini-guide"},v((function(){})))},g.defaultProps={enableMultiLines:!1},g.propTypes={type:c.a.oneOf(["lite","mini","custom"]),tip:c.a.oneOfType([c.a.string,c.a.node]),containerSelector:c.a.string.isRequired,readTrigger:c.a.array,placement:c.a.oneOf(["bottomRight","bottomLeft","bottom","right","left","top"]),offsetY:c.a.string,onRead:c.a.func.isRequired,guideSignContainerStyle:c.a.object,enableMultiLines:c.a.bool,customRender:c.a.element,styleFix:c.a.func,closeGuide:c.a.func};t.a=g},3629:function(e,t,r){"use strict";r.d(t,"a",(function(){return le})),r.d(t,"b",(function(){return T}));var n=r(135),o=r.n(n),a=r(3614),i=r.n(a),c=r(817),u=r.n(c),l=r(3465),s=r.n(l),f=r(724),d=r.n(f),p=r(1020),h=r.n(p),m=r(3616),y=r.n(m),v=r(175),g=r.n(v),b=r(366),w=r.n(b);function _(e,t){return function(e){for(var t,r=e.rows,n=r.length,o=[],a=[],i=0,c=0,u=0,l=0;l<n;l++){for(var s=r[l].cells,f=0,d=0;d<s.length;d++){var p=s[d],h=p.rowSpan,m=p.colSpan;i+=h*m,f+=m,h>1&&(c+=(h-1)*m)}a[l]=f,0===l&&(t=f),u=Math.max(f,u)}if(y()(i/t)&&t===u){var v=0;if(a.forEach((function(e){v+=u-e})),v!==c){var g=c-v;if(g&&y()(g/u)){for(var b=[],w=0;w<n;w++){for(var _=r[w].cells;o[w+b.length]===u;)b.push(w+b.length);for(var E=w+b.length,O=0;O<_.length;O++){var S=_[O],k=S.rowSpan,x=S.colSpan;if(k>1)for(var j=1;j<k;j++)o[E+j]=(o[E+j]||0)+x}}b.forEach((function(t){e.insertRow(t)}))}}}}(e),function(e){var t=e.rows[0];0===t.cells.length&&t.remove(),e.rows.length>1&&1===t.cells.length&&""===t.cells[0].innerText.trim()&&0===t.cells[0].getElementsByTagName("img").length&&1===t.cells[0].colSpan&&1===t.cells[0].rowSpan&&t.remove()}(e),function(e){Array.from(e.rows).forEach((function(e){var t=e.getAttribute("style"),r=t&&t.match(/mso-xlrowspan:(\d+)/),n=e.getAttribute("height");if(r&&n){var o=parseInt(r[1]);n=parseInt(n)/o||24,e.setAttribute("height",n),e.style.height=n+"px"}if(Array.from(e.cells).forEach((function(t){var r=t.getAttribute("style");if(t.setAttribute("height",n),t.style.height=n+"px",t.colSpan>1&&r&&-1!==r.indexOf("mso-ignore:colspan")){var o=t.colSpan;t.setAttribute("colSpan",1);for(var a=1;a<o;a++){var i=t.cloneNode();e.insertBefore(i,t.nextSibling)}}})),r){var a=parseInt(r[1]);if(a<1e6)for(var i=1;i<a;i++){var c=e.cloneNode();e.parentNode.insertBefore(c,e)}}}))}(e),function(e,t){for(var r=[],n=e.rows,o=n.length,a=100,i=0;i<o;i++){var c=n[i].cells,u=c.length;r[i]=r[i]||[];for(var l=u>16300,s=0;s<u;s++){var f=c[s];if(l&&s>a&&""===f.innerHTML&&E(f))break;a=Math.max(a,s);for(var d=f.rowSpan,p=void 0===d?1:d,m=f.colSpan,y=void 0===m?1:m,v=p>1||y>1,g=s;r[i][g];)g++;if(r[i][g]={rowSpan:p,colSpan:y,isMulti:v,element:f},v)for(var b=p;b>0;){for(var w=y;w>0;){if(1!==w||1!==b){var _=i+b-1,O=g+w-1;r[_]=r[_]||[],r[_][O]={isEmpty:!0,parent:{row:i,col:g}}}w--}b--}}}var S=r.map((function(e){return e.length})),k=Math.max.apply(Math,h()(S));return r.forEach((function(e,r){if(e.length<k)for(var n=k-e.length;n--;)0!==r||t?e.push({rowSpan:1,colSpan:1,isShadow:!0,element:null}):e.unshift({rowSpan:1,colSpan:1,isShadow:!0,element:null});for(var o=0;o<k;o++)e[o]||(e[o]={rowSpan:1,colSpan:1,isShadow:!0,element:null})})),{rows:r.length,cols:k,table:r}}(e,t)}function E(e){for(var t=10;t>0&&e;){if(e.tagName&&"td"===e.tagName.toLowerCase()){if(""!==e.innerHTML)return!1;t-=1}e=e.nextSibling}return!0}var O=/^\s*\(?¥\s*\(?[\d,.]+\)?$/,S=/^#+$/,k=/^\d\.\d+[Ee]\+\d+$/,x=String.fromCharCode(165),j=String.fromCharCode(36),A=String.fromCharCode(8364),L=String.fromCharCode(163);function T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;e=function(e){return e.replace(/\\0022/g,"")}(e=function(e,t,r){var n=e.match(/<col[^>]*>/g),o=0;if(n){var a=n[n.length-1].match(/<col[^>]*span=(\d+)[^>]*>/);a&&(o=parseInt(a[1],10))}if(o>r){var i=e.split("</tr>");e=(i=i.map((function(e){var t=e.match(/(\s*<td[^>]*>\s*<\/td>)(\s*)$/);if(t){var r=t[1].repeat(o-30);e.endsWith(r+t[2])&&(e=e.substr(0,e.length-r.length-t[2].length))}return e}))).join("</tr>")}var c=e.match(/\s*<tr[^>]*>\s*(<td[^>]*>\s*<\/td>\s*)+<\/tr>/g);if(c&&c.length>t){var u=e.match(/<td[^>]*>[^<]*[^\s<]+[^<]*<\/td>/g);if(!u)return"<table><tr><td></td></tr></table>";var l=u[u.length-1],s=e.lastIndexOf(l),f=e.slice(0,s+l.length);e=e.slice(s+l.length);var p={};c.forEach((function(e){p[e]=p[e]||{content:e,count:0},p[e].count+=1}));for(var h=Object.values(p),m=(h=d()(h,"count")).length-1;h[m];){var y=h[m];if(y.count>t){var v=y.content.replace(/([*.?+$^[\](){}|/\\])/g,(function(e){return"\\".concat(e)}));e=e.replace(new RegExp(v,"g"),"")}m--}e=f+e}return e}(e,200,200));var a=(new DOMParser).parseFromString(e,"text/html"),c=a.body,l=function(e,t){for(var r=e.length,n=[],o=0;o<r;o++)t(e[o])&&n.push(e[o]);return n}(a.all,(function(e){return"STYLE"===e.tagName}));if(!c)return null;for(var s,f=c.firstChild,p=[],h=[],m={},y={},v=[],g={},b=!1;f;)if(R(f)){var w=W(f,p.length,l,o);w.mergeCells&&(h=h.concat(w.mergeCells)),w.startCell&&(s=w.startCell),w.selectOptions&&Object.assign(g,w.selectOptions),Object.assign(y,w.rows),w.columns&&Object.assign(m,w.columns),p=p.concat(w.table),w.cellsNeedFix&&(v=v.concat(w.cellsNeedFix)),f=H(f),b=!1}else if(U(f))F(f)&&(f.innerHTML=""),I(f)&&(f.innerHTML=f.innerHTML.replace(/\n/g,"<br/>")),f=f.firstChild||H(f),b=!1;else if(M(f)){var _=f.innerText.trim(),E=f.getAttribute("href");P(p,p.length,_,E),b=!1,f=H(f)}else if(D(f)){var O=f.getAttribute("src");N(p,p.length,O,o),b=!1,f=H(f)}else if(q(f))f=f.firstChild||H(f);else if(V(f))b=!1,f=H(f);else if(z(f)){var S=f.data;if(""!==S.trim()||!U(f.parentNode))C(p,b?p.length-1:p.length,S),b=!0;f=H(f)}else f=H(f);var k=function(e){var t={};return e.forEach((function(e,r){e.forEach((function(e,n){e&&0!==Object.keys(e).length&&(t[r]=t[r]||{},0!==Object.keys(e).length&&(t[r][n]=e))}))})),t}(p);h=u()(h,(function(e){return"".concat(e.row,":").concat(e.col)}));var x=i()(p.map((function(e){return e.length})))||20,j={name:r||"Sheet".concat(t+1),rowCount:n?Math.max(p.length,n.rowCount):p.length,colCount:n?Math.max(x,n.colCount):x,data:k,mergeCells:h,rows:y,columns:m,filter:{},index:t,defaults:{}};return s&&(j.startCell=s),Object.keys(g).length>0&&(j.selectOptions=g),v.length>0&&(j.cellsNeedFix=v),j}function C(e,t,r){e[t]=e[t]||[],e[t][0]?e[t][0].value+=""+r:e[t][0]={value:r}}function P(e,t,r,n){e[t]=e[t]||[],e[t][0]=e[t][0]||{},e[t][0].value={class:"link",text:r,url:n}}function N(e,t,r,n){r=function(e){return e.replace(/\?x-oss-process=image\/resize.+/,"")}(r),e[t]=e[t]||[],e[t][0]=e[t][0]||{},e[t][0].value=n?{class:"image",name:"",src:r}:{class:"image",name:"",status:"needUpload",originSrc:r}}function R(e){return"TABLE"===e.tagName}function I(e){return"PRE"===e.tagName}function D(e){return"IMG"===e.tagName}function M(e){return"A"===e.tagName}function F(e){var t=e.getAttribute("style");return t&&t.startsWith("mso-element")}var G=["BODY","ARTICLE","ASIDE","ADDRESS","DD","DL","FIELDSET","FIGCAPTION","FIGURE","FOOTER","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","P","DIV","PRE","BLOCKQUOTE","UL","OL","LI","TABLE","THEAD","TBODY","TFOOT","SECTION"];function U(e){return 1===e.nodeType&&G.includes(e.tagName)}var B=["B","I","ABBR","CITE","CODE","DFN","DEL","EM","KBD","STRONG","SAMP","A","BDO","Q","SPAN","SUB","SUP","BUTTON","LABEL"];function q(e){return 1===e.nodeType&&B.includes(e.tagName)}function V(e){return"BR"===e.tagName}function z(e){return 3===e.nodeType}function H(e){if(e.nextSibling)return e.nextSibling;for(var t=e.parentNode;t;){if(t.nextSibling)return t.nextSibling;t=t.parentNode}return null}function W(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,a=e.cloneNode(!0);document.body.appendChild(a);var i=_(a,n),c={};r&&r.forEach((function(e){document.body.appendChild(e),Object.assign(c,K(e.innerHTML))}));var u={table:[]},l=a.querySelectorAll("col");if(l.length>0){var s={},f=0;l.forEach((function(e){for(var t=parseInt(e.getAttribute("width")),r=e.span,n=0;n<r&&f<i.cols;)s[f]=0!==t?{size:t}:{size:0,hidden:!0,oldSize:120},f+=1,n+=1})),u.columns=s}var d=Array.from(a.rows);u.rows={},d.forEach((function(e,r){if(0===e.offsetHeight&&r!==d.length-1)u.rows[r+t]={size:0,hidden:!0,oldSize:24};else{var n=Math.max(e.offsetHeight,24)||24,o={size:n};24!==n&&(o.customSize=n),u.rows[r+t]=o}}));var p=a.getAttribute("data-startCell");if(p){var h=p.split(":");u.startCell={row:parseInt(h[0])||0,col:parseInt(h[1])||0}}var m=a.getAttribute("data-selectOptions");if(m)try{u.selectOptions=JSON.parse(decodeURIComponent(m))}catch(e){console.log(e)}return i.table.forEach((function(e,r){u.table[r]=[],e.forEach((function(e,a){if(e.element){var i=function(e,t){var r=e.getAttribute("data-value");if(r)try{var n=JSON.parse(decodeURIComponent(r));if(function(e){return!!e.class&&("link"===e.class?e.text&&e.url:"file"===e.class||"image"===e.class?e.name&&e.src:"checkbox"===e.class?void 0!==e.value:"select"===e.class?e.value&&(e.options||e.optionId):"mention"===e.class?e.value&&e.value[0].id&&e.value[0].login:"formula"===e.class&&void 0!==e.formula)}(n))return n}catch(e){console.log(e)}for(var o=e.querySelectorAll("img"),a=o.length,i=0;i<a;i++){var c=o[i].getAttribute("src");if(c)return t?{class:"image",src:c,name:"image"}:{class:"image",status:"needUpload",originSrc:c,name:"image"}}e.innerHTML=e.innerHTML.replace(/<!--\[if[\s\S]+<!--\[endif\]-->/g,"").replace(/<rt[^>]*>[^<]*<\/rt>/g,"").replace(/\n/g,"").replace(/<br>\s*/g,"\n");var u,l=e.innerHTML.replace(/<[^>]+>/g,"").trim();l="string"!=typeof(u=l)?u:u.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&").replace(/&nbsp;/g," ");var s=e.querySelector("a");return s&&s.getAttribute("href")?{class:"link",text:l.replace(/\n/g,""),url:s.getAttribute("href")}:(l.endsWith(" %")&&(l=l.replace(/ %$/,"%")),l)}(e.element,n),l=function(e){try{var t=window.getComputedStyle(e),r={};1===e.childNodes.length&&"S"===e.childNodes[0].tagName&&(r.strikeThrough=!0);var n=function(e){var t;-1!==e.indexOf("pt")&&(t=parseInt(e,10));var r=12;if(-1!==e.indexOf("em")?r=parseFloat(e,14):-1!==e.indexOf("px")&&(r=parseFloat(e,10)),t=t||Math.round(r/1.3333333),Q[t])return t;var n=Object.keys(Q).map((function(e){return parseInt(e,10)}));n.sort();for(var o=0;n[o];){if(n[o]>t)return n[o];o++}return n[o-1]}(t.fontSize);return-1!==t.textDecoration.indexOf("underline")&&(r.underline=!0),-1!==t.textDecoration.indexOf("line-through")&&(r.strikeThrough=!0),(n>12||e.style.fontSize&&e.style.fontSize.indexOf("px")>0)&&(r.fontSize=n),["rgba(0, 0, 0)","rgb(0, 0, 0)","rgba(0, 0, 0, 0.65)","rgb(88, 90, 90)"].includes(t.color)||(r.color=t.color),"italic"===t.fontStyle&&(r.fontStyle=t.fontStyle),"normal"===t.whiteSpace&&e.classList.length>0&&(r.overflow="wrap"),["400",400,"normal"].includes(t.fontWeight)||(r.fontWeight=t.fontWeight),"middle"!==t.verticalAlign&&(r.vAlign=Y[t.verticalAlign]||"middle"),"start"!==t.textAlign&&"left"!==t.textAlign&&(r.hAlign=Y[t.textAlign]||"left"),"rgba(0, 0, 0, 0)"!==t.backgroundColor&&"rgb(255, 255, 255)"!==t.backgroundColor&&(r.backColor=t.backgroundColor),"0px"!==t.borderLeftWidth&&"rgb(204, 204, 204)"!==t.borderLeftColor&&(r.border=r.border||{},r.border.left={color:t.borderLeftColor,lineStyle:"dashed"===t.borderLeftStyle?"dash":"normal"}),"0px"!==t.borderRightWidth&&"rgb(204, 204, 204)"!==t.borderRightColor&&(r.border=r.border||{},r.border.right={color:t.borderRightColor,lineStyle:"dashed"===t.borderRightStyle?"dash":"normal"}),"0px"!==t.borderTopWidth&&"rgb(204, 204, 204)"!==t.borderTopColor&&(r.border=r.border||{},r.border.top={color:t.borderTopColor,lineStyle:"dashed"===t.borderTopStyle?"dash":"normal"}),"0px"!==t.borderBottomWidth&&"rgb(204, 204, 204)"!==t.borderBottomColor&&(r.border=r.border||{},r.border.bottom={color:t.borderBottomColor,lineStyle:"dashed"===t.borderBottomStyle?"dash":"normal"}),0===Object.keys(r).length?null:r}catch(e){return null}}(e.element),s=function(e){var t=e.getAttribute("data-note");if(t)try{var r=JSON.parse(decodeURIComponent(t));if(r.text)return r}catch(e){console.log(e)}}(e.element),f={name:"auto"},d=!1;if(c){var p=e.element.classList&&e.element.classList[0];c[p]&&("object"===o()(c[p])?Object.assign(f,c[p]):f.name=c[p],["currency","number","percentage"].includes(f.name)&&(f.decimal=2),u.table[r][a]=u.table[r][a]||{},u.table[r][a].type=f,["text","auto"].includes(f.name)||(d=!0))}l&&(u.table[r][a]=u.table[r][a]||{},u.table[r][a].style=l),s&&(u.table[r][a]=u.table[r][a]||{},u.table[r][a].note=s),void 0!==i&&""!==i?(u.table[r][a]=u.table[r][a]||{},u.table[r][a].type=f,u.table[r][a].value=i,"string"==typeof i&&((S.test(i)||k.test(i))&&(d=!0),O.test(i)&&"auto"===f.name&&(d=!0,u.table[r][a].type.name="currency",u.table[r][a].type.symbol=x,u.table[r][a].type.decimal=2))):""===i&&u.columns&&u.columns[a]&&u.columns[a].size<=15&&u.columns[a].size>=0&&(d=!0),d&&n&&(u.cellsNeedFix=u.cellsNeedFix||[],u.cellsNeedFix.push({row:r+t,col:a})),e.isMulti&&(u.mergeCells=u.mergeCells||[],u.mergeCells.push({row:r+t,col:a,rowCount:e.rowSpan,colCount:e.colSpan}),l&&(u.table[r+e.rowSpan-1]=u.table[r+e.rowSpan-1]||[],u.table[r+e.rowSpan-1][a+e.colSpan-1]=u.table[r+e.rowSpan-1][a+e.colSpan-1]||{},u.table[r+e.rowSpan-1][a+e.colSpan-1].style=l))}}))})),a.remove(),r&&r.forEach((function(e){e.remove()})),u}var Y={"-webkit-left":"left","-webkit-right":"right","-webkit-center":"center",left:"left",right:"right",center:"center","-webkit-baseline-middle":"middle",top:"top",bottom:"bottom",middle:"middle"};function K(e){var t=/([^{}]+){([^{}]+)}/,r=e.match(/[^{}]+{([^{}]+)}/g),n={};return r&&r.forEach((function(e){var r=e.match(t);if(r){var o=r[1].trim(),a=r[2];if(o.startsWith(".")){var i=a.match(/mso-number-format:(.+);(\n|$)/);i&&(n[o.substr(1)]=function(e){return-1!==(e=e.replace(/\/|"|\\/g,"")).indexOf("Date")?"date":-1!==e.indexOf("Time")?"time":e.endsWith("%")?"percentage":-1!==e.indexOf(L)?{name:"currency",symbol:L}:-1!==e.indexOf(A)?{name:"currency",symbol:A}:-1!==e.indexOf(x)?{name:"currency",symbol:x}:e.match(/^@$/)?"text":-1!==e.indexOf("General")||-1!==e.indexOf("Standard")||-1!==e.indexOf("Fixed")?"auto":e.match(/(年|月|日|时|分|秒|dd|y|m|h|s|md|dm)/)?e.match(/(时|分|秒|s|h)/)?"datetime":e.match(/[^d]ddd[^d]/)?{name:"datetime",formatter:"dddd"}:"date":-1!==e.indexOf(j)?{name:"currency",symbol:j}:"number"}(i[1]))}}})),0===Object.keys(n).length?null:n}var Q={9:12,10:13,11:14,12:16,14:19,16:22,18:24,22:29,24:32,30:40,36:48};function Z(e){return e.trim().replace(/'/g,"").replace(/"/g,"")}var J="ABCDEFGHIJKLMNOPQRSTUVWXYZ",X=J.length,$=[{type:"whitespace",reg:/^(?:\s+)/},{type:"string",reg:/^(?:"(\\["]|[^"])*")/},{type:"string",reg:/^(?:'(\\[']|[^'])*')/},{type:"function",reg:/^(?:[A-Za-z]{1,}[A-Za-z_0-9\.]+(?=[(]))/},{type:"error",reg:/^(?:#[A-Z0-9\/]+(!|\?)?)/},{type:"sheetCell",reg:/^(?:'{1}[^']+'{1}!{1}\${0,1}[A-Za-z]+\${0,1}[0-9]+)/},{type:"sheetCell",reg:/^(?:[\u4e00-\u9fa5A-Za-z0-9]+!{1}\${0,1}[A-Za-z]+\${0,1}[0-9]+)/},{type:"absoluteCell",reg:/^(?:\$[A-Za-z]+\$[0-9]+)/},{type:"absoluteColCell",reg:/^(?:\$[A-Za-z]+[0-9]+)/},{type:"absoluteRowCell",reg:/^(?:[A-Za-z]+\$[0-9]+)/},{type:"relativeCell",reg:/^(?:[A-Za-z]+[0-9]+)/},{type:"colRange",reg:/^(?:[A-Za-z]+:[A-Za-z]+)/},{type:"colRange",reg:/^(?:'{1}[\u4e00-\u9fa5A-Za-z0-9]+'{1}!{1}[A-Za-z]+:[A-Za-z]+)/},{type:"colRange",reg:/^(?:[\u4e00-\u9fa5A-Za-z0-9]+!{1}[A-Za-z]+:[A-Za-z]+)/},{type:"rowRange",reg:/^(?:[0-9]+:[0-9]+)/},{type:"rowRange",reg:/^(?:'{1}[\u4e00-\u9fa5A-Za-z0-9]+'{1}!{1}[0-9]+:[0-9]+)/},{type:"rowRange",reg:/^(?:[\u4e00-\u9fa5A-Za-z0-9]+!{1}[0-9]+:[0-9]+)/},{type:"mixRange",reg:/^(?:[0-9]+:[0-9]+)/},{type:"function",reg:/^(?:[A-Za-z\.0-9]+(?=[(]))/},{type:"variable",reg:/^(?:[A-Za-z]{1,}[A-Za-z_0-9]+)/},{type:"number",reg:/^(?:[0-9]+)/},{type:"array",reg:/^(?:\[(.*)?\])/},{type:"&",reg:/^(?:&)/},{type:"whitespace",reg:/^(?: )/},{type:"decimal",reg:/^(?:[.])/},{type:":",reg:/^(?::)/},{type:";",reg:/^(?:;)/},{type:",",reg:/^(?:,)/},{type:"*",reg:/^(?:\*)/},{type:"/",reg:/^(?:\/)/},{type:"-",reg:/^(?:-)/},{type:"+",reg:/^(?:\+)/},{type:"^",reg:"/^(?:^)/,"},{type:"(",reg:/^(?:\()/},{type:")",reg:/^(?:\))/},{type:">",reg:/^(?:>)/},{type:"<",reg:/^(?:<)/},{type:"NOT",reg:/^(?:NOT\b)/},{type:'"',reg:/^(?:")/},{type:"'",reg:/^(?:')/},{type:"!",reg:/^(?:!)/},{type:"=",reg:/^(?:=)/},{type:"%",reg:/^(?:%)/},{type:"#",reg:/^(?:[#])/},{type:"EOF",reg:/^(?:$)/}],ee=/^([\u4e00-\u9fa5A-Za-z0-9]+!{1})/,te=/^'{1}(.+'{1}!{1})/,re=/^([$])?([A-Za-z]+)([$])?([0-9]+)$/;function ne(e){var t=parseInt(e,10);return isNaN(t)?-1:Math.max(t-1,-1)}function oe(e){var t=0;if("string"==typeof e)for(var r=0,n=e.length-1;r<e.length;r+=1,n-=1)t+=Math.pow(X,n)*(J.indexOf(e[r])+1);return t-1}function ae(e){var t=function(e){var t=null,r=e,n=e.match(ee);return n?(r=e.substring(n[0].length),t=n[0].slice(0,-1)):(n=e.match(te))&&(r=e.substring(n[0].length),t=n[0].slice(1,-2)),{sheet:t,label:r.toUpperCase()}}(e),r=t.label.match(re),n=g()(r,5),o=n[1],a=n[2],i=n[3],c=n[4];return{row:{index:ne(c),label:c,absolute:"$"===i},col:{index:oe(a),label:a,absolute:"$"===o},sheet:t.sheet}}function ie(e){var t=(e.row.absolute?"$":"")+(e.row.index+1);return function(e,t){return t?/^[A-Za-z0-9]+$/.test(t)&&!t.match(/^[A-Za-z]{1,3}[0-9]+/)?"".concat(t,"!").concat(e):"'".concat(t,"'!").concat(e):e}((e.col.absolute?"$":"")+function e(t){var r=J.substr(t%26,1),n=Math.floor(t/26);return n>0?"".concat(e(n-1)).concat(r):r}(e.col.index)+t,e.sheet)}function ce(e,t){var r=e.baseCell,n=e.formula,o=ae(r),a=ae(t);return function(e,t,r,n){var o=function(e,t){var r=[];e=(e+"").replace(/\s/g,"");for(var n=function(){var t=void 0,n=void 0,o=void 0;$.forEach((function(r){(o=e.match(r.reg))&&(!t||o[0].length>t[0].length)&&(t=o,n=r.type)})),t?(r.push({text:t[0],type:n}),e=e.slice(t[0].length)):(r.push({text:e[0],type:"other"}),e=e.slice(1)),t=null};e.length>0;)n();for(var o=r.length,a=0;a<o-2;a++)r[a].type.indexOf("Cell")>0&&":"===r[a+1].type&&r[a+2].type.indexOf("Cell")<0&&(r[a+1].type="colon");return r}(e),a="";return o.forEach((function(e){if(e.type.indexOf("Cell")>0){var n=ae(e.text);n.row.index+=n.row.absolute?0:t,n.col.index+=n.col.absolute?0:r,a+=ie(n)}else a+=e.text})),a}(n,a.row.index-o.row.index,a.col.index-o.col.index)}function ue(e){return(new DOMParser).parseFromString(e,"text/xml")}function le(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"==typeof e&&(e=[e]);var r={format:"lakesheet",type:"Sheet",version:"1.0",larkJson:!0,sheet:[]},n=t.names,a=void 0===n?[]:n,i=t.deflate,c=void 0!==i&&i,u=t.worksheetsDeflate,l=void 0!==u&&u,f=t.xml;if(e.forEach((function(e,t){c&&(e=s.a.inflate(e,{to:"string"}));var n=T(e,t,a[t],{rowCount:50,colCount:20},!0);n.selectOptions&&(r.selectOptions=r.selectOptions||{},Object.assign(r.selectOptions,n.selectOptions),delete n.selectOptions),r.sheet.push(n)})),f){if(l&&f.worksheets){var d={};for(var p in f.worksheets){var h=f.worksheets[p];d[p]=s.a.inflate(h,{to:"string"})}f.worksheets=d}!function(e,t){if(t.workbook&&t.worksheets){for(var r=function(e){if(!e)return null;var t=ue(e).getElementsByTagName("c");if(0!==t.length){for(var r=[],n=0;n<t.length;n++)r.push({cell:t[n].getAttribute("r"),sheetIndex:t[n].getAttribute("i")||1});return 0===r.length?null:w()(r,"sheetIndex")}}(t.calcChain),n=ue(t.workbook).getElementsByTagName("sheet"),a={},i={},c={},u=1,l=0;l<n.length;l++){var s=parseInt(n[l].getAttribute("r:id").replace("rId","")),f=n[l].getAttribute("sheetId"),d=n[l].getAttribute("state");a[f]=s,"hidden"!==d&&(i[u]=s,c[f]=u,u+=1)}if(e.calcChain=[],r)for(var p in r){var h=a[p],m="sheet".concat(h);if(t.worksheets[m])for(var y=ue(t.worksheets[m]).getElementsByTagName("f"),v={},g=0;g<y.length;g++){var b=y[g],_=b.parentNode.getAttribute("r"),E=b.innerHTML.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&nbsp;/g," "),O=b.getAttribute("t"),S=b.getAttribute("ref"),k=b.getAttribute("si");"shared"===O&&(S?v[k]={baseCell:_,formula:E}:E=ce(v[k],_));var x=_.match(/\d+/),j=_.match(/[A-Z]+/);x&&(x=parseInt(x[0])-1),j&&(j=oe(j[0]));var A=c[p]-1;if(e.sheet[A])if(e.sheet[A].data[x]=e.sheet[A].data[x]||{},e.sheet[A].data[x][j]=e.sheet[A].data[x][j]||{},"string"==typeof E&&0===E.toLowerCase().indexOf("hyperlink(")){var L=E.substring(10,E.length-1).split(","),T=Z(L[0]),C=L.length>1?Z(L[1]):T;console.log(T,C),e.sheet[A].data[x][j].value={class:"link",url:T,text:C}}else e.sheet[A].data[x][j].value={class:"formula",formula:E,value:e.sheet[A].data[x][j].value||""},e.calcChain.push({row:x,col:j,sheet:A})}}e.sheet.forEach((function(e,r){if(e.cellsNeedFix){var n=i[r+1],a="sheet".concat(n),c=ue(t.worksheets[a]);e.cellsNeedFix.forEach((function(t){var r=t.row,n=t.col,a=ie({row:{index:r},col:{index:n}}),i=c.querySelector("c[r=".concat(a,"]"));if(i){var u="s"===i.getAttribute("t"),l=i.querySelector("v");if(l&&l.innerHTML&&!u){var s=e.data[r]&&e.data[r][n]&&e.data[r][n].value,f=e.data[r]&&e.data[r][n]&&e.data[r][n].type,d=l.innerHTML;if(f&&!isNaN(1*d)){var p=1*d,h=p>=367?343:p<61?86400:0;"date"===f.name||"datetime"===f.name||"time"===f.name?d=86400*d+h:["percentage","number","currency"].includes(f.name)&&(d*=1)}s&&"formula"===s.class?s.value=d:"object"!==o()(s)&&(e.data[r]=e.data[r]||{},e.data[r][n]=e.data[r][n]||{},e.data[r][n].value=d)}}})),delete e.cellsNeedFix}}))}}(r,f)}return r.sheet=s.a.deflate(JSON.stringify(r.sheet),{to:"string"}),r}},3632:function(e,t,r){!function(){"use strict";var t="undefined"!=typeof window&&void 0!==window.document?window.document:{},r=e.exports,n="undefined"!=typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,o=function(){for(var e,r=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n=0,o=r.length,a={};n<o;n++)if((e=r[n])&&e[1]in t){for(n=0;n<e.length;n++)a[r[0][n]]=e[n];return a}return!1}(),a={change:o.fullscreenchange,error:o.fullscreenerror},i={request:function(e){var r=o.requestFullscreen;e=e||t.documentElement,/ Version\/5\.1(?:\.\d+)? Safari\//.test(navigator.userAgent)?e[r]():e[r](n?Element.ALLOW_KEYBOARD_INPUT:{})},exit:function(){t[o.exitFullscreen]()},toggle:function(e){this.isFullscreen?this.exit():this.request(e)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(e,r){var n=a[e];n&&t.addEventListener(n,r,!1)},off:function(e,r){var n=a[e];n&&t.removeEventListener(n,r,!1)},raw:o};o?(Object.defineProperties(i,{isFullscreen:{get:function(){return Boolean(t[o.fullscreenElement])}},element:{enumerable:!0,get:function(){return t[o.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return Boolean(t[o.fullscreenEnabled])}}}),r?e.exports=i:window.screenfull=i):r?e.exports=!1:window.screenfull=!1}()},3634:function(e,t,r){"use strict";var n=/["'&<>]/;e.exports=function(e){var t,r=""+e,o=n.exec(r);if(!o)return r;var a="",i=0,c=0;for(i=o.index;i<r.length;i++){switch(r.charCodeAt(i)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#39;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}c!==i&&(a+=r.substring(c,i)),c=i+1,a+=t}return c!==i?a+r.substring(c,i):a}},3635:function(e,t,r){"use strict";r(37);var n=r(10),o=r(0),a=r.n(o),i=r(2),c=r.n(i),u=r(3577);function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function s(){s=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function f(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var a=t&&t.prototype instanceof b?t:b,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:A(e,r,c)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",m="suspendedYield",y="executing",v="completed",g={};function b(){}function w(){}function _(){}var E={};f(E,i,(function(){return this}));var O=Object.getPrototypeOf,S=O&&O(O(N([])));S&&S!==r&&n.call(S,i)&&(E=S);var k=_.prototype=b.prototype=Object.create(E);function x(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,c){var u=p(e[o],e,a);if("throw"!==u.type){var s=u.arg,f=s.value;return f&&"object"==l(f)&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(f).then((function(e){s.value=e,i(s)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=h;return function(a,i){if(o===y)throw new Error("Generator is already running");if(o===v){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var l=p(t,r,n);if("normal"===l.type){if(o=n.done?v:m,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=v,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(l(t)+" is not iterable")}return w.prototype=_,o(k,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:w,configurable:!0}),w.displayName=f(_,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,f(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(j.prototype),f(j.prototype,c,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(d(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(k),f(k,u,"Generator"),f(k,i,(function(){return this})),f(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function f(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return p(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function h(e){var t=e.doc,r=e.docDomain,i=e.type,c=d(Object(o.useState)(null),2),l=c[0],p=c[1],h=d(Object(o.useState)(!1),2),m=h[0],y=h[1],v=function(){var o,a=(o=s().mark((function o(){var a,c;return s().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,e.docVersionProxy.find({doc_id:t.id,doc_type:r,draft:"published"===i?0:1,limit:1});case 2:1===(a=o.sent).length?p(a[0]):(c="published"===i?__("文档尚未发布"):__("暂无历史记录，请先保存文档"),n.a.warning(c)),y(!1);case 5:case"end":return o.stop()}}),o)})),function(){var e=this,t=arguments;return new Promise((function(r,n){var a=o.apply(e,t);function i(e){f(a,r,n,i,c,"next",e)}function c(e){f(a,r,n,i,c,"throw",e)}i(void 0)}))});return function(){return a.apply(this,arguments)}}();return Object(o.useEffect)((function(){v()}),[]),m||!l?null:a.a.createElement(u.b,{version:l,docVersionProxy:e.docVersionProxy,onCancel:e.onCancel,onCreated:e.onCreated||function(e){n.a.success(__("保存版本成功，点击查看 {link}",{link:a.a.createElement("a",{href:"/r/doc_versions/".concat(e.id),target:"_blank","data-testid":"version-link"},e.name)}))}})}h.propTypes={doc:c.a.object.isRequired,docDomain:c.a.string.isRequired,type:c.a.oneOf(["draft","published"]),onCancel:c.a.func.isRequired,onCreated:c.a.func,docVersionProxy:c.a.object.isRequired},t.a=h},3636:function(e,t,r){"use strict";r(3210);var n=r(1543);r(3198);t.a=n.a},3637:function(e,t,r){"use strict";r(3227);var n=r(1566);r(3199);t.a=n.a},3638:function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return c}));var n=r(114),o=r.n(n),a=r(0),i=function(e){if(e.render)return Object(a.createElement)(e.render,o()(e,["render"]))},c=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return"function"==typeof e?e.apply(void 0,r):e}},3639:function(e,t,r){"use strict";r.d(t,"c",(function(){return d})),r.d(t,"e",(function(){return E})),r.d(t,"d",(function(){return k})),r.d(t,"b",(function(){return x})),r.d(t,"a",(function(){return A}));r(37);var n=r(10),o=r(0),a=r(82),i=r.n(a);function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var l=function(e,t){return t.book&&Object.values(i.a.TYPE).includes(e.type)},s=function(e,t){if(!e.joinToken)return"";var r=e.joinToken;if("Doc"===r.target_type){var n=e.slug,o=t.group,a=t.book,i=t.isEditing,c="".concat(window.location.origin,"/g/").concat(o.login,"/").concat(a.slug,"/").concat(n,"/collaborator/join?token=").concat(r.token);if(i){var u="/".concat(o.login,"/").concat(a.slug,"/").concat(n,"/edit");c="".concat(c,"&goto=").concat(encodeURIComponent(u))}return c+="# ".concat(__("邀你参与文档协作"),"《").concat(e.title,"》")}return""},f=function(e){return!e.joinToken||!!e.joinToken.approve},d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=c(Object(o.useState)(!1),2),a=r[0],i=r[1],u=c(Object(o.useState)(s(e,t)),2),d=u[0],p=u[1],h=c(Object(o.useState)(f(e)),2),m=h[0],y=h[1],v=t.dispatch,g=function(r){i(!0);var o="proxy.web/books.token",a="book/updateToken",c=e.id;l(e,t)&&(o="proxy.web/docs.token",a="doc/updateToken",c=e.id),v({type:o,payload:{data:{id:c,force:r},reducer:a}}).then((function(o){r&&n.a.success(__("重置链接成功")),e.joinToken=o;var a=s(e,t);p(a),y(f(e)),i(!1)}))};return Object(o.useEffect)((function(){e.abilities&&e.abilities.create_collaborator&&!d&&g()}),[e.id]),[d,function(){return g(!0)},a,m,function(r){var n="proxy.web/books.updateToken",o="book/updateToken",a=e.id;l(e,t)&&(n="proxy.web/docs.updateToken",o="doc/updateToken",a=e.id),v({type:n,payload:{data:{id:a,approve:!0===r?1:0},reducer:o}}).then((function(e){y(r)}))}]},p=r(454),h=r.n(p),m=r(3329),y=r(50);function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}function g(){g=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof b?t:b,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:A(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function b(){}function w(){}function _(){}var E={};l(E,i,(function(){return this}));var O=Object.getPrototypeOf,S=O&&O(O(N([])));S&&S!==r&&n.call(S,i)&&(E=S);var k=_.prototype=b.prototype=Object.create(E);function x(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==v(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(v(t)+" is not iterable")}return w.prototype=_,o(k,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(j.prototype),l(j.prototype,c,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(k),l(k,u,"Generator"),l(k,i,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function b(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var E=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.organization,n=w(Object(o.useState)(!1),2),a=n[0],i=n[1],c=w(Object(o.useState)([]),2),u=c[0],l=c[1],s=Object(o.useCallback)(h()(function(){var e,n=(e=g().mark((function e(n){var o,a;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=3;break}return i(!1),e.abrupt("return");case 3:return i(!0),o={q:n.trim(),include_unconfirmed_corp_account:!0,optional_properties:t.optional_properties},r&&r.id||(o.global=!0),e.prev=6,e.next=9,y.a.users.complete(o);case 9:a=e.sent,l(Object(m.format)(a));case 11:return e.prev=11,i(!1),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[6,,11,14]])})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){b(a,n,o,i,c,"next",e)}function c(e){b(a,n,o,i,c,"throw",e)}i(void 0)}))});return function(e){return n.apply(this,arguments)}}(),200),[]);return[u,s,a,function(){return l([])}]};function O(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return S(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var k=function(){var e=O(Object(o.useState)(!1),2),t=e[0],r=e[1];return[t,Object(o.useCallback)((function(){return r((function(e){return!e}))}),[])]},x=function(e){return[window.location.hash==="#".concat(e),function(){window.location.hash=""}]};function j(e){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j(e)}var A=function(e,t){return function(r,n){var o=e.id,a=e.settings.homepage,i=a?a.layout:{};Object.keys(i).map((function(e){return i[e]&&i[e].length>0&&(i[e]=i[e].map((function(e){return"string"==typeof e&&e===t||"object"===j(e)&&e.type===t?{name:r,type:t}:e}))),i[e]})),y.a.groups.settings({id:o,homepage:{layout:i}}).then((function(e){n&&"function"==typeof n&&n(e)}))}}},3640:function(e,t,r){"use strict";r(169);var n=r(40),o=(r(41),r(9)),a=(r(279),r(138)),i=(r(785),r(424)),c=(r(37),r(10)),u=(r(139),r(44)),l=(r(151),r(29)),s=(r(73),r(31)),f=r(0),d=r.n(f),p=r(2),h=r.n(p),m=r(1442),y=r(1422),v=r(1407),g=r(78),b=r.n(g),w=r(261),_=r.n(w),E=r(3697),O=r(1321),S=r.n(O),k=r(215);var x=function(e,t){var r=Object(f.useRef)();Object(f.useEffect)((function(){r.current=e}),[e]),Object(f.useEffect)((function(){if(null!==t){var e=setInterval((function(){r.current()}),t);return function(){return clearInterval(e)}}}),[t])},j=r(3654),A=r(228),L=r(1207);r(1412);var T=function(e){return f.createElement("a",e)},C=r(238),P=r(458),N=r(1431),R=r(3688),I=r(962),D="DocImport-module_docImport_uDZWD",M="DocImport-module_title_vylxD",F="DocImport-module_tips_gx2+N",G="DocImport-module_help_YDms4",U="DocImport-module_processingModal_5vLO+",B="DocImport-module_setting_6ttU6",q="DocImport-module_settingTitle_EsA43",V="DocImport-module_settingUpload_WXf0g",z="DocImport-module_processing_K3nVL",H="DocImport-module_processingTitle_UzLg1",W="DocImport-module_processingFooter_xOxG5",Y="DocImport-module_fileList_jRvlw",K="DocImport-module_fileItem_gtT95",Q="DocImport-module_fileItemIcon_SdTY-",Z="DocImport-module_fileItemTitle_qprAi",J="DocImport-module_spin_aEZeg",X="DocImport-module_uploadingStatus_UWCen",$="DocImport-module_hr_nD0TF",ee="DocImport-module_footerTitle_2O1eI",te="DocImport-module_radioGroup_klLUa",re=r(329),ne=r(1513),oe={id:14,content:'{"popupType":"activity","title":"👋🏻 Hi，亲爱的印象笔记用户","desc":"欢迎加入语雀，开启新的创作旅程，语雀会稳定地陪伴着你。\\n<br />\\n<br />\\n为感谢你的选择，已赠送你 1 个月语雀会员。\\n<br />\\n<br />\\n✨ 分享你的迁移经验 / 使用心得，再获得 1 个月会员。 <br /><a target=\\"_blank\\" href=\\"https://www.yuque.com/yuque/eaghk3/share-events\\">了解详情</a>\\n<br />\\n<br />\\n<a target=\\"_blank\\" href=\\"https://www.yuque.com/yuque/eaghk3/evernote\\">👉🏻 迁移支持与反馈</a>","image":"https://intranetproxy.alipay.com/skylark/lark/0/2023/png/345912/1678879373131-361a8d0b-c661-4afa-8714-9b49afc2ef87.png?x-oss-process=image%2Fresize%2Cw_1272%2Climit_0","type":"normal","mainButton":{"title":"我知道了","openType":"close"},"viceButton":{"title":"","openType":"close"},"otherButton":{"openType":"href"}}',type:"public_popup",user_id:null,created_at:"2023-07-22T02:22:29.000Z",updated_at:"2023-07-22T02:25:07.000Z",deleted_at:null,_serializer:"admin.tip"};function ae(e){return ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ae(e)}function ie(){ie=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==ae(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(ae(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function ce(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function ue(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){ce(a,n,o,i,c,"next",e)}function c(e){ce(a,n,o,i,c,"throw",e)}i(void 0)}))}}function le(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function se(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?le(Object(r),!0).forEach((function(t){fe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):le(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function fe(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==ae(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==ae(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===ae(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function de(e){return function(e){if(Array.isArray(e))return me(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||he(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||he(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function he(e,t){if(e){if("string"==typeof e)return me(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?me(e,t):void 0}}function me(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var ye=s.a.confirm,ve=I.a.STATUS,ge=window.appData.settings&&window.appData.settings.max_import_task_count||2,be=function(e){var t=e.visible,r=e.book,p=e.group,h=e.formats,g=e.importType,w=e.importParams,O=e.wrapModal,S=void 0===O||O,A=e.autoConvert,ae=void 0===A||A,ce=pe(Object(f.useState)(ve.INIT),2),le=ce[0],fe=ce[1],me=pe(Object(f.useState)([]),2),be=me[0],we=me[1],_e=pe(Object(f.useState)([]),2),Ee=_e[0],Oe=_e[1],Se=pe(Object(f.useState)(0),2),ke=Se[0],xe=Se[1],je=pe(Object(f.useState)(0),2),Ae=je[0],Le=je[1],Te=pe(Object(f.useState)(0),2),Ce=Te[0],Pe=Te[1],Ne=pe(Object(f.useState)({}),2),Re=Ne[0],Ie=Ne[1],De=pe(Object(f.useState)(!1),2),Me=De[0],Fe=De[1],Ge=pe(Object(f.useState)(!0),2),Ue=Ge[0],Be=Ge[1],qe=pe(Object(f.useState)(!1),2),Ve=qe[0],ze=qe[1],He=pe(Object(f.useState)([]),2),We=He[0],Ye=He[1],Ke=pe(Object(f.useState)(!1),2),Qe=Ke[0],Ze=Ke[1],Je=Object(f.useRef)();Object(j.a)(!Ve&&le===ve.PROCESSING,__("还没导入完成，确认关闭窗口吗？"));var Xe=function(e){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])){if(We.length>0)return We.push(e),void Ye(de(We));We.push(e)}var t=e.data,r=e.file,n=e.filename,o=e.onError,a=e.onSuccess;e.__uploaded=!0;var i=se(se(se({},w),t),{},{filename:n,path:r.path});r.uploading=!0,C.b.upload({requestData:i,params:e,onError:o,onSuccess:function(e){a(e,r)}})},$e={evernote:[{default:_.a.windows,name:"isGBK",label:__("zip 使用 GBK 编码文件名(导入乱码时请勾选)"),value:1}],gitbook:[{default:_.a.windows,name:"isGBK",label:__("zip 使用 GBK 编码文件名(导入乱码时请勾选)"),value:1}],markdown:[{default:!0,name:"enableLatex",label:__("识别 Markdown 文件中 LaTeX 公式语法"),value:1}],confluence:[{type:"text",label:d.a.createElement(u.a,{type:"flex",justify:"space-between"},d.a.createElement(l.a,null,__("批量替换链接")),d.a.createElement(l.a,null,d.a.createElement(T,{href:"https://www.yuque.com/yuque/eaghk3/bu0hnd",target:"_blank"},__("如何从 Confluence 导出？")))),colon:!1,placeholder:__("请输入 Confluence 地址"),name:"host",autoFocus:!0,validateOnBlur:!0,validator:function(e,t,r){var n=E.validator.httpURL(t);Be(!n),r(n)}},{default:!1,name:"isGBK",label:__("zip 使用 GBK 编码文件名(导入乱码时请勾选)"),value:1}],zip:[{default:!0,name:"overrideExistsNode",label:__("是否覆盖相同节点的已有内容，否则自动重命名"),value:!0},{default:!0,name:"useFilenameAsTitle",label:__("是否使用文件名作为目录节点名称，否则会取内容中的标题作为名称"),value:!0},{default:!0,name:"enableLatex",label:__("识别 Markdown 文件中 LaTeX 公式语法"),value:1},{default:!1,name:"isGBK",label:__("zip 使用 GBK 编码文件名(导入乱码时请勾选)"),value:1}]},et=[{key:"markdown",value:"markdown",invertedIndex:["markdown","zip"],title:__("单个 Markdown 文件"),desc:".md .markdown .mark .txt",name:__("Markdown")},{key:"zip",value:"zip1",invertedIndex:["markdown","zip"],title:__("Markdown 打包后的压缩文件"),desc:".zip",name:__("Markdown"),formValue:{fileFormat:"markdown"}},{key:"zip",value:"zip2",invertedIndex:["markdown","zip"],title:__("HTML 打包后的压缩文件"),desc:".zip",name:__("HTML"),formValue:{fileFormat:"html"}}];Object(f.useEffect)((function(){le!==ve.PROCESSING||Me||fe(ve.SUCCESS)}),[le,Me]);var tt=function(e){return e.response&&e.response.data&&e.response.data.status},rt=function(e){var t=e||{},n=t.data,o=t.joinedEvernoteIncentive,a={};if(n){var i,u=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=he(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}(n);try{for(u.s();!(i=u.n()).done;){var l=i.value;a[l.id]=l}}catch(e){u.e(e)}finally{u.f()}}var s=Ee.map((function(e){var t,r,n;if(!e.response||!e.response.data)return e;var o=a[e.response.data.id];if(!o)return e;var i=b()(o,"error.limitError");if(i&&400===i.status&&i.code){if(window.appData.isDesktopApp)return c.a.error(__("桌面端不支持此操作，请去 web 端完成"));var u=L.a.getMessage(i.code,{isImport:!0},i)||{},l=u.msg,s=u.alwaysOpen,f=u.level,d=u.callback;if(l)return d(c.a[f||"error"](l,s?0:void 0)),ze(!0),e}e.response.data=se(se({},e.response.data),o),o.status===ve.SUCCESS?(e.status=ve.SUCCESS,e.url=o.url):(o.status===ve.ERROR||o.error)&&(e.status=ve.ERROR);var p=null==e||null===(t=e.response)||void 0===t||null===(r=t.data)||void 0===r||null===(n=r.successDocs)||void 0===n?void 0:n.filter((function(e){return"html"===e.format||"lakesheet_html"===e.format}));return(null==p?void 0:p.length)>0&&ae&&we(be.concat(p)),e})),f=0,d=0;s.forEach((function(e){var t=tt(e);e.status!==ve.ERROR&&t!==ve.ERROR&&t!==ve.SUCCESS||f++,e.status!==ve.ERROR&&t!==ve.ERROR||d++})),s.filter((function(e){var t=tt(e);return t===ve.PENDING||!(null!=t||!e.uploading&&"done"!==e.status&&100!==e.percent)})).length<ge&&function(){for(var e=We.shift();e&&e.__uploaded;)e=We.shift();e&&Xe(e,!0),Ye(de(We))}(),f>Ae&&Le(f),Pe(d),Oe(s),ke===f?(Fe(!1),function(){if(r.toc){var e="highlightBookImport_".concat(r.slug,"_").concat(r.id),t=r.toc[0];k.a.set(e,t?t.uuid:"_")}}()):fe(ve.PROCESSING),o&&Object(ne.b)({tip:oe})};x(ue(ie().mark((function e(){var r,n;return ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=Ee.filter((function(e){return e.response&&e.response.data}))).length){e.next=3;break}return e.abrupt("return",rt());case 3:if(t){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,P.a.import.getImportResult({files:JSON.stringify(r.map((function(e){return{convertTaskId:e.response.data.convertTaskId,id:e.response.data.id,type:e.response.data.type,name:e.name}}))),toc_node_uuid:w&&w.toc_node_uuid,format:null==Re?void 0:Re.key},{useOriginResp:!0});case 7:n=e.sent,rt(n);case 9:case"end":return e.stop()}}),e)}))),Me?5e3:null);var nt,ot,at,it=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Ie(se(se({},h.find((function(t){return t.key===e}))),t)),$e[e]&&fe(ve.SETTING),"confluence"===e&&Be(!1)},ct=function(e){return!!$e[e.key]},ut=function(e){var t=de(e.fileList),r=t.length;r!==t.filter((function(e){var t=tt(e);return t===ve.ERROR||t===ve.SUCCESS})).length&&fe(ve.PROCESSING),Fe(!0),Oe(t),xe(r)},lt=function(){Fe(!1),fe((function(t){if(t!==ve.PROCESSING)return e.onCancel(),t;Oe((function(t){return e.onCancel(),t}))}))},st=function(){var t,n;if(w&&"doc_toc"===w.create_from)return lt(),Ee.forEach((function(e){if(!t){var o=e.response&&e.response.data||{};o.import_toc&&o.import_toc[0]&&o.import_toc[0].url?(t="/".concat(p.login,"/").concat(r.slug,"/").concat(o.import_toc[0].url),n=o.import_toc[0]):"doc"!==o.type&&"Doc"!==o.type||"success"!==o.status||!o.slug||(t="/".concat(p.login,"/").concat(r.slug,"/").concat(o.slug),n=o)}})),void(t&&(e.onRead?e.onRead(n):C.b.changeHref(t)));C.b.changeHref("/".concat(p.login,"/").concat(r.slug))},ft=d.a.createElement("div",{className:D},(nt=window.appData.isYuque?"https://www.yuque.com/yuque/eaghk3":"https://yuque.antfin.com/lark/non1k6",ot=h.filter((function(e){return e.key.startsWith("lake")})),at=h.filter((function(e){return!e.key.startsWith("lake")&&"zip"!==e.key})),d.a.createElement("div",{className:"entry",style:{display:le===ve.INIT?"block":"none"}},d.a.createElement("div",{className:M},__("导入")),d.a.createElement("div",{className:F},__("点击下方格式进行导入，可一次导入多个文件，导入非语雀格式的文件可能存在样式不兼容、耗时较长的情况，请耐心等待。"),d.a.createElement("a",{href:nt,target:"_blank","data-desktoptarget":"_browser",className:G},__("帮助文档"))),d.a.createElement("div",null,d.a.createElement("h4",null,__("三方格式")),d.a.createElement(N.a,{mode:"import",book:r,types:at,importType:g,disableUpload:ct,onSelect:it,onUploadChange:ut,customRequest:Xe,maxCount:0,setModalHide:Ze})),d.a.createElement("div",null,d.a.createElement("h4",null,__("语雀格式")),d.a.createElement(N.a,{mode:"import",book:r,types:ot,importType:g,disableUpload:ct,onSelect:it,onUploadChange:ut,customRequest:Xe,maxCount:0})))),function(){var e;if(!Re)return null;var t=Re.key,a=Re.multiSettingValue,i=et.filter((function(e){return e.invertedIndex.includes(t)})),c=i.find((function(e){return e.value===a}))||(null==i?void 0:i[0]),u=$e[t];return u?d.a.createElement("div",{className:B,style:{display:le===ve.SETTING?"block":"none"}},d.a.createElement("h1",{className:q},__("{type} 导入配置",{type:(null==c?void 0:c.name)||Re.name})),!!i.length&&d.a.createElement(n.a.Group,{value:null===(e=c||(null==i?void 0:i[0]))||void 0===e?void 0:e.value,className:te},null==i?void 0:i.map((function(e){return d.a.createElement(n.a,{value:e.value,onClick:function(){return it(e.key,{multiSettingValue:e.value})}},d.a.createElement(re.a,{variant:"title",type:"strong"},e.title),d.a.createElement(re.a,{variant:"caption-small"},e.desc))}))),d.a.createElement(I.a.AdvanceSetting,{wrappedComponentRef:Je,type:Re,settings:u,hideHeader:i,actions:d.a.createElement(N.a.FileUpload,{mode:"import",book:r,getParamsOption:function(){return se(se({},(null==c?void 0:c.formValue)||{}),Je.current.getValue())},fileOption:Re,importType:g,customRequest:Xe,onUploadChange:ut,maxCount:0},d.a.createElement(o.a,{type:"primary",disabled:!Ue,className:V},__("选择本地文件")))})):null}(),le!==ve.INIT&&le!==ve.SETTING?d.a.createElement("div",{className:z},d.a.createElement("h1",{className:H},le===ve.DONE?__("导入完成"):__("导入中")),d.a.createElement("div",{className:Y},Ee.map((function(e){return d.a.createElement(u.a,{type:"flex",justify:"space-between",align:"middle",className:K,key:e.uid},d.a.createElement(l.a,null,d.a.createElement(u.a,{type:"flex",align:"middle"},d.a.createElement(l.a,null,d.a.createElement("img",{src:Re.icon,className:Q}),function(e){var t,r=e.name,n=tt(e);return t=e.url?d.a.createElement("a",{className:Z,href:e.url,target:"_blank"},r):d.a.createElement("h2",{className:Z},r),e.status!==ve.ERROR&&n!==ve.ERROR||(t=d.a.createElement(i.a,{placement:"right",content:__("文件处理失败，请重新上传。")},t)),t}(e)))),d.a.createElement(l.a,null,function(e){var t=tt(e);if(e.status===ve.ERROR||t===ve.ERROR){var r=e.error&&e.error.response&&e.error.response.data&&e.error.response.data.message;r||(r=e.response&&e.response.data&&e.response.data.error&&e.response.data.error.message);var n=e.response&&e.response.data&&e.response.data.id;return n&&(r="".concat(r," [id: ").concat(n,"]")),r?r+=__("（请重新上传，如果持续失败，请反馈到语雀）"):r=__("文件处理失败，请重新上传，如果持续失败，请反馈到语雀。"),d.a.createElement("span",null,d.a.createElement(i.a,{placement:"right",width:600,content:r},d.a.createElement(m.default,null)))}return e.status===ve.SUCCESS||t===ve.SUCCESS?d.a.createElement("span",null,d.a.createElement(y.default,null)):d.a.createElement("span",null,d.a.createElement("span",{className:X},0===e.percent&&__("等待中"),100===e.percent&&__("处理中"),0!==e.percent&&100!==e.percent&&d.a.createElement("span",null,parseInt(e.percent,10),"%")),d.a.createElement(a.a,{indicator:d.a.createElement(v.default,{style:{fontSize:16},spin:!0}),className:J}))}(e)))}))),d.a.createElement("div",{className:$}),function(){var e;if(0!==Ae&&ke===Ae&&0===be.length){var t;Ee.forEach((function(e){if(!t){e.status===ve.ERROR&&((t=e.error&&e.error.response&&e.error.response.data&&e.error.response.data.message)||(t=e.response&&e.response.data&&e.response.data.error&&e.response.data.error.message));var r=e.response&&e.response.data&&e.response.data.id;t&&r&&(t="".concat(t," [id: ").concat(r,"]"))}}));var r=Ce?__("导入结束，有文件导入失败"):__("导入完成");t&&(r="".concat(r," (").concat(t,")")),e=d.a.createElement(u.a,{type:"flex",justify:"space-between",align:"middle"},d.a.createElement(l.a,null,Ce?d.a.createElement(m.default,null):d.a.createElement(y.default,null),d.a.createElement("span",{className:ee},r)),d.a.createElement(l.a,null,d.a.createElement(o.a,{type:"primary",onClick:st},__("查看"))))}else le===ve.PROCESSING||le===ve.UPLOADING||le===ve.PENDING?e=d.a.createElement("div",null,d.a.createElement(a.a,{indicator:d.a.createElement(v.default,{style:{fontSize:16},spin:!0})}),d.a.createElement("span",{className:ee},__("文件导入中")),"(".concat(Ae,"/").concat(ke,")")):0!==be.length&&(e=d.a.createElement("div",null,d.a.createElement(a.a,{indicator:d.a.createElement(v.default,{style:{fontSize:16},spin:!0})}),d.a.createElement("span",{className:ee},__("文件转换中"))));return d.a.createElement("div",{className:W},e)}()):null,ae&&function(){if(Ae&&ke===Ae&&be.length)return d.a.createElement(R.a,{docs:be,bookId:r.id,onSuccess:function(){we([])}})}());return S?d.a.createElement(s.a,{title:null,onCancel:function(e){le!==ve.INIT&&le!==ve.DONE?(e.preventDefault(),e.stopPropagation(),le===ve.PROCESSING?ye({title:__("导入尚未完成，确认要停止导入?"),content:d.a.createElement("div",null,__("处理中的文件无法取消，请稍后从知识库中删除。")),okText:__("确认"),okType:"danger",cancelText:__("取消"),centered:!0,onOk:lt,onCancel:function(){}}):lt()):lt()},visible:t,footer:null,centered:!0,width:le===ve.INIT?160*Math.min(h.length,4):406,maskClosable:!1,className:le!==ve.INIT&&U,style:Qe?{display:"none"}:{}},ft):ft};be.defaultProps={visible:!0,importType:S.a.IMPORT_TYPE.PARSE},be.propTypes={visible:h.a.bool,book:h.a.object.isRequired,formats:h.a.array.isRequired,importType:h.a.oneOf([S.a.IMPORT_TYPE.CREATE,S.a.IMPORT_TYPE.PARSE]),onCancel:h.a.func.isRequired,onRead:h.a.func,importParams:h.a.object,group:h.a.object.isRequired,wrapModal:h.a.bool,autoConvert:h.a.bool};t.a=Object(A.b)(be,!0)},3641:function(e,t,r){"use strict";var n=r(0),o=r.n(n),a=r(480),i=r(3570),c=r(320),u=r(3628);t.a=Object(c.b)(Object(a.d)((function(e){return{guide:e.guide}}))((function(e){var t=e.guide,r=e.tip_id;return Object(n.useEffect)((function(){var e=i.a.findFeatureGuide({tip_id:r,type:"lite"});e&&i.a.readLiteFeatureGuide(e)}),[]),o.a.createElement("div",{className:e.className||"",style:e.style,"data-testid":"guide_".concat(r),onClick:function(){var t=i.a.findFeatureGuide({tip_id:r,type:"mini"});i.a.readMiniFeatureGuide(t,e.dispatch)}},e.children,("#guide"===window.location.hash||!t.readTip[r])&&o.a.createElement(u.a.Mini,null))})),!1)},3642:function(e,t,r){"use strict";var n=r(428),o=r.n(n),a=r(148),i={default:[{id:"book",name:__("文档知识库"),desc:__("创作在线文档、表格"),icon:"book-type-default2",book_icon:"book-type-default",intro:__("提供结构化展示，在线完成知识创作。覆盖产品文档、项目文档、帮助手册、周报、个人笔记、旅行攻略、财务报表、报价单等场景。"),cover:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*0zoQT6wVAEMAAAAAAAAAAABkARQnAQ",detail:__("覆盖产品文档、项目文档、帮助手册、周报、个人笔记、旅行攻略、财务报表、报价单等场景"),help:window.appData.isYuque?"https://www.yuque.com/yuque/thyzgp/repository":"".concat(window.location.origin,"/lark/bsgp0v/repository"),type:"Book",mode:"custom",spm:{factory:"c36318.d73307"}},{id:"resource",name:__("资源知识库"),desc:__("上传并预览本地文件"),icon:"book-type-resource2",book_icon:"book-type-resource",intro:__("支持上传并预览 Word、 Excel 、Keynote 、Xmind 等办公文件。覆盖本地文件上传、资源管理、Word 在线预览等场景。"),cover:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*Y6gPQ5rExJkAAAAAAAAAAABkARQnAQ",detail:__("覆盖本地文件上传、资源管理、Word 在线预览等场景"),help:window.appData.isYuque?"https://www.yuque.com/yuque/thyzgp/utx3aa":"".concat(window.location.origin,"/lark/bsgp0v/utx3aa"),type:"Resource",mode:"custom",spm:{factory:"c36318.d73305"}},{id:"design",name:__("图片知识库"),desc:__("上传并预览设计稿"),icon:"book-type-design2",book_icon:"book-type-design",intro:__("提供设计稿、图片管理，分享与交流创意。覆盖 Sketch 设计稿、PSD 设计稿等图片管理场景。"),cover:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*5Db6SY8QwnsAAAAAAAAAAABkARQnAQ",detail:__("覆盖 Sketch 设计稿、PSD 设计稿等图片管理场景"),help:window.appData.isYuque?"https://www.yuque.com/yuque/thyzgp/rppabq":"".concat(window.location.origin,"/lark/bsgp0v/rppabq"),type:"Design",mode:"custom",spm:{factory:"c36318.d73304"}},{id:"thread",name:__("话题知识库"),desc:__("基于话题的多人协同交流"),icon:"book-type-thread2",book_icon:"book-type-thread",intro:__("发起话题，与大家一起展开讨论与交流。可用于日报周报收集、会议记录汇总、产品讨论、想法交流等。"),cover:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*K_dmR7rFswcAAAAAAAAAAABkARQnAQ",detail:__("可用于日报周报收集、会议记录汇总、产品讨论、想法交流等"),help:window.appData.isYuque?"https://www.yuque.com/yuque/thyzgp/threads":"".concat(window.location.origin,"/lark/bsgp0v/threads"),type:"Thread",mode:"custom",spm:{factory:"c36318"}},{id:"challenge_works",name:"",name_placeholder:"请输入名称：学校-姓名-学号",desc:"",desc_placeholder:"建议 100 字",desc_extra:"",cover:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*tPThT5dB5BIAAAAAAAAAAAAAARQnAQ",show_in_create_entry:!1,type:"Book",mode:"template",icon:"book-type-default2",book_icon:"book-type-default",spm:{factory:"c36318.d732971",guide:"c36329.d733371"}},{id:"challenge_thinking",name:"",name_placeholder:"请输入名称：学校-姓名-学号",desc:"",desc_placeholder:"建议 100 字",desc_extra:"",cover:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*w5L9SpRyDJoAAAAAAAAAAAAAARQnAQ",show_in_create_entry:!1,type:"Book",mode:"template",icon:"book-type-default2",book_icon:"book-type-default",spm:{factory:"c36318.d732972",guide:"c36329.d733372"}}],user:[{id:"notes",name:__("学习笔记"),desc:__("点滴学习，随时记录"),icon:"book-type-notes",book_icon:"book-type-notes",intro:__("点滴学习，随时记录"),cover:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*oYTyS4EZZ3MAAAAAAAAAAABkARQnAQ",detail:"",type:"Book",mode:"template",spm:{factory:"c36318.d73299",guide:"c36329.d73339"}},{id:"blog",name:__("博客专栏"),desc:__("分享与交流你的知识"),icon:"book-type-blog",book_icon:"book-type-blog",intro:__("分享与交流你的知识"),cover:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*QyEWTose5kAAAAAAAAAAAABkARQnAQ",detail:"",type:"Book",mode:"template",spm:{factory:"c36318.d73298",guide:"c36329.d73338"}},{id:"travel",name:__("旅行攻略"),desc:__("行程单、预算、游记"),icon:"book-type-travel",book_icon:"book-type-travel",intro:__("行程单、预算、游记"),cover:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*QTUnQaJmAgMAAAAAAAAAAABkARQnAQ",detail:"",type:"Book",mode:"template",spm:{factory:"c36318.d73297",guide:"c36329.d73337"}}],group:[{id:"project",name:__("项目方案"),icon:"book-type-project",book_icon:"book-type-project",intro:"",desc:__("项目相关的所有文档"),cover:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*vAlXQIVsv8IAAAAAAAAAAABkARQnAQ",detail:"",type:"Book",mode:"template",spm:{factory:"c36318.d73302"}},{id:"manual",name:__("产品手册"),desc:__("规范形式的产品说明"),icon:"book-type-manual",book_icon:"book-type-manual",intro:"",cover:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*qHFuTYn2evsAAAAAAAAAAABkARQnAQ",detail:"",type:"Book",mode:"template",spm:{factory:"c36318.d73301"}},{id:"reports",name:__("团队周报"),desc:__("团队内约定的周总结"),icon:"book-type-reports",book_icon:"book-type-reports",intro:"",cover:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*RF7nTJJwxWEAAAAAAAAAAABkARQnAQ",detail:"",type:"Book",mode:"template",spm:{factory:"c36318.d73300"}},{id:"team_blog",name:__("团队博客"),desc:__("知识沉淀与经验分享"),icon:"book-type-blog",book_icon:"book-type-blog",intro:"",cover:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*WK-PQ5aEASwAAAAAAAAAAABkARQnAQ",detail:"",type:"Book",mode:"template",spm:{factory:"c36318.d74002"}}],publication:[{id:"publication_book",name:__("文档知识库"),desc:__("创作在线文档、表格"),icon:"book-type-default2",book_icon:"book-type-default",intro:__("提供结构化展示，在线完成知识创作。覆盖产品文档、项目文档、帮助手册、周报、个人笔记、旅行攻略、财务报表、报价单等场景。"),cover:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*0zoQT6wVAEMAAAAAAAAAAABkARQnAQ",detail:__("覆盖产品文档、项目文档、帮助手册、周报、个人笔记、旅行攻略、财务报表、报价单等场景"),help:"https://www.yuque.com/yuque/thyzgp/repository",type:"Book",mode:"custom",layout:a.BOOK_LAYOUT.Column,bookPublic:1,spm:{factory:"c36318.d73308"}}]},c=o()(Object.values(i)),u={SCENES:i,findById:function(e){return e?c.find((function(t){return t.id===e})):null},isTemplate:function(e){return"template"===e.mode}};t.a=u},3649:function(e,t,r){(function(t){var n=r(3531),o=r(3584),a=r(3585),i=r(3586),c=r(3532),u=a.CODES;function l(e,t,r){n.EventEmitter.call(this),this.connection=e,this.collection=t,this.id=r,this.version=null,this.type=null,this.data=void 0,this.inflightFetch=[],this.inflightSubscribe=[],this.inflightUnsubscribe=[],this.pendingFetch=[],this.subscribed=!1,this.wantSubscribe=!1,this.inflightOp=null,this.pendingOps=[],this.type=null,this.applyStack=null,this.preventCompose=!1}function s(e,t,r){if(t){var n=e.pop();e.push((function(e){n&&n(e),r&&r(e)}))}else e.push(r)}function f(e,t){if(e.del)return delete(r=t).op,delete r.create,void delete r.del;var r;if(t.del)return new a(u.ERR_DOC_WAS_DELETED,"Document was deleted");if(t.create)return new a(u.ERR_DOC_ALREADY_CREATED,"Document already created");if(t.op){if(e.create)return new a(u.ERR_DOC_ALREADY_CREATED,"Document already created");if(e.type.transformX){var n=e.type.transformX(e.op,t.op);e.op=n[0],t.op=n[1]}else{var o=e.type.transform(e.op,t.op,"left"),i=e.type.transform(t.op,e.op,"right");e.op=o,t.op=i}}}function d(e,t){for(var r=!1,n=0;n<e.length;n++){var o=e[n];o&&(o(t),r=!0)}return r}e.exports=l,n.mixin(l),l.prototype.destroy=function(e){var t=this;t.whenNothingPending((function(){t.wantSubscribe?t.unsubscribe((function(r){if(r)return e?e(r):t.emit("error",r);t.connection._destroyDoc(t),e&&e()})):(t.connection._destroyDoc(t),e&&e())}))},l.prototype._setType=function(e){if("string"==typeof e&&(e=i.map[e]),e)this.type=e;else{if(null!==e){var t=new a(u.ERR_DOC_TYPE_NOT_RECOGNIZED,"Missing type "+e);return this.emit("error",t)}this.type=e,this.data=void 0}},l.prototype.ingestSnapshot=function(e,t){if(!e)return t&&t();if("number"!=typeof e.v){var r=new a(u.ERR_INGESTED_SNAPSHOT_HAS_NO_VERSION,"Missing version in ingested snapshot. "+this.collection+"."+this.id);return t?t(r):this.emit("error",r)}if(this.type||this.hasWritePending()){if(null==this.version){if(this.hasWritePending())return t&&this.once("no write pending",t);r=new a(u.ERR_DOC_MISSING_VERSION,"Cannot ingest snapshot in doc with null version. "+this.collection+"."+this.id);return t?t(r):this.emit("error",r)}return e.v>this.version?this.fetch(t):t&&t()}if(this.version>e.v)return t&&t();this.version=e.v;var n=void 0===e.type?i.defaultType:e.type;this._setType(n),this.data=this.type&&this.type.deserialize?this.type.deserialize(e.data):e.data,this.emit("load"),t&&t()},l.prototype.whenNothingPending=function(e){var r=this;t.nextTick((function(){r.hasPending()?r.once("nothing pending",e):e()}))},l.prototype.hasPending=function(){return!!(this.inflightOp||this.pendingOps.length||this.inflightFetch.length||this.inflightSubscribe.length||this.inflightUnsubscribe.length||this.pendingFetch.length)},l.prototype.hasWritePending=function(){return!(!this.inflightOp&&!this.pendingOps.length)},l.prototype._emitNothingPending=function(){this.hasWritePending()||(this.emit("no write pending"),this.hasPending()||this.emit("nothing pending"))},l.prototype._emitResponseError=function(e,t){return e&&e.code===u.ERR_SNAPSHOT_READ_SILENT_REJECTION?(this.wantSubscribe=!1,t&&t(),void this._emitNothingPending()):t?(t(e),void this._emitNothingPending()):(this._emitNothingPending(),void this.emit("error",e))},l.prototype._handleFetch=function(e,t){var r=this.inflightFetch.shift();if(e)return this._emitResponseError(e,r);this.ingestSnapshot(t,r),this._emitNothingPending()},l.prototype._handleSubscribe=function(e,t){var r=this.inflightSubscribe.shift();if(e)return this._emitResponseError(e,r);this.wantSubscribe&&(this.subscribed=!0),this.ingestSnapshot(t,r),this._emitNothingPending()},l.prototype._handleUnsubscribe=function(e){var t=this.inflightUnsubscribe.shift();if(e)return this._emitResponseError(e,t);t&&t(),this._emitNothingPending()},l.prototype._handleOp=function(e,t){if(e)return this.inflightOp?(e.code===u.ERR_OP_SUBMIT_REJECTED&&(e=null),this._rollback(e)):this.emit("error",e);if(this.inflightOp&&t.src===this.inflightOp.src&&t.seq===this.inflightOp.seq)this._opAcknowledged(t);else if(null==this.version||t.v>this.version)this.fetch();else if(!(t.v<this.version)){if(this.inflightOp)if(n=f(this.inflightOp,t))return this._hardRollback(n);for(var r=0;r<this.pendingOps.length;r++){var n;if(n=f(this.pendingOps[r],t))return this._hardRollback(n)}this.version++;try{this._otApply(t,!1)}catch(e){return this._hardRollback(e)}}},l.prototype._onConnectionStateChanged=function(){if(this.connection.canSend)this.flush(),this._resubscribe();else if(this.inflightOp&&(this.pendingOps.unshift(this.inflightOp),this.inflightOp=null),this.subscribed=!1,(this.inflightFetch.length||this.inflightSubscribe.length)&&(this.pendingFetch=this.pendingFetch.concat(this.inflightFetch,this.inflightSubscribe),this.inflightFetch.length=0,this.inflightSubscribe.length=0),this.inflightUnsubscribe.length){var e=this.inflightUnsubscribe;this.inflightUnsubscribe=[],d(e)}},l.prototype._resubscribe=function(){var e=this.pendingFetch;if(this.pendingFetch=[],this.wantSubscribe)return e.length?void this.subscribe((function(t){d(e,t)})):void this.subscribe();e.length&&this.fetch((function(t){d(e,t)}))},l.prototype.fetch=function(e){if(this.connection.canSend){var t=this.connection.sendFetch(this);s(this.inflightFetch,t,e)}else this.pendingFetch.push(e)},l.prototype.subscribe=function(e){if(this.wantSubscribe=!0,this.connection.canSend){var t=this.connection.sendSubscribe(this);s(this.inflightSubscribe,t,e)}else this.pendingFetch.push(e)},l.prototype.unsubscribe=function(e){if(this.wantSubscribe=!1,this.subscribed=!1,this.connection.canSend){var r=this.connection.sendUnsubscribe(this);s(this.inflightUnsubscribe,r,e)}else e&&t.nextTick(e)},l.prototype.flush=function(){this.connection.canSend&&!this.inflightOp&&!this.paused&&this.pendingOps.length&&this._sendOp()},l.prototype._otApply=function(e,t){if(e.op){if(!this.type)throw new a(u.ERR_DOC_DOES_NOT_EXIST,"Cannot apply op to uncreated document. "+this.collection+"."+this.id);if(!t&&this.type===i.defaultType&&e.op.length>1){this.applyStack||(this.applyStack=[]);for(var r=this.applyStack.length,n=0;n<e.op.length;n++){for(var o={op:[e.op[n]]},c=r;c<this.applyStack.length;c++){var l=f(this.applyStack[c],o);if(l)return this._hardRollback(l)}this.emit("before op",o.op,t),this.data=this.type.apply(this.data,o.op),this.emit("op",o.op,t)}return void this._popApplyStack(r)}return this.emit("before op",e.op,t),this.data=this.type.apply(this.data,e.op),void this.emit("op",e.op,t)}if(e.create)return this._setType(e.create.type),this.data=this.type.deserialize?this.type.createDeserialized?this.type.createDeserialized(e.create.data):this.type.deserialize(this.type.create(e.create.data)):this.type.create(e.create.data),void this.emit("create",t);if(e.del){var s=this.data;return this._setType(null),void this.emit("del",s,t)}},l.prototype._sendOp=function(){if(this.connection.canSend){var e=this.connection.id;this.inflightOp||(this.inflightOp=this.pendingOps.shift());var t=this.inflightOp;if(!t){var r=new a(u.ERR_INFLIGHT_OP_MISSING,"No op to send on call to _sendOp");return this.emit("error",r)}if(t.sentAt=Date.now(),t.retries=null==t.retries?0:t.retries+1,null==t.seq){if(this.connection.seq>=c.MAX_SAFE_INTEGER)return this.emit("error",new a(u.ERR_CONNECTION_SEQ_INTEGER_OVERFLOW,"Connection seq has exceeded the max safe integer, maybe from being open for too long"));t.seq=this.connection.seq++}this.connection.sendOp(this,t),null==t.src&&(t.src=e)}},l.prototype._submit=function(e,r,n){if(r||(r=!0),e.op){if(!this.type){var o=new a(u.ERR_DOC_DOES_NOT_EXIST,"Cannot submit op. Document has not been created. "+this.collection+"."+this.id);return n?n(o):this.emit("error",o)}this.type.normalize&&(e.op=this.type.normalize(e.op))}try{this._pushOp(e,n),this._otApply(e,r)}catch(e){return this._hardRollback(e)}var i=this;t.nextTick((function(){i.flush()}))},l.prototype._pushOp=function(e,t){if(this.applyStack)this.applyStack.push(e);else{var r=this._tryCompose(e);if(r)return void r.callbacks.push(t)}e.type=this.type,e.callbacks=[t],this.pendingOps.push(e)},l.prototype._popApplyStack=function(e){if(e>0)this.applyStack.length=e;else{var t=this.applyStack[0];if(this.applyStack=null,t)if(-1!==(n=this.pendingOps.indexOf(t)))for(var r=this.pendingOps.splice(n),n=0;n<r.length;n++){t=r[n];var o=this._tryCompose(t);o?o.callbacks=o.callbacks.concat(t.callbacks):this.pendingOps.push(t)}}},l.prototype._tryCompose=function(e){if(!this.preventCompose){var t=this.pendingOps[this.pendingOps.length-1];if(t&&!t.sentAt)return t.create&&e.op?(t.create.data=this.type.apply(t.create.data,e.op),t):t.op&&e.op&&this.type.compose?(t.op=this.type.compose(t.op,e.op),t):void 0}},l.prototype.submitOp=function(e,t,r){"function"==typeof t&&(r=t,t=null);var n={op:e},o=t&&t.source;this._submit(n,o,r)},l.prototype.create=function(e,t,r,n){if("function"==typeof t?(n=t,r=null,t=null):"function"==typeof r&&(n=r,r=null),t||(t=i.defaultType.uri),this.type){var o=new a(u.ERR_DOC_ALREADY_CREATED,"Document already exists");return n?n(o):this.emit("error",o)}var c={create:{type:t,data:e}},l=r&&r.source;this._submit(c,l,n)},l.prototype.del=function(e,t){if("function"==typeof e&&(t=e,e=null),!this.type){var r=new a(u.ERR_DOC_DOES_NOT_EXIST,"Document does not exist");return t?t(r):this.emit("error",r)}var n=e&&e.source;this._submit({del:!0},n,t)},l.prototype.pause=function(){this.paused=!0},l.prototype.resume=function(){this.paused=!1,this.flush()},l.prototype._opAcknowledged=function(e){if(this.inflightOp.create)this.version=e.v;else if(e.v!==this.version)return o.warn("Invalid version from server. Expected: "+this.version+" Received: "+e.v,e),this.fetch();this.version++,this._clearInflightOp()},l.prototype._rollback=function(e){var t=this.inflightOp;if(t.op&&t.type.invert){t.op=t.type.invert(t.op);for(var r=0;r<this.pendingOps.length;r++){var n=f(this.pendingOps[r],t);if(n)return this._hardRollback(n)}try{this._otApply(t,!1)}catch(e){return this._hardRollback(e)}this._clearInflightOp(e)}else this._hardRollback(e)},l.prototype._hardRollback=function(e){var t=[];this.inflightOp&&t.push(this.inflightOp),t=t.concat(this.pendingOps),this._setType(null),this.version=null,this.inflightOp=null,this.pendingOps=[];var r=this;this.fetch((function(){for(var n=!!t.length,o=0;o<t.length;o++)n=d(t[o].callbacks,e)&&n;if(e&&!n)return r.emit("error",e)}))},l.prototype._clearInflightOp=function(e){var t=this.inflightOp;this.inflightOp=null;var r=d(t.callbacks,e);if(this.flush(),this._emitNothingPending(),e&&!r)return this.emit("error",e)}}).call(this,r(144))},3650:function(e,t,r){(function(t){var n=r(3531);function o(e,t,r,o,a,i,c){n.EventEmitter.call(this),this.action=e,this.connection=t,this.id=r,this.collection=o,this.query=a,this.results=null,i&&i.results&&(this.results=i.results,delete i.results),this.extra=void 0,this.options=i,this.callback=c,this.ready=!1,this.sent=!1}e.exports=o,n.mixin(o),o.prototype.hasPending=function(){return!this.ready},o.prototype.send=function(){if(this.connection.canSend){var e={a:this.action,id:this.id,c:this.collection,q:this.query};if(this.options&&(e.o=this.options),this.results){for(var t=[],r=0;r<this.results.length;r++){var n=this.results[r];t.push([n.id,n.version])}e.r=t}this.connection.send(e),this.sent=!0}},o.prototype.destroy=function(e){this.connection.canSend&&"qs"===this.action&&this.connection.send({a:"qu",id:this.id}),this.connection._destroyQuery(this),e&&t.nextTick(e)},o.prototype._onConnectionStateChanged=function(){this.connection.canSend&&!this.sent?this.send():this.sent=!1},o.prototype._handleFetch=function(e,t,r){this.connection._destroyQuery(this),this._handleResponse(e,t,r)},o.prototype._handleSubscribe=function(e,t,r){this._handleResponse(e,t,r)},o.prototype._handleResponse=function(e,t,r){var n=this.callback;if(this.callback=null,e)return this._finishResponse(e,n);if(!t)return this._finishResponse(null,n);var o=this,a=1,i=function(e){if(e)return o._finishResponse(e,n);--a||o._finishResponse(null,n)};if(Array.isArray(t))a+=t.length,this.results=this._ingestSnapshots(t,i),this.extra=r;else for(var c in t){a++;var u=t[c];this.connection.get(u.c||this.collection,c).ingestSnapshot(u,i)}i()},o.prototype._ingestSnapshots=function(e,t){for(var r=[],n=0;n<e.length;n++){var o=e[n],a=this.connection.get(o.c||this.collection,o.d);a.ingestSnapshot(o,t),r.push(a)}return r},o.prototype._finishResponse=function(e,t){if(this.emit("ready"),this.ready=!0,e)return this.connection._destroyQuery(this),t?t(e):this.emit("error",e);t&&t(null,this.results,this.extra)},o.prototype._handleError=function(e){this.emit("error",e)},o.prototype._handleDiff=function(e){for(var t=0;t<e.length;t++){"insert"===(r=e[t]).type&&(r.values=this._ingestSnapshots(r.values))}for(t=0;t<e.length;t++){var r;switch((r=e[t]).type){case"insert":var n=r.values;Array.prototype.splice.apply(this.results,[r.index,0].concat(n)),this.emit("insert",n,r.index);break;case"remove":var o=r.howMany||1,a=this.results.splice(r.index,o);this.emit("remove",a,r.index);break;case"move":o=r.howMany||1;var i=this.results.splice(r.from,o);Array.prototype.splice.apply(this.results,[r.to,0].concat(i)),this.emit("move",i,r.from,r.to)}}this.emit("changed",this.results)},o.prototype._handleExtra=function(e){this.extra=e,this.emit("extra",e)}}).call(this,r(144))},3651:function(e,t,r){var n=r(3776),o=r(3531);function a(e,t,r,n,a){if(o.EventEmitter.call(this),"function"!=typeof a)throw new Error("Callback is required for SnapshotRequest");this.requestId=t,this.connection=e,this.id=n,this.collection=r,this.callback=a,this.sent=!1}e.exports=a,o.mixin(a),a.prototype.send=function(){this.connection.canSend&&(this.connection.send(this._message()),this.sent=!0)},a.prototype._onConnectionStateChanged=function(){this.connection.canSend?this.sent||this.send():this.sent=!1},a.prototype._handleResponse=function(e,t){if(this.emit("ready"),e)return this.callback(e);var r=t.meta?t.meta:null,o=new n(this.id,t.v,t.type,t.data,r);this.callback(null,o)}},3653:function(e,t,r){"use strict";r(3205);var n=r(1528);r(3186);t.a=n.a},3654:function(e,t,r){"use strict";var n=r(0);t.a=function(e,t){Object(n.useEffect)((function(){if(e){var r=function(e){return e.preventDefault(),t&&(e.returnValue=t),t};return window.addEventListener("beforeunload",r),function(){return window.removeEventListener("beforeunload",r)}}}),[t,e])}},3655:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r(3629);function o(e){var t=[],r={};if(e.startsWith("<!doctype html>"))t.push(e.substring(15));else{var o=JSON.parse(e.substring(15));t=o.htmls,r=o.options}var a=Object(n.a)(t,r);return{value:JSON.stringify(a)}}},3658:function(e,t,r){"use strict";r(73);var n=r(31),o=(r(41),r(9)),a=(r(37),r(10)),i=r(0),c=r.n(i),u=r(2),l=r.n(u),s=r(228),f=r(150),d=r(1223),p=r(1244);r(1339);function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function m(){m=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof b?t:b,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:A(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",y="executing",v="completed",g={};function b(){}function w(){}function _(){}var E={};l(E,i,(function(){return this}));var O=Object.getPrototypeOf,S=O&&O(O(N([])));S&&S!==r&&n.call(S,i)&&(E=S);var k=_.prototype=b.prototype=Object.create(E);function x(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==h(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=d;return function(a,i){if(o===y)throw new Error("Generator is already running");if(o===v){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?v:p,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=v,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(h(t)+" is not iterable")}return w.prototype=_,o(k,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(j.prototype),l(j.prototype,c,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(k),l(k,u,"Generator"),l(k,i,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function y(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return g(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return g(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function b(e){var t=v(Object(i.useState)(e.doc.title),2),r=t[0],u=t[1],l=v(Object(i.useState)(-1),2),s=l[0],h=l[1],g=function(){var t,n=(t=m().mark((function t(){var n,o,i,u,l,p,h;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.book,o=e.doc,i=e.docletType,u=e.onOpenTemplateSelector,l=e.inEdit,s===f.TYPE.BOOK?(p=n.id,h=f.TARGET_TYPE.BOOK):s===f.TYPE.PERSONAL?(p=window.appData.me.id,h=f.TARGET_TYPE.USER):(p=n.user_id,h=f.TARGET_TYPE.USER),Object(d.e)(p,h,s,i,r,o.id,l).then((function(){var t=c.a.createElement("span",null,__("模板已创建")," ",c.a.createElement("a",{onClick:u},__("查看全部模板")));a.a.success(t),e.onCancel()})).catch((function(e){console.error(e)}));case 3:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(e){y(a,n,o,i,c,"next",e)}function c(e){y(a,n,o,i,c,"throw",e)}i(void 0)}))});return function(){return n.apply(this,arguments)}}(),b=e.group,w=e.organization,_=e.isDesktop;return c.a.createElement(n.a,{className:"modal-without-padding",visible:e.visible,style:{top:78},width:"368px",onCancel:e.onCancel,title:e.modalTitle,footer:c.a.createElement(c.a.Fragment,null,c.a.createElement(o.a,{onClick:e.onCancel},__("取消")),c.a.createElement(o.a,{type:"primary",onClick:g},__("确定")))},c.a.createElement(p.a,{newTemplateName:r,onSetNewTemplateName:u,onSetSelectedScope:h,group:b,organization:w,isDesktop:_}))}b.propTypes={visible:l.a.bool,onCancel:l.a.func,modalTitle:l.a.string,docletType:l.a.string,doc:l.a.object,book:l.a.object,group:l.a.object,organization:l.a.object,isDesktop:l.a.bool,onOpenTemplateSelector:l.a.func,templateProxy:l.a.object,docProxy:l.a.object,inEdit:l.a.bool},t.a=Object(s.b)(b,!0)},3659:function(e,t,r){"use strict";r(41);var n=r(9),o=(r(229),r(34)),a=(r(60),r(14)),i=(r(37),r(10)),c=(r(161),r(23)),u=r(0),l=r.n(u),s=r(480),f=r(2),d=r.n(f),p=r(32),h=r(101),m=r(51),y=r(507),v=(r(143),r(67)),g=r(713),b=r(46),w=r(3309),_=r(455),E=r(59),O=r(230),S=r(11),k=r(238);function x(e){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x(e)}function j(){j=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:A(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(N([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==x(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(x(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function A(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}var L=o.a.Option,T=function(e){var t,r=e.group,n=e.organization,a=e.bookPrivacy,i=e.onChange,c=l.a.useMemo((function(){var e;return e=null!=n&&n.id?null!=r&&r.isPublicPage?_.a.PUBLIC_PAGE:_.a.ORG:_.a.PERSON,Object(k.a)()?e:_.a.INTERNAL}),[n,r]),u=function(){return a.public===S.PRIVACY.private&&a.extendPrivate===S.EXTEND_PRIVATE.BIND_DEPARTMENTS?S.EXTEND_PRIVATE_MAP_TO_PRIVACY_VALUE:a.public},s=function(){var e,t=(e=j().mark((function e(t){return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==S.EXTEND_PRIVATE_MAP_TO_PRIVACY_VALUE){e.next=3;break}return i({public:S.PRIVACY.private,extendPrivate:S.EXTEND_PRIVATE.BIND_DEPARTMENTS}),e.abrupt("return");case 3:i({public:t,extendPrivate:S.EXTEND_PRIVATE.NONE});case 4:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){A(a,n,o,i,c,"next",e)}function c(e){A(a,n,o,i,c,"throw",e)}i(void 0)}))});return function(e){return t.apply(this,arguments)}}();return l.a.createElement("div",{className:"group-selector","data-testid":"group-selector"},l.a.createElement(o.a,{placement:"bottomLeft",getPopupContainer:function(e){return e.parentNode},dropdownMatchSelectWidth:!0,value:u(),onChange:s},(t=E.a.isExpired(n)&&Object(O.g)(r),w.m[c].actions.map((function(e){return r.type===m.TYPES_MAP.user&&e.value===S.EXTEND_PRIVATE_MAP_TO_PRIVACY_VALUE||(null==r?void 0:r.extend_private)===S.EXTEND_PRIVATE.NONE&&e.value===S.EXTEND_PRIVATE_MAP_TO_PRIVACY_VALUE?null:l.a.createElement(L,{"data-testid":"public-selector-".concat(e.value),key:e.value,value:e.value,disabled:t&&e.value===S.PRIVACY.public},l.a.createElement("div",{className:"group-selector-item"},l.a.createElement("div",null,e.label),e.value===S.EXTEND_PRIVATE_MAP_TO_PRIVACY_VALUE&&l.a.createElement(v.a,{title:__("具体绑定部门由团队设置")},l.a.createElement("div",{className:"tip-icon",onClick:function(){k.b.windowOpen("https://yuque.antfin.com/lark/zp2v9g/emrme5")}},l.a.createElement(b.b,{size:16,name:"help"})))),u()===e.value&&l.a.createElement(g.a,null))})))))},C=r(3610),P=r(3574),N=r(3573),R=r(3514),I=r(1450),D=r(3642),M=r(50),F=r(3597),G="index-module_newRepoWrap_dEIFH",U="index-module_content_Paldp",B="index-module_basicInfoNormal_0J70G",q="index-module_bookIcon_LCBKs",V="index-module_submitBtnWrapper_D+zDy",z="index-module_submitBtn_ANP9f",H=r(708);function W(e){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W(e)}function Y(e){return function(e){if(Array.isArray(e))return re(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||te(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function K(){K=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==W(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(W(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function Q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(r),!0).forEach((function(t){J(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function J(e,t,r){return t=function(e){var t=function(e,t){if("object"!==W(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==W(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===W(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function X(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function $(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){X(a,n,o,i,c,"next",e)}function c(e){X(a,n,o,i,c,"throw",e)}i(void 0)}))}}function ee(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||te(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function te(e,t){if(e){if("string"==typeof e)return re(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?re(e,t):void 0}}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var ne=c.a.Item,oe=D.a.SCENES;function ae(e){return e?!window.appData.isYuque||(null==e?void 0:e.type)!==m.TYPES_MAP.group&&(null==e?void 0:e.type)!==m.TYPES_MAP.wiki&&(null==e?void 0:e.type)!==m.TYPES_MAP.publicPage||"number"!=typeof e.public?{public:S.PRIVACY.private,extendPrivate:e.extend_private}:(null==e?void 0:e.type)===m.TYPES_MAP.publicPage&&E.a.isExpired(null===(t=window.appData)||void 0===t?void 0:t.organization)?{public:S.PRIVACY.intranet,extendPrivate:S.EXTEND_PRIVATE.NONE}:{public:e.public,extendPrivate:S.EXTEND_PRIVATE.NONE}:{};var t}function ie(e){var t,r,s=e.group,f=e.me,d=e.organization,v=e.isPublicCloud,g=e.disabled,b=e.book,w=e.scene,_=e.isYuque,E=e.belongTo,O=e.availableGroups,k=e.bookNameDefault,x=e.dispatch,j=ee(c.a.useForm(),1)[0],A=window.appData.settings.publication_enable_whitelist,L=!window.appData.isYuque&&((null==A?void 0:A.includes(null==f?void 0:f.id))||(null==A?void 0:A.includes("all"))),W=!(!d||!d.id),Q=ee(Object(u.useState)(s),2),J=Q[0],X=Q[1],te=ee(Object(u.useState)(oe.default),2),re=te[0],ie=te[1],ce=ee(Object(u.useState)(null==re||null===(t=re[0])||void 0===t?void 0:t.type),2),ue=ce[0],le=ce[1],se=ee(Object(u.useState)(null),2),fe=se[0],de=se[1],pe=ee(Object(u.useState)((function(){return ae(J)})),2),he=pe[0],me=pe[1],ye=ee(Object(u.useState)(!0),2),ve=ye[0],ge=ye[1],be=ee(Object(u.useState)((function(){return[m.TYPES_MAP.group,m.TYPES_MAP.publicPage].includes(null==s?void 0:s.type)?[s]:s||!E.includes("mine")||W?[]:[f]})),2),we=be[0],_e=be[1],Ee=ee(Object(u.useState)(!1),2),Oe=Ee[0],Se=Ee[1],ke=Object(u.useRef)(),xe=!W&&J.id&&"User"===J.type&&!J.isPaid,je=(null==J?void 0:J.type)&&!xe;Object(u.useEffect)((function(){me(xe?{public:S.PRIVACY.private,extendPrivate:S.EXTEND_PRIVATE.NONE}:ae(J))}),[J]),Object(u.useEffect)((function(){var e;null===(e=ke.current)||void 0===e||e.focus(),k&&ge(!1)}),[]),Object(u.useEffect)((function(){["Resource","Design","Thread"].includes(ue)||null!=s&&s.isPublicPage?Se(!0):Se(!1)}),[ue,s]),Object(u.useEffect)((function(){le(w||(null==re?void 0:re[0].type))}),[JSON.stringify(re)]),Object(u.useEffect)((function(){if(_||e.isH5||null==J||!J.isWiki)if(!_&&e.isH5&&null!=J&&J.isWiki){var t=["book","resource","thread"],r=oe.default.filter((function(e){return t.includes(e.id)}));ie(r)}else{var n=oe.default.filter((function(e){return"book"===e.id}));ie(n)}else ie(oe.default)}),[J]);var Ae=function(){var e=$(K().mark((function e(t){var r,n,o,a,c,u,l,s,h,y;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.a.destroy(),t){e.next=5;break}return X(null),ge(!0),e.abrupt("return");case 5:if(!v||d||t.isPaid){e.next=10;break}return e.next=8,M.a.books.getCount({user_id:t.id});case 8:(r=e.sent)&&(n="max_book_number",o=t.isGroupOrPublication()?p.MEMBER_RULE.Group.normal[n]:p.MEMBER_RULE.User[m.MEMBER_LEVEL.free][n],r.count>=o&&(a=I.h.getMessage(n,{isOwner:r.isOwner,user:t})||{},c=a.msg,u=a.alwaysOpen,l=a.level,s=a.callback,c&&s(i.a[l||"error"](c,u?0:void 0))));case 10:if(t.id!==f.id){e.next=16;break}return e.next=13,M.a.mine.bookStacks();case 13:return h=e.sent,X(Z(Z({},t),{},{book_stacks:h})),e.abrupt("return");case 16:return e.next=18,M.a.groups.getBookStacks({id:t.id});case 18:(y=e.sent)&&X(Z(Z({},t),{},{book_stacks:y}));case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Le=function(e){var t;return null!=s&&s.id&&null!=s&&null!==(t=s.abilities)&&void 0!==t&&t.create_book?s.name?s:e.find((function(e){return e.id===s.id})):W?e[0]:f},Te=function(){var e=$(K().mark((function e(){var t,r;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={filterByAbility:"create_book",scene:"create_book"},W&&(t.organization_id=d.id),r=L?M.a.mine.publications:function(){return[]},e.next=5,Promise.all([M.a.mine.groups(t),r(t)]).then((function(e){var t=ee(e,2),r=t[0],n=t[1],o=r.concat(n);return o=o.filter((function(e){var t;return e.group_user_role!==h.default.ROLE.readonly&&(null===(t=e.abilities)||void 0===t?void 0:t.createBook)}))}));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(u.useEffect)((function(){var e=function(){var e=$(K().mark((function e(){var t,r;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],E.includes("mine")&&!W&&t.push(f),!E.includes("group")){e.next=10;break}if(e.t0=O,e.t0){e.next=8;break}return e.next=7,Te();case 7:e.t0=e.sent;case 8:r=e.t0,t.push.apply(t,Y(r));case 10:if(0!==t.length){e.next=13;break}return i.a.warning(__("暂时无法操作，请先联系管理员，加入团队成员后才能进行知识协作")),e.abrupt("return");case 13:_e(t),Ae(Le(r));case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[]);var Ce,Pe=function(){var t=$(K().mark((function t(r){var n,o;return K().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=Y(e.me.commonUsedBooks),t.next=4,P.a.addItemByTarget(r,n,{refId:"dashboard_books",type:"Book",targetType:"Book"});case 4:o=t.sent,x({type:"me/update",payload:{commonUsedBooks:o}}),t.next=10;break;case 8:t.prev=8,t.t0=t.catch(0);case 10:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e){return t.apply(this,arguments)}}(),Ne=function(e){me(e)};return l.a.createElement("div",{className:G},l.a.createElement("div",{className:U},l.a.createElement(c.a,{form:j,layout:"vertical",initialValues:{name:k}},l.a.createElement(ne,{colon:!1,label:__("基本信息"),name:"name",rules:[{max:50,message:__("名称过长，最多输入50个字")}]},l.a.createElement("div",{className:B},l.a.createElement(F.b,{className:q,disabled:g,updateIcon:function(e){de(e)}}),l.a.createElement(a.a,{"data-testid":"input-name",type:"text",disabled:g,placeholder:__("知识库名称"),autoComplete:"off",ref:ke,maxLength:50,onChange:function(e){e.target.value.trim()?ge(!1):ge(!0)},defaultValue:k}))),l.a.createElement(ne,{colon:!1,name:"description",rules:[{max:255,message:__("简介过长，最多输入255个字")}]},l.a.createElement(a.a.TextArea,{"data-testid":"input-desc",name:"description",autoComplete:"off",className:"book-form-desc",disabled:g,autoSize:{minRows:4},placeholder:__("知识库简介（选填）")})),!W||we.length||null!=d&&null!==(Ce=d.abilities)&&void 0!==Ce&&Ce.create_group?l.a.createElement(ne,{colon:!1,label:__("新建至")},l.a.createElement(R.a,{size:"large",groups:we,onChange:Ae,current:J,disabled:Oe})):null,je&&l.a.createElement(ne,{colon:!1,label:__("公开性")},l.a.createElement(T,{group:J,bookPrivacy:he,organization:d,onChange:Ne})),l.a.createElement(C.a,{publicValue:he.public,organization:d}),(null==J||null===(r=J.book_stacks)||void 0===r?void 0:r.length)>1&&l.a.createElement(ne,{colon:!1,label:__("分组"),name:"stack_id"},l.a.createElement(o.a,{size:"large",getPopupContainer:function(e){return e.parentNode},disabled:g,defaultValue:e.stackId||(null==b?void 0:b.stack_id)||J.book_stacks.find((function(e){return e.is_default})).id},null==J?void 0:J.book_stacks.map((function(e){return l.a.createElement(o.a.Option,{key:e.id,value:e.id},e.name)})))))),l.a.createElement("div",{className:V},l.a.createElement(N.a,{content:[__("点击「 新建 」"),__("即可创建完成你的知识库")],placement:"right",stage:y.ACTION.new_book,taskId:y.TASK_ID.NOVICE_OFFER,step:2,width:392,height:56,offsetX:16,popWidth:218,offsetY:-8,borderRadius:8,action:"click",popMarginLeft:20},l.a.createElement(n.a,{className:z,disabled:ve||0===we.length||!(null!=J&&J.id),type:"primary",onClick:function(t){t.preventDefault(),j.validateFields().then(function(){var t=$(K().mark((function t(r){var n,o,a,c,u;return K().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ge(!0),n={user_id:J.id,name:r.name.trim(),public:he.public,extend_private:he.extendPrivate,type:ue},fe&&fe.symbol&&(n.book_icon=fe),J.book_stacks&&J.book_stacks.length>1&&(n.stack_id=r.stack_id||e.stackId),w&&(n.type=w.type,D.a.isTemplate(w)&&(r.scene=w.id)),o=Object.assign(r,n),t.next=8,M.a.books.createBook(o);case 8:if(a=t.sent,c="/".concat(J.login,"/").concat(a.slug),!e.onBookCreated){t.next=14;break}e.onBookCreated({book:a,user:J}),t.next=22;break;case 14:if(i.a.success(__("新建成功")),!window.appData.isYuqueMobileApp){t.next=17;break}return t.abrupt("return",window.location.replace(c));case 17:if((null==J?void 0:J.id)!==(null==f?void 0:f.id)){t.next=20;break}return t.next=20,Pe(a);case 20:null===(u=e.onCancel)||void 0===u||u.call(e),Object(H.c)(c,{page:"bookOverview"});case 22:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},"data-aspm-click":"c323989.d353721"},__("新建")))))}ie.defaultProps={organization:window.appData.organization,isYuque:window.appData.isYuque,isPublicCloud:window.appData.isPublicCloud,belongTo:["mine","group"]},ie.propTypes={me:d.a.object.isRequired,group:d.a.object,organization:d.a.object,scene:d.a.object,isH5:d.a.bool,onBookCreated:d.a.func,isYuque:d.a.bool,isPublicCloud:d.a.bool,disabled:d.a.bool,book:d.a.object,stackId:d.a.string,belongTo:d.a.array,bookNameDefault:d.a.string,availableGroups:d.a.array};t.a=Object(s.d)((function(e,t){var r=e.group,n=e.me,o=e.organization;return{group:t.group||r,me:n,organization:o}}))(ie)},3672:function(e,t,r){"use strict";r(73);var n=r(31),o=(r(37),r(10)),a=r(0),i=r.n(a),c=r(64),u=r.n(c),l=r(3632),s=r.n(l),f=r(82),d=r.n(f),p=r(32),h=r(454),m=r.n(h),y=r(1223),v=r(3509),g=r(260),b=r(3518),w=r(1199),_=r(3464),E=r(120),O=r(790),S=r(22);function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function x(){x=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:A(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(N([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==k(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(k(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(j.prototype),l(j.prototype,c,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function A(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach((function(t){L(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function L(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==k(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==k(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===k(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function T(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function C(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){T(a,n,o,i,c,"next",e)}function c(e){T(a,n,o,i,c,"throw",e)}i(void 0)}))}}function P(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return N(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return N(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var R=u()("doc:useDocAction"),I=window.appData,D=I.isYuqueMobileApp,M=I.userSettings,F=function(e,t,r){if(window.__engine&&window.__engine.execCommand)return window.__engine[e](t,r)},G=m()((function(e){F("execCommand","defaultFontsize",e),F("execCommand","clearDefaultFontsize")}),200),U=m()((function(e){F("execCommand","paragraphSpacing",e)})),B=m()((function(e){F("execCommand","autoSpacing",!!e)}));t.a=function(e){var t=e.book,c=e.doc,u=e.commandParams,l=e.dispatch,f=e.onCommandsExecuted,h=e.onSelectTemplate,k=e.onCreateDoc,j=e.history,L=e.spaMode,T=Object(w.a)(t),N=P(Object(a.useState)(null),2),I=N[0],q=N[1],V=P(Object(a.useState)(!1),2),z=V[0],H=V[1],W=P(Object(a.useState)(!1),2),Y=W[0],K=W[1],Q=P(Object(a.useState)("false"!==(null==M?void 0:M.recordDocSetting)),2),Z=Q[0],J=Q[1];Object(a.useEffect)((function(){Promise.all([r.e(4),r.e(5),r.e(6),r.e(0),r.e(1260)]).then(r.bind(null,3676))}),[]);var X=function(){return F("queryCommandValue","defaultFontsize",!(arguments.length>0&&void 0!==arguments[0])||arguments[0])},$=P(Object(a.useState)(F("queryCommandValue","typography")),2),ee=$[0],te=$[1],re=P(Object(a.useState)(X(!1)),2),ne=re[0],oe=re[1],ae=P(Object(a.useState)(F("queryCommandValue","paragraphSpacing")),2),ie=ae[0],ce=ae[1],ue=P(Object(a.useState)(!!F("queryCommandValue","autoSpacing")),2),le=ue[0],se=ue[1],fe=Object(a.useCallback)(m()((function(e,t,r,n){if(!e)return!1;var o=["default"===t?0:1];15!==r?o.push(r):o.push(15),o.push(n?1:0);var a=o.join(",");b.a.update({docsSetting:a}),l({type:"proxy.web/mine.updateUserSettings",payload:{data:{key:"docsSetting",value:a}}})}),500),[]),de=Object(a.useCallback)(m()((function(e,t,r,n){b.a.update({recordDocSetting:e}),l({type:"proxy.web/mine.updateUserSettings",payload:{data:{key:"recordDocSetting",value:e}}}).then((function(){fe(e,t,r,n)}))}),500),[]),pe=Object(a.useCallback)((function(e){oe(e),G(e),fe(Z,ie,e,le)}),[Z,ie,ne,le]),he=Object(a.useCallback)((function(e){ce(e),U(e),fe(Z,e,ne,le)}),[Z,ie,ne,le]),me=Object(a.useCallback)((function(e){se(!!e),B(!!e),fe(Z,ie,ne,!!e)}),[Z,ie,ne,le]),ye=Object(a.useCallback)((function(e){J(e),de(e,ie,ne,le)}),[Z,ie,ne,le]),ve=function(){q(null)},ge=function(){var e=C(x().mark((function e(){var r,n,a,i,c,l,s,f,d,h,m,y,v,g=arguments;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=A(A({},r=g.length>0&&void 0!==g[0]?g[0]:{}),u),n=r.slug||O.a.createSlug(),r.slug=n,r.book_id=t.id,r.format||(r.format=_.a.getDefaultDocumentFormat(r.type)),a=null,e.prev=7,!L||!j){e.next=26;break}return e.next=11,O.a.createDoc(r,void 0,{useOriginResp:!0});case 11:if(i=e.sent,c=i.data,l=i.toc,R("doc created",{cmd:I,doc:c}),s="/".concat(t.namespace,"/").concat(c.slug,"/edit"),f=s,"doc_toc"===r.create_from&&((d=new URLSearchParams(window.location.search)).set("toc_node_uuid",r.toc_node_uuid),f="".concat(s,"?").concat(d.toString())),T.current.id!==t.id){e.next=23;break}if("markdown"===c.format?(h=new URL(s,window.location.origin),a=a||window,"doc_toc"===r.create_from&&h.searchParams.set("toc_node_uuid",r.toc_node_uuid),a.location.href=h.href):j.push(f),!k){e.next=23;break}return k(c,l),e.abrupt("return");case 23:ve(),e.next=40;break;case 26:if(L){e.next=40;break}return e.next=29,O.a.createDoc(r);case 29:if(m=e.sent,R("doc created",{cmd:I,doc:m}),y="/".concat(t.namespace,"/").concat(m.slug,"/edit"),v=new URL(y,window.location.origin),a=a||window,"doc_toc"===r.create_from&&v.searchParams.set("toc_node_uuid",r.toc_node_uuid),ve(),!k){e.next=39;break}return k(m),e.abrupt("return");case 39:a.location.href=v.href;case 40:e.next=45;break;case 42:e.prev=42,e.t0=e.catch(7),"limit_exceeded"===e.t0.code?o.a.error(e.t0.message):e.t0.code!==p.LIMIT_RULE_CODE.max_doc_note_number&&a&&a.close();case 45:return e.prev=45,a=null,e.finish(45);case 48:case"end":return e.stop()}}),e,null,[[7,42,45,48]])})));return function(){return e.apply(this,arguments)}}(),be=function(){var e=__("确认删除 {title}？",{title:c.title});n.a.confirm({title:e,content:__(""),onOk:function(){l({type:"proxy.web/docs.destroy",payload:{data:{id:c.id}}}).then((function(e){f({cmd:E.a.DOC.delete.cmd,result:e})}))}})},we=Object(v.a)(),_e=we.loadTemplateSelector,Ee=we.showTemplateSelector,Oe=we.contextHolder,Se=function(){var e=C(x().mark((function e(){var r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee({book:t});case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return",ve());case 5:return e.abrupt("return",Object(y.d)(t,r,u));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ke=function(n,a){var i=u;switch(R("exec",{cmd:n,params:i}),q(n),n){case E.a.DOC.delete.cmd:be();break;case E.a.DOC.print.cmd:window.print();break;case E.a.DOC.enter_read_mode.cmd:case E.a.DOC.publish_enter_read_mode.cmd:window.__readyToPublish({enterReadMode:!0});break;case E.a.DOC.open_in_browser.cmd:window.YuqueDesktopAppJSBridge.openExternalLink("".concat(window.location.origin,"/").concat(t.namespace,"/").concat(c.slug));break;case E.a.DOC.fullscreen.cmd:case E.a.DOC.exit_fullscreen.cmd:s.a.enabled?s.a.toggle():o.a.error(__("你的浏览器不支持全屏功能"));break;case E.a.DOC.raw.cmd:window.location.href="".concat(window.location.pathname.replace(/\/+$/,""),"/html");break;case E.a.DOC.view_markdown.cmd:window.location.href="".concat(window.location.pathname.replace(/\/+$/,""),"/markdown");break;case E.a.DOC.presentation.cmd:window.open("".concat(window.location.pathname.replace(/\/+$/,""),"/present"));break;case E.a.DOC.create_doc.cmd:ge({type:"Doc",format:d.a.FORMAT.LAKE,title:i.title,slug:i.slug});break;case E.a.NOTE.create_note.cmd:var p,m;if(window.appData.isDesktopApp)null===(p=window.YuqueDesktopAppJSBridge)||void 0===p||null===(m=p.ipcSend)||void 0===m||m.call(p,{channel:S.a.MINI_WINDOW.OPEN_WINDOW});else Promise.all([r.e(4),r.e(5),r.e(6),r.e(0),r.e(1260)]).then(r.bind(null,3676)).then((function(e){e.default.show()}));break;case E.a.DOC.create_doc_template.cmd:ge({title:__("自定义模板"),type:d.a.TYPE.DOC,format:d.a.FORMAT.LAKE,tag:"YUQUE_TEMPLATE"});break;case E.a.DOC.create_from_template.cmd:h&&h(),Se();break;case E.a.DOC.create_markdown.cmd:ge({type:"Doc",format:d.a.FORMAT.MARKDOWN,title:i.title,slug:i.slug});break;case E.a.DOC.create_sheet.cmd:ge({type:"Sheet",title:i.title,slug:i.slug});break;case E.a.DOC.create_mind.cmd:case E.a.DOC.create_board.cmd:ge({type:"Board",title:i.title,slug:i.slug});break;case E.a.DOC.create_table.cmd:ge({type:"Table",title:i.title,slug:i.slug});break;case E.a.DOC.create_thread.cmd:window.location.href="/".concat(t.namespace,"/new");break;case E.a.DOC.edit.cmd:var y="/".concat(t.namespace,"/").concat(c.slug,"/edit");D?g.a.pushWebWindow({url:"".concat(window.location.origin).concat(y)}):window.location.href=y;break;case E.a.DOC.manage_table.cmd:case E.a.DOC.manage_doc.cmd:window.location.href="/r/".concat(t.namespace,"/docs");break;case E.a.DOC.modify_toc.cmd:window.location.href="/r/".concat(t.namespace,"/toc?from=").concat(c.slug);break;case E.a.DOC.exit.cmd:window.location.href="/dashboard";break;case E.a.DOC.archive.cmd:l({type:"proxy.web/docs.archive",payload:{data:{id:c.id}}}).then((function(e){o.a.success(__("话题已归档")),f({cmd:E.a.DOC.archive.cmd,result:e})}));break;case E.a.DOC.unarchive.cmd:l({type:"proxy.web/docs.unarchive",payload:{data:{id:c.id}}}).then((function(e){o.a.success(__("已取消归档")),f({cmd:E.a.DOC.unarchive.cmd,result:e})}));break;case E.a.DOC.pin.cmd:l({type:"proxy.web/docs.pin",payload:{data:{id:c.id}}}).then((function(e){o.a.success(__("置顶成功")),f({cmd:E.a.DOC.pin.cmd,result:e})}));break;case E.a.DOC.unpin.cmd:l({type:"proxy.web/docs.unpin",payload:{data:{id:c.id}}}).then((function(e){o.a.success(__("已取消置顶")),f({cmd:E.a.DOC.unpin.cmd,result:e})}));break;case E.a.DOC.send_mail.cmd:H(!0);break;case E.a.DOC.document_layout_select.cmd:case E.a.DOC.document_layout.cmd:!function(e){F("execCommand","layout",e)}(a);break;case E.a.DOC.document_typography.cmd:!function(e){te(e),F("execCommand","typography",e),X()||oe(X(!1))}(a);break;case E.a.DOC.document_fontsize.cmd:pe(a);break;case E.a.DOC.document_paragraph_spacing.cmd:he(a);break;case E.a.DOC.document_auto_spacing.cmd:me(a);break;case E.a.DOC.document_record_setting.cmd:ye(a);break;default:e.onCommandsExecuted({cmd:n})}};return i.a.useEffect((function(){I&&(null==I?void 0:I.cmd)===E.a.DOC.create_from_template.cmd&&_e()}),[I]),i.a.useEffect((function(){window.__execAction=function(t,r){[E.a.DOC.save_published_as_version.cmd,E.a.DOC.save_editing_as_version.cmd].includes(t)&&(ke(t,r),e.onSelect({key:t}))}}),[]),{cmd:I,sendAlimail:z,mailSending:Y,typography:ee,defaultFontSize:ne,recordDocSetting:Z,paragraphSpacing:ie,autoSpacing:le,reset:ve,doAction:ke,setSendAlimail:H,setMailSending:K,getEditorLayout:function(){return F("queryCommandValue","layout")},getWordCount:function(){return F("queryCommandValue","wordCount")},contextHolder:Oe}}},3673:function(e,t,r){"use strict";r(2935);var n=r(1258);r(3200);t.a=n.a},3679:function(e,t,r){"use strict";r(3222);var n=r(1559);r(3202);t.a=n.a},3683:function(e,t,r){"use strict";r.d(t,"a",(function(){return v}));var n=r(64),o=r.n(n),a=r(65),i=r.n(a),c=r(163);function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,m(n.key),n)}}function s(e,t){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},s(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=p(e);if(t){var o=p(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===u(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return d(e)}(this,r)}}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function h(e,t,r){return(t=m(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function m(e){var t=function(e,t){if("object"!==u(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===u(t)?t:String(t)}var y=o()("pagestatus"),v={ACTIVE:"active",INACTIVE:"inActive",ONLINE:"online",OFFLINE:"offline",CLOSE:"close"},g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&s(e,t)}(a,e);var t,r,n,o=f(a);function a(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),h(d(e=o.call(this)),"onVisibilityChange",(function(){y("visibility change to: ",document.visibilityState),"hidden"===document.visibilityState?e.onPageHide():"visible"===document.visibilityState&&e.onActive()})),h(d(e),"registerCloseChecker",(function(t){e.closeChecker.push(t)})),h(d(e),"closeAbleCheck",(function(){var t=d(e).closeChecker;for(var r in t)if(!t[r]())return!1;return!0})),h(d(e),"onBeforeunload",(function(t){if(y("close"),e.emit(v.CLOSE),!e.closeAbleCheck())return t.returnValue="确定要离开么？","确定要离开么？"})),h(d(e),"onBlur",(function(){e.transmitStatus(v.INACTIVE)})),h(d(e),"onPageHide",(function(){e.transmitStatus(v.INACTIVE)})),h(d(e),"onPageNetworkChange",(function(t){t?e.emit(v.ONLINE):e.emit(v.OFFLINE)})),h(d(e),"transmitStatus",(function(t){e.status!==t&&(e.status=t,y(t),e.emit(t))})),h(d(e),"onActive",(function(t){e.startIdle(),e.transmitStatus(v.ACTIVE)})),e.IDLE_INTERVAL=t.idleInterval||60,e.status=v.ACTIVE,e.init(),e.closeChecker=[],e}return t=a,(r=[{key:"isActive",get:function(){return this.status===v.ACTIVE}},{key:"init",value:function(){this.bindEvents()}},{key:"destroy",value:function(){this.unbindEvents(),this.clearIdle()}},{key:"bindEvents",value:function(){var e=this;window.addEventListener("beforeunload",this.onBeforeunload),window.addEventListener("visibilitychange",this.onVisibilityChange),window.addEventListener("pagehide",this.onPageHide),c.b.on(c.a,this.onPageNetworkChange),window.addEventListener("blur",this.onBlur),["focus","mousemove","click","touchStart","compositionend"].forEach((function(t){window.addEventListener(t,e.onActive)})),this.startIdle()}},{key:"unbindEvents",value:function(){var e=this;window.removeEventListener("beforeunload",this.onBeforeunload),window.removeEventListener("visibilitychange",this.onVisibilityChange),window.removeEventListener("pagehide",this.onPageHide),c.b.off(c.a,this.onPageNetworkChange),window.removeEventListener("blur",this.onBlur),["focus","mousemove","click","touchStart","compositionend"].forEach((function(t){window.removeEventListener(t,e.onActive)})),this.closeChecker=[]}},{key:"setIdle",value:function(e){isNaN(e)||(this.IDLE_INTERVAL=e)}},{key:"startIdle",value:function(){var e=this;this.clearIdle(),this._idleTimer=setTimeout((function(){e.transmitStatus(v.INACTIVE)}),1e3*this.IDLE_INTERVAL)}},{key:"clearIdle",value:function(){this._idleTimer&&clearTimeout(this._idleTimer)}}])&&l(t.prototype,r),n&&l(t,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(i.a);t.b=g},3684:function(e,t,r){"use strict";var n=r(78),o=r.n(n),a=r(64),i=r.n(a),c=r(65),u=r.n(c),l=r(3301),s=r(1321),f=r(3605);function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function p(){p=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof b?t:b,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:A(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var h="suspendedStart",m="suspendedYield",y="executing",v="completed",g={};function b(){}function w(){}function _(){}var E={};l(E,i,(function(){return this}));var O=Object.getPrototypeOf,S=O&&O(O(N([])));S&&S!==r&&n.call(S,i)&&(E=S);var k=_.prototype=b.prototype=Object.create(E);function x(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==d(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=h;return function(a,i){if(o===y)throw new Error("Generator is already running");if(o===v){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?v:m,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=v,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(d(t)+" is not iterable")}return w.prototype=_,o(k,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(j.prototype),l(j.prototype,c,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(k),l(k,u,"Generator"),l(k,i,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function h(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function m(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){h(a,n,o,i,c,"next",e)}function c(e){h(a,n,o,i,c,"throw",e)}i(void 0)}))}}function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){E(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function g(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,O(n.key),n)}}function b(e,t){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},b(e,t)}function w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=_(e);if(t){var o=_(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===d(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function _(e){return _=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_(e)}function E(e,t,r){return(t=O(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function O(e){var t=function(e,t){if("object"!==d(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==d(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===d(t)?t:String(t)}var S=i()("common:biz:doc.editor.base"),k="empty",x="actived",j="out",A=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&b(e,t)}(u,e);var t,r,n,a,i,c=w(u);function u(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),t=t||{},(r=c.call(this)).doc=e,r.docDomain=t.docDomain||l.DOC_DOMAIN.DOC,r.baseVersion=e.draft_version,r.storage={},r.cacheKeys=r._getCacheKeys(),r.cacheStatus=k,r}return t=u,r=[{key:"hasNewVersion",value:function(e){return S("check new version",{base:this.baseVersion,lock:e}),this.baseVersion<e.draft_version}},{key:"isContentChanged",value:function(e){e=e.trim();var t="<cursor />";return f.a.adaptBodyToContent(this.doc).replace(t,"")!==e.replace(t,"")}},{key:"resetDoc",value:function(e){S("onSaved, version:",this.baseVersion),this.doc=v(v({},this.doc),e),this.baseVersion=e.draft_version,this.cacheKeys=this._getCacheKeys()}},{key:"getInitialDocument",value:function(){return this.getLatestDocument()}},{key:"getLatestDocument",value:function(){var e=f.a.adaptDocToDocument(this.doc),t=this._getCachedDocument();if(!t)return S("not found cached content, user server version"),this.transmitCacheStatus(k),e;var r=!this._needUseCache(t,e);return this.transmitCacheStatus(r?j:x),r?e:t}},{key:"transmitCacheStatus",value:function(e){this.cacheStatus!==e&&(this.cacheStatus=e)}},{key:"isCacheActived",get:function(){return this.cacheStatus===x}},{key:"extractSummaryRaw",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.summary,n=t.maxHtmlTextLength,a=e.match(/^\s*<([^>]+)>/),i=["LI","CARD"],c="",u=!r||r===e;a&&(a[1].startsWith("!")||a[1].startsWith("meta"));){var s=a[0].length;c+=a[0],a=(e=e.substr(s)).match(/^\s*<([^>]+)>/)}var f=(new DOMParser).parseFromString(e,"text/html"),d=f.body.childNodes.length>l.BIG_DOCUMENT_BLOCK_COUNT;this.isBigDocument=d;var p=!!f.body.querySelector('card[name="image"]'),h=!!f.body.querySelector('card[name="checkbox"]'),m=!!f.body.querySelector('card[name="bookmarklink"]'),y=!!f.body.querySelector('card[name="file"],card[name="localdoc"]'),v=u?f:(new DOMParser).parseFromString(r,"text/html"),g=v.body,b=l.SUMMARY_PARAGRAPH_MAX_COUNT,w=c;n&&(n-=c.length);for(var _=0,E=!1,O="<p>---".concat(__("首段内容太长，无法截取摘要"),"---</p>"),S=g.childNodes[b];S;){var k=S.nextSibling;S.remove(),S=k}g.querySelectorAll("*").forEach((function(e){if("CARD"===e.nodeName){var t=e.getAttribute("name");if("bookmarklink"===t){var r=e.getAttribute("value");if(r)try{var n=JSON.parse(decodeURIComponent(r.slice(5))),a=o()(n,"detail.icon")||"",c=o()(n,"detail.image")||"";a.startsWith("data:")&&(n.detail.icon=""),c.startsWith("data:")&&(n.detail.image=""),e.setAttribute("value","data:".concat(encodeURIComponent(JSON.stringify(n))))}catch(t){e.remove()}}if("image"===t){var u=e.getAttribute("value");if(u)try{var l=JSON.parse(decodeURIComponent(u.slice(5)));delete l.ocrLocations,delete l.search,e.setAttribute("value","data:".concat(encodeURIComponent(JSON.stringify(l))))}catch(t){e.remove()}}if("board"===t){var s=e.getAttribute("value");if(s)try{var f=JSON.parse(decodeURIComponent(s.slice(5)));if(f.src){var d={src:f.src};e.setAttribute("name","image"),e.setAttribute("type","inline"),e.setAttribute("value","data:".concat(encodeURIComponent(JSON.stringify(d))));var h=v.createElement("p");e.parentNode.replaceChild(h,e),h.appendChild(e),p=!0}}catch(t){e.remove()}}}i.includes(e.nodeName)||(e.removeAttribute("id"),e.removeAttribute("data-lake-id"))}));for(var x=0;x<g.childNodes.length;x++){var j=g.childNodes[x];if(w.length+j.outerHTML.length>n){if(0===x){var A=j;for("TABLE"===j.nodeName&&(A=j.querySelector("tbody"));A.lastChild&&w.length+j.outerHTML.length>n;)if(A.lastChild!==A.firstChild)A.lastChild.remove();else if(A.firstChild.nodeType===Node.ELEMENT_NODE)A=A.firstChild;else{var L=w.length+j.outerHTML.length-n;A.firstChild.data="".concat(A.firstChild.data.substr(0,Math.max(0,A.firstChild.data.length-L-3)),"...")}A.lastChild?(_++,w+=j.outerHTML):w+=O}E=!0;break}_++,w+=j.outerHTML}return{extractCount:_,html:w,isFull:!E&&_===f.body.childNodes.length&&u,isBigDocument:d,hasImage:p,hasTodo:h,hasBookmark:m,hasAttachment:y}}},{key:"extractSummary",value:function(){var e=this.getLatestDocument(),t=e.value;if(e.format!==s.FORMAT.LAKE)return t;var r=this.extractSummaryRaw(t);return r&&r.html}},{key:"_needUseCache",value:function(e,t){return e.draft_version===t.draft_version||e.base_timestamp===t.base_timestamp}},{key:"saveToCache",value:function(e){if(!e.format)return S("save to cache, format not supplied: ignore"),!1;var t=this.doc.content_updated_at;e.draft_version||(e.draft_version=this.doc.draft_version),S("save to cache:",{doc_draft_version:this.doc.draft_version,change_draft_version:e.draft_version});var r=f.a.adaptChangeToCacheData(e,t),n=this.storage.set(this.cacheKeys.changes,r);return n&&this.transmitCacheStatus(x),n}},{key:"saveOutdatedCacheToServer",value:(i=m(p().mark((function e(t){var r,n,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(r=f.a.adapterDocumentContent(t),u.CACHE_CONTENT_SAVED[this.doc.id]!==r){e.next=5;break}return e.abrupt("return");case 5:return u.CACHE_CONTENT_SAVED[this.doc.id]=r,n={doc_id:this.doc.id,format:t.format,content:r,base_timestamp:t.base_timestamp,draft_version:t.draft_version,origin:l.DOC_VERSION.ORIGIN.cache,doc_type:this.docDomain},e.prev=7,e.next=10,this.doSaveOutdatedDocVersion(n);case 10:e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(7),e.abrupt("return");case 15:o=!this.isContentChanged(r),this.cacheStatus===j&&(this.clearCachedContent(),o||this.emit("outDatedCacheSavedToServer"));case 17:case"end":return e.stop()}}),e,this,[[7,12]])}))),function(e){return i.apply(this,arguments)})},{key:"doSaveOutdatedDocVersion",value:(a=m(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return a.apply(this,arguments)})},{key:"clearCachedContent",value:function(){S("clear cache"),this.storage.remove(this.cacheKeys.changes),this.transmitCacheStatus(k)}},{key:"_getCacheKeys",value:function(){var e="autosave/docs/".concat(this.doc.id),t={changes:"".concat(e,"/changes"),corrupted:"".concat(e,"/corrupted"),outdated:"".concat(e,"/outdated")};return this.doc.format===s.FORMAT.LAKE&&(t.changes="autosave/docs/".concat(this.doc.id,"/lake")),t}},{key:"_getCachedDocument",value:function(){var e=this.cacheKeys.changes,t=this.storage.get(e);try{var r=f.a.adaptCacheDataToDocument(t,this.doc.format);if(r&&r.value)return r}catch(e){this.clearCachedContent(),S("invalid cached data: ")}return null}},{key:"getDocument",value:function(){return f.a.adaptDocToDocument(this.doc)}},{key:"saveCacheToServer",value:function(){try{var e=this._getCachedDocument();if(!e)return;this.saveOutdatedCacheToServer(e)}catch(e){}}}],n=[{key:"isDefaultTitle",value:function(e){return!e||e.startsWith("无标题")||e.startsWith("Untitled")}}],r&&g(t.prototype,r),n&&g(t,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(u.a);E(A,"SAVE_TYPE",l.SAVE_TYPE),E(A,"MODE",{NORMAL:"normal",OT:"ot"}),E(A,"CACHE_CONTENT_SAVED",{}),t.a=A},3685:function(e,t,r){"use strict";r(37);var n=r(10),o=r(65),a=r.n(o),i=r(64),c=r.n(i),u=r(3301),l=r(93),s=r(282),f=r(1321),d=r(429),p=r.n(d);r(3356);function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,a=void 0,a=function(e,t){if("object"!==h(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==h(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===h(a)?a:String(a)),n)}var o,a}var y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.timing={Init:(new Date).getTime(),EditorLoaded:-1,DocLoadStart:-1,DocLoadEnd:-1,DocRendered:-1,LockReady:-1,CollabReady:-1},this.context=t,this.scene=t.scene,this.MaxRenderTime=5e3,this.maxTimeLimit=6e4,this.autoReportTime=12e4,this._records=[],this.maxRecordCount=1e3,this.minRecordCount=150,this.heartbeatInterval=2e3,this.minBlockTime=300,this.perfReported=!1,this.smoothReported=!1,this.limitSlowActionTime=1e3,this.lastReportAction={},this.reportInterval=3e4,this.startAutoReport()}var t,r,n;return t=e,r=[{key:"getDocFormat",value:function(){return this.context.docFormat}},{key:"getEditorMode",value:function(){return this.context.defaultMode}},{key:"getEditorScene",value:function(){return this.context.scene}},{key:"marks",value:function(e){this.timing[e]=(new Date).getTime()}},{key:"has",value:function(e){return-1!==this.timing[e]}},{key:"startAutoReport",value:function(){var e=this;this.reportTimer=setTimeout((function(){e.reportPerf()}),this.autoReportTime)}},{key:"stopAutoReport",value:function(){this.reportTimer&&(clearTimeout(this.reportTimer),this.reportTimer=null)}},{key:"destroy",value:function(){try{this.reportPerf(),this.reportSmooth(),this.stopAutoReport(),this.clearHeartbeat()}catch(e){}}},{key:"stats",value:function(){var e={m1:this.measure("Init","EditorLoaded"),m2:this.measure("DocLoadStart","DocLoadEnd"),m3:this.measure("Init","DocRendered")};return this.has("CollabReady")?(e.m4=this.measure("Init","CollabReady"),e.d1="collab"):(e.m4=this.measure("Init","DocRendered"),e.d1="lock"),e.d2=this.getEditorScene(),e}},{key:"editReady",value:function(){return this.has("EditorLoaded")&&this.has("DocRendered")}},{key:"reportPerf",value:function(){if(!this.perfReported&&(this.perfReported=!0,this.editReady())){var e=this.stats(),t=this.getDocFormat();this.context.isBigLakeDocument&&l.a.logBigLakeEditorPerf(e),l.a.logEditorPerf(t,e),e.m3>this.MaxRenderTime&&l.a.logEditWorkflow({code:"RENDER_SLOW",message:"渲染耗时 <".concat(Math.ceil(e.m3/1e4),"0 秒"),editMode:this.getEditorMode(),scene:this.getEditorScene()})}}},{key:"reset",value:function(){for(var e in this.timing)this.timing[e]=-1}},{key:"measure",value:function(e,t){return this.timing[e]&&this.timing[t]?-1===this.timing[e]||-1===this.timing[t]?0:Math.max(0,Math.min(this.maxTimeLimit,this.timing[t]-this.timing[e])):0}},{key:"startHeartbeat",value:function(){var e=this;this.smoothReported||(this.clearHeartbeat(),this.pingTime=+new Date,this.heartbeat=setTimeout((function(){e.pong()}),this.heartbeatInterval))}},{key:"clearHeartbeat",value:function(){this.heartbeat&&clearTimeout(this.heartbeat)}},{key:"pong",value:function(){if(!this.inActive){var e=new Date-this.pingTime-this.heartbeatInterval;e<this.minBlockTime?this._records.push(0):this._records.push(Math.ceil(e/1e3))}this._records.length>this.maxRecordCount?this.reportSmooth():this.startHeartbeat()}},{key:"pause",value:function(){this.inActive=!0}},{key:"resume",value:function(){this.inActive=!1}},{key:"reportSmooth",value:function(){if(!this.smoothReported){var e=this._records.length;if(!(e<this.minRecordCount)){var t=0;this._records.forEach((function(e){e&&t++}));var r=Math.round(100*(e-t)/e),n=this.getDocFormat();l.a.logEditorSmooth(n,{d1:this.getEditorMode(),d2:this.getEditorScene(),m1:r,m2:2*e,c2:this._records.join("_"),msg:"顺滑等级: ".concat(Math.floor(r/10))}),this._records=[],this.smoothReported=!0}}}},{key:"logSlowAction",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!(r<this.limitSlowActionTime)){var n=+new Date;if(!(this.lastReportAction[t]&&this.lastReportAction[t]+this.reportInterval>n)){this.lastReportAction[t]=n;var o={action:t,useTime:r,scene:this.getEditorScene()};switch(e){case"sheet":l.a.logSheetSlowAction(o);break;case"lakex":l.a.logLakexSlowAction(o);break;case"board":l.a.logBoardSlowAction(o);break;case"table":l.a.logTableSlowAction(o)}}}}}],r&&m(t.prototype,r),n&&m(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),v=y,g=r(12),b=r.n(g),w=r(201);function _(e){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(e)}function E(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,A(n.key),n)}}function O(e,t){return O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},O(e,t)}function S(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=x(e);if(t){var o=x(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===_(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return k(e)}(this,r)}}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function x(e){return x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},x(e)}function j(e,t,r){return(t=A(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function A(e){var t=function(e,t){if("object"!==_(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==_(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===_(t)?t:String(t)}var L,T=c()("editor:doc:lockManager"),C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&O(e,t)}(a,e);var t,r,n,o=S(a);function a(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),j(k(r=o.call(this)),"lazyLock",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;r.clearLockTimer(),e?r.lockTimer=setTimeout((function(){r.lock()}),1e3*e):r.lock()})),j(k(r),"unLock",(function(){var e,t,n;if(T("unLock"),r.clearLockTimer(),!r.locked)return Promise.resolve();var o=(null===(e=window.appData)||void 0===e?void 0:e.isYuqueMobileApp)&&(null===(t=window.AlipayJSBridge)||void 0===t||null===(n=t.startupParams)||void 0===n?void 0:n.appId);if("function"!=typeof navigator.sendBeacon||r.workflow.isDesktopApp||window.appData.isAlipayWebApp||o||r.workflow.note)return r.locked=!1,r.workflow.doUnlock({id:r.doc.id,uuid:r.uuid});var a=new URLSearchParams;return a.set("ctoken",Object(w.a)(window)),a.set("uuid",r.uuid),navigator.sendBeacon("/api/".concat(r.workflow.docDomain.toLowerCase(),"s/").concat(r.doc.id,"/unlock?").concat(a.toString())),r.locked=!1,Promise.resolve()})),j(k(r),"checkLakeEditConflict",(function(e){T("[check conflict]lock: %o",e);var t,n=k(r).me,o=e.locker,a=e.collab_members,i=void 0===a?[]:a;return i.length>0&&(T("[check conflict]doc is editing in ot mode"),t=1===i.length&&i[0].id===n.id?u.ERROR_CODE.LOCKED_BY_SELF_COLLAB:u.ERROR_CODE.LOCKED_BY_COLLAB),!t&&o&&o.id!==n.id&&(T("[check conflict]doc is locked by other one"),t=u.ERROR_CODE.LOCKED_BY_OTHER),!t&&e.draft_version>r.doc.draft_version&&(T("[check conflict]doc content has new version"),t=u.ERROR_CODE.LOCKED_BY_VERSIONCONFLICT),!t&&e.content_updated_at&&b()(e.content_updated_at).isAfter(r.doc.content_updated_at)&&(T("[check conflict]doc content has new version"),t=u.ERROR_CODE.LOCKED_BY_VERSIONCONFLICT),T("[check conflict]result",{code:t,lock:e}),t})),r.doc=e,r.workflow=t,r.me=t.me,r.lockTimer=null,r.LOCK_INTERVAL=59,r.MAX_RETRY_COUNT=10,r.locking=!1,r.locked=!1,r.retryCount=0,r.uuid=p()(10),r}return t=a,(r=[{key:"start",value:function(){T("lock start"),this.lockTimer||this.lazyLock()}},{key:"resume",value:function(){this.lazyLock(1)}},{key:"resetDoc",value:function(e){this.doc=e}},{key:"lock",value:function(){var e,t=this;T("lock doc, is locking: ",this.locking);var r=null===(e=this.doc)||void 0===e?void 0:e.id;if(!this.locking&&r){this.locking=!0;var n=this.uuid;return this.emit("lock_start"),this.workflow.doLock({id:r,uuid:n}).then((function(e){if(t.locking=!1,!t.doc||t.doc.id!==r)return t.workflow.doUnlock({id:r,uuid:n});t.locked=!e.code;var o=t.checkLakeEditConflict(e);o?(t.emit("error",{code:o,lock:e}),t.locked&&t.workflow.doUnlock({id:r,uuid:n})):t.locked&&(t.lazyLock(t.LOCK_INTERVAL),t.emit("ready"),t.retryCount=0)})).catch((function(e){t.locking=!1,t.doc&&r===t.doc.id&&(t.locked=!1,t.emit("error",{code:u.ERROR_CODE.LOCK_FAILED,message:e.message,stack:e.stack}),t.retryCount++,t.retryCount<t.MAX_RETRY_COUNT&&t.lazyLock(t.retryCount*t.LOCK_INTERVAL))}))}}},{key:"clearLockTimer",value:function(){this.lockTimer&&(T("stop polling"),clearTimeout(this.lockTimer),this.lockTimer=null)}},{key:"destroy",value:function(){this.unLock(),this.locking=!1,this.workflow=null,delete this.doc}}])&&E(t.prototype,r),n&&E(t,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(a.a),P=C;function N(e){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N(e)}function R(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==N(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==N(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===N(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var I=(R(L={},u.EDITOR_NAME.LAKEX,{bgColor:"ca19007.da16020",label:"ca19007.da16062",headingCollapsed:"ca19007.da16050",tableSpacing:"ca19007.da16043",tableBorderVisible:"ca19007.da16042",tableVerticalAlign:"ca19007.da16033",tableEquallyColumn:"ca19007.da16045",tableInsertAfterColumn:"ca19007.da16037",tableInsertAfterRow:"ca19007.da16035",tableToggleWidthMode:"ca19007.da16044",tableColumnWidth:"ca19007.da16032",tableColumnMoveTo:"ca19007.da16041",tableInsertBeforeColumn:"ca19007.da16036",tableInsertBeforeRow:"ca19007.da16034",tableDeleteColumn:"ca19007.da16038",tableDeleteRow:"ca19007.da16039",tableRowHeight:"ca19007.da16031",tableRowMoveTo:"ca19007.da16040",emoji:"ca19007.da16071",unicodeEmoji:"ca19007.da16071",table:"ca19007.da16027",insertFile:"ca19007.da9386",insertFiles:"ca19007.da9386",insertCard:"ca19007.da13586",insertLink:"ca19007.da16054",insertVideo:"ca19007.da15970",insertBookmark:"ca19007.da16079",image:"ca19007.da15966",insertImage:"ca19007.da15966",insertYuqueInlineDoc:"ca19007.da16075",insertDocument:"ca19007.da16081",tableUnmergeCell:"ca19007.da16029",undo:"ca19007.da9540",tableCellBgColor:"ca19007.da16030",alignment:"ca19007.da16049",translate:"ca19007.da16059",outdent:"ca19007.da16052",columnsAddColumn:"ca19007.da16086",columns:"ca19007.da16084",columnsToggleWidthMode:"ca19007.da16089",columnsWidths:"ca19007.da16085",copy:"ca19007.da16046",alert:"ca19007.da16064",paintFormat:"ca19007.da16057",tableMergeCell:"ca19007.da16028",hr:"ca19007.da16063",bold:"ca19007.da15971",cut:"ca19007.da16047",cardToLink:"ca19007.da16055",textContainerTrans:"ca19007.da9385",link:"ca19007.da16053",linkToYuqueInlineDoc:"ca19007.da16074",linkToYuqueDoc:"ca19007.da16073",linkToThirdparty:"ca19007.da16061",linkToBookmark:"ca19007.da16077",linkToBookmarkInline:"ca19007.da16078",defaultFontsize:"ca19007.da16023",cardBatchApply:"ca19007.da15965",clearBgColor:"ca19007.da16021",clearFormat:"ca19007.da16058",clearColor:"ca19007.da16019",taskList:"ca19007.da16026",containerToggle:"ca19007.da9384",deleteColumns:"ca19007.da16088",columnDelete:"ca19007.da16087",columnDeleteByIndex:"ca19007.da16087",deleteCard:"ca19007.da13690",deleteBrick:"ca19007.da9381",sup:"ca19007.da16067",paragraphSpacing:"ca19007.da13585",typography:"ca19007.da13582",layout:"ca19007.da9542",search:"ca19007.da16069",indent:"ca19007.da16051",mention:"ca19007.da16076",replaceText:"ca19007.da16070",dropFile:"ca19007.da9387",unorderedList:"ca19007.da16025",sub:"ca19007.da16066",addBelowBrick:"ca19007.da9383",underline:"ca19007.da16016",insertSlash:"ca19007.da16082",italic:"ca19007.da16015",lineHeight:"ca19007.da16056",code:"ca19007.da16068",moveCard:"ca19007.da13691",moveBrick:"ca19007.da9382",moveImage:"ca19007.da16060",quote:"ca19007.da16065",orderedList:"ca19007.da16024",paste:"ca19007.da16048",markdownPasteParse:"ca19007.da16080",collapse:"ca19007.da16083",strikethrough:"ca19007.da16017",redo:"ca19007.da9541",brickToCodeblock:"ca19007.da16072",fontsize:"ca19007.da16022",wordCount:"ca19007.da9539",color:"ca19007.da16018"}),R(L,u.EDITOR_NAME.SHEET,{setType:"ca33271.da12555",setDecimal:"ca33271.da12842",setStyle:"ca33271.da12843",insertCol:"ca33271.da12844",insertRow:"ca33271.da16148",mergeCell:"ca33271.da16149",splitCell:"ca33271.da16150",moveCol:"ca33271.da16151",moveRow:"ca33271.da16152",removeCol:"ca33271.da16153",removeRow:"ca33271.da16154",hideCol:"ca33271.da16155",hideRow:"ca33271.da16156",cancelHide:"ca33271.da16157",resizeCol:"ca33271.da16158",resizeRow:"ca33271.da16159",copy:"ca33271.da16160",paste:"ca33271.da16161",cut:"ca33271.da16162",clear:"ca33271.da16163",clearFormat:"ca33271.da16164",filter:"ca33271.da16165",sort:"ca33271.da16166",insert:"ca33271.da16167",replaceOne:"ca33271.da16168",replaceAll:"ca33271.da16169",autofill:"ca33271.da16170",insertRowAtBottom:"ca33271.da16171",frozen:"ca33271.da16172",insertSheet:"ca33271.da16173",removeSheet:"ca33271.da16174",cloneSheet:"ca33271.da16175",moveSheet:"ca33271.da16176",renameSheet:"ca33271.da16177",paint:"ca33271.da16178",setBorder:"ca33271.da16179",protect:"ca33271.da16180",resizeVessel:"ca33271.da16181",moveVessel:"ca33271.da16182",removeVessel:"ca33271.da16183",addChart:"ca33271.da16184",copyChart:"ca33271.da16185",updateChartConfig:"ca33271.da16186",activeSheet:"ca33271.da16187",adjustRowHeight:"ca33271.da16188",adjustColWidth:"ca33271.da16189",hideSheet:"ca33271.da16190",showSheet:"ca33271.da16191",setConditionalFormatting:"ca33271.da16192",sortConditionalFormatting:"ca33271.da16193",removeConditionalFormatting:"ca33271.da16194",clearConditionalFormatting:"ca33271.da16195",replaceSelections:"ca33271.da16196",exportSheet:"ca33271.da16197",addNote:"ca33271.da16198",removeNotes:"ca33271.da16199",highlightArea:"ca33271.da16200",tabColor:"ca33271.da16201",zoomSheet:"ca33271.da16202"}),R(L,u.EDITOR_NAME.BOARD,{ToBack:"ca33306.da16235",ToFront:"ca33306.da16236",Forward:"ca33306.da16237",Backward:"ca33306.da16238",Collapse:"ca33306.da16239",Expand:"ca33306.da16240",ZoomIn:"ca33306.da16241",ZoomOut:"ca33306.da16242",ZoomTo:"ca33306.da16243",ActualSize:"ca33306.da16244",FitViewport:"ca33306.da16245",Copy:"ca33306.da16246",Paste:"ca33306.da16247",CreateLink:"ca33306.da16248",BeginInsertLine:"ca33306.da16249",ButtonDragCanvas:"ca33306.da16250",SetTheme:"ca33306.da16251",SetCanvasBackgroundColor:"ca33306.da16252",Cut:"ca33306.da16253",MakeGroup:"ca33306.da16254",Ungroup:"ca33306.da16255",BeginInsertGeometry:"ca33306.da16256",BeginInsertText:"ca33306.da16257",BeginInsertImage:"ca33306.da16258",AlignBottom:"ca33306.da16259",AlignHCenter:"ca33306.da16260",AlignLeft:"ca33306.da16261",AlignRight:"ca33306.da16262",AlignTop:"ca33306.da16263",AlignVCenter:"ca33306.da16264",DistributeHorizontally:"ca33306.da16265",DistributeVertically:"ca33306.da16266",InsertText:"ca33306.da16257",InsertGeometry:"ca33306.da16256",InsertImage:"ca33306.da16258",AttachLink:"ca33306.da16248",LineSwapEndpoint:"ca33306.da16267",MindmapAppendChild:"ca33306.da16268",MindmapAppendSibling:"ca33306.da16269",MindmapMoveNode:"ca33306.da16270",MindmapAttachImage:"ca33306.da16271",MindmapBeginInsertStem:"ca33306.da16272",MindmapCreateLink:"ca33306.da16273",MindmapPrependSibling:"ca33306.da16269",MindmapInsertStem:"ca33306.da16272",MindmapInsertImage:"ca33306.da16271",MindmapAppendParent:"ca33306.da16274",MindmapRemoveSingleNode:"ca33306.da16275",MindmapAttachNote:"ca33306.da16276",MindmapAppendAbstract:"ca33306.da16277",ChangeLaneNumber:"ca33306.da16278",AddSwimlane:"ca33306.da16279",UpdateSwimlane:"ca33306.da16280"}),R(L,u.EDITOR_NAME.TABLE,{activeView:"ca33314.da16288",insertTable:"ca33314.da16289",insertRow:"ca33314.da16290",removeRows:"ca33314.da16291",insertForm:"ca33314.da16292",removeForm:"ca33314.da16293",enableForm:"ca33314.da16294",disableForm:"ca33314.da16295",updateForm:"ca33314.da16296",insertCol:"ca33314.da16297",moveCol:"ca33314.da16298",resizeCol:"ca33314.da16299",search:"ca33314.da16300",removeCol:"ca33314.da16301",updateCol:"ca33314.da16302",copy:"ca33314.da16303",paste:"ca33314.da16304",setFilter:"ca33314.da16305",setSort:"ca33314.da16306",setStats:"ca33314.da16307",setGroup:"ca33314.da16308",setGroupState:"ca33314.da16309",insertCard:"ca33314.da16310",insertGrid:"ca33314.da16311",updateRowHeight:"ca33314.da16312",updateViewName:"ca33314.da16313",copyView:"ca33314.da16314",removeView:"ca33314.da16315",insertKanban:"ca33314.da16316",setColumns:"ca33314.da16317",setCover:"ca33314.da16318",setShowField:"ca33314.da16319",copyRow:"ca33314.da16320",addGroupItem:"ca33314.da16321",removeGroupItem:"ca33314.da16322",updateGroupItem:"ca33314.da16323",moveGroupItem:"ca33314.da16324",moveRow:"ca33314.da16325"}),L),D=r(116);function M(e){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(e)}function F(e){return function(e){if(Array.isArray(e))return G(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return G(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return G(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function U(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,a=void 0,a=function(e,t){if("object"!==M(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==M(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===M(a)?a:String(a)),n)}var o,a}var B=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pageId=window.appData.traceId,this.actions=[],this.errorCode=null,this.context=t,this.userChanged=!1}var t,r,n;return t=e,(r=[{key:"getDate",value:function(){var e=new Date;return"".concat(e.getFullYear(),"-").concat(e.getMonth()+1,"-").concat(e.getDate())}},{key:"getTime",value:function(){var e=new Date;return"".concat(e.getHours(),":").concat(e.getMinutes(),":").concat(e.getSeconds())}},{key:"pushDate",value:function(){var e=this.getDate();e!==this.date&&(this.date&&this.report(),this.date=e,this.actions.push("[".concat(e,"]")))}},{key:"log",value:function(e,t){this.pushDate(),this.actions.push("".concat(this.getTime()," ").concat(e," ").concat(void 0===t?"":t))}},{key:"logUserChanged",value:function(){this.userChanged=!0}},{key:"logError",value:function(e,t,r){this.pushDate(),this.actions.push("".concat(this.getTime()," ").concat(e," ").concat(void 0===t?"":t)),null!=r&&r.stack&&this.actions.push(r.stack),this.errorCode=e}},{key:"getReportData",value:function(){return["".concat(this.context.scene,":").concat(this.context.defaultMode)].concat(F(this.actions)).join("~")}},{key:"reset",value:function(){this.actions=[],this.errorCode=null,this.date=null,this.userChanged=!1}},{key:"report",value:function(){if(0!==this.actions.length){var e={c2:this.getReportData(),d1:this.context.currentMode,d2:this.context.docFormat,d3:this.context.scene,d4:this.errorCode};l.a.logEditAction(e,this.errorCode,this.userChanged),this.reset()}}},{key:"logAction",value:function(e,t){I[e]&&I[e][t]&&Object(D.spmClick)(I[e][t])}},{key:"destroy",value:function(){(this.userChanged||this.errorCode)&&this.report()}}])&&U(t.prototype,r),n&&U(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),q=B,V=r(22);function z(e){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z(e)}function H(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function W(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?H(Object(r),!0).forEach((function(t){te(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Y(){Y=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==z(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(z(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function K(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function Q(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){K(a,n,o,i,c,"next",e)}function c(e){K(a,n,o,i,c,"throw",e)}i(void 0)}))}}function Z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,re(n.key),n)}}function J(e,t){return J=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},J(e,t)}function X(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=ee(e);if(t){var o=ee(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===z(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return $(e)}(this,r)}}function $(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ee(e){return ee=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ee(e)}function te(e,t,r){return(t=re(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function re(e){var t=function(e,t){if("object"!==z(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===z(t)?t:String(t)}var ne=c()("editor:doc:wf"),oe=window.appData,ae=oe.isAlipayWebApp,ie=oe.isYuqueMobileApp,ce=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&J(e,t)}(_,e);var t,r,o,a,i,c,d,h,m,y,g,b,w=X(_);function _(e){var t,r,n=e.doc,o=void 0===n?{}:n,a=e.mode,i=e.scene;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,_),te($(r=w.call(this)),"clear",Q(Y().mark((function e(){return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.doc.id){e.next=2;break}return e.abrupt("return",!0);case 2:if(r._clearAble()){e.next=4;break}return e.abrupt("return",!1);case 4:return r.clearing=!0,r.onBeforeReset(),r.clearError(),r._clearMessage(),r._clearLazyDisconnect(),r._clearLazyStartTimer(),r._clearCacheTimer(),e.next=13,r.save(u.SAVE_TYPE.AUTO);case 13:return r.transmitDocStatus(u.DOC_STATUS.loaded),r.editable=!1,r.docLoaded={},r.saving=!1,r.publishing=!1,r.docRendered=!1,r.initialDocument=null,r.saveId=null,r.lockManager&&(r.lockManager.destroy(),r.lockManager=null),r.collabManager=null,r.collabDisabled=!1,delete r.editorBiz,r.onReset(),r.clearing=!1,r.destroying=!1,r.freeCallback=null,e.abrupt("return",!0);case 30:case"end":return e.stop()}}),e)})))),te($(r),"onEditorLoaded",(function(e){var t=e.engine;r.engine=t,window.__engine=t.getOriginEngine(),window.__workflow=$(r),r._bindEvents(),r.performance.marks("EditorLoaded"),r.userAction.log("editor_ready"),Object(s.a)("editorLoaded")})),te($(r),"_bindEvents",(function(){var e,t;r.eventBinded||(r.doBindEvents(),r.engine.onCommandError((function(e){r.error(W({code:u.ERROR_CODE.COMMAND_ERROR},e))})),null===(e=(t=r.engine).onMonitorLog)||void 0===e||e.call(t,(function(e,t,r){l.a.editorMonitorLog(e,t,r)})),r.engine.onCommandEnd((function(e,t,n){r.performance.logSlowAction(e,t,n),r.userAction.logAction(e,t)})),r.eventBinded=!0)})),te($(r),"waitForFree",(function(e){r._clearAble()?(r.freeCallback=null,e()):(r.emit(u.WORKFLOW_EVENT.message,{type:u.MESSAGE.BUZY,data:{docStatus:r.docStatus}}),r.freeCallback=e)})),te($(r),"setDoc",(function(e){return!!r._clearAble()&&(r.docSetUid=p()(6),r._updateDoc(e),r._renderSummary(),!0)})),te($(r),"onPageInactive",(function(){r.userAction.log("page_inactive"),r.currentMode!==u.EDIT_MODE.COLLAB_CUSTOM&&(r.cache(),r.save(u.SAVE_TYPE.AUTO),r.currentMode===u.EDIT_MODE.LOCK&&r.lockManager&&r.lockManager.unLock(),r._lazyDisconnect())})),te($(r),"onPageLeave",(function(){r.userAction.log("page_leave"),r.currentMode!==u.EDIT_MODE.COLLAB_CUSTOM&&(r.cache(),r.save(u.SAVE_TYPE.AUTO),r.currentMode===u.EDIT_MODE.LOCK&&r.lockManager&&r.lockManager.unLock())})),te($(r),"onPageOnline",(function(){r.transmitNetStatus(u.NET_STATUS.online),r.currentMode===u.EDIT_MODE.COLLAB&&r.collabManager&&!r.collabManager.isAlive()&&(r._clearActiveTimer(),r._activeTimer=setTimeout((function(){r.cache(),r.start()}),1e3))})),te($(r),"onPageOffline",(function(){r.transmitNetStatus(u.NET_STATUS.offline)})),te($(r),"onPageActive",(function(){r.userAction.log("page_active"),r._clearLazyDisconnect(),ne("page _onPageActive",r.currentMode,r.docStatus),r.reChooseMode(),r.currentMode===u.EDIT_MODE.COLLAB?r.collabManager&&!r.collabManager.isAlive()&&r.start():r.currentMode===u.EDIT_MODE.LOCK&&r.startLockService()})),te($(r),"_lazyDisconnect",(function(){r._clearLazyDisconnect(),r.disconnectTimer=setTimeout((function(){r.currentMode===u.EDIT_MODE.COLLAB&&r.collabManager&&r.collabManager.isAlive()&&(r.collabManager.disconnect(),r.userAction.log("collab_lazy_disconnect"),r.setEditable(!1))}),r.lazyDisconnectInterval)})),te($(r),"_clearLazyDisconnect",(function(){r.disconnectTimer&&clearTimeout(r.disconnectTimer)})),te($(r),"start",function(){var e=Q(Y().mark((function e(t){var n,o,a;return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.userAction.log("start"),r._checkStartAble()){e.next=4;break}return r.lazyStart(),e.abrupt("return");case 4:return r._beforeStart(),r.setEditable(!1),r.performance.marks("DocLoadStart"),e.next=9,r.loadDoc(t);case 9:if((a=e.sent)&&r.doc&&a.id===r.doc.id){e.next=12;break}return e.abrupt("return");case 12:return r.performance.marks("DocLoadEnd"),r._updateDoc(a),r.editorBiz.isCacheActived?(r.useCache=!0,r.userAction.log("useCache_to_edit")):r.useCache=!1,r.editorBiz.saveCacheToServer(),!t&&null!==(n=r.doc.readerEditModeData)&&void 0!==n&&null!==(o=n.matchCondition)&&void 0!==o&&o.editType.includes("Collab")&&r.currentMode===u.EDIT_MODE.LOCK&&(r.defaultMode=u.EDIT_MODE.COLLAB,r.transmitMode(u.EDIT_MODE.COLLAB)),r.currentMode===u.EDIT_MODE.COLLAB&&r.startCollabService(),e.next=20,r.initEditor(a);case 20:r.currentMode!==u.EDIT_MODE.LOCK&&r.currentMode!==u.EDIT_MODE.COLLAB_CUSTOM||r.setEditable(!0),r.performance.marks("DocRendered"),Object(s.a)("docRendered"),r.currentMode===u.EDIT_MODE.LOCK&&(r.startLockService(),r.performance.reportPerf()),r.onStarted();case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),te($(r),"setContent",(function(e){for(var t,n=arguments.length,o=new Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];(t=r.engine).setContent.apply(t,[e].concat(o))})),te($(r),"isReady",(function(){return!!r.engine})),te($(r),"onMiniEditorExpandChange",(function(e){r.emit(u.WORKFLOW_EVENT.miniExpand,e)})),te($(r),"onSaveTitle",(function(e){r.doc.title=e,r.emit(u.WORKFLOW_EVENT.saveTitle,e),window.dispatchEvent(new CustomEvent("WORKFLOW_EVENT.saveTitle",{detail:e}))})),te($(r),"onContentChange",(function(e){if(!r.ignoreChange())return r._lazyCache(),r._setStopWatch("autosaveConflict",10),r.transmitDocStatus(u.DOC_STATUS.changed),r.emit(u.WORKFLOW_EVENT.change,e),r.currentMode===u.EDIT_MODE.LOCK&&r.startLockService(),delete r.cached,r.userAction.logUserChanged(),!0})),te($(r),"_getInitEditorOption",(function(e){var t={};return e&&e.doc_dynamic_data&&(t.dynamicData=e.doc_dynamic_data),t})),te($(r),"initEditor",function(){var e=Q(Y().mark((function e(t){var n;return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ne("document loaded, use document",r.initialDocument),n=r.initialDocument.value,r.currentMode===u.EDIT_MODE.COLLAB_CUSTOM&&(n=t.content),r.engine.getPureContent()===n&&!r.isDynamicDataChanged){e.next=15;break}return e.prev=5,e.next=8,r.engine.init({content:n},r._getInitEditorOption(r.doc));case 8:r.userAction.log("editor_render","".concat(null==t?void 0:t.id,":").concat(r.initialDocument.draft_version)),e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(5),r.error({code:u.ERROR_CODE.RENDER_FAILED,error:e.t0,detail:{commandName:"init",content:n}}),e.abrupt("return");case 15:r.docRendered=!0,r.engine.readonly(!1),r.onDocRendered();case 18:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(t){return e.apply(this,arguments)}}()),te($(r),"save",function(){var e=Q(Y().mark((function e(t){var n,o,a,i,c,l;return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.userAction.log("save","".concat(t," ").concat(null===(n=r.doc)||void 0===n?void 0:n.id)),o=$(r),a=o.editable,ne("on save, context: ",{editable:a,type:t}),i=r.checkSaveStatus(t),e.t0=i,e.next=e.t0===u.SAVE_STATUS.IGNORE?7:e.t0===u.SAVE_STATUS.DISABLED?9:(e.t0,u.SAVE_STATUS.OK,12);break;case 7:return r.userAction.log("ignore_save",r.docStatus),e.abrupt("return");case 9:return r.userAction.log("unable_save"),r.throwWhenPublish(t),e.abrupt("return");case 12:return r.cache(),r.transmitDocStatus(u.DOC_STATUS.saving),r.saving=!0,r.saveId=p()(6),e.prev=16,e.next=19,r.engine.onBeforeSave();case 19:ne("save:before done, do save to server"),e.next=28;break;case 22:e.prev=22,e.t1=e.catch(16),r.saving=!1,ne("save:before has exception: ",e.t1),r.throwWhenPublish(t,new Error(__("内容存在未完成的上传或其他异常，请检查后重试"))),r.userAction.logError(u.ERROR_CODE.SAVE_BEFORE_FAILED,null===e.t1||void 0===e.t1?void 0:e.t1.message,e.t1);case 28:return e.prev=28,e.next=31,r.doSaveDoc(t,r.saveId);case 31:if(l=e.sent,r.saving=!1,l&&l.id===(null===(c=r.doc)||void 0===c?void 0:c.id)){e.next=35;break}throw new Error("document unExist");case 35:return r.saveSuccess(t,l),e.abrupt("return",l);case 39:e.prev=39,e.t2=e.catch(28),r.saving=!1,r.throwWhenPublish(t,e.t2),r.saveFailed(t,e.t2);case 44:case"end":return e.stop()}}),e,null,[[16,22],[28,39]])})));return function(t){return e.apply(this,arguments)}}()),te($(r),"publish",function(){var e=Q(Y().mark((function e(t){var n,o,a,i,c,l;return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.userAction.log("publish"),ne("publish:",t),!r._checkBuzy()){e.next=4;break}throw new Error("buzy");case 4:return e.prev=4,r.publishing=!0,e.next=8,r.save(u.SAVE_TYPE.USER_PUBLISH);case 8:return n=e.sent,r.transmitDocStatus(u.DOC_STATUS.publishing),e.next=12,r.doPublishDoc(t);case 12:r.publishing=!1,e.next=20;break;case 15:throw e.prev=15,e.t0=e.catch(4),r.publishing=!1,r.publishFailed(e.t0),e.t0;case 20:return e.next=22,r.publishSuccess(n||r.doc);case 22:if(!r.destroying){e.next=24;break}throw new Error("destroying");case 24:return o=$(r),a=o.doc,i={},"Table"===a.type&&t.type===u.SAVE_TYPE.USER_PUBLISH&&(i.fullBody=!0),c=r.engine.getEditorContent(i),l=c.content,e.abrupt("return",l);case 29:case"end":return e.stop()}}),e,null,[[4,15]])})));return function(t){return e.apply(this,arguments)}}()),te($(r),"saveDocTheme",function(){var e=Q(Y().mark((function e(t){return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.saveEditorMeta({isDraft:!0,themeMetas:[t]});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),te($(r),"inferNotify",(function(){try{if(r.doc.format!==f.FORMAT.LAKE)return!1;var e=r.doc.word_count,t=r.getWordCount();return ne("infer_notify","".concat(e,":").concat(t)),t-e>300}catch(e){return!1}})),te($(r),"getWordCount",(function(e){return r.engine.getWordCount(e)})),te($(r),"getSummary",(function(e){r.engine.getSummary(e)})),te($(r),"isVersionConflict",(function(e){return r.editorBiz.hasNewVersion(e)})),te($(r),"isEmptyDoc",(function(){return!!r.isDefaultTitle(r.doc.title)&&r.engine.isEmpty()})),te($(r),"isDocContentEmpty",(function(){return r.engine.isEmpty()})),te($(r),"isOnlyOneEditSession",(function(){return r.currentMode===u.EDIT_MODE.LOCK||r.collabManager&&r.collabManager.isOnlyOneCollabSession()})),te($(r),"revert",(function(e){r.userAction.log("revert_doc"),ne("[onRevert]version:",e),r.editorBiz.saveCacheToServer(),r.engine.setContent(e.content),r.transmitDocStatus(u.DOC_STATUS.changed),r.currentMode===u.EDIT_MODE.LOCK&&r.startLockService()})),te($(r),"reset",(function(e){r.engine.reset(e)})),te($(r),"doSaveDoc",function(){var e=Q(Y().mark((function e(t){return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),te($(r),"doIgnoreSave",(function(){return!1})),te($(r),"dontIgnoreSave",(function(){return!1})),te($(r),"doPublishDoc",function(){var e=Q(Y().mark((function e(t){return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),r.doc=W({},o),r.scene=i||u.EDIT_SCENE.WEB,r.defaultMode=a||u.EDIT_MODE.LOCK,r.engine=null,r.editorBiz=null,r.lockManager=null,r.collabManager=null,r.editable=!1,r.docLoaded={},r.saving=!1,r.useCache=!1,r.initialDocument=null,r.performance=new v($(r)),r.userAction=new q($(r)),r._stopWatch={},r.lazyCacheInterval=ae||ie?1e3:5e3,r.lazyDisconnectInterval=12e5,r.bigDocumentWordCount=1e4,r.isDynamicDataChanged=!1,r.collabConnected=!1,r.netStatus=null!==(t=navigator)&&void 0!==t&&t.onLine?u.NET_STATUS.online:u.NET_STATUS.offline,r.currentMode=r.defaultMode,r.destroyCount=0,r.maxDestroyCount=20,r}return t=_,r=[{key:"setTargetDocId",value:function(e){this.targetDocId=e}},{key:"isSwitchingDoc",get:function(){return!(!this.doc||!this.targetDocId||this.doc.id===this.targetDocId)}},{key:"docFormat",get:function(){var e;return this.doc&&this.doc.format&&(e=this.doc.format),"lake"===e&&this.engine&&this.engine.lakex&&(e="lakex"),e}},{key:"isBigLakeDocument",get:function(){return this.doc&&"lake"===this.doc.format&&this.doc.word_count>this.bigDocumentWordCount}},{key:"_checkFreeCallback",value:function(){this.freeCallback&&this._clearAble()&&(this.freeCallback(),this.freeCallback=null)}},{key:"_checkBuzy",value:function(){return!!this._isBuzy()&&(this.emit(u.WORKFLOW_EVENT.message,{type:u.MESSAGE.BUZY,data:{docStatus:this.docStatus}}),!0)}},{key:"_renderSummary",value:function(){try{this.setContent(this.editorBiz.extractSummary(),this._getInitEditorOption(this.doc)),this.engine.readonly(!0),this.editorBiz.isBigDocument&&this.emit(u.WORKFLOW_EVENT.message,{type:u.MESSAGE.RENDER_BIG_DOCUMENT})}catch(e){}}},{key:"_clearActiveTimer",value:function(){this._activeTimer&&clearTimeout(this._activeTimer)}},{key:"reChooseMode",value:function(){this.defaultMode!==u.EDIT_MODE.COLLAB_CUSTOM&&this.defaultMode!==u.EDIT_MODE.LOCK?(this.currentMode===u.EDIT_MODE.LOCK&&this.defaultMode===u.EDIT_MODE.COLLAB&&this.lockManager&&this.lockManager.unLock(),this.transmitMode(u.EDIT_MODE.COLLAB)):this.transmitMode(this.defaultMode)}},{key:"_checkStartAble",value:function(){return!this._isBuzy()&&!!this.engine&&this.startAble()}},{key:"_isBuzy",value:function(){return!!([u.DOC_STATUS.saving,u.DOC_STATUS.publishing,u.DOC_STATUS.loading].includes(this.docStatus)||this.clearing||this.publishing||this.saving)}},{key:"_clearAble",value:function(){return!([u.DOC_STATUS.saving,u.DOC_STATUS.publishing].includes(this.docStatus)||this.clearing||this.publishing||this.saving)}},{key:"_beforeStart",value:function(){this.clearError(),this._clearLazyStartTimer(),this._clearLazyDisconnect()}},{key:"lazyStart",value:function(){var e=this;this._clearLazyStartTimer(),this.lazyStartTimer=setTimeout((function(){e.start()}),1e3)}},{key:"_clearLazyStartTimer",value:function(){this.lazyStartTimer&&clearTimeout(this.lazyStartTimer)}},{key:"_setStopWatch",value:function(e,t){var r=+new Date;this._stopWatch[e]={start:r,end:r+1e3*t}}},{key:"_inStopWatch",value:function(e){if(!this._stopWatch[e])return!1;var t=+new Date;return t>=this._stopWatch[e].start&&t<=this._stopWatch[e].end}},{key:"clearError",value:function(){this.emit(u.WORKFLOW_EVENT.error,null)}},{key:"_clearMessage",value:function(){this.emit(u.WORKFLOW_EVENT.message,{type:u.MESSAGE.CLEAR})}},{key:"loadDoc",value:(b=Q(Y().mark((function e(t){var r,n,o;return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ne("start loading document"),r=this.doc,this.userAction.log("load_doc",r.id),this.needLoad()){e.next=5;break}return e.abrupt("return");case 5:if(this.transmitDocStatus(u.DOC_STATUS.loading),n=this.docSetUid,e.prev=7,e.t0=t,e.t0){e.next=13;break}return e.next=12,this.doLoadDoc();case 12:e.t0=e.sent;case 13:if(o=e.t0,!(n&&n!==this.docSetUid||this.isSwitchingDoc)){e.next=16;break}return e.abrupt("return");case 16:return this.transmitDocStatus(u.DOC_STATUS.loaded),this.docLoaded[r.id]=!0,e.abrupt("return",o);case 21:if(e.prev=21,e.t1=e.catch(7),!(n&&n!==this.docSetUid||this.isSwitchingDoc)){e.next=25;break}return e.abrupt("return");case 25:this.transmitDocStatus(u.DOC_STATUS.loaded),this.docLoaded[r.id]&&this._isNetWorkError(null===e.t1||void 0===e.t1?void 0:e.t1.message)?this.emit(u.WORKFLOW_EVENT.message,{type:u.MESSAGE.DISCONNECT}):this.error({code:u.ERROR_CODE.INIT_FAILED,type:null===e.t1||void 0===e.t1?void 0:e.t1.type,status:null===e.t1||void 0===e.t1?void 0:e.t1.status,message:null===e.t1||void 0===e.t1?void 0:e.t1.message,stack:null===e.t1||void 0===e.t1?void 0:e.t1.stack});case 27:case"end":return e.stop()}}),e,this,[[7,21]])}))),function(e){return b.apply(this,arguments)})},{key:"updateEditorBiz",value:function(e){var t=this;this.editorBiz&&this.editorBiz.doc.id===e.id?(this.onBeforeUpdateEditorBiz(e),this.editorBiz.resetDoc(e)):(this.editorBiz=this.createEditorBiz(e),this.editorBiz.on("outDatedCacheSavedToServer",(function(){t.emit(u.WORKFLOW_EVENT.message,{type:u.MESSAGE.DOC_CACHE_SAVED}),t.userAction.log("outDatedCacheSavedToServer")})))}},{key:"createLockManager",value:function(){var e=this;this.lockManager||(this.userAction.log("create_lock"),this.lockManager=new P(this.doc,this),this.lockManager.on("ready",(function(){e.userAction.log("lock_ready"),e.docStatus!==u.DOC_STATUS.changed&&e.unLock()})),this.lockManager.on("lock_start",(function(){e.userAction.log("lock_start")})),this.lockManager.on("error",(function(t){e.lockError(t)})))}},{key:"lockError",value:function(e){this.userAction.logError(e.code,e.message,e),e.message&&this._isNetWorkError(e.message)||e.code===u.ERROR_CODE.LOCKED_BY_VERSIONCONFLICT&&this._isBuzy()||this.onLockError(e)||(this.setEditable(!1),this.error(e))}},{key:"createCollabManager",value:function(){var e=this;this.collabManager||(this.collabManager=this.doCreateCollabManager(),this.collabManager&&(this.userAction.log("create_collab"),this.collabManager.on("ready",(function(){e.userAction.log("collab_ready"),e.engine.focusBlankDoc(e.initialDocument.value),e.setEditable(!0),e.collabConnected=!0,e.performance.marks("CollabReady"),e.performance.reportPerf()})),this.collabManager.on(u.WORKFLOW_EVENT.error,(function(t){if(e.onCollabError(t),e.cache(),e.error(t),t.code!==u.ERROR_CODE.COLLAB_DATA_INIT_ERROR){if(t.code===u.ERROR_CODE.DISCONNECTED&&e._collaboratorCounts&&e.netStatus===u.NET_STATUS.online)return e.userAction.log("collab_reconnect"),void e.start();e.transmitMode(u.EDIT_MODE.LOCK),e.transmitNetStatus(u.NET_STATUS.online)}else e.setEditable(!1)})),this.collabManager.on(u.WORKFLOW_EVENT.message,(function(t){t.type===u.MESSAGE.DOC_DELETED?(e.transmitDocStatus(u.DOC_STATUS.deleted),e.error({code:u.ERROR_CODE.DOC_DELETED,data:t})):e.emit(u.WORKFLOW_EVENT.message,t)})),this.collabManager.on(u.WORKFLOW_EVENT.collabUsersChange,(function(t){e.emit(u.WORKFLOW_EVENT.collabUsersChange,t),e._collaboratorCounts=t.length,e.userAction.log("collab_user_changes",t.length)})),this.collabManager.on(u.WORKFLOW_EVENT.netStatusChange,(function(t){e.transmitNetStatus(t)}))))}},{key:"startLockService",value:function(){this.docStatus===u.DOC_STATUS.deleted||this.netStatus===u.NET_STATUS.offline&&!V.g||(ne("startLockService"),this.createLockManager(),this.lockManager.start())}},{key:"startCollabService",value:function(){this.userAction.log("collab_start"),ne("startCollabService"),this.createCollabManager(),this.collabManager.connect()}},{key:"unLock",value:function(){this.currentMode===u.EDIT_MODE.LOCK&&this.lockManager&&this.docStatus!==u.DOC_STATUS.changed&&(this.doc&&this.doc.local||(this.userAction.log("unlock"),this.lockManager.unLock()))}},{key:"transmitDocStatus",value:function(e){ne("transmitDocStatus===========: ",this.docStatus,"=>",e),this.docStatus!==u.DOC_STATUS.deleted&&(e!==u.DOC_STATUS.saved||this.docStatus===u.DOC_STATUS.saving?e===u.DOC_STATUS.published&&this.docStatus!==u.DOC_STATUS.publishing||this.docStatus!==e&&(this.userAction.log("docStatus_changed","".concat(this.docStatus," => ").concat(e)),this.docStatus=e,this.emit(u.WORKFLOW_EVENT.docStatusChange,e)):this.emit(u.WORKFLOW_EVENT.docStatusChange,e))}},{key:"transmitNetStatus",value:function(e){if(this.netStatus!==e){if(e===u.NET_STATUS.congestion&&this.netStatus===u.NET_STATUS.offline)return;this.netStatus=e,this.userAction.log("netStatus_changed",e),this.emit(u.WORKFLOW_EVENT.netStatusChange,e)}}},{key:"transmitMode",value:function(e){this.currentMode!==e&&(ne("transmitDocStatus===========: ",this.currentMode,"=>",e),this.currentMode=e,this.userAction.log("mode_changed",e),this.emit(u.WORKFLOW_EVENT.editModeChange,e)),this.currentMode===u.EDIT_MODE.LOCK&&this.setEditable(!0)}},{key:"setEditable",value:function(e){this.editable!==e&&(this.editable=e,this.userAction.log("editable_changed",e),this.emit(u.WORKFLOW_EVENT.editableChange,e))}},{key:"_updateDoc",value:function(e){this.userAction.log("doc_update",e.draft_version),this.updateEditorBiz(e),this.initialDocument=this.editorBiz.getInitialDocument(),this.onDocUpdated(e);var t=e&&e.doc_dynamic_data&&e.doc_dynamic_data[0]&&e.doc_dynamic_data[0].updated_at||"",r=this.doc&&this.doc.doc_dynamic_data&&this.doc.doc_dynamic_data[0]&&this.doc.doc_dynamic_data[0].updated_at||"";this.isDynamicDataChanged=t!==r,this.doc=W({},e),this.lockManager&&this.lockManager.resetDoc(e),this.currentMode===u.EDIT_MODE.COLLAB&&this.collabManager&&this.collabManager.resetDoc(e,this.initialDocument)}},{key:"_clearCacheTimer",value:function(){this.cacheTimer&&clearTimeout(this.cacheTimer)}},{key:"_lazyCache",value:function(){var e=this;this._clearCacheTimer(),this.cacheTimer=setTimeout((function(){e.cache()}),this.lazyCacheInterval)}},{key:"ignoreChange",value:function(){return!this.docRendered||!!this.destroying}},{key:"cache",value:function(){if(this.needCache()&&!this.cached&&this.docRendered&&this.docStatus===u.DOC_STATUS.changed){var e;this._clearCacheTimer();try{e=this.engine.getPureContent()}catch(e){return this.error({code:u.ERROR_CODE.DATA_ERROR,error:e}),!1}try{this.cached=this.editorBiz.saveToCache({format:this.doc.format,value:e})}catch(e){return this.userAction.logError(u.ERROR_CODE.CACHE_FAILED,null==e?void 0:e.message,e),!1}return this.cached||this.userAction.logError(u.ERROR_CODE.CACHE_FAILED),this.userAction.log("cached"),!0}}},{key:"checkSaveStatus",value:function(e){var t=this.editable,r=this.docStatus,o=this.docRendered,a=this.saving,i=this.netStatus;this.userAction.log("save_status","editable:".concat(t,", docStatus:").concat(r,", docRendered:").concat(o,", saving:").concat(a,", netStatus:").concat(i));var c=e===u.SAVE_TYPE.USER_PUBLISH||e===u.SAVE_TYPE.USER_SAVE;return o?t?r===u.DOC_STATUS.deleted?(c&&(n.a.destroy(),n.a.error(__("文档已经被删除"))),u.SAVE_STATUS.DISABLED):r===u.DOC_STATUS.publishing?(c&&this.emit(u.WORKFLOW_EVENT.message,{type:u.MESSAGE.PUBLISHING}),u.SAVE_STATUS.DISABLED):this.destroying?u.SAVE_STATUS.DISABLED:r===u.DOC_STATUS.saving||a?(c&&this.emit(u.WORKFLOW_EVENT.message,{type:u.MESSAGE.SAVING}),u.SAVE_STATUS.IGNORE):this.doIgnoreSave(e)?u.SAVE_STATUS.IGNORE:this.dontIgnoreSave(e)?u.SAVE_STATUS.OK:this.docStatus===u.DOC_STATUS.saved||this.docStatus===u.DOC_STATUS.published||this.docStatus===u.DOC_STATUS.loaded&&!this.editorBiz.isCacheActived?(e===u.SAVE_TYPE.USER_SAVE&&this.emit(u.WORKFLOW_EVENT.message,{type:u.MESSAGE.SAVED}),u.SAVE_STATUS.IGNORE):u.SAVE_STATUS.OK:(ne("on save, editor disabled, ignore"),c&&this.emit(u.WORKFLOW_EVENT.message,{type:u.MESSAGE.EDIT_DISABLE}),u.SAVE_STATUS.DISABLED):(ne("on save, editor unrendered, ignore"),c&&this.emit(u.WORKFLOW_EVENT.message,{type:u.MESSAGE.UNREADY}),u.SAVE_STATUS.DISABLED)}},{key:"throwWhenPublish",value:function(e,t){if(e===u.SAVE_TYPE.USER_PUBLISH)throw t||(t=new Error("")),t}},{key:"_isNetWorkError",value:function(e){return e.startsWith(__("网络异常"))||e.includes("Failed to fetch")}},{key:"_isConflictError",value:function(e){return e.includes("conflict")}},{key:"closeAble",value:function(){return!1===this.cached&&this.docStatus===u.DOC_STATUS.saving?(this.error({code:u.ERROR_CODE.CACHE_FAILED}),!1):!(this.engine&&!this.engine.isContentReady()&&(this.error({code:u.ERROR_CODE.CONTENT_UNREADY}),1))}},{key:"saveFailed",value:function(e,t,r){var n;(this.userAction.log("save_failed",null==t?void 0:t.message),r&&r!==this.saveId)||(this.transmitDocStatus(u.DOC_STATUS.changed),e===u.SAVE_TYPE.USER_SAVE&&(this._isNetWorkError(null==t?void 0:t.message)?this.emit(u.WORKFLOW_EVENT.message,{type:u.MESSAGE.SAVE_FAILED,body:null==t?void 0:t.message}):this._isConflictError(null==t?void 0:t.message)?(n=u.ERROR_CODE.DOC_SAVE_CONFLICT,null!=t&&t.weak_net_delay&&(n=null)):n=404===(null==t?void 0:t.status)?u.ERROR_CODE.DOC_NOT_EXIST:u.ERROR_CODE.SAVE_FAILED),n&&this.error({code:n,message:null==t?void 0:t.message,stack:null==t?void 0:t.stack}),this.onSaveFailed(),this._checkFreeCallback())}},{key:"saveSuccess",value:function(e,t){this.userAction.log("save_success","".concat(e,":").concat(null==t?void 0:t.id)),this.transmitDocStatus(u.DOC_STATUS.saved),e!==u.SAVE_TYPE.USER_SAVE||t.local||(n.a.destroy(),n.a.success(__("保存成功"))),t.local&&!this.clearing||this.clearCache(),this._updateDoc(t),e!==u.SAVE_TYPE.USER_PUBLISH&&(this.unLock(),this.onSaveSuccess(t),this._checkFreeCallback())}},{key:"clearCache",value:function(){this.docStatus!==u.DOC_STATUS.changed&&(this.editorBiz.clearCachedContent(),delete this.cached,this.userAction.log("clear_cache"))}},{key:"publishSuccess",value:(g=Q(Y().mark((function e(t){return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.userAction.log("publish_success"),this.transmitDocStatus(u.DOC_STATUS.published),e.next=4,this.onPublishSuccess(t);case 4:this._checkFreeCallback();case 5:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"publishFailed",value:function(e){this.transmitDocStatus(u.DOC_STATUS.changed),"max_doc_note_number"!==(null==e?void 0:e.code)&&this.error({code:u.ERROR_CODE.PUBLISH_FAILED,message:null==e?void 0:e.message,stack:null==e?void 0:e.stack}),this.onPublishFailed(),this._checkFreeCallback()}},{key:"saveEditorMeta",value:(y=Q(Y().mark((function e(t){var r,n,o,a,i,c;return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.isDraft,n=t.themeMetas,o=this.doc,a=this.engine.getDocMeta({themeMetas:n})){e.next=5;break}return e.abrupt("return");case 5:return i=JSON.stringify(a),c={id:o.id,meta_draft:i},r||(c.meta=i),e.prev=8,e.next=11,this.doSaveEditorMeta(c);case 11:this.engine.updateDocEditorMeta(c),this.onEditorMetaSaved(),e.next=17;break;case 15:e.prev=15,e.t0=e.catch(8);case 17:case"end":return e.stop()}}),e,this,[[8,15]])}))),function(e){return y.apply(this,arguments)})},{key:"deleteDoc",value:function(){this.transmitDocStatus(u.DOC_STATUS.deleted),this.onDocDeleted()}},{key:"exit",value:(m=Q(Y().mark((function e(t){return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.unlock||!this.lockManager){e.next=6;break}return e.next=4,this.lockManager.unLock();case 4:e.next=7;break;case 6:return e.abrupt("return",Promise.resolve());case 7:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"error",value:function(e){var t,r;e.message=e.message||(null===(t=e.error)||void 0===t?void 0:t.message),e.stack=e.stack||(null===(r=e.error)||void 0===r?void 0:r.stack),this.emit(u.WORKFLOW_EVENT.error,e),this.reportError(e)}},{key:"reportError",value:function(e){var t;e.editMode=this.currentMode,e.scene=this.scene,e.docFormat=this.docFormat,this.userAction.logError(e.code,e.message,e),u.REPORT_ACTION_ERROR.includes(e.code)&&this.netStatus===u.NET_STATUS.online&&this.userAction.report(),l.a.logEditWorkflow(e),e.code===u.ERROR_CODE.COMMAND_ERROR&&l.a.logEngineError(W(W({},e),{},{code:null===(t=e.detail)||void 0===t?void 0:t.commandName}))}},{key:"lazyDestroy",value:function(){var e=this;this.userAction.log("lazy_destroy"),setTimeout((function(){e.destroy()}),1e3)}},{key:"_clearTimer",value:function(){this._clearCacheTimer(),this._clearLazyDisconnect(),this._clearLazyStartTimer(),this._clearActiveTimer()}},{key:"destroy",value:function(){if(this.destroying=!0,this._clearTimer(),this._isBuzy()&&this.destroyCount<this.maxDestroyCount)return this.destroyCount++,void this.lazyDestroy();this.userAction.log("workflow_destroy"),this.performance&&(this.performance.destroy(),this.performance=null),this.lockManager&&(this.lockManager.destroy(),this.lockManager=null),this.collabManager&&(this.collabManager.destroy(),this.collabManager=null),this.engine&&(this.engine.destroy(),this.engine=null),this.userAction&&(this.userAction.destroy(),this.userAction=null),this.doc=null,this.onDestroy()}},{key:"onDestroy",value:function(){}},{key:"onBeforeReset",value:function(){}},{key:"onReset",value:function(){}},{key:"onBeforeUpdateEditorBiz",value:function(){}},{key:"doBindEvents",value:function(){}},{key:"startAble",value:function(){return!0}},{key:"onStarted",value:function(){}},{key:"needLoad",value:function(){return!0}},{key:"doLoadDoc",value:(h=Q(Y().mark((function e(){return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)}))),function(){return h.apply(this,arguments)})},{key:"onLockError",value:function(){}},{key:"doCreateCollabManager",value:function(){}},{key:"onCollabError",value:function(){}},{key:"createEditorBiz",value:function(){}},{key:"onDocUpdated",value:function(){}},{key:"onDocRendered",value:function(){}},{key:"needCache",value:function(){return!0}},{key:"onSaveFailed",value:function(){}},{key:"onSaveSuccess",value:function(){}},{key:"onDocDeleted",value:function(){}},{key:"onPublishSuccess",value:(d=Q(Y().mark((function e(){return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)}))),function(){return d.apply(this,arguments)})},{key:"onPublishFailed",value:function(){}},{key:"doSaveEditorMeta",value:(c=Q(Y().mark((function e(){return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)}))),function(){return c.apply(this,arguments)})},{key:"onEditorMetaSaved",value:function(){}},{key:"isDefaultTitle",value:function(){}},{key:"isActive",value:function(){return!0}},{key:"doLock",value:(i=Q(Y().mark((function e(){return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)})},{key:"doUnlock",value:(a=Q(Y().mark((function e(){return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)}))),function(){return a.apply(this,arguments)})}],r&&Z(t.prototype,r),o&&Z(t,o),Object.defineProperty(t,"prototype",{writable:!1}),_}(a.a);t.a=ce},3687:function(e,t,r){"use strict";r(3223);var n=r(1561);r(3201);t.a=n.a},3688:function(e,t,r){"use strict";var n=r(0),o=r.n(n),a=r(2),i=r.n(a),c=r(3655),u=r(50);function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function s(){s=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function f(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var a=t&&t.prototype instanceof b?t:b,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:A(e,r,c)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",m="suspendedYield",y="executing",v="completed",g={};function b(){}function w(){}function _(){}var E={};f(E,i,(function(){return this}));var O=Object.getPrototypeOf,S=O&&O(O(N([])));S&&S!==r&&n.call(S,i)&&(E=S);var k=_.prototype=b.prototype=Object.create(E);function x(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,c){var u=p(e[o],e,a);if("throw"!==u.type){var s=u.arg,f=s.value;return f&&"object"==l(f)&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(f).then((function(e){s.value=e,i(s)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=h;return function(a,i){if(o===y)throw new Error("Generator is already running");if(o===v){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var l=p(t,r,n);if("normal"===l.type){if(o=n.done?v:m,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=v,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(l(t)+" is not iterable")}return w.prototype=_,o(k,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:w,configurable:!0}),w.displayName=f(_,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,f(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(j.prototype),f(j.prototype,c,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(d(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(k),f(k,u,"Generator"),f(k,i,(function(){return this})),f(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function f(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}Promise.all([r.e(4),r.e(5),r.e(6),r.e(0),r.e(1161)]).then(r.bind(null,3382));var d=function(e){var t=e.docs,a=e.onSuccess,i=e.bookId,l=t.length,d=function(){var e,n=(e=s().mark((function e(){var n,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=s().mark((function e(){var n,l,f,d,p,h,m;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t[o].slug,e.prev=1,e.next=4,u.a.docs.findOne({id:n,book_id:i});case 4:if(l=e.sent,f=l.format,d=l.content,p=null,"lakesheet_html"!==f){e.next=12;break}p=Object(c.a)(l.content),h="lakesheet",e.next=17;break;case 12:if("html"!==f){e.next=17;break}return e.next=15,Promise.all([r.e(4),r.e(5),r.e(6),r.e(0),r.e(1161)]).then(r.bind(null,3382)).then((function(e){return e.htmlToLake(d)}));case 15:p=e.sent,h="lake";case 17:return m={id:l.id,format:h,body_asl:p.value,draft_version:l.draft_version,save_type:"auto"},p.html&&(m.body_html=p.html),e.next=21,u.a.docs.updateContent(m);case 21:return e.next=23,u.a.docs.publish({id:l.id,format:h,notify:!1,force:!0});case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(1),console.log("convert error",e.t0),a();case 29:case"end":return e.stop()}}),e,null,[[1,25]])})),o=0;case 2:if(!(o<l)){e.next=7;break}return e.delegateYield(n(),"t0",4);case 4:o++,e.next=2;break;case 7:a();case 8:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){f(a,n,o,i,c,"next",e)}function c(e){f(a,n,o,i,c,"throw",e)}i(void 0)}))});return function(){return n.apply(this,arguments)}}();return Object(n.useEffect)((function(){return d(),function(){}}),[]),o.a.createElement("div",null)};d.propTypes={onSuccess:i.a.func.isRequired,bookId:i.a.number.isRequired,docs:i.a.array.isRequired},t.a=d},3690:function(e,t,r){"use strict";r(3225);var n=r(1564);r(3204);t.a=n.a},3692:function(e,t,r){"use strict";r(3178);var n=r(3360),o=r(0),a=r.n(o),i=r(2),c=r.n(i),u=r(1333),l=r(959),s=r(709),f=r(356),d=r(3511),p=r(320);function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,a=void 0,a=function(e,t){if("object"!==h(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==h(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===h(a)?a:String(a)),n)}var o,a}function y(e,t){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},y(e,t)}function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=g(e);if(t){var o=g(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===h(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function g(e){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},g(e)}var b=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}(c,e);var t,r,o,i=v(c);function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=i.call(this,e)).breadcrumbRef=a.a.createRef(),t}return t=c,(r=[{key:"render",value:function(){var e=this,t=this.props,r=t.group,o=t.book,i=t.doc,c=t.separator,f=t.noPrivateTip,d=t.noDocPrivateTip,h=t.docLevelUrl,m=t.noGroup,y=t.showBookIcon,v=t.isNote,g=t.disableClickOnIcon,b=o?o.namespace||"".concat(r.login,"/").concat(o.slug):null;return v?null:a.a.createElement(p.a,null,a.a.createElement("div",{className:"lark-breadcrumb",ref:this.breadcrumbRef},y&&a.a.createElement(l.d,{group:r,book:o}),a.a.createElement(n.a,{separator:c},!m&&r&&a.a.createElement(n.a.Item,{href:"/".concat(r.login)},a.a.createElement(u.default.Name,{user:r,className:"".concat(o||i?"":"lark-breadcrumb-current")})),o&&(g?a.a.createElement(n.a.Item,{className:"lark-breadcrumb-link-ellipsis"},a.a.createElement("span",{className:"".concat(i?"":"lark-breadcrumb-current")},a.a.createElement(l.g,{group:r,book:o,showBookIcon:!1,showPrivateIcon:!f,href:"/".concat(b),getPopupContainer:function(){return e.breadcrumbRef.current}}))):a.a.createElement(n.a.Item,{href:"/".concat(b),className:"lark-breadcrumb-link-ellipsis"},a.a.createElement("span",{className:"".concat(i?"":"lark-breadcrumb-current")},a.a.createElement(l.g,{group:r,book:o,showBookIcon:!1,showPrivateIcon:!f,getPopupContainer:function(){return e.breadcrumbRef.current}})))),i&&a.a.createElement(n.a.Item,{className:"header-crumb-doc",href:h||"/".concat(b,"/").concat(i.slug)},a.a.createElement("span",{className:"lark-breadcrumb-current"},a.a.createElement(s.o,{doc:i})),!d&&a.a.createElement(s.b,{group:r,book:o,doc:i,getPopupContainer:function(){return e.breadcrumbRef.current}})))))}}])&&m(t.prototype,r),o&&m(t,o),Object.defineProperty(t,"prototype",{writable:!1}),c}(o.PureComponent);b.propTypes={group:c.a.object.isRequired,book:c.a.object,doc:c.a.object,separator:c.a.node,noPrivateTip:c.a.bool,noDocPrivateTip:c.a.bool,docLevelUrl:c.a.string,noGroup:c.a.bool,showBookIcon:c.a.bool,isNote:c.a.bool,disableClickOnIcon:c.a.bool},b.Logo=function(e){var t=e.separator,r=e.organization,n=e.allowClick,o=r&&r.id?a.a.createElement(f.g,{src:r.logo,size:28}):a.a.createElement(d.b,{height:40});return a.a.createElement("span",{className:"lark-breadcrumb-logo"},n?a.a.createElement("a",{href:"/",className:"lark-logo"},o):o,t&&a.a.createElement("span",{className:"lark-breadcrumb-separator"},t))},b.Logo.defaultProps={allowClick:!0},b.Logo.propTypes={separator:c.a.node,organization:c.a.object,allowClick:c.a.bool};t.a=b},3693:function(e,t,r){"use strict";r.r(t);r(73);var n=r(31),o=r(0),a=r.n(o),i=r(2),c=r.n(i),u=r(3533),l="index-module_searchModalWrapper_vtDAq",s="index-module_searchInput_MvuM1",f=["visible","onCancel"];function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},d.apply(this,arguments)}function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return h(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function m(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var y=function(e){var t=e.visible,r=e.onCancel,i=m(e,f),c=p(Object(o.useState)(t),2),h=c[0],y=c[1],v={size:"large",placeholder:__("搜索"),autoComplete:"nope",allowClear:!0,bordered:!1,className:s},g=function(){y(!1),r()};return Object(o.useEffect)((function(){y(t)}),[t]),a.a.createElement(n.a,{keyboard:!0,onCancel:g,wrapClassName:l,width:720,footer:null,visible:h,destroyOnClose:!0},a.a.createElement(u.a,d({},i,{sence:"modal",searchInputProps:v,onCancel:g})))};y.propTypes={onCancel:c.a.func,visible:c.a.bool};t.default=y},3697:function(e,t,r){e.exports=r(3460)},3698:function(e,t,r){var n=r(804),o=r(268),a=r(1198),i=Math.max;e.exports=function(e,t,r){var c=null==e?0:e.length;if(!c)return-1;var u=null==r?0:a(r);return u<0&&(u=i(c+u,0)),n(e,o(t,3),u)}},3700:function(e,t,r){"use strict";r(279);var n=r(138),o=(r(41),r(9)),a=(r(60),r(14)),i=(r(37),r(10)),c=r(0),u=r.n(c),l=r(2),s=r.n(l),f=r(149),d=r.n(f),p=r(50),h=(r(229),r(34)),m=r(454),y=r.n(m),v=r(3538),g=r.n(v),b=r(3460),w=r(320),_=r(499);function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return O(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var S=function(e){var t=E(Object(c.useState)([]),2),r=t[0],n=t[1];return Object(c.useEffect)((function(){p.a.users.mailHistories({}).then((function(e){n(e)}))}),[e]),{mailHistory:r}},k="RecipientSelector-module_recipient_Ds5UW",x="RecipientSelector-module_mention_5r6oN",j="RecipientSelector-module_userForCheck_a4ZZP",A="RecipientSelector-module_mailHistory_-ft0g",L="RecipientSelector-module_title_-yKJG",T="RecipientSelector-module_users_ZwnLM",C="RecipientSelector-module_info_eM40g",P="RecipientSelector-module_avatar_lGHzI",N="RecipientSelector-module_name_HeaN7",R="RecipientSelector-module_dep_B2T89";function I(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return D(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return D(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var M=["alibaba-inc.com","antfin.com","list.alibaba-inc.com","cainiao.com"];function F(e){var t=I(Object(c.useState)(!1),2),r=t[0],n=t[1],o=I(Object(c.useState)(e.defaultValue||[]),2),a=o[0],l=o[1],s=S(window.appData.me).mailHistory,f=I(Object(c.useState)([]),2),d=f[0],m=f[1],v=Object(c.useRef)(),w=null,E=__("最多只能选择100个邮箱地址，建议请使用邮件组"),O=__("收件人有重复，已自动去重"),D=function(t){var r=t.length,o=(t=g()(t,(function(e,t){return e.email&&t.email?e.email===t.email:!(!e.login||!t.login)&&e.login===t.login}))).length;o>100?(i.a.warning(E),t.splice(100)):o!==r&&i.a.warning(O),l(t),e.onChange(t),n(!1),m([]),setTimeout((function(){v&&v.current&&v.current.focus()}),100)};Object(c.useEffect)((function(){return function(){w&&(clearTimeout(w),w=null)}}));var F=y()((function(e){(function(e){e=e.split(";");var t=[];if(e.forEach((function(e){if(b.validator.isEmail(e))t.push({name:e,email:e});else{var r=e.match(/([^<]+)<([^>]+)>/);r&&b.validator.isEmail(r[2])&&t.push({name:r[1],email:r[2]})}})),t.length>0){var r=a.concat(t);return D(r),v.current.blur(),!0}return!1})(e)||function(e){if(-1!==e.indexOf("@")){var t=e.split("@"),r=t[1],n=M.filter((function(e){return e.startsWith(r)})).map((function(e){return{name:"".concat(t[0],"@").concat(e),email:"".concat(t[0],"@").concat(e)}}));return m(n),!0}return!1}(e)||(n(!1),p.a.users.complete({q:e.trim(),include_unconfirmed_corp_account:!0}).then((function(e){m(e),v.current.focus()})))}),300),G=a.map((function(e){return e.name}));return u.a.createElement("div",{className:k},u.a.createElement("span",{className:x,onClick:function(){if(window.__engine&&window.__engine.extractMention){var e=window.__engine.extractMention();if(0===(e=e.filter((function(e){return e.name&&e.name.trim()&&e.login&&e.login.trim()}))).length)return void i.a.warn(__("文档中没有 @ 人"));var t=a.concat(e);D(t)}}},__("添加文档中 @ 的人")),u.a.createElement(h.a,{mode:"multiple",style:{width:"100%"},placeholder:__("请输入花名或邮箱地址"),onChange:function(e){var t=a.filter((function(t){return e.includes(t.name)}));D(t)},onFocus:function(){0===a.length&&n(!0)},onSearch:F,onBlur:function(){w&&clearTimeout(w),w=setTimeout((function(){n(!1),m([])}),500)},allowClear:!0,value:G,notFoundContent:null,ref:v}),d.length>0&&u.a.createElement("div",{className:j},d.map((function(e){return u.a.createElement("p",{key:e.email,onClick:function(){!function(e){if(100!==a.length)if(0===a.filter((function(t){return t.email===e.email})).length){var t=a.concat(e);D(t)}else i.a.warning(O);else i.a.warning(E)}(e)}},e.avatar_url&&u.a.createElement(_.a,{className:P,src:e.avatar_url,size:32}),u.a.createElement("span",{className:N},e.name),e.dep&&u.a.createElement("span",{className:R},e.dep))}))),r&&s&&s.length>0&&u.a.createElement("div",{className:A,"data-testid":"mail-history"},u.a.createElement("div",{className:L},__("历史记录")),u.a.createElement("ul",null,s.map((function(e){return u.a.createElement("li",{onClick:function(){!function(e){D(e.mail_list)}(e)},key:e.id},u.a.createElement("p",{className:T},e.mail_list.map((function(e){return e.name})).join(",")),u.a.createElement("p",null,u.a.createElement("span",{className:C},__("标题："),e.title)))})))))}F.propTypes={onChange:s.a.func.isRequired,defaultValue:s.a.array};var G=Object(w.b)(F,!1),U="DocSendMail-module_sendMail_QBA+O",B="DocSendMail-module_recipient_zqM9E",q="DocSendMail-module_title_Af2FA",V="DocSendMail-module_submitButton_HEsW-",z="DocSendMail-module_mailResult_AhaV4";function H(e){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},H(e)}function W(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,X(n.key),n)}}function Y(e,t){return Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Y(e,t)}function K(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Z(e);if(t){var o=Z(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===H(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Q(e)}(this,r)}}function Q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Z(e){return Z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Z(e)}function J(e,t,r){return(t=X(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function X(e){var t=function(e,t){if("object"!==H(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==H(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===H(t)?t:String(t)}var $=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Y(e,t)}(s,e);var t,r,c,l=K(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),J(Q(t=l.call(this,e)),"ready",(function(){0!==t.state.receiver.length?"sending"!==t.state.mailStatus&&(t.setState({mailStatus:"sending"},(function(){t.props.onMailSending(),t.startClock(5)})),t.timer=setTimeout(t.sendMail,5e3)):i.a.error(__("请选择收件人"))})),J(Q(t),"startClock",(function(e){t.setState({seconds:e}),0!==e&&"sending"===t.state.mailStatus&&(t.clocker=setTimeout((function(){t.startClock(e-1)}),1e3))})),J(Q(t),"sendMail",(function(){var e=t.state,r=e.receiver,n=e.title,o={id:t.props.doc.id,title:n||t.props.doc.title,content:window.__engine?window.__engine.getDocument("text/html",{mode:"inline"}):""};try{o.mail_list=t.normalizeMail(r)}catch(e){return void i.a.error(e.message)}p.a.docs.sendMail(o,{ignoreGlobalMessage:!0}).then((function(e){t.setState({mailStatus:"success",receiver:[]}),t.props.onMailSended()})).catch((function(e){e.status&&e.status>=400&&e.status<500?t.setState({mailStatus:"block",mailBlockMessage:e.message}):t.setState({mailStatus:"failed"})}))})),J(Q(t),"retry",(function(){t.setState({mailStatus:"normal",mailBlockMessage:""})})),J(Q(t),"normalizeMail",(function(e){return e.map((function(e){return d()(e,["email","login","user_id","name"])}))})),J(Q(t),"onChangeReceiver",(function(e){t.setState({receiver:e})})),J(Q(t),"onChangeTitle",(function(e){t.setState({title:e.target.value})})),J(Q(t),"renderMailSelector",(function(){return u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{className:q},u.a.createElement("h5",null,__("标题")),u.a.createElement(a.a,{onChange:t.onChangeTitle,defaultValue:t.props.doc.title})),u.a.createElement("div",{className:B},u.a.createElement("h5",null,__("收件人")),u.a.createElement(G,{onChange:t.onChangeReceiver,defaultValue:t.state.receiver})),u.a.createElement("div",{className:V},u.a.createElement(o.a,{onClick:t.ready,type:"primary"},__("发送"))))})),J(Q(t),"cancel",(function(){t.timer&&(clearTimeout(t.timer),t.timer=null),t.clocker&&(clearTimeout(t.clocker),t.clocker=null),t.setState({mailStatus:"normal",mailBlockMessage:""}),i.a.warning(__("已取消发送")),t.props.onMailSended()})),J(Q(t),"renderSending",(function(){return u.a.createElement("div",{className:z},u.a.createElement(n.a,{justify:"block"}),u.a.createElement("p",null,__("邮件即将在 {seconds} 秒后发送，{cancel}",{cancel:u.a.createElement("a",{href:"#",onClick:t.cancel},__("撤销")),seconds:t.state.seconds||0})))})),J(Q(t),"renderSuccess",(function(){return u.a.createElement("div",{className:z},u.a.createElement("span",{className:"larkicon larkicon-check-o"}),u.a.createElement("p",null,__("发送成功")))})),J(Q(t),"renderFailed",(function(){return u.a.createElement("div",{className:z},u.a.createElement("span",{className:"larkicon larkicon-error"}),u.a.createElement("p",null,__("发送失败, 请{retry}",{retry:u.a.createElement("a",{href:"#",onClick:t.retry},__("重新发送"))})))})),J(Q(t),"renderBlock",(function(){return u.a.createElement("div",{className:z},u.a.createElement("span",{className:"larkicon larkicon-error"}),u.a.createElement("p",null,t.state.mailBlockMessage))})),J(Q(t),"renderCanceled",(function(){return u.a.createElement("div",{className:z},u.a.createElement("p",null,__("已取消发送")))})),t.state={receiver:[]},t}return t=s,(r=[{key:"componentDidMount",value:function(){this.setState({mailStatus:"normal",mailBlockMessage:""})}},{key:"render",value:function(){var e;switch(this.state.mailStatus){case"sending":e=this.renderSending();break;case"success":e=this.renderSuccess();break;case"failed":e=this.renderFailed();break;case"block":e=this.renderBlock();break;case"canceled":e=this.renderCanceled();break;default:e=this.renderMailSelector()}return u.a.createElement("div",{className:U,"data-testid":"send-mail-modal"},u.a.createElement("h4",null,__("发送到邮箱")),u.a.createElement("p",null,__("将文档内容发送到指定邮箱")),e)}}])&&W(t.prototype,r),c&&W(t,c),Object.defineProperty(t,"prototype",{writable:!1}),s}(c.PureComponent);$.defaultProps={},$.propTypes={onMailSended:s.a.func,onMailSending:s.a.func,doc:s.a.object};t.a=$},3703:function(e,t,r){"use strict";t.a={fullscreen:"index-module_fullscreen_YFc74",head:"index-module_head_5fmgf",isInsetTitleBar:"index-module_isInsetTitleBar_L9FrS",back:"index-module_back_1eag2",pageTitle:"index-module_pageTitle_UaM1v",headNav:"index-module_headNav_10ysn",headActions:"index-module_headActions_dizKK",restoreButton:"index-module_restoreButton_sPfkI",versionNameTip:"index-module_versionNameTip_+ul2k",versionName:"index-module_versionName_mi01u",body:"index-module_body_LQoQ8",aside:"index-module_aside_kliFq",main:"index-module_main_kYLWG",content:"index-module_content_8lh-O",document:"index-module_document_oSFJb",fixed:"index-module_fixed_5d1CF",toolbar:"index-module_toolbar_icO0H",adapt:"index-module_adapt_esbh-",doc:"index-module_doc_2jnwi"}},3722:function(e,t,r){"use strict";r.d(t,"a",(function(){return T}));r(999);var n=r(651),o=(r(60),r(14)),a=(r(41),r(9)),i=(r(37),r(10)),c=(r(143),r(67)),u=r(0),l=r(1618),s=r(1697),f=r(1210),d=r(59),p=r(5),h=r.n(p),m=r(956),y=r.n(m),v=r(238),g=r(455),b=r(3309),w=r(3406),_=r(1403),E=r(11),O=r(32),S=r(3337);function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function x(){x=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:A(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(N([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==k(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(k(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(j.prototype),l(j.prototype,c,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function j(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function A(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){j(a,n,o,i,c,"next",e)}function c(e){j(a,n,o,i,c,"throw",e)}i(void 0)}))}}function L(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==k(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==k(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===k(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var T=function(e){var t,r,p=e.bookPublicSet,m=e.panelType,k=e.panelTitle,j=e.share,T=e.belongs,C=e.organization,P=e.group,N=e.book,R=e.me,I=e.shareViewType,D=e.handlePasswordChange,M=e.handleScopeChange,F=e.handleSearchChange,G=e.onBack,U=u.useMemo((function(){return Object(_.d)(j,I,P,N)}),[j,I,P,N]).privacy,B={scopeSet:function(){var e=b.q[T],t=e.desc,r=e.actions,n=T===g.a.ORG&&(0===(null==C?void 0:C.share_to_outside_enable)||!d.a.isPremium(C));return u.createElement(u.Fragment,null,u.createElement("p",{className:S.a.titleDesc},t),r.map((function(e){var t;return u.createElement(c.a,{key:e.value,title:e.value===E.PRIVACY.public&&n?null===(t=e.tip)||void 0===t?void 0:t.call(e,C):"",placement:"bottomLeft",overlayInnerStyle:{width:"200px"},autoAdjustOverflow:!0},function(e){return u.createElement("div",{className:h()(S.a.contentArea,S.a.selectorItem,L({},S.a.disabledItem,e.value===E.PRIVACY.public&&n)),onClick:function(){U===e.value||e.value===E.PRIVACY.public&&n||null==M||M(e.value)}},u.createElement("span",null,e.label),U===e.value&&u.createElement(l.default,{className:S.a.selectorIcon,width:16,height:16}))}(e))})))},passwordSet:function(){var e=Object(_.c)(j,I,P,N),t=e.currentPassword,r=e.isInheritBookPassword,n="";(I===g.b.DOC&&r||I===g.b.BOOK)&&(n=b.o[I]);var l=Object(v.a)()?"https://www.yuque.com/yuque/thyzgp/wgy2sb#ebmU2":"https://yuque.antfin.com/lark/bsgp0v/lrui64#ebmU2",f=__("所属知识库已开启密码，文档无法独立设置。{terms}",{terms:u.createElement("a",{href:l,target:"_blank"},__("查看帮助"))}),d=function(e,t){var r=Object(_.a)(e,I,P,N);if(null!=r&&r.url){y()((null==r?void 0:r.urlWithDesc)||r.url,{format:"text/plain"});var n=t?__("已重置并复制链接和密码"):__("已复制链接和密码"),o=null!=e&&e.password?n:__("已复制链接");i.a.success(o,2)}},m=function(){var e=A(x().mark((function e(){var r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null==D?void 0:D(t?E.ENCRYPTED_PASSWORD_ACTIONS.disabled:E.ENCRYPTED_PASSWORD_ACTIONS.enabled);case 3:if(!(r=e.sent)){e.next=8;break}if(!t){e.next=7;break}return e.abrupt("return",i.a.success(__("设置成功"),1));case 7:return e.abrupt("return",d(r));case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}(),w=function(){var e=A(x().mark((function e(){var t;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null==D?void 0:D(E.ENCRYPTED_PASSWORD_ACTIONS.enabled);case 3:(t=e.sent)&&d(t,!0),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),O=u.createElement("div",{className:S.a.contentArea},t?u.createElement("div",{className:h()(S.a.pwdBlock,L({},S.a.bookPublicSet,p))},u.createElement("span",{"data-testid":"password-text",className:S.a.passwordText},__("密码：{password}",{password:t})),u.createElement(a.a,{type:"text",disabled:r,onClick:w,className:S.a.resetBtn},u.createElement(s.default,{className:S.a.resetIcon,width:12,height:12}),__("重置"))):u.createElement(o.a,{className:h()(S.a.pwdLink,L({},S.a.bookPublicSet,p)),disabled:!0,placeholder:__("点击开启生成随机密码")}),u.createElement(a.a,{className:S.a.pwdBtn,size:"large",type:"primary",disabled:r,onClick:m},t?__("关闭"):__("开启")));return u.createElement(u.Fragment,null,u.createElement("p",{className:h()(S.a.titleDesc,L({},S.a.bookPublicSet,p))},n),u.createElement(c.a,{title:r?f:"",placement:"bottomRight",autoAdjustOverflow:!0},O))},searchSet:function(){var e=Object(_.b)(j,I,P,N),t=e.currentIndexedLevel,r=e.isInheritBookIndex,o=b.r[I][T],a=o.desc,i=o.action,l=o.tip,s=u.createElement("div",{className:S.a.contentArea},u.createElement("span",{className:S.a.switchTitle},i),u.createElement(n.a,{disabled:r,onChange:F,checked:1===t}));return u.createElement(u.Fragment,null,u.createElement("p",{className:h()(S.a.titleDesc,L({},S.a.bookPublicSet,p))},a),u.createElement(c.a,{title:r?l:"",placement:"bottomRight",autoAdjustOverflow:!0},s))},shareExpiredTimeSet:function(){var e=!(!C||null==C||!C.id),t=!e&&"User"===(null==P?void 0:P.type)&&P.id===R.id,r=Object(_.e)(j,I,e);if(r){var n=r.startTime,o=r.expiredTime,a=b.s[T].desc,i=[{label:__("半年（{startTime} - {expiredTime}）",{startTime:n,expiredTime:o}),value:o},{label:__("永久有效"),value:null}],c=function(e){return u.createElement(u.Fragment,null,u.createElement("div",{onClick:function(){return function(e){var r;null===e.value&&t&&(null===(r=window.__member_message_ref)||void 0===r||r.current.showMemberIntro(O.LIMIT_SCENE.share_public))}(e)},className:h()(S.a.contentArea,S.a.selectorItem,L({},S.a.notOwner,!t))},u.createElement("span",{className:S.a.shareTime},e.label,null===e.value&&u.createElement(w.a,{className:S.a.memberAbleIcon,noTooltip:!0,isYuque:Object(v.a)(),group:P,organization:C})),e.value===o&&u.createElement(l.default,{className:S.a.selectorIcon,width:16,height:16})),null===e.value&&!t&&u.createElement("span",{className:S.a.shareNotOwner},__("请联系知识库所有者购买会员")))};return u.createElement(u.Fragment,null,u.createElement("p",{className:S.a.titleDesc},a),i.map((function(e){return c(e)})))}}};return p?u.createElement("div",{className:h()(S.a.shareDetailSettingPanel,S.a.bookPublicSetting)},u.createElement("div",{className:S.a.bookPublicTitle},k),null===(r=B[m])||void 0===r?void 0:r.call(B)):u.createElement("div",{className:S.a.shareDetailSettingPanel},u.createElement("div",{className:S.a.title,onClick:G},u.createElement(f.default,{className:S.a.backIcon,width:20,height:20}),k),null===(t=B[m])||void 0===t?void 0:t.call(B))}},3724:function(e,t,r){"use strict";r.r(t),r.d(t,"ShareButton",(function(){return _r}));r(41);var n=r(9),o=r(0),a=r.n(o),i=r(228),c=(r(785),r(424)),u=(r(143),r(67)),l=r(455),s=r(238),f=r(22),d="styles-module_popover_v7CCF",p="styles-module_disable_OpJcF";function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}var m=["panel","CollaboratorChannel","InviteSelectorChannel","children"],y=["shareViewType","canCollaborator","canShare","isFileBook","onlyCollaborator","organization","group","book","me","targetResource","onChangeShare","beforeShareUpdate","getPopupContainer"];function v(){return v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},v.apply(this,arguments)}function g(){g=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof b?t:b,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:A(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",m="executing",y="completed",v={};function b(){}function w(){}function _(){}var E={};l(E,i,(function(){return this}));var O=Object.getPrototypeOf,S=O&&O(O(N([])));S&&S!==r&&n.call(S,i)&&(E=S);var k=_.prototype=b.prototype=Object.create(E);function x(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==h(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=d;return function(a,i){if(o===m)throw new Error("Generator is already running");if(o===y){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?y:p,l.arg===v)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=y,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(h(t)+" is not iterable")}return w.prototype=_,o(k,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(j.prototype),l(j.prototype,c,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(k),l(k,u,"Generator"),l(k,i,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),v}},t}function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){_(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _(e,t,r){return t=function(e){var t=function(e,t){if("object"!==h(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==h(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===h(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function E(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function O(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return S(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function k(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var x=function(e){return e.parentNode||document.body},j=function(e){var t=e.panel,r=e.CollaboratorChannel,a=e.InviteSelectorChannel,i=e.children,h=k(e,m),b=h.shareViewType,_=h.canCollaborator,S=h.canShare,j=h.isFileBook,A=h.onlyCollaborator,L=h.organization,T=h.group,C=h.book,P=h.me,N=h.targetResource,R=h.onChangeShare,I=h.beforeShareUpdate,D=h.getPopupContainer,M=void 0===D?x:D,F=k(h,y),G=O(o.useState(!1),2),U=G[0],B=G[1],q=O(o.useState(!1),2),V=q[0],z=q[1];o.useEffect((function(){var e="#collaborator"===window.location.hash||window.location.hash.startsWith("#collaborator?");A&&e&&_&&b===l.b.DOC&&(z(!0),B(!0))}),[]),o.useEffect((function(){A&&_&&b===l.b.DOC&&z(!0)}),[A]);var H=function(){var e,t=(e=g().mark((function e(t){var r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=w(w({},t),{},{id:N.id}),!A){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",null==R?void 0:R(r));case 4:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){E(a,n,o,i,c,"next",e)}function c(e){E(a,n,o,i,c,"throw",e)}i(void 0)}))});return function(e){return t.apply(this,arguments)}}(),W=o.useMemo((function(){var e=null!=L&&L.id?l.a.ORG:l.a.PERSON;return Object(s.a)()?e:l.a.INTERNAL}),[L]);return null!=N&&N.id?o.createElement(c.a,{overlayClassName:d,content:o.createElement(t,{CollaboratorChannel:r,InviteSelectorChannel:a,onAttrsChange:H,beforeAttrsChange:I,share:N,shareViewType:b,canCollaborator:_,canShare:S,isFileBook:j,belongs:W,organization:L,group:T,book:C,me:P,showCollaborator:V,onlyCollaborator:A}),trigger:U&&f.c?"hover":"click",placement:"bottomRight",destroyTooltipOnHide:!0,visible:U,onVisibleChange:function(e){B(e)},getPopupContainer:M,noArrow:!0},i||o.createElement(n.a,v({},F,{"data-aspm-click":"c36321.d326998"}),o.createElement("span",null,__("分享")))):o.createElement(u.a,{placement:"bottomRight",title:__("当前无法使用分享，请检查网络状态"),arrowPointAtCenter:!0},o.createElement(n.a,v({className:p},F),o.createElement("span",null,__("分享"))))},A=(r(37),r(10)),L=(r(73),r(31)),T=r(267),C=r(1403),P=r(3365),N=r(11),R=r(78),I=r.n(R),D=r(3722),M=(r(1397),r(1402)),F="ShareQrCodeLazyShow-module_skeletonPanel_OLLRv",G="ShareQrCodeLazyShow-module_skeletonTitle_-9VKp",U="ShareQrCodeLazyShow-module_skeletonImage_oIjcM",B="ShareQrCodeLazyShow-module_skeletonButton_VsITP",q=function(){return o.createElement("div",{className:F},o.createElement(M.a,{className:G,title:!0,paragraph:!1,active:!0}),o.createElement(M.a.Image,{className:U}),o.createElement(M.a,{className:B,title:!0,paragraph:!1,active:!0}))},V=(r(1196),r(954)),z=(r(3180),r(3482)),H=r(5),W=r.n(H),Y=r(213),K=r.n(Y),Q=r(46),Z=r(50),J=r(518),X=r(500),$=r(3309),ee=r(3355);function te(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return re(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return re(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var ne=function(e){var t=e.target_id,r=e.target_type,n=te(o.useState(0),2),a=n[0],i=n[1];return o.useEffect((function(){t&&["Book","Doc"].includes(r)&&Z.a.collaborations.count({target_type:r,target_id:t,status:X.STATUS.applying}).then((function(e){i((null==e?void 0:e.count)||0)}))}),[t,r]),o.createElement(z.a,{dot:a>0,offset:[-4,4],className:ee.a.dot},o.createElement(Q.b,{className:ee.a.inviteIcon,name:"icon-collaboratorlist",width:30}))},oe=function(e){var t=e.share,r=e.shareViewType,n=e.group,a=e.book,i=e.handlePanelShow;return o.createElement(o.Fragment,null,o.createElement(V.a.Item,{className:ee.a.firstItem,actions:[o.createElement(u.a,{title:__("链接添加协作者"),placement:"top",autoAdjustOverflow:!0,arrowPointAtCenter:!0},o.createElement("div",{key:"list-loadmore-edit",onClick:function(){return i($.c.inviteSelectorChannel)},"data-aspm-click":"c36321.d326999"},o.createElement(Q.b,{className:ee.a.inviteIcon,name:"addlink",width:30}))),o.createElement(u.a,{title:__("查看所有协作者"),placement:"top",autoAdjustOverflow:!0,arrowPointAtCenter:!0},o.createElement("div",{key:"list-loadmore-more",className:ee.a.inviteIconLi,onClick:function(){r===l.b.BOOK?Object(J.b)("/r/".concat(null==n?void 0:n.login,"/").concat(null==a?void 0:a.slug,"/collaborators")):r===l.b.DOC&&i($.c.collaboratorChannel)},"data-aspm-click":"c36321.d327000"},o.createElement(ne,{target_id:null==t?void 0:t.id,target_type:K()(r.toLowerCase())})))]},o.createElement(V.a.Item.Meta,{avatar:o.createElement(Q.b,{className:W()(ee.a.itemIcon,ee.a.appointIcon),name:"nav-invite",width:40}),title:o.createElement("span",null,__("添加协作者")),description:o.createElement("span",null,__("通过链接，邀请对方加入协作"))})))},ae=r(1407),ie=r(1863),ce=r(1864),ue=r(3406),le=r(32),se=r(52),fe=r(3744);function de(e){return de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},de(e)}function pe(e,t,r){return t=function(e){var t=function(e,t){if("object"!==de(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==de(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===de(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function he(){he=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==de(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(de(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function me(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function ye(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ve(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ve(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ve(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var ge=function(e){var t,r,a,i,c=e.canCollaborator,u=e.isShareActive,f=e.belongs,d=e.shareViewType,p=e.organization,h=e.group,m=e.book,y=e.share,v=e.me,g=e.handleScopeChange,b=ye(o.useState(!1),2),w=b[0],_=b[1],E=!(!p||null==p||!p.id),O=Object(P.a)(),S=null===(t=window.appData)||void 0===t||null===(r=t.settings)||void 0===r?void 0:r.user_certifications_share_scale,k=null===(a=window.appData)||void 0===a||null===(i=a.settings)||void 0===i?void 0:i.user_certifications_share_whitelist,x=Object(fe.a)(S)||k.includes(String(v.id)),j=o.useMemo((function(){var e=O.interests[se.INTEREST_CODE.create_public_resource];return e||E||d!==l.b.DOC||!x||(e=!0),e}),[h]),A=function(){var e;null===(e=window.__member_message_ref)||void 0===e||e.current.showMemberIntro(le.LIMIT_SCENE.share_public)},L=o.useMemo((function(){if(!u&&!j&&((null==p||!p.id)&&"User"===(null==h?void 0:h.type)))return h.id===v.id?__("会员可公开内容至互联网 {btn}",{btn:o.createElement("a",{onClick:A},__("购买会员"))}):__("联系知识库所有者购买会员可公开内容至互联网");return I()($.v,[f,Object($.k)(y,d,h,m)])}),[d,f,y,h,m]),T=o.useMemo((function(){return I()($.t,[f,u?"public":"private"])}),[f,u]),C=function(){var e,t=(e=he().mark((function e(){return he().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,_(!0),e.next=4,g(f===l.a.PERSON?N.PRIVACY.public:N.PRIVACY.intranet);case 4:return e.prev=4,_(!1),e.finish(4);case 7:case"end":return e.stop()}}),e,null,[[0,,4,7]])})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){me(a,n,o,i,c,"next",e)}function c(e){me(a,n,o,i,c,"throw",e)}i(void 0)}))});return function(){return t.apply(this,arguments)}}();return o.createElement(V.a.Item,{className:W()(pe({},ee.a.firstItem,!c)),actions:[!u&&(j||E)&&o.createElement(o.Fragment,null,o.createElement(n.a,{className:W()(ee.a.shareButton,ee.a.sharePublic),disabled:w,onClick:C},w?o.createElement(ae.default,{width:14,height:14,className:ee.a.loadingIcon}):__("公开")))]},o.createElement(V.a.Item.Meta,{avatar:u?o.createElement(ie.default,{width:40,height:40,className:W()(ee.a.itemIcon,ee.a.publicIcon)}):o.createElement(ce.default,{width:40,height:40,className:W()(ee.a.itemIcon,ee.a.publicIcon)}),title:o.createElement("span",{className:ee.a.itemTitle},T,!j&&o.createElement(ue.a,{className:ee.a.memberAbleIcon,isYuque:Object(s.a)(),group:h,organization:p})),description:L}))},be=(r(60),r(14)),we=r(1865),_e=r(956),Ee=r.n(_e),Oe=r(3467),Se=r(230),ke=function(e){var t,r=e.shareLink,a=e.isFileBook,i=e.privacy,c=e.belongs,u=e.shareViewType,s=e.organization,f=e.group,d=e.book,p=e.share,h=e.handleScopeChange,m=e.handlePanelShow,y=e.handlePanelType,v=e.handlePanelTitle,g=e.LazyShareQrCodeChannel,b=!(!s||null==s||!s.id),w=Object(C.c)(p,u,f,d).currentPassword,_=Object(C.b)(p,u,f,d).currentIndexedLevel,E=Object(C.e)(p,u,b),O=Object(Se.g)(f),S=[{type:"scopeSet",title:__("分享范围"),hidden:c===l.a.PERSON||c===l.a.ORG&&a,defaultValue:c!==l.a.PERSON?null===(t=$.q[c].actions.find((function(e){return e.value===i})))||void 0===t?void 0:t.label:null,icon:"icon-range"},{type:"passwordSet",title:__("密码访问"),defaultValue:w||__("无密码"),icon:"icon-key-2"},{type:"searchSet",title:$.r[u][c].action,hidden:a||O,defaultValue:1===_?__("已开启"):__("关闭"),icon:"help-search"},{type:"closeShareSet",title:__("关闭公开分享"),noDetail:!0,icon:"icon-cancellink"}];E&&S.unshift({type:"shareExpiredTimeSet",title:__("有效期"),defaultValue:E.expiredTime,icon:"nav-clock"});var k=o.useCallback((function(){if(null!=r&&r.url){Ee()((null==r?void 0:r.urlWithDesc)||r.url,{format:"text/plain"});var e=w?__("已复制链接和密码"):__("已复制链接");A.a.success(e,1)}}),[r]);return o.createElement("div",{className:ee.a.moreConfigs},o.createElement("div",{className:ee.a.shareLinkSet},o.createElement(be.a,{className:W()(ee.a.shareLinkShow,ee.a.qrCode),disabled:!0,placeholder:null==r?void 0:r.url}),o.createElement(n.a,{className:ee.a.shareButton,onClick:k},__("复制链接")),o.createElement(n.a,{className:ee.a.shareQrCode,onClick:function(){return m($.c.shareQrCodeChannel)},onMouseOver:function(){g.preload()}},o.createElement(we.default,{className:ee.a.shareQrCodeIcon,width:18,height:18}))),o.createElement(Oe.a,{settings:S,onClick:function(e,t){"closeShareSet"===e?h(N.PRIVACY.private):function(e,t){m($.c.shareChannels),y(e),v(t)}(e,t)}}))},xe=r(3743);function je(e){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},je(e)}function Ae(){Ae=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==je(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(je(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function Le(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function Te(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Le(a,n,o,i,c,"next",e)}function c(e){Le(a,n,o,i,c,"throw",e)}i(void 0)}))}}function Ce(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Pe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Pe(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Ne,Re=Object(T.b)((function(){return r.e(1291).then(r.bind(null,5639))})),Ie=function(e){var t=e.share,r=e.shareViewType,n=e.canShare,a=e.canCollaborator,i=void 0!==a&&a,c=e.isFileBook,u=void 0!==c&&c,s=e.showCollaborator,f=e.onlyCollaborator,d=e.belongs,p=e.beforeAttrsChange,h=e.onAttrsChange,m=e.organization,y=e.group,v=e.book,g=e.me,b=e.CollaboratorChannel,w=e.InviteSelectorChannel,_=Ce(o.useState(s?$.c.collaboratorChannel:$.c.sharePanel),2),E=_[0],O=_[1],S=Ce(o.useState(""),2),k=S[0],x=S[1],j=Ce(o.useState(""),2),T=j[0],R=j[1],M=Object(P.a)(),F=Ce(L.a.useModal(),2),G=F[0],U=F[1],B=o.useMemo((function(){return Object(C.d)(t,r,y,v)}),[t,r,y,v]),V=B.privacy,z=B.isShareActive,H=o.useMemo((function(){var e=Object($.k)(t,r,y,v);return d===l.a.INTERNAL&&V===N.PRIVACY.private&&(null==v?void 0:v.extend_private)===N.EXTEND_PRIVATE.BIND_DEPARTMENTS&&(e="extend_private"),I()($.d,[r,d,e])}),[r,d,t,y,v]),W=o.useMemo((function(){return Object(C.a)(t,r,y,v)}),[t,r,y,v]),Y=function(){var e=Te(Ae().mark((function e(n){return Ae().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(xe.a)(n,r,t,M,G,p,h,V);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),A.a.error((null===e.t0||void 0===e.t0?void 0:e.t0.message)||__("操作失败"));case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}(),K=function(){var e=Te(Ae().mark((function e(t){return Ae().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==h?void 0:h({encrypted_password:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Q=function(){var e=Te(Ae().mark((function e(t){var r;return Ae().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t?1:0,e.next=3,null==h?void 0:h({indexed_level:r});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return o.createElement(o.Fragment,null,o.createElement("div",{className:ee.a.sharePanel},n&&E===$.c.shareChannels&&o.createElement(D.a,{panelType:k,panelTitle:T,share:t,belongs:d,organization:m,group:y,book:v,me:g,shareViewType:r,handlePasswordChange:K,handleScopeChange:Y,handleSearchChange:Q,onBack:function(){return O($.c.sharePanel)}}),E===$.c.sharePanel&&o.createElement("div",{className:ee.a.main},o.createElement("div",{className:ee.a.mainIntro},n&&o.createElement("div",{className:ee.a.shareDescText},H),i&&o.createElement(oe,{share:t,shareViewType:r,group:y,book:v,handlePanelShow:function(e){return O(e)}}),n&&o.createElement(ge,{canCollaborator:i,isShareActive:z,belongs:d,shareViewType:r,organization:m,group:y,book:v,share:t,me:g,handleScopeChange:Y})),n&&z&&o.createElement(ke,{shareLink:W,isFileBook:u,privacy:V,belongs:d,shareViewType:r,organization:m,group:y,book:v,share:t,handleScopeChange:Y,handlePanelShow:function(e){return O(e)},handlePanelType:function(e){return x(e)},handlePanelTitle:function(e){return R(e)},LazyShareQrCodeChannel:Re})),i&&E===$.c.inviteSelectorChannel&&w&&o.createElement(w,{share:t,organization:m,group:y,book:v,shareViewType:r,onBack:function(){return O($.c.sharePanel)},inviteContent:"inviteSharePanel"}),i&&E===$.c.collaboratorChannel&&b&&o.createElement(b,{onlyCollaborator:f,share:t,organization:m,group:y,book:v,inviteContent:"collaboratorPanel",onBack:function(){return O($.c.sharePanel)}}),n&&z&&E===$.c.shareQrCodeChannel&&o.createElement(o.Suspense,{fallback:o.createElement(q,null)},o.createElement(Re,{share:t,shareViewType:r,link:null==W?void 0:W.url,onBack:function(){return O($.c.sharePanel)}}))),U)},De=r(1210),Me=r(480),Fe=r(2),Ge=r.n(Fe),Ue=r(1450),Be=r(3370),qe=r(790),Ve=(r(229),r(34)),ze=(r(279),r(138)),He=(r(498),r(100)),We=r(1698),Ye=r(499),Ke=r(116),Qe=(r(650),r(319)),Ze=r(1212),Je=r(3510),Xe={role:"RoleSelector-module_role_jDwZn",trigger:"RoleSelector-module_trigger_PbJ3K",active:"RoleSelector-module_active_lhpS5",icon:"RoleSelector-module_icon_YSGjG",up:"RoleSelector-module_up_BKR9i",menu:"RoleSelector-module_menu_MwfMA",label:"RoleSelector-module_label_JI2Gx",menuItem:"RoleSelector-module_menuItem_cwz56",desc:"RoleSelector-module_desc_lnp7h"};function $e(e){return $e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$e(e)}function et(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return tt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function rt(e,t,r){return t=function(e){var t=function(e,t){if("object"!==$e(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==$e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===$e(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var nt=(rt(Ne={},X.ROLE.edit,{label:Object(Je.c)(X.ROLE.edit),desc:__("拥有文档的编辑权限"),role:X.ROLE.edit}),rt(Ne,X.ROLE.readonly,{label:Object(Je.c)(X.ROLE.readonly),desc:__("仅拥有只读和评论权限"),role:X.ROLE.readonly}),Ne),ot=function(e){var t=et(Object(o.useState)(!1),2),r=t[0],n=t[1],i=e.role,c=e.placement,u=e.canChange,l=e.disableItems,s=e.externalActions,f=nt[i];if(!u)return a.a.createElement("span",{className:Xe.status,"data-collaboration-role":i},null==f?void 0:f.label);return a.a.createElement("div",{className:"role-selector"},a.a.createElement(Qe.a,{trigger:["click"],placement:c,onVisibleChange:function(e){n(e)},overlay:a.a.createElement(He.a,{selectedKeys:["".concat(i)],className:Xe.menu,style:{border:"none"}},[X.ROLE.edit,X.ROLE.readonly].map((function(t){var r=nt[t],o=l.includes(r.role);return a.a.createElement(He.a.Item,{key:"".concat(r.role),disabled:o,onClick:function(){return t=r.role,e.onChange(t),void n(!1);var t}},a.a.createElement("a",{className:Xe.menuItem,href:"#"},a.a.createElement("span",null,a.a.createElement("span",{className:Xe.label},r.label),a.a.createElement("span",{className:Xe.desc},r.desc)),a.a.createElement(Ze.default,{style:{color:"#25B864"}})))})),s&&s())},a.a.createElement("span",{className:W()(Xe.trigger,rt({},Xe.active,r)),"data-collaboration-role":i},null==f?void 0:f.label," ",a.a.createElement(Q.b,{name:"arrow-down",className:W()(Xe.icon,rt({},Xe.up,r)),width:16}))))};ot.propTypes={onChange:Ge.a.func,placement:Ge.a.string,canChange:Ge.a.bool,role:Ge.a.oneOf([X.ROLE.readonly,X.ROLE.edit]),externalActions:Ge.a.func,disableItems:Ge.a.array},ot.defaultProps={onChange:function(){},placement:"bottomRight",role:0,canChange:!0,disableItems:[]};var at=ot,it={joinUserItem:"Item-module_joinUserItem_0O6yw",userInfo:"Item-module_userInfo_F4pgj",showItem:"Item-module_showItem_sCn3R",avatar:"Item-module_avatar_JD1HW",userDesc:"Item-module_userDesc_q4mqR",name:"Item-module_name_ff-QM",selectorItem:"Item-module_selectorItem_UePAS",loginShow:"Item-module_loginShow_DePxA",login:"Item-module_login_bu7O2",department:"Item-module_department_y3daB",applyPending:"Item-module_applyPending_7Va+N",pending:"Item-module_pending_KikZW",pendingRole:"Item-module_pendingRole_mvO-A",topRightDesc:"Item-module_topRightDesc_dQW2s",actions:"Item-module_actions_Mfqej",actionItem:"Item-module_actionItem_piU3P",actionItemReject:"Item-module_actionItemReject_rSq40",actionItemLabel:"Item-module_actionItemLabel_kzYeZ",deleteActionItem:"Item-module_deleteActionItem_RJWcd",label:"Item-module_label_qLBXy",desc:"Item-module_desc_-+chL"};function ct(e){return ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ct(e)}function ut(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,st(n.key),n)}}function lt(e,t,r){return(t=st(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function st(e){var t=function(e,t){if("object"!==ct(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==ct(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===ct(t)?t:String(t)}function ft(){ft=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==ct(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(ct(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function dt(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function pt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ht(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ht(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ht(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function mt(e){var t=e.data,r=e.renderActions;return a.a.createElement("div",{"data-testid":"join-user-item",key:t.uid,className:it.joinUserItem,onClick:function(){t.ableToAdd()&&e.onAdd(t)}},a.a.createElement("div",{className:W()(it.userInfo,lt({},it.showItem,!t.isNewUser()))},a.a.createElement("span",{className:it.avatar},a.a.createElement(Ye.a,{src:t.avatar,name:t.name,size:"sm"})),a.a.createElement("div",{className:it.userDesc},function(e){var t,r=window.appData.isYuque,n=e.login||e.uid;if(!r){var o,i=(null===(o=e.data)||void 0===o?void 0:o.lastName)||e.login;return a.a.createElement("div",{className:W()(it.name,lt({},it.selectorItem,e.isNewUser()))},a.a.createElement("p",{className:it.loginShow},e.name,a.a.createElement("span",{className:it.login},__("（")+i+__("）"))),a.a.createElement("p",{className:it.department},e.department))}return a.a.createElement("div",{className:it.name},e.name,1!==(null===(t=e.collaborator)||void 0===t?void 0:t.status)?null:a.a.createElement("span",{className:it.login},__("（")+n+__("）")))}(t),!t.isGroupMember()&&!t.isGroupReadonlyMember()&&t.isInvited()&&!t.isMine()&&a.a.createElement("span",{className:it.topRightDesc},__("尚未加入")),!t.isGroupMember()&&!t.isGroupReadonlyMember()&&t.isApplying()&&a.a.createElement("div",{className:it.applyPending},a.a.createElement("span",{className:it.pending},__("申请权限")),a.a.createElement("span",{className:W()(it.pending,it.pendingRole)},"0"===t.role?__("可阅读"):__("可编辑"))))),a.a.createElement("div",{className:it.actions},r(e)))}var yt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),lt(this,"data",void 0),this.data=t}var t,r,n;return t=e,(r=[{key:"actionId",get:function(){throw new Error("需要实现这个对象")}},{key:"actionType",get:function(){throw new Error("需要实现这个对象")}},{key:"uid",get:function(){return this.data.uid}},{key:"id",get:function(){return this.data.id}},{key:"login",get:function(){return this.data.login}},{key:"name",get:function(){return this.data.name}},{key:"avatar",get:function(){return this.data.avatar_url}},{key:"role",get:function(){return this.data.role}},{key:"provider_type",get:function(){return this.data.provider_type}},{key:"provider_userid",get:function(){return this.data.provider_userid}}])&&ut(t.prototype,r),n&&ut(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),vt=function(e){if(!(e.data instanceof yt))throw new Error("data should be extend ItemBase");return mt(e)};vt.propTypes={data:Ge.a.object.isRequired,renderActions:Ge.a.func,onAgree:Ge.a.func,onReject:Ge.a.func,onDelete:Ge.a.func,onRoleChange:Ge.a.func,onAdd:Ge.a.func,limited:Ge.a.bool},vt.defaultProps={renderActions:function(e){var t=e.data,r=e.limited,o=a.a.useRef(null),i=pt(L.a.useModal(),2),c=i[0],u=i[1];if(t.ableToAdd())return null;if(t.isMine())return a.a.createElement("span",{className:it.actionItemLabel},__("你自己"));var l=function(e){var t=__("确认拒绝 ".concat(e," 的访问申请？")),r=__("确认要拒绝 ".concat(e," 的访问申请吗？"));return new Promise((function(e){c.confirm({icon:a.a.createElement(We.default,null),width:505,title:t,content:__("{desc}拒绝后该用户无法访问该文档。",{desc:r}),okText:__("拒绝"),cancelText:__("取消"),onOk:function(){e(!0)},onCancel:function(){e(!1)},getContainer:function(){return o.current||document.body}})}))},s=function(){var t,r=(t=ft().mark((function t(r){return ft().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l(r.name);case 2:if(t.sent){t.next=5;break}return t.abrupt("return");case 5:Object(Ke.spmClick)("c330513",{source:window.location.href.includes("source=auto_apply")?"auto_apply":"default",action:"refuse",infoType:"Doc"}),e.onReject(r);case 7:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(e){dt(a,n,o,i,c,"next",e)}function c(e){dt(a,n,o,i,c,"throw",e)}i(void 0)}))});return function(e){return r.apply(this,arguments)}}();return a.a.createElement(a.a.Fragment,null,t.isUpdateAbility()&&t.isApplying()&&a.a.createElement(a.a.Fragment,null,a.a.createElement(n.a,{type:"text",size:"small",onClick:function(){e.onAgree(t),Object(Ke.spmClick)("c330513",{source:window.location.href.includes("source=auto_apply")?"auto_apply":"default",action:"approve",infoType:"Doc"})},className:it.actionItem,"data-testid":"join-user-agree-button",disabled:r},__("同意")),a.a.createElement(n.a,{type:"text",size:"small",onClick:function(){s(t)},className:W()(it.actionItem,it.actionItemReject)},__("拒绝"))),t.isUpdateAbility()&&(t.isJoined()||t.isInvited())&&a.a.createElement(at,{role:parseInt(t.role,10),onChange:function(r){e.onRoleChange(t,r)},externalActions:function(){return a.a.createElement(He.a.Item,{key:"deleteItem-".concat(t.role)},a.a.createElement("a",{key:"deleteItem",className:it.deleteActionItem,"data-testid":"join-user-delete-button",onClick:function(){e.onDelete(t)}},a.a.createElement("span",null,a.a.createElement("span",{className:it.label},__("移除")),a.a.createElement("span",{className:it.desc},__("移除该协作者")))))},canChange:t.isUpdateAbility()}),u)}};var gt=vt;function bt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return wt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var _t=function(e){var t=bt(Object(o.useState)(""),2),r=t[0],n=t[1],i=e.renderItem,c=e.dataSource,u="searchSelector-".concat(+new Date);return a.a.createElement("div",{className:"join-user-search-selector",id:u},a.a.createElement("div",{className:"selector"},a.a.createElement(Ve.a,{mode:"multiple",labelInValue:!0,listHeight:354,value:[],placeholder:e.placeholder,notFoundContent:e.loading?a.a.createElement(ze.a,{justify:"block"}):r?e.renderNotFound():null,filterOption:!1,onSearch:function(t){n(t),e.onSearch(t)},onChange:e.onChange,onSelect:function(t,r){n("");var o=c.find((function(r){return r[e.key]===t.key}));o&&e.onSelect(o)},onBlur:function(){n(""),e.onBlur&&e.onBlur()},style:{width:"100%"},disabled:e.disableSearch,getPopupContainer:function(){return document.getElementById(u)}},c.map((function(t){return a.a.createElement(Ve.a.Option,{key:t[e.key],className:"selector-item",disabled:e.disableSelect(t)},a.a.createElement("div",{className:"full-item"},a.a.createElement(i,{data:t,onAgree:e.onAgree,onReject:e.onReject,onDelete:e.onDelete,onRoleChange:e.onRoleChange,onAdd:e.onAdd,renderActions:e.renderActions})),a.a.createElement("div",{className:"simple-item"},t[e.name]))})))))};_t.propTypes={dataSource:Ge.a.array,renderItem:Ge.a.func,renderNotFound:Ge.a.func,renderActions:Ge.a.func,key:Ge.a.string,name:Ge.a.string,disableSelect:Ge.a.func,onSearch:Ge.a.func,onChange:Ge.a.func,onSelect:Ge.a.func,onAgree:Ge.a.func,onReject:Ge.a.func,onDelete:Ge.a.func,onRoleChange:Ge.a.func,onAdd:Ge.a.func,onBlur:Ge.a.func,loading:Ge.a.bool,placeholder:Ge.a.string,disableSearch:Ge.a.bool},_t.defaultProps={key:"uid",name:"name",placeholder:__("搜索添加用户"),loading:!1,dataSource:[],renderItem:gt,renderNotFound:function(){return null},onSearch:function(){},onChange:function(){},onSelect:function(){},onAgree:function(){},onReject:function(){},onDelete:function(){},onRoleChange:function(){},onBlur:function(){},onAdd:function(){},disableSelect:function(){return!1},disableSearch:!1};var Et=_t,Ot="EmptyTip-module_emptyTip_aBtYt",St="EmptyTip-module_emptyImageWrapper_6BIQC",kt="EmptyTip-module_emptyImage_u42M6",xt="EmptyTip-module_emptyText_JUjEv",jt=function(){return a.a.createElement("div",{className:Ot},a.a.createElement("div",{className:St},a.a.createElement("img",{src:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*aSg9SJR6isIAAAAAAAAAAAAAARQnAQ",className:kt})),a.a.createElement("p",{className:xt},__("暂无文档协作者")))},At="List-module_item_Yt8gv",Lt=function(e){var t=e.dataSource,r=e.renderItem,n=e.limited,o=t.filter((function(e){return e.collaborator.status===X.STATUS.joined})),i=t.filter((function(e){return e.collaborator.status!==X.STATUS.joined}));return a.a.createElement(a.a.Fragment,null,!!i.length&&a.a.createElement(a.a.Fragment,null,null==i?void 0:i.map((function(t){return a.a.createElement("div",{key:t.id||t.login,className:At},a.a.createElement(r,{data:t,onAgree:e.onAgree,onReject:e.onReject,onDelete:e.onDelete,onRoleChange:e.onRoleChange,onAdd:e.onAdd,renderActions:e.renderActions,limited:n}))}))),!!o.length&&a.a.createElement(a.a.Fragment,null,null==o?void 0:o.map((function(t){return a.a.createElement("div",{key:t.id||t.login,className:At},a.a.createElement(r,{data:t,onAgree:e.onAgree,onReject:e.onReject,onDelete:e.onDelete,onRoleChange:e.onRoleChange,onAdd:e.onAdd,renderActions:e.renderActions}))}))))};Lt.propTypes={dataSource:Ge.a.array,onAgree:Ge.a.func,onReject:Ge.a.func,onDelete:Ge.a.func,onRoleChange:Ge.a.func,onAdd:Ge.a.func,renderItem:Ge.a.func,renderActions:Ge.a.func,limited:Ge.a.bool},Lt.defaultProps={dataSource:[],onAgree:function(){},onReject:function(){},onDelete:function(){},onRoleChange:function(){},onAdd:function(){},renderItem:gt};var Tt=Lt,Ct={title:"Modal-module_title_Fhe+q",menu:"Modal-module_menu_GTmMW",searchWrapper:"Modal-module_searchWrapper_G76nZ",searchSelector:"Modal-module_searchSelector_qZfrJ",searchAdd:"Modal-module_searchAdd_srKkd",btnLoadMore:"Modal-module_btnLoadMore_+NLxh",spinContainer:"Modal-module_spinContainer_6y18w",listWrapper:"Modal-module_listWrapper_YI-Wn"};function Pt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Nt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Nt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Nt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Rt=function(e){var t=e.collaboratorCount,r=Pt(a.a.useState(!1),2),n=r[0],o=r[1],i=window.appData,c=i.isYuque,u=i.organization,l=i.group,f=t>=qe.a.getDocCollaboratorLimit(l),d=!(Object(s.a)()&&(null==u||!u.id));return e.onLoading?a.a.createElement("div",{className:Ct.spinContainer},a.a.createElement(M.a,{title:!0,paragraph:!1,active:!0}),a.a.createElement(M.a,{avatar:!0,title:!0,paragraph:!1,active:!0}),a.a.createElement(M.a,{avatar:!0,title:!0,paragraph:!1,active:!0}),a.a.createElement(M.a,{avatar:!0,title:!0,paragraph:!1,active:!0}),a.a.createElement(M.a,{avatar:!0,title:!0,paragraph:!1,active:!0})):a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:Ct.content},c&&e.memberDocCollaboratorTip&&a.a.createElement(Ue.e,{collaboratorCount:e.collaboratorCount,user:l}),a.a.createElement("div",{className:Ct.searchWrapper},e.showSearch&&a.a.createElement("div",{className:Ct.searchSelector},a.a.createElement(Et,{loading:e.searchLoading,dataSource:e.searchData,placeholder:e.placeholder,onSelect:e.onSelect,onSearch:e.onSearch,onChange:e.onChange,onAgree:e.onAgree,onReject:e.onReject,onDelete:e.onDelete,onRoleChange:e.onRoleChange,onAdd:e.onAdd,onBlur:e.onBlur,disableSelect:e.disableSelect,disableSearch:e.disableSearch,renderNotFound:e.renderSearchNotFound,renderItem:e.renderItem,renderActions:e.renderActions})),d&&a.a.createElement("div",{className:Ct.searchAdd,onClick:function(){return o(!0)}},__("批量添加"))),e.dataSource.length>0?a.a.createElement("div",{className:Ct.listWrapper},a.a.createElement(Tt,{dataSource:e.dataSource,onAgree:e.onAgree,onReject:e.onReject,onDelete:e.onDelete,onRoleChange:e.onRoleChange,onAdd:e.onAdd,renderItem:e.renderItem,renderActions:e.renderActions,limited:c&&f}),e.moreLoading?a.a.createElement("div",{className:Ct.btnLoadMore},__("加载中...")):e.shouldLoadMore?a.a.createElement("div",{className:Ct.btnLoadMore,onClick:e.onLoadMore},__("加载更多")):null):a.a.createElement(jt,null)),n&&a.a.createElement(Be.a,{type:"doc",visible:n,onCancel:function(){return o(!1)},afterSubmit:function(){var t;o(!1),null===(t=e.onAdd)||void 0===t||t.call(e)}}))};Rt.propTypes={dataSource:Ge.a.array,shouldLoadMore:Ge.a.bool,onLoadMore:Ge.a.func,onAgree:Ge.a.func,onReject:Ge.a.func,onDelete:Ge.a.func,onRoleChange:Ge.a.func,onAdd:Ge.a.func,moreLoading:Ge.a.bool,renderItem:Ge.a.func,renderActions:Ge.a.func,dispatch:Ge.a.func,memberDocCollaboratorTip:Ge.a.bool,collaboratorCount:Ge.a.number,searchData:Ge.a.array,placeholder:Ge.a.string,disableSearch:Ge.a.bool,disableSelect:Ge.a.func,onSearch:Ge.a.func,onChange:Ge.a.func,onSelect:Ge.a.func,onBlur:Ge.a.func,searchLoading:Ge.a.bool,renderSearchNotFound:Ge.a.func,showSearch:Ge.a.bool,onLoading:Ge.a.bool},Rt.defaultProps={collaboratorCount:0,dataSource:[],searchData:[],shouldLoadMore:!1,moreLoading:!1,onLoadMore:function(){},showSearch:!0,disableSearch:!1};var It=Rt,Dt=r(320),Mt=r(3639),Ft=r(3329),Gt=r(3537),Ut="SearchNotFound-module_notfound_MSXOw",Bt="SearchNotFound-module_notfoundTitle_Br7DA",qt=function(){return a.a.createElement("div",{className:Ut},a.a.createElement("p",{className:Bt},__("未在空间中找到该用户，请检查输入或联系管理员添加到空间成员")))},Vt=function(){return a.a.createElement("div",{className:Ut},a.a.createElement("p",{className:Bt},__("未搜索到相关用户")))},zt=r(101);function Ht(e){return Ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ht(e)}function Wt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Yt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,a=void 0,a=function(e,t){if("object"!==Ht(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Ht(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===Ht(a)?a:String(a)),n)}var o,a}function Kt(e,t,r){return t&&Yt(e.prototype,t),r&&Yt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Qt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Zt(e,t)}function Zt(e,t){return Zt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Zt(e,t)}function Jt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Xt(e);if(t){var o=Xt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Ht(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Xt(e){return Xt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Xt(e)}var $t=function(e){Qt(r,e);var t=Jt(r);function r(e,n,o,a,i){var c;return Wt(this,r),(c=t.call(this,e)).collaborator=n,c.groupUser=o,c.target=a,c.book=i||a,c}return Kt(r,[{key:"department",get:function(){var e,t,r;return(null===(e=this.data)||void 0===e||null===(t=e.profile)||void 0===t?void 0:t.department)||(null===(r=this.data)||void 0===r?void 0:r.dep)||null}},{key:"actionId",get:function(){return this.collaborator.id}},{key:"actionType",get:function(){return this.collaborator.type}},{key:"uid",get:function(){return this.data.uid||Object(Ft.format)([this.data]),this.data.uid}},{key:"userId",get:function(){return this.data.id}},{key:"role",get:function(){return this.collaborator&&String(this.collaborator.role)}},{key:"workId",get:function(){return this.data.workid}},{key:"isUpdateAbility",value:function(){return this.target.abilities.create_collaborator}},{key:"isInvited",value:function(){return this.collaborator&&this.collaborator.status===X.STATUS.invited}},{key:"isJoined",value:function(){return this.collaborator&&this.collaborator.status===X.STATUS.joined}},{key:"isApplying",value:function(){return this.collaborator&&this.collaborator.status===X.STATUS.applying}},{key:"isGroupMember",value:function(){return this.groupUser&&this.groupUser.role!==zt.ROLE.readonly}},{key:"isGroupReadonlyMember",value:function(){return this.groupUser&&this.groupUser.role===zt.ROLE.readonly}},{key:"isMine",value:function(){return window.appData.me.login===this.login}},{key:"isNewUser",value:function(){return this.isUpdateAbility()&&!this.isMine()&&!this.isApplying()&&!this.isJoined()&&!this.isInvited()}},{key:"ableToAdd",value:function(){return this.isNewUser()}}]),r}(yt),er=function(e){Qt(r,e);var t=Jt(r);function r(e,n,o,a){var i,c;return Wt(this,r),(c=t.call(this,e)).collaborator=e,c.user=e.owner,c.collaborator.owner_id=null===(i=c.user)||void 0===i?void 0:i.id,c.groupUser=n,c.target=o,c.book=a||o,c.departments=e.departments,c}return Kt(r,[{key:"department",get:function(){var e;return null!==(e=this.departments)&&void 0!==e&&e.length?this.departments.map((function(e){return e.name})).join("-"):null}},{key:"ownerType",get:function(){return this.collaborator.owner_type}},{key:"actionId",get:function(){return this.collaborator.id}},{key:"actionType",get:function(){return this.collaborator.type}},{key:"uid",get:function(){return this.user.uid||Object(Ft.format)([this.user]),this.user.uid}},{key:"userId",get:function(){return this.user.id}},{key:"role",get:function(){return String(this.collaborator.role)}},{key:"login",get:function(){return this.user.login}},{key:"name",get:function(){return this.user.name}},{key:"avatar",get:function(){return this.user.avatar_url}},{key:"workId",get:function(){return this.user.workid}},{key:"isUpdateAbility",value:function(){return this.target.abilities.create_collaborator}},{key:"isInvited",value:function(){return this.collaborator.status===X.STATUS.invited}},{key:"isJoined",value:function(){return this.collaborator.status===X.STATUS.joined}},{key:"isApplying",value:function(){return this.collaborator.status===X.STATUS.applying}},{key:"isGroupMember",value:function(){return this.groupUser&&this.groupUser.role!==zt.ROLE.readonly}},{key:"isGroupReadonlyMember",value:function(){return this.groupUser&&this.groupUser.role===zt.ROLE.readonly}},{key:"isMine",value:function(){return window.appData.me.login===this.login&&this.isUser()}},{key:"isNewUser",value:function(){return this.isUpdateAbility()&&!this.isMine()&&!this.isApplying()&&!this.isJoined()&&!this.isInvited()}},{key:"ableToAdd",value:function(){return this.isNewUser()}},{key:"isUser",value:function(){return this.ownerType===X.OWNER_TYPE.User}}]),r}(yt);function tr(e){return tr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tr(e)}function rr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function nr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rr(Object(r),!0).forEach((function(t){or(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function or(e,t,r){return t=function(e){var t=function(e,t){if("object"!==tr(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==tr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===tr(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ar(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ir(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ir(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ir(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var cr=function(e){var t=e.group,r=e.book,n=e.doc,i=e.organization,c=e.dispatch,u=e.isEditing,l=e.onReverting,s=window.appData.isYuque,f=ar(Object(o.useState)(0),2),d=f[0],p=f[1],h=ar(Object(o.useState)(0),2),m=h[0],y=h[1],v=ar(Object(o.useState)(!1),2),g=v[0],b=v[1],w=ar(Object(o.useState)(!1),2),_=w[0],E=w[1],O=ar(Object(Mt.c)(n,{dispatch:c,book:r,group:t,isEditing:u}),5),S=O[0],k=O[1],x=O[2],j=O[3],L=O[4],T=ar(Object(Mt.e)(n,{dispatch:c,organization:i,optional_properties:"profile"}),4),C=T[0],P=T[1],N=T[2],R=T[3],I=function(e){Z.a.collaborations.count({target_type:"Doc",target_id:e.id}).then((function(e){y((null==e?void 0:e.count)||0)}))},D=function(e){return c({type:"proxy.web/collaborations.find",payload:{data:{target_type:"Doc",target_id:e.id,offset:d,optional_properties:"departments"},reducer:0===d?"doc/updateCollaborations":"doc/addCollaborations"}}).then((function(e){200===e.length&&E(!0)}))};Object(o.useEffect)((function(){var e;e=n,b(!0),D(e).then((function(){b(!1)})).catch((function(e){b(!1)})),c({type:"proxy.web/groups.users",payload:{data:{id:t.id},reducer:"group/updateMembers"}}),I(n)}),[n.id,t.id]);var M=function(e){c({type:"proxy.web/collaborations.destroy",payload:{data:{id:e.actionId,type:e.actionType},reducer:"doc/removeCollaboration"}}).then((function(){var t=!e.isMine()&&!e.isApplying();A.a.success(a.a.createElement("span",null,__("操作成功"),t&&a.a.createElement("a",{className:Gt.a.revertLink,onClick:function(){l&&l(),A.a.destroy(),c({type:"doc/addCollaborator",payload:{data:e.collaborator}}).then((function(){A.a.success(__("撤销成功!")),D(n),I(n)}))}},__("撤销"))),3),I(n)}))},F=s&&m>=qe.a.getDocCollaboratorLimit(t);Object(Ft.format)(t.members.map((function(e){return e.user}))),Object(Ft.format)(n.collaborations.map((function(e){return e.owner})));var G=C.map((function(e){var o=t.members.find((function(t){var r;return(null===(r=t.user)||void 0===r?void 0:r.uid)===e.uid})),a=n.collaborations.find((function(t){var r;return(null===(r=t.owner)||void 0===r?void 0:r.uid)===e.uid}));return new $t(e,a,o,n,r)})),U=n.collaborations.map((function(e){var o=t.members.find((function(t){var r,n;return(null===(r=t.user)||void 0===r?void 0:r.uid)===(null===(n=e.owner)||void 0===n?void 0:n.uid)}));return new er(e,o,n,r)}));return a.a.createElement(It,{memberDocCollaboratorTip:s&&!!n,collaboratorCount:m,placeholder:__("输入用户名邀请协作"),dataSource:U,link:S,onRefreshLink:k,linkLoading:x,checked:j,onCheckChange:L,searchData:G,onSearch:P,onSelect:function(e){e.ableToAdd()&&function(e){var t={target_type:"Doc",target_id:n.id,role:X.ROLE.edit};e.userId?t.user_id=e.userId:t=nr(nr({},t),{},{login:e.login,workid:e.workId,name:e.name,provider_type:e.provider_type,provider_userid:e.provider_userid}),c({type:"proxy.web/collaborations.create",payload:{data:t,reducer:"doc/addOneCollaboration"}}).then((function(){A.a.success(__("添加成功")),setTimeout((function(){I(n),D(n)}),100)}))}(e),R(e)},onBlur:R,disableSelect:function(e){return F||e&&!e.ableToAdd()},disableSearch:F,searchLoading:N,onAgree:function(e){c({type:"proxy.web/collaborations.approve",payload:{data:{id:e.actionId},reducer:"doc/updateOneCollaboration"}}).then((function(e){var t=__("已同意用户 {member} 加入",{member:e.owner.name});A.a.success(t),I(n)}))},onReject:M,onDelete:M,onRoleChange:function(e,t){c({type:"proxy.web/collaborations.update",payload:{data:{id:e.actionId,role:t},reducer:"doc/updateOneCollaboration"}}).then((function(){A.a.success(__("更新成功")),I(n)}))},onAdd:function(){D(n),I(n)},disableInvite:F,onLoadMore:function(){p(d+200),D(n)},shouldLoadMore:_,onLoading:g,showSearch:n.abilities.create_collaborator,showJoinLink:n.abilities.create_collaborator,renderSearchNotFound:i&&i.id?qt:Vt})};cr.propTypes={dispatch:Ge.a.func.isRequired,organization:Ge.a.object.isRequired,group:Ge.a.object.isRequired,book:Ge.a.object.isRequired,doc:Ge.a.object.isRequired,isEditing:Ge.a.bool,onReverting:Ge.a.func};var ur=Object(Me.d)((function(e){return e}))(Object(Dt.b)(cr)),lr=r(3475),sr=r(3472);function fr(e){return fr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fr(e)}function dr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function pr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?dr(Object(r),!0).forEach((function(t){hr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function hr(e,t,r){return t=function(e){var t=function(e,t){if("object"!==fr(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==fr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===fr(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var mr=function(e){var t,r=e.share,n=e.shareViewType,a=e.isEditing,i=e.inviteContent,c=e.organization,u=e.group,s=e.book,f=e.onBack,d=e.onToggleCollaboratorShow,p={type:n.toLowerCase(),book:s,group:u,organization:c};n===l.b.DOC&&(t=pr(pr({},p),{},{doc:r}));var h,m=o.useMemo((function(){return sr.a.create(t||p)}),[t,p]);return m&&m.enable&&(h={id:sr.a.id,title:sr.a.title,inviteSelectorType:n.toLowerCase(),getJoinUrl:m.getUrl,getToken:m.getToken,updateToken:m.updateToken,deleteTokens:m.deleteTokens,getCopyText:m.getCopyText,inviteModalContent:i,onBackShare:f,moreSettingOptions:m.getMoreSettingOptions(),organization:c,isEditing:a,inviteTarget:r,toggleCollaboratorList:function(e){null==d||d(e)}}),o.createElement(o.Fragment,null,o.createElement(lr.a,h))},yr=r(3337);function vr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return gr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gr(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function gr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var br=function(e){var t=e.onlyCollaborator,r=e.share,n=e.inviteContent,a=e.organization,i=e.group,c=e.book,u=e.onBack,l=vr(o.useState(!0),2),s=l[0],f=l[1];return o.createElement(o.Fragment,null,s&&o.createElement("div",{className:W()(yr.a.shareDetailSettingPanel,yr.a.collaborator)},t?o.createElement("div",{className:yr.a.title},__("文档协作者")):o.createElement("div",{className:yr.a.title,onClick:u},o.createElement(De.default,{className:yr.a.backIcon,width:20,height:20}),__("文档协作者"))),s&&o.createElement("div",{className:yr.a.collaboratorContent},o.createElement(ur,null)),o.createElement(mr,{share:r,organization:a,group:i,book:c,shareViewType:"DOC",isEditing:!0,inviteContent:n,onToggleCollaboratorShow:function(e){return f(e)}}))};function wr(){return wr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},wr.apply(this,arguments)}var _r=function(e){return o.createElement(i.a,{withFallbackUI:!0,noMessage:!0,fallbackUI:function(){return o.createElement(n.a,null,__("分享"))}},o.createElement(j,wr({panel:Ie,CollaboratorChannel:br,InviteSelectorChannel:mr},e)))}},3726:function(e,t,r){"use strict";r.d(t,"b",(function(){return E})),r.d(t,"c",(function(){return O})),r.d(t,"d",(function(){return S})),r.d(t,"a",(function(){return k}));r(1346);var n=r(815),o=r(0),a=r.n(o),i=r(3596),c=r(3730),u=r(1382),l=r(3607),s=r(3638),f=r(3528),d=function(e){var t=e.content,r=e.actions;return a.a.createElement("div",null,a.a.createElement("div",{className:f.a.descCard},a.a.createElement(u.a,null,Object(s.a)(t))),r&&a.a.createElement(l.a,{actions:r}))},p=r(480),h=function(e){var t=e.img,r=e.actions,n=Object(p.f)((function(e){return e.group}));return a.a.createElement("div",null,a.a.createElement("div",{className:f.a.mediaCard},a.a.createElement("img",{className:f.a.mediaCardImg,src:t})),a.a.createElement(l.a,{actions:r,group:n}))};function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return y(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return y(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function v(){var e=m(Object(o.useState)(!1),2),t=e[0],r=e[1];return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:f.a.button,onClick:function(){return r(!0)}},__("立即体验")),t&&a.a.createElement(i.default,{isModalVisible:t,handleCancel:function(){return r(!1)}}))}var g=window.appData,b=g.isYuque,w=g.defaultSpaceHost,_=g.me,E={route:{path:["/:group","/r/:group"],key:"1"},collapseProps:{defaultActiveKey:"1"},header:{title:__("欢迎来到团队"),desc:__("在团队里，和成员一起协作，让过程有沉淀，沟通有质量，执行更有序。")},collapseList:[{key:"1",title:__("用知识库管理团队文档和知识"),content:{img:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*-vF0Qoz_udUAAAAAAAAAAAAAARQnAQ",render:h,actions:[{render:function(){return a.a.createElement(v,null)}},{title:__("了解更多"),onClick:function(){return window.open(b?"https://www.yuque.com/yuque/thyzgp/repository":"https://yuque.antfin.com/lark/bsgp0v/repository")}}]}},{key:"2",title:__("用任务将想法变成可执行的行动"),content:{img:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*y1aUQbzdKSoAAAAAAAAAAAAAARQnAQ",render:h,actions:[{title:__("立即体验"),onClick:function(e){var t=e.history,r=e.group;t.push("/r/".concat(r.login,"/issues?clickMark=createModal"))}},{title:__("了解更多"),onClick:function(){return window.open(b?"https://www.yuque.com/yuque/rvzzxz/cmcg4n":"https://yuque.antfin.com/lark/zp2v9g/lgmx3y")}}]}},{key:"3",title:__("用话题和成员进行重要议题讨论"),hidden:function(e){var t,r=e.group;return null==r||null===(t=r.settings)||void 0===t?void 0:t.thread_enable},content:{img:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*MUArR6wqhwwAAAAAAAAAAAAAARQnAQ",render:h,actions:[{title:__("立即体验"),onClick:function(e){var t=e.history,r=e.group;return t.push("/r/".concat(r.login,"/thread?clickMark=createModal"))}},{title:__("了解更多"),onClick:function(){return window.open(b?"https://www.yuque.com/yuque/rvzzxz/pe0o80":"https://yuque.antfin.com/lark/zp2v9g/ppg4yz")}}]}},{key:"4",title:__("邀请成员加入团队协作"),content:{img:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*FGX_S6zzMBIAAAAAAAAAAAAAARQnAQ",render:h,actions:[{title:__("立即体验"),onClick:function(e){var t=e.history,r=e.group;return t.push("/".concat(r.login,"/members"))}},{title:__("了解更多"),onClick:function(){return window.open(b?"https://www.yuque.com/yuque/rvzzxz/mgo5il":"https://yuque.antfin.com/lark/zp2v9g/eri1hn")}}]}}]},O={route:{path:["/dashboard/org_wiki"],key:"feature_org_wiki_introduce"},collapseProps:{defaultActiveKey:"1"},header:{title:__("欢迎来到公共区")},collapseList:[{key:"1",title:__("公共区是组织内知识沉淀的阵地"),content:{img:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*feHUQqTfcXoAAAAAAAAAAAAAARQnAQ",render:c.a,content:{render:function(){return a.a.createElement(n.a,null,__("公共区是面向空间全员的，让组织内的知识得以系统性地沉淀并创造价值。"))}},actions:[{title:__("了解更多"),onClick:function(){return window.open("https://www.yuque.com/yuque/rvzzxz/dthulx")}}]}},{key:"2",title:__("用知识库管理空间文档和知识"),content:{img:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*dBmQQZ5DnpIAAAAAAAAAAAAAARQnAQ",render:c.a,content:{render:function(){return a.a.createElement(a.a.Fragment,null,a.a.createElement(n.a,{style:{marginBottom:8}},__("知识库就像书一样，通过强大的目录功能，让多篇文档结构化地呈现。")))}},actions:[{render:function(){return a.a.createElement(v,null)}},{title:__("了解更多"),onClick:function(){return window.open("https://www.yuque.com/yuque/thyzgp/repository")}}]}}]},S={route:{path:["/:any"],key:"feature_org_wiki_introduce"},collapseProps:{defaultActiveKey:"1"},header:{title:__("欢迎来到语雀"),desc:__("使用语雀开启个人知识管理 3.0 之旅吧")},collapseList:[{key:"1",title:__("用小记记录碎片化内容"),content:{img:"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*43l-Qr5Iz3cAAAAAAAAAAAAADvuFAQ/original",render:c.a,content:{render:function(){return null}},actions:[{title:__("立即体验"),onClick:function(){return window.open("".concat(w,"/dashboard/notes"))}},{title:__("了解更多"),onClick:function(){window.open(b?"https://www.yuque.com/yuque/ekrzd1/dqdt6f":"https://yuque.antfin.com/lark/note/faq")}}]}},{key:"2",title:__("用知识库沉淀结构化知识"),content:{img:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*feHUQqTfcXoAAAAAAAAAAAAAARQnAQ",render:c.a,content:{render:function(){return null}},actions:[{render:function(){return a.a.createElement(v,null)}},{title:__("了解更多"),onClick:function(){window.open(b?"https://www.yuque.com/yuque/thyzgp/repository":"https://yuque.antfin.com/lark/bsgp0v/repository")}}]}},{key:"3",title:__("开启我的花园分享知识"),content:{img:"https://gw.alipayobjects.com/mdn/prod_resource/afts/img/A*ljInRZpwD6UAAAAAAAAAAAAAARQnAQ",render:c.a,content:{render:function(){return null}},actions:[{title:__("立即体验"),onClick:function(){return window.open("".concat(w,"/").concat(_.login))}},{title:__("了解更多"),onClick:function(){window.open(b?"https://www.yuque.com/yuque/mgcsc6/sc1leq":"https://yuque.antfin.com/lark/xwhu77/lhqpnw")}}]}}]},k={route:{path:["/:group"],key:"feature_garden_introduce"},collapseProps:{defaultActiveKey:"1"},header:{title:__("欢迎来到花园")},collapseList:[{key:"1",title:__("「我的花园」是什么？"),content:{img:"https://gw.alipayobjects.com/mdn/prod_resource/afts/img/A*ljInRZpwD6UAAAAAAAAAAAAAARQnAQ",render:c.a,content:{render:function(){return a.a.createElement(n.a,null,__("这是你的私人花园，也是你对世界的一扇窗。在这里尽情地分享知识、展现个性、表达自我，并连接其他知识工作者，大家一起共同成长。"))}},isGarden:!0,actions:[{title:__("了解理念"),onClick:function(){return window.open("https://www.yuque.com/yuque/mgcsc6/xtgy5c")}}]}},{key:"2",title:__("如何把「私密」花园公开？"),content:{render:d,content:{render:function(){return a.a.createElement(n.a,null,__("花园默认是「私密」的，语雀会员可以把花园对全互联网的访客开放。正在打理阶段的花园可以准备好后再进行公开。"))}},actions:[{title:__("详细了解"),onClick:function(){return window.open("https://www.yuque.com/yuque/mgcsc6/nf0giqstfxxcs5n0")}}]}},{key:"3",title:__("如何使用「我的花园」？"),content:{render:d,content:{render:function(){return a.a.createElement(n.a,null,__("你可以写一个文档介绍自己，并把多个公开知识库展示在花园中。「我的花园」对互联网公开后，喜欢你的朋友会来关注你。"))}},actions:[{title:__("了解添加知识库"),onClick:function(){return window.open("https://www.yuque.com/yuque/mgcsc6/yr7g5m")}},{title:__("了解自定义介绍"),onClick:function(){return window.open("https://www.yuque.com/yuque/mgcsc6/obl3qs")}}]}},{key:"4",title:__("如何使用「更新」？"),content:{render:d,content:{render:function(){return a.a.createElement(n.a,null,__("互联网公开的文档和小记可以被分享到花园-「更新」。同时，如果「我的花园」是对互联网公开的，那么分享的公开文档和小记也会推送到粉丝的「逛逛-关注」里。"),a.a.createElement("div",null,a.a.createElement("a",{href:"",target:"_blank"},__(""))))}},actions:[{title:__("详细了解"),onClick:function(){return window.open("https://www.yuque.com/yuque/mgcsc6/nl73wd")}}]}}]}},3729:function(e,t,r){"use strict";var n=r(0),o=r.n(n),a=r(1382),i=r(1445),c=r(480),u=r(5),l=r.n(u),s=r(3638),f=r(3528);t.a=function(e){var t=e.children,r=e.prefixCls,n=e.handleVisibleChange,u=e.header,d=Object(c.f)((function(e){return e.me}));return o.a.createElement("div",{className:l()(r,f.a.content),"data-testid":"introduce"},o.a.createElement("div",{className:f.a.header},o.a.createElement(a.a,{variant:"headline4",mr:38},Object(s.b)(u.title,d)),o.a.createElement(a.a,{mt:5},Object(s.b)(u.desc,d)),o.a.createElement("div",{className:f.a.closeWrapper,onClick:function(){return null==n?void 0:n(!1)}},o.a.createElement("span",{className:f.a.close},o.a.createElement(i.default,{width:12,height:12})))),t)}},3730:function(e,t,r){"use strict";var n=r(0),o=r.n(n),a=r(5),i=r.n(a),c=r(1382),u=r(3638),l=r(3607),s=r(3528);function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function d(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==f(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===f(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}t.a=function(e){var t=e.img,r=e.content,n=e.isGarden,a=e.actions;return o.a.createElement("div",null,o.a.createElement("div",{className:i()(s.a.mediaCard,d({},s.a.mediaCardGarden,n))},o.a.createElement("img",{className:s.a.mediaCardImg,src:t})),o.a.createElement(c.a,{mt:12,className:s.a.mediaBody},Object(u.a)(r)),a&&o.a.createElement(l.a,{actions:a}))}},3733:function(e,t,r){"use strict";r.d(t,"a",(function(){return x}));var n=r(35),o=r(0),a=r.n(o),i=r(3878),c=r(3859),u=r(3729),l=r(5),s=r.n(l),f=r(1382),d=r(46),p=r(1004),h=r(1222),m=r(480),y=r(3638),v=r(3528);function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}function b(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==g(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==g(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===g(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var E=function(e){var t=e.header,r=e.active,n=e.children,o=w(Object(h.a)(),2),i=o[0],c=o[1].height,u=r?c:0;return a.a.createElement("div",{className:s()(v.a.collapsePanel,b({},v.a.collapsePanelActive,r))},t,a.a.createElement("div",{className:v.a.collapsePanelContent,style:{height:u}},a.a.createElement("div",{ref:i},n)))},O=function(e){var t=e.collapseList,r=e.collapseProps,n=w(Object(o.useState)(null==r?void 0:r.defaultActiveKey),2),i=n[0],c=n[1],u=Object(p.a)(i),l=Object(m.f)((function(e){return{group:e.group,me:e.me}})),h=Object(o.useMemo)((function(){return function(e){var t=u.current===e?"arrow-down":"arrow-right";return a.a.createElement(d.b,{name:t,size:16})}}),[]);return a.a.createElement("div",{className:s()(v.a.collapse,null==r?void 0:r.className)},t.filter((function(e){var t,r;return null===(t=null===(r=e.hidden)||void 0===r?void 0:r.call(e,l))||void 0===t||t})).map((function(e){var t=a.a.createElement("div",{className:v.a.collapseHeader,onClick:function(){return function(e){if(e===i)return c(null);c(e)}(e.key)}},a.a.createElement(f.a,{component:"span",variant:"title",type:"strong"},e.title),a.a.createElement("div",{className:v.a.placeholder}),a.a.createElement("div",{className:v.a.collapseHeaderArrow},h(e.key)));return a.a.createElement(E,{key:e.key,header:t,active:e.key===i},Object(y.a)(e.content))})))},S=r(3726);function k(){return k=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},k.apply(this,arguments)}var x=function(e){var t=e.conf,r=e.prefixCls,n=e.handleVisibleChange;return a.a.createElement(u.a,{prefixCls:r,header:t.header,handleVisibleChange:n},a.a.createElement(i.a,null),a.a.createElement(O,{collapseList:t.collapseList,collapseProps:t.collapseProps}))};t.b=function(e){var t=e.prefixCls,r=e.handleVisibleChange,i=Object(c.a)(),u=i.isInGarden,l=i.isInGroup,s=i.isInOrgWiki,f=i.isInPersonal,d=Object(o.useMemo)((function(){return u?[S.a]:l?[S.b]:s?[S.c]:f?[S.d]:[]}),[u,l,s,f]);return a.a.createElement(n.Switch,null,d.map((function(e){return a.a.createElement(n.Route,k({},e.route,{render:function(){return a.a.createElement(x,{conf:e,prefixCls:t,handleVisibleChange:r})}}))})))}},3740:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return o}));var n="https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*Aj06T7NnHngAAAAAAAAAAAAADvuFAQ/original",o="https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*wPMVTriBo40AAAAAAAAAAAAAARQnAQ"},3749:function(e,t,r){"use strict";r(3228);var n=r(1563);r(3207);t.a=n.a},3750:function(e,t,r){"use strict";var n;function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==o(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===o(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,"a",(function(){return i})),r.d(t,"e",(function(){return c})),r.d(t,"d",(function(){return u})),r.d(t,"c",(function(){return l})),r.d(t,"f",(function(){return s})),r.d(t,"b",(function(){return f}));var i={generateSheet:"generateSheet",generateFormula:"generateFormula"},c={user:"user",ai:"ai"},u={modelError:"modelError",netError:"netError"},l=(a(n={},u.modelError,__("作为一个人工智能语言模型，这个问题超出我目前的学习范围了，您可以问我其他问题，我将尽力为您解答")),a(n,u.netError,__("网络异常，请稍后重试")),n),s=Object.keys(l),f={format:"lakesheet",version:"3.5.5",larkJson:!0,sheet:"",calcChain:[],vessels:{},useUTC:!0,useIndex:!0,customColors:[],meta:{sort:0,shareFilter:0},formulaCalclated:!0}},3752:function(e,t,r){"use strict";r(143);var n=r(67),o=(r(41),r(9)),a=r(0),i=r.n(a),c=r(2),u=r.n(c),l=r(64),s=r.n(l),f=r(1617),d=r(5),p=r.n(d),h=r(320),m=r(3627),y=r(951),v=r(148),g=r(22),b=(r(178),r(68)),w=(r(60),r(14)),_=(r(161),r(23)),E=(r(381),r(132)),O=(r(37),r(10)),S=r(956),k=r.n(S),x=r(281),j=r(825);function A(e){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A(e)}function L(){L=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(N([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==A(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(A(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function T(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return P(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return P(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function N(e){var t,r=e.version,n=e.active,o=e.withUser,a=void 0===o||o,c=e.disableVersionStatus;return i.a.createElement("div",{className:p()("doc-version",{"doc-version-active":n})},i.a.createElement("div",{className:"doc-version-basic"},i.a.createElement("span",{className:"doc-version-name"},i.a.createElement(x.a,{time:r.created_at})),!c&&r.local&&r.draft&&i.a.createElement(E.a,{className:"doc-version-status"},__("离线保存")),!c&&!r.local&&!r.draft&&i.a.createElement(E.a,{className:"doc-version-status"},__("已发布")),!c&&r.origin===j.ORIGIN.cache&&i.a.createElement(E.a,{className:"doc-version-status"},__("离线缓存备份"))),a&&i.a.createElement("div",{className:"doc-version-user"},null==r||null===(t=r.user)||void 0===t?void 0:t.name))}function R(e){var t,r=e.version,o=e.active,c=C(Object(a.useState)(!1),2),u=c[0],l=c[1],s=C(Object(a.useState)(!1),2),f=s[0],d=s[1],h=C(Object(a.useState)(r.name||"版本名"),2),m=h[0],y=h[1],v=C(_.a.useForm(),1)[0],g=function(){var t,n=(t=L().mark((function t(){var n,o;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,v.validateFields();case 3:if(n=t.sent,(o=n.name.trim())===r.name){t.next=8;break}return t.next=8,e.onUpdate(r,{name:o});case 8:y(o),l(!1),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),console.log(t.t0);case 15:case"end":return t.stop()}}),t,null,[[0,12]])})),function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(e){T(a,n,o,i,c,"next",e)}function c(e){T(a,n,o,i,c,"throw",e)}i(void 0)}))});return function(){return n.apply(this,arguments)}}();return i.a.createElement("div",{className:p()("doc-version",{"doc-version-active":o}),onMouseEnter:function(){u||d(!0)},onMouseLeave:function(){d(!1)}},i.a.createElement("div",{className:"doc-version-basic"},u?i.a.createElement(_.a,{form:v,layout:"vertical"},i.a.createElement(_.a.Item,{initialValue:m,name:"name",rules:[{required:!0,message:__("请输入版本名称")},{max:40,message:__("最多 40 个字符")}],style:{marginBottom:0}},i.a.createElement(w.a,{className:"doc-version-name-input",onPressEnter:g,onBlur:g}))):i.a.createElement("span",{className:"doc-version-name",title:m},m)),i.a.createElement("div",{className:"doc-version-time"},i.a.createElement(x.a,{time:r.created_at})),i.a.createElement("div",{className:"doc-version-user"},null==r||null===(t=r.user)||void 0===t?void 0:t.name),f&&i.a.createElement("div",{className:"doc-version-actions"},i.a.createElement("span",{className:"doc-version-action",onClick:function(){l(!0),d(!1)}},i.a.createElement(n.a,{title:__("修改版本名称")},i.a.createElement("span",{className:"larkicon larkicon-edit"}))),i.a.createElement(b.a,{title:__("确认删除这个版本吗？"),onConfirm:function(){e.onDelete(r)},okText:__("删除"),cancelText:__("取消"),placement:"topRight"},i.a.createElement("span",{className:"doc-version-action"},i.a.createElement(n.a,{title:__("删除该版本")},i.a.createElement("span",{className:"larkicon larkicon-delete"}))))))}N.defaultProps={withUser:!0,active:!1},N.propTypes={version:u.a.object.isRequired,active:u.a.bool,withUser:u.a.bool},R.propTypes={version:u.a.object.isRequired,active:u.a.bool,onDelete:u.a.func.isRequired,onUpdate:u.a.func.isRequired};var I={NormalVersion:N,CopyUrl:function(e){var t=e.version;return e.doc,i.a.createElement(o.a,{"data-testid":"copy-version-link",onClick:function(){k()("".concat(window.location.origin,"/r/doc_versions/").concat(t.id)),O.a.success(__("链接已复制"))}},__("复制版本链接"))},NamedVersion:R,Name:function(e){var t=e.version,r=e.category,n=e.maxWidth,o=i.a.createElement(x.a,{time:t.created_at}),a={};return n&&(a.maxWidth=n),i.a.createElement("span",{className:"doc-version-name",style:a},"named_version"===r&&t.name||o)}};I.Name.propTypes={version:u.a.object.isRequired,category:u.a.string,maxWidth:u.a.number};var D=I,M=r(3577),F=(r(1196),r(954)),G=(r(625),r(200)),U=(r(793),r(296)),B=r(46),q=r(3740),V=r(522);function z(e){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z(e)}function H(){H=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==z(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(z(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function W(e){return function(e){if(Array.isArray(e))return ee(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||$(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Y(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function K(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Y(a,n,o,i,c,"next",e)}function c(e){Y(a,n,o,i,c,"throw",e)}i(void 0)}))}}function Q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(r),!0).forEach((function(t){J(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function J(e,t,r){return t=function(e){var t=function(e,t){if("object"!==z(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===z(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function X(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||$(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $(e,t){if(e){if("string"==typeof e)return ee(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ee(e,t):void 0}}function ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var te=s()("doc:history:nav:vm");var re=function(e){var t=e.doc,r=e.docDomain,n=void 0===r?"Doc":r,o=e.defaultActiveVersion,i=e.autoActiveFirst,c=e.onVersionChange,u=e.docVersionProxy,l=e.limit,s=e.defaultCategory,f=void 0===s?"all":s,d=e.versionPublished,p=void 0!==d&&d,h=e.offlineLocalStorageVersion,m=void 0!==h&&h,v=Object(y.b)();l=l||200;var b=X(Object(a.useState)(f),2),w=b[0],_=b[1],E=X(Object(a.useState)(null),2),O=E[0],S=E[1],k=X(Object(a.useState)([]),2),x=k[0],j=k[1],A=X(Object(a.useState)(!1),2),L=A[0],T=A[1],C=X(Object(a.useState)(!0),2),P=C[0],N=C[1],R=X(Object(a.useState)({named:"named_version"===f,published:p,offlineStorageVersion:m}),2),I=R[0],D=R[1],M=function(e){D((function(t){return Z(Z({},t),e)}))},F=function(){var e=K(H().mark((function e(r){var o,a,i,c,s,f,d,p,h;return H().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.named,a=r.published,i=r.offlineStorageVersion,c=r.offset,N(!0),s={doc_id:t.id,doc_type:n,offset:c,limit:l},o&&(s.named=!0),!o&&a&&(s.draft=0),e.next=7,u.find(s);case 7:if(f=e.sent,d=[],!(g.c&&v&&i)||o){e.next=20;break}return e.prev=10,e.next=13,V.a.getDocVersions(s);case 13:p=e.sent,d=p.data,e.next=20;break;case 17:e.prev=17,e.t0=e.catch(10),console.log(e.t0);case 20:return(h=[].concat(W(d),W(f))).sort((function(e,t){var r=new Date(e.created_at);return new Date(t.created_at).getTime()-r.getTime()})),T(h.length===l),N(!1),j((function(e){return[].concat(W(e),W(h))})),e.abrupt("return",h);case 26:case"end":return e.stop()}}),e,null,[[10,17]])})));return function(t){return e.apply(this,arguments)}}(),G=function(){var e=K(H().mark((function e(){var t;return H().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S(null),j([]),T(!1),e.next=5,F(Z(Z({},I),{},{offset:0}));case 5:return t=e.sent,e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),U=function(e){S(e),c({version:e,isDefault:!1})},B=function(){var e=K(H().mark((function e(t){var r,n;return H().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.unname({id:t.id});case 2:te("deleteVersion success: ",t.id),r=x.findIndex((function(e){return e.id===t.id})),n=null,r===x.length-1?x.length>=2&&(n=x[0]):n=x[r+1],U(n),j(x.filter((function(e){return e.id!==t.id})));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),q=function(){var e=K(H().mark((function e(t,r){var n,o;return H().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.name({id:t.id,name:r.name});case 2:te("updateVersion success:",{id:t.id,params:r}),n=W(x),o=n.findIndex((function(e){return e.id===t.id})),n.splice(o,1,Z(Z({},n[o]),{},{name:r.name})),j(n),c({version:Z(Z({},t),{},{name:r.name}),isDefault:!1});case 8:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),z=function(){var e=K(H().mark((function e(){var t,r;return H().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G();case 2:t=e.sent,te("initialized: ",t),t.length>0&&(o&&!O&&S(o),i&&(r=t[0],S(r),c({version:r,isDefault:!0})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){z()}),[I,v]),{state:{currentCategory:w,currentVersion:O,filters:I,hasMore:L,loading:P,versions:x},switchVersion:U,switchCategory:function(e){_(e),M({named:"named_version"===e,published:!1})},changePublishStatus:function(e){M({published:e})},changeOfflineStorageStatus:function(e){M({offlineStorageVersion:e})},loadMore:function(){return K(H().mark((function e(){return H().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N(!0),e.next=3,F(Z(Z({},I),{},{offset:x.length}));case 3:case"end":return e.stop()}}),e)})))()},nameVersion:q,unnameVersion:B}},ne="HistoryNavigator-module_historyNav_0uTs5",oe="HistoryNavigator-module_tabs_ys1En",ae="HistoryNavigator-module_search_JoWgi",ie="HistoryNavigator-module_versionFilter_BaQHr",ce="HistoryNavigator-module_versions_gHGm6",ue="HistoryNavigator-module_desktopOnline_EDBEm",le="HistoryNavigator-module_desktopOffline_BLIlM",se="HistoryNavigator-module_version_Oisjl",fe="HistoryNavigator-module_currentVersion_QjWMY",de="HistoryNavigator-module_namedVersions_zbDbQ",pe="HistoryNavigator-module_empty_jqTUJ",he="HistoryNavigator-module_emptyVersions_bBFPt",me="HistoryNavigator-module_tip_xRD8q",ye="HistoryNavigator-module_withChecked_ifTnW",ve="HistoryNavigator-module_categoryTip_5pKSF";function ge(e){return ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ge(e)}function be(e,t,r){return t=function(e){var t=function(e,t){if("object"!==ge(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==ge(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===ge(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var we=s()("doc:history:nav:view");function _e(e){var t,r=Object(y.b)(),n=re({doc:e.doc,defaultActiveVersion:e.defaultActiveVersion,autoActiveFirst:e.autoActiveFirst,docDomain:e.docDomain,onVersionChange:e.onVersionChange,docVersionProxy:e.docVersionProxy,limit:e.limit,defaultCategory:e.defaultCategory,versionPublished:e.versionPublished,offlineLocalStorageVersion:g.c}),o=n.state,c=o.versions,u=o.currentVersion,l=o.currentCategory,s=o.filters,f=o.loading;we(n.state);return Object(a.useEffect)((function(){e.forceActiveCategory&&(we("category change to named_version, force switch tab"),n.switchCategory(e.forceActiveCategory))}),[e.forceActiveCategory]),i.a.createElement("div",{"data-testid":e["data-testid"],className:p()(ne,e.className,be({},ye,e.withChecked))},e.withSearch&&i.a.createElement("div",{className:ae},i.a.createElement(w.a.Search,{placeholder:__("搜索")})),i.a.createElement(U.a,{activeKey:l,className:oe,onChange:function(t){n.switchCategory(t),e.onTabChange(t)}},i.a.createElement(U.a.TabPane,{tab:__("全部记录"),key:"all"}),r&&i.a.createElement(U.a.TabPane,{tab:__("版本"),key:"named_version"})),e.allCategoryTip&&"all"===l&&i.a.createElement("div",{className:ve},e.allCategoryTip),e.withVersionFilter&&!s.named&&i.a.createElement(i.a.Fragment,null,r&&i.a.createElement("div",{className:ie},i.a.createElement(G.a,{checked:s.published,onChange:function(e){n.changePublishStatus(e.target.checked)}},__("仅显示已发布的历史记录"))),g.c&&r&&i.a.createElement("div",{className:ie},i.a.createElement(G.a,{checked:s.offlineStorageVersion,onChange:function(e){n.changeOfflineStorageStatus(e.target.checked)}},__("显示所有本地存储版本")))),!f&&0===c.length&&i.a.createElement("div",{className:pe},i.a.createElement("ul",{className:he},i.a.createElement("li",null,i.a.createElement("img",{width:"140",height:"82",src:q.b})),"named_version"===l?i.a.createElement("li",{className:me},__("暂无版本记录"),i.a.createElement("a",{href:"https://www.yuque.com/yuque/thyzgp/fs0x2z",target:"_blank"},i.a.createElement(B.b,{name:"help",width:16}))):i.a.createElement("li",{className:me},i.a.createElement("span",null,__("暂无记录"))))),c.length>0&&i.a.createElement("div",{className:p()(ce,(t={},be(t,de,s.named),be(t,ue,g.c&&r),be(t,le,g.c&&!r),t))},i.a.createElement(F.a,{justify:"block",bordered:!1,split:!1,dataSource:c,renderItem:function(t){return i.a.createElement("div",{"data-version":"".concat(t.id),onClick:function(){u&&t.id===u.id?"function"==typeof e.onVersionDeselect&&(e.onVersionDeselect(t),n.switchVersion(null)):n.switchVersion(t)}},function(t){var r=u&&u.id===t.id;if("function"==typeof e.renderVersion)return e.renderVersion({version:t,active:r,named:s.named});var o=null;return o="named_version"===l?i.a.createElement(D.NamedVersion,{version:t,active:r,onDelete:n.unnameVersion,onUpdate:n.nameVersion}):i.a.createElement(D.NormalVersion,{version:t,active:r,withUser:!0,disableVersionStatus:e.disableVersionStatus}),i.a.createElement("div",{className:p()(se,be({},fe,r))},o)}(t))},loading:f,showLoadingMore:n.state.hasMore,onLoadMore:n.loadMore})))}_e.defaultProps={defaultActiveVersion:null,autoActiveFirst:!0,withSearch:!1,withVersionFilter:!1,onTabChange:function(){}},_e.propTypes={"data-testid":u.a.string,className:u.a.string,doc:u.a.object.isRequired,docDomain:u.a.string.isRequired,forceActiveCategory:u.a.oneOf(["all","named_version"]),defaultActiveVersion:u.a.object,autoActiveFirst:u.a.bool,withSearch:u.a.bool,withVersionFilter:u.a.bool,withChecked:u.a.bool,onVersionChange:u.a.func.isRequired,onVersionDeselect:u.a.func,onTabChange:u.a.func,renderVersion:u.a.func,docVersionProxy:u.a.object.isRequired,limit:u.a.number,defaultCategory:u.a.oneOf(["all","named_version"]),versionPublished:u.a.bool,allCategoryTip:u.a.object,disableVersionStatus:u.a.bool};var Ee=_e,Oe=(r(785),r(424)),Se=r(1212),ke=r(1210),xe="VersionToolbar-module_toolbar_jTI6g",je="VersionToolbar-module_toolbarActions_43Fcf",Ae="VersionToolbar-module_diffHead_7EP0a",Le="VersionToolbar-module_diffBase_ylwWT",Te="VersionToolbar-module_diffPlaceholder_iPfAA",Ce="VersionToolbar-module_diffWith_FI0JB",Pe="VersionToolbar-module_diffTip_nQ9S2",Ne="VersionToolbar-module_diffTipAdd_fjXD0",Re="VersionToolbar-module_diffTipDelete_VzJsd",Ie="VersionToolbar-module_versionSelector_lPRPy",De="VersionToolbar-module_versionSelectorHistoryNav_f4rcN",Me="VersionToolbar-module_version_tDu5-",Fe="VersionToolbar-module_selectedVersion_Odsmy";function Ge(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ue(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ue(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ue(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Be=s()("doc:history:toolbar");function qe(e){var t=e.doc,r=e.headVersion,n=Ge(Object(a.useState)("all"),2),o=n[0],c=n[1],u=Ge(Object(a.useState)(null),2),l=u[0],s=u[1],f=Ge(Object(a.useState)(!1),2),d=f[0],p=f[1],h=function(t){"content"===t?(e.showContent(r),s(null)):e.showDiff(r,l)};return Be("select version:",l),i.a.createElement("div",{className:"".concat(xe," ").concat(e.className||""),"data-testid":"version-toolbar"},i.a.createElement("div",{className:je},i.a.createElement(E.a,{className:Ae,onClick:function(){h("content")},"data-testid":"diff-head"},i.a.createElement(D.Name,{version:r,category:e.navigatorCategory,maxWidth:160})),i.a.createElement("span",{className:Ce},__("与#doc_version_diff")),i.a.createElement(Oe.a,{noArrow:!0,placement:"bottomLeft",trigger:["click"],overlayClassName:Ie,content:i.a.createElement(Ee,{"data-testid":"diff-history-nav",className:De,doc:t,docDomain:e.docDomain,autoActiveFirst:!1,withVersionFilter:t.type!==v.DOC_TYPES.Table,withChecked:!0,defaultActiveVersion:null,onVersionChange:function(t){var n=t.version;t.isDefault?Be("vision change, caused by default, ignore"):(p(!1),s(n),e.showDiff(r,n))},onVersionDeselect:function(){h("content")},onTabChange:function(e){c(e)},renderVersion:function(e){var t=e.version,r=e.active,n=null;return n="named_version"===o?i.a.createElement("span",null,t.name):i.a.createElement(D.NormalVersion,{version:t,active:r,withUser:!1}),i.a.createElement("div",{className:Me},r&&i.a.createElement("div",{className:Fe},i.a.createElement(Se.default,null)),n)},docVersionProxy:e.docVersionProxy}),visible:d,onVisibleChange:p},i.a.createElement(E.a,{className:Le,"data-testid":"diff-version-selector-trigger"},l?i.a.createElement(D.Name,{version:l,category:o}):i.a.createElement("span",{className:Te},__("请选择历史")),i.a.createElement(ke.default,{style:{marginLeft:"8px"}}))),__("对比#doc_version_diff")),l&&i.a.createElement("div",{className:Pe},i.a.createElement(E.a,{className:Ne},__("增加的内容")),i.a.createElement(E.a,{className:Re},__("删除的内容"))))}qe.propTypes={className:u.a.string,doc:u.a.object.isRequired,docDomain:u.a.oneOf(["Doc","Doclet"]),navigatorCategory:u.a.oneOf(["all","named_version"]),headVersion:u.a.object.isRequired,showContent:u.a.func.isRequired,showDiff:u.a.func.isRequired,docVersionProxy:u.a.object.isRequired};var Ve=Object(h.b)(qe,!0);function ze(e){return ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ze(e)}function He(){He=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==ze(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(ze(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function We(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function Ye(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){We(a,n,o,i,c,"next",e)}function c(e){We(a,n,o,i,c,"throw",e)}i(void 0)}))}}function Ke(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Qe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Qe(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Ze=s()("doc:history:viewer:vm");var Je=function(e){var t=e.doc,r=(e.docType,e.docDomain),n=e.onRevert,o=e.onReverted,i=e.docVersionProxy,c=e.docProxy,u=e.docletProxy,l=Object(a.useRef)({}),s=Ke(Object(a.useState)(null),2),f=s[0],d=s[1],p=Ke(Object(a.useState)(null),2),h=p[0],m=p[1],y=Ke(Object(a.useState)(null),2),v=y[0],b=y[1],w=Ke(Object(a.useState)("content"),2),_=w[0],E=w[1],S=Ke(Object(a.useState)("all"),2),k=S[0],x=S[1],j=Ke(Object(a.useState)(null),2),A=j[0],L=j[1],T=function(){var e=Ye(He().mark((function e(r,n){var o,a;return He().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l.current[r]){e.next=2;break}return e.abrupt("return",l.current[r]);case 2:if(!g.c||!n){e.next=9;break}return e.next=5,V.a.getOneDocVersionsById({id:r,doc_id:t.id});case 5:a=e.sent,o=a.data,e.next=12;break;case 9:return e.next=11,i.findOne({id:r,doc_id:t.id});case 11:o=e.sent;case 12:return l.current[r]=o,e.abrupt("return",o);case 14:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),C=function(){var e=Ye(He().mark((function e(t){var r;return He().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Ze("vm.showContent:",t),E("content"),e.next=4,T(t.id,t.local);case 4:r=e.sent,m(r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=Ye(He().mark((function e(t,r){var n;return He().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ze("vm.showDiff:",{head:t,base:r}),r){e.next=3;break}return e.abrupt("return");case 3:return E("diff"),e.next=6,T(r.id,r.local);case 6:n=e.sent,b(n);case 8:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),N=function(){m(null),d(null),E("content")},R=function(){var e=Ye(He().mark((function e(a){var i,s,f=arguments;return He().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=f.length>1&&void 0!==f[1]&&f[1],Ze("on revert:",a),"function"!=typeof n){e.next=6;break}return s=l.current[a.id],n(s),e.abrupt("return");case 6:if(e.prev=6,"Doclet"!==r){e.next=12;break}return e.next=10,u.rollback({id:t.id,version_id:a.id});case 10:e.next=14;break;case 12:return e.next=14,c.rollback({id:t.id,version_id:a.id,force:i});case 14:e.next=20;break;case 16:return e.prev=16,e.t0=e.catch(6),"LockedByOther"===e.t0.code?O.a.error(__("有其它用户正在编辑，恢复可能会导致对方编辑的内容丢失，请联系他们退出编辑后再进行恢复")):"LockedBeMe"===e.t0.code?O.a.error(e.t0.message):O.a.error(__("你正在其它浏览器窗口编辑该文档，请关闭窗口再进行恢复")),e.abrupt("return");case 20:Ze("reverted to ",a),"function"==typeof o?o(a):O.a.success(__("恢复成功，你可以进入编辑页发布文档"));case 22:case"end":return e.stop()}}),e,null,[[6,16]])})));return function(t){return e.apply(this,arguments)}}();return{state:{currentVersion:f,currentVersionDetail:h,baseVersionDetail:v,currentNavigatorCategory:k,forceActiveCategory:A,currentView:_},switchVersion:function(e){return Ye(He().mark((function t(){var r;return He().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.version,Ze("vm.switchVersion: ",{version:r}),N(),!r){t.next=7;break}return d(r),t.next=7,C(r);case 7:case"end":return t.stop()}}),t)})))()},switchNavigatorCategory:function(e){var t=e.category,r=e.force;Ze("vm.switchNavigatorCategory: ",{category:t,force:r}),x(t),r&&L(t),N()},isReadyToDisplayDiff:function(){return"diff"===_&&v},showContent:C,showDiff:P,showAction:!0,revert:R}},Xe=r(3703);function $e(e){return $e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$e(e)}function et(e,t,r){return t=function(e){var t=function(e,t){if("object"!==$e(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==$e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===$e(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var tt=s()("doc:history:viewer");function rt(e){var t=e.layout,r=e.doc,c=e.docDomain,u=e.defaultCategory,l=e.versionPublished,s=Je({doc:e.doc,docDomain:e.docDomain,docType:e.docType,onRevert:e.onRevert,onReverted:e.onReverted,docVersionProxy:e.docVersionProxy,docProxy:e.docProxy,docletProxy:e.docletProxy}),d=s.state,b=d.currentVersion,w=d.currentVersionDetail,_=d.currentNavigatorCategory,E=d.forceActiveCategory,O=d.currentView,S=d.baseVersionDetail;Object(a.useEffect)((function(){return document.body.style.overflow="hidden",function(){document.body.style.removeProperty("overflow")}}),[]),tt("render",s.state);var k,x,j,A=Object(y.b)(),L=Object(m.c)().editMode,T=i.a.createRef();return i.a.createElement("div",{ref:T,className:"".concat(Xe.a[t]," ").concat(e.className||""),"data-testid":"history-viewer"},i.a.createElement("div",{className:p()(Xe.a.head,et({},Xe.a.isInsetTitleBar,g.e))},i.a.createElement("div",{className:Xe.a.headNav},i.a.createElement(f.default,{"data-testid":"history-back",className:Xe.a.back,onClick:e.onCancel}),i.a.createElement("span",{className:Xe.a.pageTitle},__("历史记录"))),s.showAction&&i.a.createElement("div",{className:Xe.a.headActions},b?b.name?i.a.createElement(i.a.Fragment,null,"all"===_&&i.a.createElement("span",{className:Xe.a.versionNameTip},__("已存为版本："),i.a.createElement("span",{className:Xe.a.versionName},b.name)),"Doc"===c&&i.a.createElement(D.CopyUrl,{version:b})):i.a.createElement(M.a,{version:b,docVersionProxy:e.docVersionProxy,onCreated:function(e){tt("named version created:",e),s.switchNavigatorCategory({category:"named_version",force:!0})},getContainer:function(){return T.current||document.body}}):null,(A||L)&&(k=!(w&&w.content),x="named_version"===_?__("恢复此版本"):__("恢复此记录"),j=i.a.createElement(o.a,{"data-testid":"history-revert",type:"primary",onClick:function(){s.revert(b)},disabled:k,className:Xe.a.restoreButton},x),k?i.a.createElement(n.a,{title:__("内容为空，无需恢复")},j):j))),i.a.createElement(h.a,{withFallbackUI:!0},i.a.createElement("div",{className:Xe.a.body},i.a.createElement("div",{className:Xe.a.aside,"data-testid":"history-aside-nav"},i.a.createElement(Ee,{"data-testid":"main-history-nav",defaultCategory:u,versionPublished:l,doc:r,docDomain:e.docDomain,autoActiveFirst:!0,withVersionFilter:r.type!==v.DOC_TYPES.Table,allCategoryTip:r.type===v.DOC_TYPES.Table&&i.a.createElement("span",null,__("历史记录每10分钟保存一次")),disableVersionStatus:r.type===v.DOC_TYPES.Table,forceActiveCategory:E,docVersionProxy:e.docVersionProxy,onVersionChange:s.switchVersion,onTabChange:function(e){s.switchNavigatorCategory({category:e,force:!1})},limit:e.limit})),i.a.createElement("div",{className:Xe.a.main},w&&i.a.createElement("div",{className:"Doc"===r.type?Xe.a.fixed:Xe.a.adapt},"Doc"===r.type&&i.a.createElement("div",{className:Xe.a.toolbar},i.a.createElement(Ve,{key:b.id,doc:r,docDomain:e.docDomain,navigatorCategory:_,headVersion:b,showContent:s.showContent,showDiff:s.showDiff,docVersionProxy:e.docVersionProxy})),i.a.createElement("div",{className:"".concat(Xe.a.content),"data-testid":"history-content","data-history-content":"true"},i.a.createElement("div",{className:"".concat(Xe.a.document," ").concat(Xe.a[r.type.toLowerCase()])},"content"===O&&e.renderVersion(w),s.isReadyToDisplayDiff()&&e.renderDiff(w,S))))))))}rt.defaultProps={layout:"fullscreen",docDomain:"Doc",limit:200},rt.propTypes={layout:u.a.oneOf(["fullscreen"]),className:u.a.string,doc:u.a.object.isRequired,docDomain:u.a.oneOf(["Doc","Doclet"]),renderVersion:u.a.func.isRequired,renderDiff:u.a.func.isRequired,onCancel:u.a.func.isRequired,onRevert:u.a.func,onReverted:u.a.func,docProxy:u.a.object.isRequired,docletProxy:u.a.object.isRequired,docVersionProxy:u.a.object.isRequired,limit:u.a.number,defaultCategory:u.a.oneOf(["all","named_version"]),versionPublished:u.a.bool};t.a=Object(h.b)(rt,!0)},3753:function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return c}));var n="left",o="right",a="center",i=/\S+[ ]*\|[ ]*\S+.*?\n.*?(-)+[ ]*\|[ ]*(-)+.*?\n.*?\S+[ ]*\|[ ]*\S+.*?/g,c=function(e){if(!e)return null;if(!e.match(i))return null;var t=[],r=[],c=0,u="beforeTable",l="",s="";if(e.split("\n").forEach((function(e){var i=e.split("|");if(i.length>=2){u="inTable";var f=i.map((function(e){return e.trim()})),d=f.filter((function(e,t){return 0!==t&&t!==f.length-1||e}));d.every((function(e){return/^:[-]+:$/.test(e)?(r.push(a),!0):/^[-]+:/.test(e)?(r.push(o),!0):!!/^:?[-]+/.test(e)&&(r.push(n),!0)}))||(c=Math.max(c,d.length),t.push(d))}else e&&("inTable"===u&&(u="afterTable"),"beforeTable"===u?l+=l?"\n".concat(e):e:s+=s?"\n".concat(e):e)})),0===t.length)return null;if(0===t[0].length)return null;var f={};return t.forEach((function(e,t){e.forEach((function(e,n){var o=r[n];f[t]=f[t]||{},f[t][n]={value:e,style:{hAlign:o}}}))})),{colCount:c,rowCount:t.length,data:f,rows:[],columns:[],beforeText:l,afterText:s}}},3755:function(e,t,r){"use strict";r(3226);var n=r(1565);r(3208);t.a=n.b},3758:function(e,t,r){},3759:function(e,t,r){var n=r(3408)(r(3698));e.exports=n},3760:function(e,t,r){"use strict";e.exports={OWNER_HELP_GUIDE_CURRENT:"OWNER_HELP_GUIDE_CURRENT",NEVER_SHOW_OWNER_HELP:"NEVER_SHOW_OWNER_HELP",HAS_READ_RECOMMEND_DATE:"HAS_READ_RECOMMEND_DATE",HAS_OPEN_ASSISTANT:"HAS_OPEN_ASSISTANT"}},3771:function(e,t,r){"use strict";r(143);var n=r(67),o=r(0),a=r.n(o),i=r(2),c=r.n(i),u=r(12),l=r.n(u),s=r(3301);function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,a=void 0,a=function(e,t){if("object"!==f(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===f(a)?a:String(a)),n)}var o,a}function p(e,t){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},p(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=m(e);if(t){var o=m(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===f(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}(c,e);var t,r,o,i=h(c);function c(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),i.apply(this,arguments)}return t=c,(r=[{key:"renderContent",value:function(){var e=this.props,t=e.docStatus,r=e.savedAt,n=e.netStatus;if(n===s.NET_STATUS.offline)switch(t){case"loading":return a.a.createElement("span",{"data-testid":"loading"},__("正在加载..."));case"changed":return a.a.createElement("span",{"data-testid":"auto_saving"},__("离线编辑中..."));case"saving":return a.a.createElement("span",{"data-testid":"saving"},__("正在离线保存..."));case"saved":return a.a.createElement("span",{"data-testid":"saved"},__("已保存离线版本")," ",r&&l()(r).format("H:mm:ss"));default:return a.a.createElement("span",{"data-testid":"offline"},__("当前在离线编辑状态..."))}if(n===s.NET_STATUS.congestion)return a.a.createElement("span",{"data-testid":"congestion"},__("网络不稳定，无法实时协同..."));switch(t){case"loading":return a.a.createElement("span",{"data-testid":"loading"},__("正在加载..."));case"changed":return a.a.createElement("span",{"data-testid":"auto_saving"},__("自动保存中..."));case"saving":return a.a.createElement("span",{"data-testid":"saving"},__("正在保存..."));case"publishing":return a.a.createElement("span",{"data-testid":"publishing"},__("正在发布..."));case"published":return a.a.createElement("span",{"data-testid":"published"},__("已发布"));case"saved":return a.a.createElement("span",{"data-testid":"saved"},__("已保存")," ",r&&l()(r).format("H:mm:ss"));case"loaded":return a.a.createElement("span",{"data-testid":"loaded"},__("已加载最新版本"));default:return null}}},{key:"render",value:function(){var e=this,t=this.renderContent(),r=this.props.showHistory;return t&&r?a.a.createElement(n.a,{title:__("查看历史版本"),trigger:["hover","click"],placement:"bottom"},a.a.createElement("span",{style:{cursor:"pointer"},onClick:function(t){return e.handleClick(t)}},t)):t}},{key:"handleClick",value:function(e){var t;"a"!==(null===(t=e.target)||void 0===t?void 0:t.tagName.toLowerCase())&&(0,this.props.showHistory)()}}])&&d(t.prototype,r),o&&d(t,o),Object.defineProperty(t,"prototype",{writable:!1}),c}(o.PureComponent);y.propTypes={savedAt:c.a.instanceOf(Date),docStatus:c.a.string,netStatus:c.a.string,showHistory:c.a.func},t.a=y},3772:function(e,t,r){t.Connection=r(3773),t.Doc=r(3649),t.Error=r(3585),t.Query=r(3650),t.types=r(3586),t.logger=r(3584)},3773:function(e,t,r){(function(t){var n=r(3649),o=r(3650),a=r(3775),i=r(3777),c=r(3531),u=r(3585),l=r(3586),s=r(3532),f=r(3584),d=u.CODES;function p(e){return 0===e.readyState||1===e.readyState?"connecting":"disconnected"}function h(e){c.EventEmitter.call(this),this.collections={},this.nextQueryId=1,this.nextSnapshotRequestId=1,this.queries={},this._snapshotRequests={},this.seq=1,this.id=null,this.agent=null,this.debug=!1,this.state=p(e),this.bindToSocket(e)}function m(e,t){var r=new Error(e.message);return r.code=e.code,t&&(r.data=t),r}function y(e){return e.hasPending()}function v(e){return e.hasWritePending()}e.exports=h,c.mixin(h),h.prototype.bindToSocket=function(e){this.socket&&(this.socket.close(),this.socket.onmessage=null,this.socket.onopen=null,this.socket.onerror=null,this.socket.onclose=null),this.socket=e;var r=p(e);this._setState(r),this.canSend=!1;var n=this;e.onmessage=function(e){try{var r="string"==typeof e.data?JSON.parse(e.data):e.data}catch(t){return void f.warn("Failed to parse message",e)}n.debug&&f.info("RECV",JSON.stringify(r));var o={data:r};if(n.emit("receive",o),o.data)try{n.handleMessage(o.data)}catch(e){t.nextTick((function(){n.emit("error",e)}))}},1===e.readyState&&n._initializeHandshake(),e.onopen=function(){n._setState("connecting"),n._initializeHandshake()},e.onerror=function(e){n.emit("connection error",e)},e.onclose=function(e){"closed"===e||"Closed"===e?n._setState("closed",e):"stopped"===e||"Stopped by server"===e?n._setState("stopped",e):n._setState("disconnected",e)}},h.prototype.handleMessage=function(e){var t=null;switch(e.error&&(t=m(e.error,e),delete e.error),e.a){case"init":return this._handleLegacyInit(e);case"hs":return this._handleHandshake(t,e);case"qf":return void((r=this.queries[e.id])&&r._handleFetch(t,e.data,e.extra));case"qs":return void((r=this.queries[e.id])&&r._handleSubscribe(t,e.data,e.extra));case"qu":return;case"q":var r;if(!(r=this.queries[e.id]))return;return t?r._handleError(t):(e.diff&&r._handleDiff(e.diff),void(e.hasOwnProperty("extra")&&r._handleExtra(e.extra)));case"bf":return this._handleBulkMessage(t,e,"_handleFetch");case"bs":return this._handleBulkMessage(t,e,"_handleSubscribe");case"bu":return this._handleBulkMessage(t,e,"_handleUnsubscribe");case"nf":case"nt":return this._handleSnapshotFetch(t,e);case"f":return void((n=this.getExisting(e.c,e.d))&&n._handleFetch(t,e.data));case"s":return void((n=this.getExisting(e.c,e.d))&&n._handleSubscribe(t,e.data));case"u":return void((n=this.getExisting(e.c,e.d))&&n._handleUnsubscribe(t));case"op":var n;return void((n=this.getExisting(e.c,e.d))&&n._handleOp(t,e));default:f.warn("Ignoring unrecognized message",e)}},h.prototype._handleBulkMessage=function(e,t,r){if(t.data)for(var n in t.data){var o=t.data[n];(i=this.getExisting(t.c,n))&&(e?i[r](e):o.error?i[r](m(o.error)):i[r](null,o))}else if(Array.isArray(t.b))for(var a=0;a<t.b.length;a++){n=t.b[a];(i=this.getExisting(t.c,n))&&i[r](e)}else if(t.b)for(var n in t.b){var i;(i=this.getExisting(t.c,n))&&i[r](e)}else f.error("Invalid bulk message",t)},h.prototype._reset=function(){this.agent=null},h.prototype._setState=function(e,t){if(this.state!==e){if("connecting"===e&&"disconnected"!==this.state&&"stopped"!==this.state&&"closed"!==this.state||"connected"===e&&"connecting"!==this.state){var r=new u(d.ERR_CONNECTION_STATE_TRANSITION_INVALID,"Cannot transition directly from "+this.state+" to "+e);return this.emit("error",r)}for(var n in this.state=e,this.canSend="connected"===e,"disconnected"!==e&&"stopped"!==e&&"closed"!==e||this._reset(),this.startBulk(),this.queries){this.queries[n]._onConnectionStateChanged()}for(var o in this.collections){var a=this.collections[o];for(var n in a)a[n]._onConnectionStateChanged()}for(var n in this._snapshotRequests){this._snapshotRequests[n]._onConnectionStateChanged()}this.endBulk(),this.emit(e,t),this.emit("state",e,t)}},h.prototype.startBulk=function(){this.bulk||(this.bulk={})},h.prototype.endBulk=function(){if(this.bulk)for(var e in this.bulk){var t=this.bulk[e];this._sendBulk("f",e,t.f),this._sendBulk("s",e,t.s),this._sendBulk("u",e,t.u)}this.bulk=null},h.prototype._sendBulk=function(e,t,r){if(r){var n,o=[],a={},i=0;for(var c in r){var u=r[c];null==u?o.push(c):(a[c]=u,n=c,i++)}if(1===o.length){c=o[0];this.send({a:e,c:t,d:c})}else o.length&&this.send({a:"b"+e,c:t,b:o});if(1===i){var l=a[n];this.send({a:e,c:t,d:n,v:l})}else i&&this.send({a:"b"+e,c:t,b:a})}},h.prototype._sendAction=function(e,t,r){if(this._addDoc(t),this.bulk){var n=this.bulk[t.collection]||(this.bulk[t.collection]={}),o=n[e]||(n[e]={}),a=o.hasOwnProperty(t.id);return o[t.id]=r,a}var i={a:e,c:t.collection,d:t.id,v:r};this.send(i)},h.prototype.sendFetch=function(e){return this._sendAction("f",e,e.version)},h.prototype.sendSubscribe=function(e){return this._sendAction("s",e,e.version)},h.prototype.sendUnsubscribe=function(e){return this._sendAction("u",e)},h.prototype.sendOp=function(e,t){this._addDoc(e);var r={a:"op",c:e.collection,d:e.id,v:e.version,src:t.src,seq:t.seq};t.op&&(r.op=t.op),t.create&&(r.create=t.create),t.del&&(r.del=t.del),this.send(r)},h.prototype.send=function(e){this.debug&&f.info("SEND",JSON.stringify(e)),this.emit("send",e),this.socket.send(JSON.stringify(e))},h.prototype.close=function(){this.socket.close()},h.prototype.getExisting=function(e,t){if(this.collections[e])return this.collections[e][t]},h.prototype.get=function(e,t){var r=this.collections[e]||(this.collections[e]={}),o=r[t];return o||(o=r[t]=new n(this,e,t),this.emit("doc",o)),o},h.prototype._destroyDoc=function(e){var t=this.collections[e.collection];t&&(delete t[e.id],s.hasKeys(t)||delete this.collections[e.collection])},h.prototype._addDoc=function(e){var t=this.collections[e.collection];t||(t=this.collections[e.collection]={}),t[e.id]!==e&&(t[e.id]=e)},h.prototype._createQuery=function(e,t,r,n,a){var i=this.nextQueryId++,c=new o(e,this,i,t,r,n,a);return this.queries[i]=c,c.send(),c},h.prototype._destroyQuery=function(e){delete this.queries[e.id]},h.prototype.createFetchQuery=function(e,t,r,n){return this._createQuery("qf",e,t,r,n)},h.prototype.createSubscribeQuery=function(e,t,r,n){return this._createQuery("qs",e,t,r,n)},h.prototype.hasPending=function(){return!!(this._firstDoc(y)||this._firstQuery(y)||this._firstSnapshotRequest())},h.prototype.hasWritePending=function(){return!!this._firstDoc(v)},h.prototype.whenNothingPending=function(e){var r=this._firstDoc(y);if(r)r.once("nothing pending",this._nothingPendingRetry(e));else{var n=this._firstQuery(y);if(n)n.once("ready",this._nothingPendingRetry(e));else{var o=this._firstSnapshotRequest();o?o.once("ready",this._nothingPendingRetry(e)):t.nextTick(e)}}},h.prototype._nothingPendingRetry=function(e){var r=this;return function(){t.nextTick((function(){r.whenNothingPending(e)}))}},h.prototype._firstDoc=function(e){for(var t in this.collections){var r=this.collections[t];for(var n in r){var o=r[n];if(e(o))return o}}},h.prototype._firstQuery=function(e){for(var t in this.queries){var r=this.queries[t];if(e(r))return r}},h.prototype._firstSnapshotRequest=function(){for(var e in this._snapshotRequests)return this._snapshotRequests[e]},h.prototype.fetchSnapshot=function(e,t,r,n){"function"==typeof r&&(n=r,r=null);var o=this.nextSnapshotRequestId++,i=new a(this,o,e,t,r,n);this._snapshotRequests[i.requestId]=i,i.send()},h.prototype.fetchSnapshotByTimestamp=function(e,t,r,n){"function"==typeof r&&(n=r,r=null);var o=this.nextSnapshotRequestId++,a=new i(this,o,e,t,r,n);this._snapshotRequests[a.requestId]=a,a.send()},h.prototype._handleSnapshotFetch=function(e,t){var r=this._snapshotRequests[t.id];r&&(delete this._snapshotRequests[t.id],r._handleResponse(e,t))},h.prototype._handleLegacyInit=function(e){e.protocolMinor||this._initialize(e)},h.prototype._initializeHandshake=function(){this.send({a:"hs",id:this.id})},h.prototype._handleHandshake=function(e,t){if(e)return this.emit("error",e);this._initialize(t)},h.prototype._initialize=function(e){return 1!==e.protocol?this.emit("error",new u(d.ERR_PROTOCOL_VERSION_NOT_SUPPORTED,"Unsupported protocol version: "+e.protocol)):l.map[e.type]!==l.defaultType?this.emit("error",new u(d.ERR_DEFAULT_TYPE_MISMATCH,e.type+" does not match the server default type")):"string"!=typeof e.id?this.emit("error",new u(d.ERR_CLIENT_ID_BADLY_FORMED,"Client id must be a string")):(this.id=e.id,void this._setState("connected"))}}).call(this,r(144))},3774:function(e,t){var r=["info","warn","error"];function n(){var e={};r.forEach((function(t){e[t]=console[t].bind(console)})),this.setMethods(e)}e.exports=n,n.prototype.setMethods=function(e){e=e||{};var t=this;r.forEach((function(r){"function"==typeof e[r]&&(t[r]=e[r])}))}},3775:function(e,t,r){var n=r(3651),o=r(3532);function a(e,t,r,a,i,c){if(n.call(this,e,t,r,a,c),!o.isValidVersion(i))throw new Error("Snapshot version must be a positive integer or null");this.version=i}e.exports=a,a.prototype=Object.create(n.prototype),a.prototype._message=function(){return{a:"nf",id:this.requestId,c:this.collection,d:this.id,v:this.version}}},3776:function(e,t){e.exports=function(e,t,r,n,o){this.id=e,this.v=t,this.type=r,this.data=n,this.m=o}},3777:function(e,t,r){var n=r(3651),o=r(3532);function a(e,t,r,a,i,c){if(n.call(this,e,t,r,a,c),!o.isValidTimestamp(i))throw new Error("Snapshot timestamp must be a positive integer or null");this.timestamp=i}e.exports=a,a.prototype=Object.create(n.prototype),a.prototype._message=function(){return{a:"nt",id:this.requestId,c:this.collection,d:this.id,ts:this.timestamp}}},3779:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=(n=r(65))&&"object"==typeof n&&"default"in n?n.default:n;function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return function(){var t,r=i(e);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}()){var n=i(this).constructor;t=Reflect.construct(r,arguments,n)}else t=r.apply(this,arguments);return u(this,t)}}var s={PUBLISH:"yuque_sdk_publish",PUBLISH_CALLBACK:"yuque_sdk_publish_callback",RESIZE_CALLBACK:"yuque_sdk_resize_callback",CONNECT:"yuque_sdk_connect",DISCONNECT:"yuque_sdk_disconnect",FULLSCREEN_CALLBACK:"yuque_sdk_fullscreen_callback",SAVE_CALLBACK:"yuque_sdk_save_callback",SET_VALUE:"yuque_sdk_set_value",GET_VALUE:"yuque_sdk_get_value",GET_VALUE_CALLBACK:"yuque_sdk_get_value_callback",INSERT_VALUE:"yuque_sdk_insert_value",CHANGE_CALLBACK:"yuque_sdk_change_callback",SET_TITLE_VALUE:"yuque_sdk_set_title_value",GET_TITLE_VALUE:"yuque_sdk_get_title_value",GET_TITLE_VALUE_CALLBACK:"yuque_sdk_get_title_value_callback",SAVE_TITLE_CALLBACK:"yuque_sdk_save_title_callback",TITLE_CHANGE_CALLBACK:"yuque_sdk_title_change_callback",SCROLL_TO:"yuque_sdk_scroll_to",DOC_LOADED_CALLBACK:"yuque_sdk_doc_loaded_callback",UNLOCK:"yuque_sdk_unlock",UNLOCK_CALLBACK:"yuque_sdk_unlock_callback",RESET:"yuque_sdk_reset",RESET_CALLBACK:"yuque_sdk_reset_callback",LOAD_CALLBACK:"yuque_sdk_load_callback"},f=0,d=function(e){a(r,o);var t=l(r);function r(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(e=t.call(this)).init=function(t){e.url=location.href,e.target=t,e._postMessageToParent({type:s.CONNECT,url:e.url}),window.addEventListener("message",(function t(r){("string"==typeof r.data?JSON.parse(r.data):r.data).type===s.CONNECT&&(e._postMessageToParent({type:s.CONNECT,url:e.url}),window.removeEventListener("message",t,!1))}),!1),window.addEventListener("unload",(function(){e._postMessageToParent({type:s.DISCONNECT,url:e.url})}))},e._postMessageToParent=function(t){e.target&&e.target.postMessage(JSON.stringify(t),"*")},e.postMessage=function(t,r){var n={type:t,message:r,messageId:++f,url:e.url};e._postMessageToParent(n)},e.handleMessage=function(t){return e.emit("message",t)},e.ready=!1,e}return r}(),p=new d,h=function(e){try{var t="string"==typeof e.data?JSON.parse(e.data):e.data;p.handleMessage(t)}catch(e){console&&console.error(e)}};window&&window.parent&&window.self!==window.top&&(p.init(window.parent),window.addEventListener("message",h));t.MESSAGE_TYPES=s,t.eventHandler=h,t.handler=p,t.onMessage=function(e){return p.on("message",e)},t.postMessage=function(e,t){return p.postMessage(e,t)}},3780:function(e,t,r){"use strict";r(37);var n=r(10),o=r(64),a=r.n(o),i=r(480),c=r(3685),u=r(1321),l=r(3683),s=r(184),f=r(3463),d=r(282),p=r(50),h=r(3356),m=r(181),y=r(261),v=r.n(y),g=r(3684),b=r(174),w=r(3605),_={adaptDocPreviewImageToFormData:function(e){for(var t=new FormData,r=e.replace(/^data:image\/\w+;base64,/,""),n=window.atob(r),o=new Uint8Array(n.length),a=0;a<n.length;a++)o[a]=n.charCodeAt(a);var i=new Blob([o],{type:"image/png"});return t.append("file",i,"image.png"),t}};Object.assign(_,w.a);var E=_;function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function S(){S=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:A(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(N([])));E&&E!==r&&n.call(E,i)&&(w=E);var k=b.prototype=v.prototype=Object.create(w);function x(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==O(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(O(t)+" is not iterable")}return g.prototype=b,o(k,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(j.prototype),l(j.prototype,c,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(k),l(k,u,"Generator"),l(k,i,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function k(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function x(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,a=void 0,a=function(e,t){if("object"!==O(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==O(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===O(a)?a:String(a)),n)}var o,a}function j(e,t){return j=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},j(e,t)}function A(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=L(e);if(t){var o=L(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===O(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function L(e){return L=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},L(e)}var T=a()("editor:doc.biz"),C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&j(e,t)}(c,e);var t,r,n,o,a,i=A(c);function c(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=i.call(this,e,r)).dispatch=n,t.storage=b.a,t}return t=c,r=[{key:"doSaveOutdatedDocVersion",value:(o=S().mark((function e(t){return S().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.docVersions.create(t);case 2:case"end":return e.stop()}}),e)})),a=function(){var e=this,t=arguments;return new Promise((function(r,n){var a=o.apply(e,t);function i(e){k(a,r,n,i,c,"next",e)}function c(e){k(a,r,n,i,c,"throw",e)}i(void 0)}))},function(e){return a.apply(this,arguments)})}],n=[{key:"uploadCover",value:function(e){var t=e.image,r=e.doc_id,n=window.navigator.userAgent,o=v.a.detect(n);if(o.msie||o.msedge)return Promise.resolve(null);var a="/api/upload/attach?attachable_type=Doc&attachable_id=".concat(r,"&type=image"),i=E.adaptDocPreviewImageToFormData(t);return new Promise((function(e,t){Object(m.ajax)({url:a,data:i,dataType:"json",success:function(t){T("upload cover success",t.data),e(t.data.url)},error:function(){T("upload cover error"),t(new Error("DocEditorBiz.uploadCover failed."))},method:"POST",processData:!1})}))}}],r&&x(t.prototype,r),n&&x(t,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(g.a),P=C;function N(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=window.appData.callbackURL;if(r){if("SAME"===r)return;e=r}e&&(t.beforeRedirect&&t.beforeRedirect(),window.location.href=e)}var R=r(3572),I=r(3772),D=r.n(I),M=r(65),F=r.n(M),G=r(93),U=r(426),B=r.n(U),q=r(429),V=r.n(q);function z(e){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z(e)}function H(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,a=void 0,a=function(e,t){if("object"!==z(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===z(a)?a:String(a)),n)}var o,a}function W(e,t){return W=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},W(e,t)}function Y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=K(e);if(t){var o=K(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===z(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function K(e){return K=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},K(e)}var Q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&W(e,t)}(a,e);var t,r,n,o=Y(a);function a(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(r=o.call(this)).doc=e,r.clientId=t?t.clientId:V()(),t&&t instanceof a&&(r.parent=t),r.subCollabDoc={},r._init(),r}return t=a,(r=[{key:"data",get:function(){return this.collabId?this.doc.data[this.collabId]:this.doc.data}},{key:"commands",get:function(){var e,t;return this.collabId?null===(t=this.doc.data[this.collabId])||void 0===t?void 0:t.commands:null===(e=this.doc.data)||void 0===e?void 0:e.commands}},{key:"setClientId",value:function(e){this.clientId=e}},{key:"_init",value:function(){var e=this;this.doc.on("op",(function(t,r){if(e.clientId!==r&&0!==(t=e._pickOps(t)).length){var n=t.filter((function(e){return"commands"===e.p[0]&&e.li})),o=t.filter((function(e){return"commands"!==e.p[0]}));n.length>0&&e.emit("command",n.map((function(e){return e.li}))),o.length>0&&e.emit("op",o)}}))}},{key:"_setCollabId",value:function(e){this.parent&&(this.collabId=e)}},{key:"createSub",value:function(e){if(this.parent)throw new Error("只支持1级子协同");if(void 0===e)throw new Error("需要传递 collabId");this.subCollabDoc[e]&&this._collabIdExistError();var t=new a(this.doc,this);return t._setCollabId(e),this.subCollabDoc[e]=t,t}},{key:"submitOp",value:function(e){this.parent&&(e=this._transformToParentOp(e)),this.doc.submitOp(e,{source:this.clientId})}},{key:"submitCommand",value:function(e){this.data&&this.data.commands||this.submitOp([{p:["commands"],oi:[]}]);var t=this.data.commands.length;this.submitOp([{p:["commands",t],li:e}])}},{key:"create",value:function(e){if(this.parent)return this._requireCollabId(),void this.doc.submitOp([{p:[this.collabId],oi:e}],{source:this.clientId});this.doc.create(e,"json0",{source:this.clientId})}},{key:"_pickOps",value:function(e){var t=this;return this.collabId?e.filter((function(e){return e.p[0]===t.collabId})).map((function(e){var t=B()(e);return t.p=t.p.slice(1),t})):e.filter((function(e){return!t.subCollabDoc[e.p[0]]})).map((function(e){return B()(e)}))}},{key:"_transformToParentOp",value:function(e){var t=this;return this._requireCollabId(),e.forEach((function(e){e.p=[t.collabId].concat(e.p)})),e}},{key:"_requireCollabId",value:function(){if(!this.collabId)throw new Error("缺少 collabId")}},{key:"_collabIdExistError",value:function(){throw new Error("collabId 已存在")}}])&&H(t.prototype,r),n&&H(t,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(F.a),Z=r(3575);function J(e){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J(e)}function X(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function $(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ae(n.key),n)}}function ee(e,t){return ee=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ee(e,t)}function te(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=ne(e);if(t){var o=ne(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===J(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return re(e)}(this,r)}}function re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ne(e){return ne=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ne(e)}function oe(e,t,r){return(t=ae(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ae(e){var t=function(e,t){if("object"!==J(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==J(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===J(t)?t:String(t)}var ie=a()("editor:doc:collabManager"),ce=["#597EF7","#73D13D","#FF4D4F","#9254DE","#36CFC9","#FFA940","#F759AB","#40A9FF"],ue=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ee(e,t)}(a,e);var t,r,n,o=te(a);function a(e,t,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),oe(re(n=o.call(this)),"onMessage",(function(e){var t=JSON.parse(e.data);if(n._limitFetchRequest(t),t.action&&ie("message, action: ",t.action,t.data),"members"===t.action)return n.engine.setCollabMembers(t.data),n.addMembers(t.data),void n.reportCollabUserCount(t.data.length);if("join"===t.action)return n.engine.addCollabMember(t.data),void n.addMembers([t.data]);if("leave"===t.action)return n.engine.removeCollabMember(t.data),void n.removeMember(t.data);("ready"===t.action&&(n.engine.setCurrentMember(t.data),n.currentMember=t.data,n.loadCollabDoc()),"broadcast"===t.action)&&(t.data.body.user.uuid!==n.currentMember.uuid&&n.emit(h.i.message,t.data))})),n.doc=e,n.dispatch=t,n.ctx=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?X(Object(r),!0).forEach((function(t){oe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):X(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},r),n.initialContent=r.initialContent,n.socket=null,n.engine=r.engine,n.userClients=[],n.currentMember=null,n.MAX_FETCH_COUNT=100,n.fetchCount=0,n.startFetchTime=null,n}return t=a,(r=[{key:"reset",value:function(){this.userClients=[],this.currentMember=null,this.disconnect()}},{key:"resetDoc",value:function(e){this.doc=e,e.collab&&(this.ctx.collab=e.collab)}},{key:"connect",value:function(){var e=this;this.reset();var t=this.ctx.collab;if(t){var r="".concat(t.host,"/?id=").concat(t.id,"&token=").concat(t.token);ie("connect",r);var n=new Z.a(r);n.on("ready",(function(t){t&&(e.socket=t,t.addEventListener("message",e.onMessage),e.connectTime=+new Date)})),n.on("close",(function(t){ie("collab server connection close",{event:t});var r=!!e.socket;e.disconnect(),!r||e.justConnect()?e.emit(h.i.error,{code:h.d.CONNECT_COLLAB_SERVER_FAILED,message:t.message,stack:t.stack}):e.emit(h.i.error,{code:h.d.DISCONNECTED,message:t.message,stack:t.stack})})),n.on("error",(function(e){throw ie("collab server connection close",{event:e}),e})),n.on("congestion",(function(){e.transmitNetStatus(h.g.congestion)})),n.on("congestionEnd",(function(){e.transmitNetStatus(h.g.online)})),this.connection=n}}},{key:"justConnect",value:function(){return this.connectTime&&+new Date-this.connectTime<2e4}},{key:"reportCollabUserCount",value:function(e){var t=this.doc.format;G.a.logCollabUserCount(t,e)}},{key:"_limitFetchRequest",value:function(e){if("f"===e.a)if(this.fetchCount+=1,this.startFetchTime){var t=+new Date;this.fetchCount>this.MAX_FETCH_COUNT&&1e3*this.fetchCount/(t-this.startFetchTime)>this.MAX_FETCH_COUNT&&(this.disconnect(),this.transmitNetStatus(h.g.congestion))}else this.startFetchTime=+new Date;else this.fetchCount=0,this.startFetchTime=null}},{key:"loadCollabDoc",value:function(){var e=this,t=this.ctx.collab;ie("start load collab doc",t.id);var r=new D.a.Connection(this.socket);r.on("receive",(function(e){ie("receive",e.data)}));var n=r.get("lake",t.id);n.subscribe((function(t){if(t)ie("collab doc subscribe error",t);else try{ie("ot doc loaded",n),e.initOt(n),e.emit(h.i.collabUsersChange,e.normalizeMembers())}catch(t){e.emit(h.i.error,{code:h.d.COLLAB_DATA_INIT_ERROR,error:t,message:t.message})}})),n.on("create",(function(){ie("collab doc create",n)})),n.on("load",(function(){})),n.on("op",(function(e,t){})),n.on("del",(function(e,t){ie("collab doc deleted",e,t)})),n.on("error",(function(e){ie("collab doc error",{error:e,origin_code:e.code})}))}},{key:"initOt",value:function(e){ie("init ot"),this.engine.initCollabDoc(new Q(e)),this.connection.startHeartBeat(),this.emit("ready")}},{key:"disconnect",value:function(){try{this.socket&&(this.socket.removeEventListener("message",this.onMessage),this.socket=null),this.connection&&(this.connection.disconnect(),this.connection=null)}catch(e){}}},{key:"isAlive",value:function(){return!!this.connection}},{key:"isOnlyOneCollabSession",value:function(){return 1===this.userClients.length}},{key:"needRedirectToLock",value:function(){return!this.socket||!(!this.connection||"congestion"!==this.connection.netStatus||!this.isOnlyOneCollabSession())}},{key:"onDocDeleted",value:function(){ie("doc deleted"),this.connection&&this.connection.broadcast(h.f.DOC_DELETED,{user:this.currentMember})}},{key:"onDocPublished",value:function(){ie("doc deleted"),this.connection&&this.connection.broadcast(h.f.DOC_PUBLISHED,{user:this.currentMember})}},{key:"addMembers",value:function(e){this.userClients=this.userClients.concat(e),this.emit(h.i.collabUsersChange,this.normalizeMembers())}},{key:"removeMember",value:function(e){this.userClients=this.userClients.filter((function(t){return t.uuid!==e.uuid})),this.emit(h.i.collabUsersChange,this.normalizeMembers())}},{key:"setMemberColor",value:function(e){var t=((e.iid||1)-1)%ce.length;e.color=ce[t]}},{key:"normalizeMembers",value:function(){for(var e=[],t={},r=this.userClients.length;r>0;r--){var n=this.userClients[r-1];n.color||(n.color=this.setMemberColor(n)),t[n.login]||(t[n.login]=n,n.login!==this.ctx.me.login&&e.push(n))}return e}},{key:"transmitNetStatus",value:function(e){this.emit(h.i.netStatusChange,e)}},{key:"destroy",value:function(){this.disconnect()}}])&&$(t.prototype,r),n&&$(t,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(F.a),le=ue;function se(e){return se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},se(e)}function fe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function de(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fe(Object(r),!0).forEach((function(t){Oe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function pe(){pe=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==se(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(se(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function he(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return me(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return me(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function me(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ye(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function ve(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){ye(a,n,o,i,c,"next",e)}function c(e){ye(a,n,o,i,c,"throw",e)}i(void 0)}))}}function ge(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Se(n.key),n)}}function be(e,t){return be=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},be(e,t)}function we(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Ee(e);if(t){var o=Ee(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===se(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _e(e)}(this,r)}}function _e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ee(e){return Ee=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ee(e)}function Oe(e,t,r){return(t=Se(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Se(e){var t=function(e,t){if("object"!==se(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==se(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===se(t)?t:String(t)}var ke=a()("editor:doc:wf"),xe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&be(e,t)}(w,e);var t,r,o,a,c,m,y,v,g,b=we(w);function w(e){var t,r=e.group,o=e.book,a=e.doc,i=e.docDomain,c=e.dispatch,f=e.params,d=e.mode,m=e.scene,y=e.onPublishSuccessRedirect,v=void 0===y?function(e){return setTimeout((function(){return N(e)}),1e3)}:y,g=e.disableAutoSave,_=e.me,E=void 0===_?window.appData.me:_,O=e.pageStatus;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,w),Oe(_e(t=b.call(this,{doc:a,mode:d,scene:m})),"doBindEvents",(function(){t.pageStatus.on(l.a.CLOSE,t.onPageLeave.bind(_e(t))),t.pageStatus.on(l.a.INACTIVE,t.onPageInactive.bind(_e(t))),t.pageStatus.on(l.a.ACTIVE,t.onPageActive.bind(_e(t))),t.pageStatus.on(l.a.ONLINE,t.onPageOnline.bind(_e(t))),t.pageStatus.on(l.a.OFFLINE,t.onPageOffline.bind(_e(t))),t.pageStatus.registerCloseChecker(t.closeAble.bind(_e(t))),t.pageStatus.on(l.a.INACTIVE,(function(){t.performance.pause()})),t.pageStatus.on(l.a.ACTIVE,(function(){t.performance.resume()})),t.pageStatus.on(l.a.CLOSE,(function(){t.performance.reportSmooth(),t.userAction.report()}))})),Oe(_e(t),"_fetchMentionDocsHandler",(function(e,r){return e.map((function(e){return e.group=r?t.group.name:e.group_name,e.book=r?t.book.name:e.belong,e}))})),Oe(_e(t),"getDefaultSuggestions",ve(pe().mark((function e(){var r;return pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([null!==(r=t.book.abilities)&&void 0!==r&&r.read?p.a.books.docs({id:t.book.id,order_by:"published_at"}):[],p.a.users.listDocContextUsers({id:t.doc.id})]).then((function(e){var r=he(e,2),n=r[0],o=r[1];return{docs:t._fetchMentionDocsHandler(n,!0),users:o}})));case 1:case"end":return e.stop()}}),e)})))),Oe(_e(t),"onMentionSearch",function(){var e=ve(pe().mark((function e(r,n){var o,a;return pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",t.getDefaultSuggestions());case 2:return o=function(){var e=ve(pe().mark((function e(){return pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=6;break}return e.next=3,p.a.books.docs({id:t.book.id,order_by:"published_at"}).then((function(e){return t._fetchMentionDocsHandler(e,!0)}));case 3:e.t0=e.sent,e.next=9;break;case 6:return e.next=8,p.a.editor.search({q:r,type:"content",related:!0,range:"title"}).then((function(e){return t._fetchMentionDocsHandler(e||[])}));case 8:e.t0=e.sent;case 9:return e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),a=function(){var e=ve(pe().mark((function e(){return pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",p.a.users.complete({q:r,target_type:t.docDomain,target_id:t.doc.id}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",Promise.all([o(),a()]).then((function(e){return{docs:e[0],users:e[1]}})));case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),Oe(_e(t),"doIgnoreSave",(function(e){return!(e!==h.h.AUTO||!t.disableAutoSave)})),Oe(_e(t),"doSaveDoc",function(){var e=ve(pe().mark((function e(r){var n,o,a,i,c,l,f,d,p,m,y,v,g;return pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=_e(t),o=n.doc,a=o.id,i=o.format,c={fullHTML:t.openEditorConfig.fullHTML},"Table"===o.type&&r===h.h.USER_PUBLISH&&(c.fullBody=!0),l=t.engine.getEditorContent(c),f=l.content,d=l.html,ke("doSaveDoc",t.currentMode),p={save_type:r===h.h.AUTO?"auto":"user",edit_type:"collab"===t.currentMode?u.EDIT_TYPE.LAKE_COLLAB:u.EDIT_TYPE.LAKE},t.autoPublish&&(p.target_uuid=new URLSearchParams(window.location.search).get("toc_node_uuid")),m={id:a,format:u.FORMAT_REPAIR_MAP[i]||i,body_asl:f,body:d,body_html:d,draft_version:o.draft_version,sync_dynamic_data:!1},"Show"===o.type&&(m.cover=(null==r||null===(y=r.shows)||void 0===y||null===(v=y[0])||void 0===v?void 0:v.thumb)||null),m.draft_version||(m._without_draft_version=1),ke("doc save lake doc: ",m),e.next=15,t.modelProxy.updateContent(t.docDomain===s.DOCLET?m:de(de({},m),p),{ignoreGlobalMessage:!0});case 15:return g=e.sent,e.abrupt("return",g);case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Oe(_e(t),"doPublishDoc",function(){var e=ve(pe().mark((function e(r){var n,o,a;return pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.autoPublish){e.next=2;break}return e.abrupt("return");case 2:return r=r||{notify:!1},n={id:t.doc.id,force:!1,notify:!0===r.notify,cover:null,ignoreGlobalMessage:!0},window.h5&&(n.insertToCatalog=!0),e.next=7,t.getDocCover();case 7:return(o=e.sent)&&(n.cover=o),a=t.docDomain===s.DOCLET?{id:t.doc.id}:n,e.next=12,t.modelProxy.publish(a,{ignoreGlobalMessage:!0});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Oe(_e(t),"getOpenEditorConfig",(function(){return t.openEditorConfig})),Oe(_e(t),"useTemplate",(function(e){var r,o=e.title,a=e.content;t.engine.setContent(a),t.transmitDocStatus(h.a.changed);var i=(null==o||null===(r=o.trim)||void 0===r?void 0:r.call(o))||t.doc.title;t.isDefaultTitle(i)||p.a.docs.updateMeta({id:t.doc.id,title:i}).then((function(){t.dispatch({type:"doc/update",payload:{title:i}})})).catch((function(e){n.a.warn("save title failed")})),t.doc.title=i})),t.group=r,t.book=o,t.params=f||{},t.dispatch=c,t.me=E,t.docDomain=i||s.DOC,t.modelProxy=i===s.DOCLET?p.a.doclets:p.a.docs,t.onPublishSuccessRedirect=v,t.disableAutoSave=g,t.openEditorConfig=new R.a,t.pageStatus=O||new l.b,t}return t=w,r=[{key:"autoPublish",get:function(){return this.book&&this.book.enable_auto_publish&&this.docDomain!==s.DOCLET}},{key:"onStarted",value:function(){this.startAutoSave(),this.performance.startHeartbeat()}},{key:"onDestroy",value:function(){this.pageStatus.destroy(),n.a.destroy(),this.clearAutoSave()}},{key:"onSaveSuccess",value:function(){if(this.startAutoSave(),this.autoPublish)try{this.saveEditorMeta({isDraft:!1})}catch(e){ke("saveEditorMeta error",e)}this.performance.reportSmooth()}},{key:"clearAutoSave",value:function(){this.autoSaveTimer&&clearTimeout(this.autoSaveTimer)}},{key:"startAutoSave",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:600;if(this.disableAutoSave)return!1;this.clearAutoSave(),this.autoSaveTimer=setTimeout((function(){e._inStopWatch("autosaveConflict")?e.startAutoSave(10):(e.save(h.h.AUTO),e.startAutoSave())}),1e3*t)}},{key:"onLockError",value:function(e){return e.code===h.d.LOCKED_BY_COLLAB&&this.defaultMode===h.b.COLLAB&&this.collabConnected&&(e.code=h.d.LOCKED_BY_COLLAB_DISCONNECT),!1}},{key:"createEditorBiz",value:function(e){return new P(e,{docDomain:this.docDomain},this.dispatch)}},{key:"onDocUpdated",value:function(e){var t=this;if(!this.destroying){var r={};!e.contributors||this.doc.contributors&&this.doc.contributors.length===e.contributors.length||(r.contributors=e.contributors),r.content_updated_at=e.content_updated_at,e.description&&(r.description=e.description),Object(i.c)((function(){t.dispatch({type:"doc/update",payload:de({},r)}),t.dispatch({type:"book/updateDoc",payload:de({id:e.id},r)})})),this.collab=e.collab}}},{key:"needCache",value:function(){var e;return!(this.openEditorConfig.isServify&&!this.openEditorConfig.saveToServer)&&"laketable"!==(null===(e=this.doc)||void 0===e?void 0:e.format)}},{key:"needLoad",value:function(){return!(this.openEditorConfig.isServify&&!this.openEditorConfig.saveToServer)}},{key:"doLoadDoc",value:(g=ve(pe().mark((function e(){var t,r,n,o,a,i;return pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.doc,o=this.docDomain===s.DOCLET?{id:n.id,category:s.CATEGORY.BOOK_INDEX_PAGE,target_type:"Book",target_id:n.target_id}:{id:n.slug,book_id:n.book_id,mode:"edit",merge_dynamic_data:!1},Object(d.b)("start-loadDoc"),e.next=5,this.modelProxy.findOne(o,{ignoreGlobalMessage:!0,useOriginResp:!0});case 5:return a=e.sent,(i=de({},a.data)).readerEditModeData=a.meta,Object(d.b)("finish-loadDoc"),Object(d.b)("doc-size",(null==i||null===(t=i.body_draft_asl)||void 0===t?void 0:t.length)||(null==i||null===(r=i.body_draft)||void 0===r?void 0:r.length)||0),e.abrupt("return",i);case 11:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"onDocRendered",value:function(){Object(d.b)("finish-doc-render")}},{key:"doCreateCollabManager",value:function(){return new le(this.doc,this.dispatch,{book:this.book,group:this.group,engine:this.engine,me:this.me,collab:this.collab,initialContent:this.initialDocument.value})}},{key:"getDocCover",value:(v=ve(pe().mark((function e(){var t;return pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.engine.getThumbnail();case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0="";case 5:if(!(t=e.t0).startsWith("https:")){e.next=8;break}return e.abrupt("return",t);case 8:if(!t){e.next=18;break}return e.prev=9,e.next=12,P.uploadCover({image:t,doc_id:this.doc.id});case 12:return e.abrupt("return",e.sent);case 15:e.prev=15,e.t1=e.catch(9),ke("upload cover error",e.t1);case 18:case"end":return e.stop()}}),e,this,[[9,15]])}))),function(){return v.apply(this,arguments)})},{key:"isActive",value:function(){return this.pageStatus.isActive}},{key:"onPublishSuccess",value:(y=ve(pe().mark((function e(){return pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.docDomain!==s.DOCLET)try{this.saveEditorMeta({isDraft:!1})}catch(e){ke("saveEditorMeta error",e)}this.currentMode===h.b.LOCK&&this.exit({unlock:!0}),this.currentMode===h.b.COLLAB&&this.collabManager&&this.collabManager.onDocPublished(),f.c.saveEditPosition(this.doc.id,this.doc.format),this.performance.reportSmooth(),this.userAction.report(),window.__readerEditMode||this.destroying||this.onPublishSuccessRedirect(this.buildRedirectToUrlForPublish());case 7:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"doLock",value:(m=ve(pe().mark((function e(t){return pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.modelProxy.lock(t,{ignoreGlobalMessage:!0}));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"doUnlock",value:(c=ve(pe().mark((function e(t){return pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.modelProxy.unlock(t,{ignoreGlobalMessage:!0}));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"buildRedirectToUrlForPublish",value:function(){var e=this.book,t=this.doc,r=this.params,n=this.docDomain;return"lakesheet"===t.format&&n===s.DOC?"/".concat(e.namespace,"/").concat(t.slug).concat(window.location.hash):n===s.DOCLET?t.category===s.CATEGORY.TEMPLATE?window.location.href.replace(/\/[^\/]+?$/,""):"/".concat(window.appData.group.login,"/").concat(window.appData.book.slug):r.group&&r.book?"/".concat(r.group,"/").concat(r.book,"/").concat(t.slug):"/go/doc/".concat(t.id)}},{key:"doSaveEditorMeta",value:(a=ve(pe().mark((function e(t){return pe().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.docDomain!==s.DOCLET){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,0!==Object.keys(JSON.parse(t.meta_draft||{})).length||0!==Object.keys(JSON.parse(t.meta||{})).length){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,p.a.docs.updateEditorMeta(t);case 7:if(!this.destroying){e.next=9;break}return e.abrupt("return");case 9:this.dispatch({type:"doc/updateEditorMetas",payload:t}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),console.log(e.t0);case 15:case"end":return e.stop()}}),e,this,[[2,12]])}))),function(e){return a.apply(this,arguments)})},{key:"isDefaultTitle",value:function(e){return P.isDefaultTitle(e)}},{key:"onDocDeleted",value:function(){var e=this.group,t=this.book;this.currentMode===h.b.COLLAB&&this.collabManager.onDocDeleted(),setTimeout((function(){N("/".concat(e.login,"/").concat(t.slug))}),300)}}],r&&ge(t.prototype,r),o&&ge(t,o),Object.defineProperty(t,"prototype",{writable:!1}),w}(c.a);xe.WORKFLOW_EVENT=h.i,xe.DOC_STATUS=h.a,xe.SAVE_TYPE=h.h,xe.EDIT_MODE=h.b,xe.EDIT_SCENE=h.c;t.a=xe},3781:function(e,t,r){"use strict";r(37);var n=r(10),o=(r(1508),r(1509)),a=(r(41),r(9)),i=r(0),c=r.n(i),u=r(2),l=r.n(u),s=r(1858),f=r(1859),d=r(1861),p=r(61),h=r(5),m=r.n(h),y=r(35),v=r(3301),g=r(22),b="StatusView-module_wrap_8c-mq",w="StatusView-module_tip_DFrDV",_="StatusView-module_error_cvob-",E="StatusView-module_title_8Zp5n",O="StatusView-module_content_80A7-",S="StatusView-module_contentIcon_vp-6I",k="StatusView-module_action_FlBG8",x="StatusView-module_mask_CFGUv";function j(e){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j(e)}function A(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==j(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==j(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===j(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function L(e){var t,r,u,l=e.book,h=e.doc,j=e.error,L=e.docStatus,T=e.onReload,C=e.wfMessage,P=e.onClear,N=Object(y.useParams)().doc,R=c.a.createElement(a.a,{type:"primary",onClick:T,"data-testid":"reload"},__("重新加载")),I=c.a.createElement(a.a,{type:"primary",onClick:P,"data-testid":"clearError"},__("知道了")),D=function(e,t){o.a.destroy(),o.a.open({message:c.a.createElement("div",{"data-testid":e},t)})},M={Unauthorized:__("登录过期，请刷新页面重新登录"),"Failed to fetch":__("请求异常"),"Not Found":__("当前文档不存在或已被删除"),"request entity too large":__("文档内容太大，无法保存"),"502 Bad Gateway":__("服务器繁忙，请稍后再试"),"<h3>404</h3>":__("当前文档已被删除或移走"),"无权限访问":__("当前文档缺少权限或权限被移除"),"服务中断":__("服务器繁忙，请稍后再试")},F=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";for(var t in M)if(e&&e.includes(t))return M[t];return e},G=c.a.createElement("div",{className:_,"data-testid":"network-error-view"},c.a.createElement("p",{className:E},c.a.createElement(s.default,null)," ",__("文档加载失败")),c.a.createElement("p",{className:O},__("网络异常，请检查网络连接是否正常")),c.a.createElement("p",{className:k},R)),U=c.a.createElement("div",{className:_,"data-testid":"locked-by-self-collab-error-view"},c.a.createElement("p",{className:E},c.a.createElement(s.default,null)," ",__("你正在其它窗口编辑该文档")),c.a.createElement("p",{className:O},__("请重新加载最新的编辑内容")),c.a.createElement("p",{className:k},R)),B=c.a.createElement("div",{className:_,"data-testid":"locked-by-desktop-error-view"},c.a.createElement("p",{className:E},c.a.createElement(s.default,null)," ",__("你正在使用语雀桌面端编辑此文档")),c.a.createElement("p",{className:O},__("语雀当前不支持使用桌面端和浏览器同时编辑")),c.a.createElement("p",{className:k},c.a.createElement(a.a,{href:l?"/".concat(l.namespace,"/").concat(h.slug):"/dashboard"},__("退出编辑")))),q=c.a.createElement("div",{className:_,"data-testid":"locked-by-versionConflict-error-view"},c.a.createElement("p",{className:E},c.a.createElement(s.default,null)," ",__("文档内容有更新")),c.a.createElement("p",{className:O},__("请基于最新内容重新编辑")),c.a.createElement("p",{className:k},R)),V=function(e){var t=e.type;D(t,__("正在保存，请稍候"))};if(C&&!C.readed){switch(C.type){case v.MESSAGE.DOC_PUBLISHED:r=(t=C).body,u=t.type,D(u,__("{user} 刚刚 {action} 了文档",{user:r.user.name,action:h.published_at?__("更新"):__("发布")}));break;case v.MESSAGE.DOC_CACHE_SAVED:!function(e){var t=e.type;D(t,__("已为你加载最新编辑版本，本地离线缓存已保存到历史版本"))}(C);break;case v.MESSAGE.SAVING:V(C);break;case v.MESSAGE.SAVED:!function(e){var t=e.type;D(t,__("文档已保存"))}(C);break;case v.MESSAGE.SAVE_FAILED:!function(e){D(e.type,c.a.createElement(c.a.Fragment,null,c.a.createElement("p",null,__("网络异常，保存失败")),c.a.createElement("p",null,__("编辑内容暂存至本地缓存中，请在网络恢复后，重新保存"))))}(C);break;case v.MESSAGE.DISCONNECT:!function(e){D(e.type,__("网络连接异常，编辑内容已保存至离线缓存"))}(C);break;case v.MESSAGE.UNREADY:!function(e){D(e.type,__("文档准备中，请稍候"))}(C);break;case v.MESSAGE.EDIT_DISABLE:!function(e){D(e.type,__("正在连接服务，已保存至离线缓存，请稍后重试"))}(C);break;case v.MESSAGE.CACHE_FAILED:!function(e){D(e.type,__("本地缓存失败，避免丢失内容，请手动保存"))}(C);break;case v.MESSAGE.RENDER_BIG_DOCUMENT:!function(e){D(e.type,__("文档较大，正在努力渲染，请稍等一下"))}(C);break;case v.MESSAGE.BUZY:C.data.docStatus===v.DOC_STATUS.saving?V(C):C.data.docStatus===v.DOC_STATUS.publishing&&function(e){var t=e.type;D(t,__("正在发布，请稍候"))}(C);break;case v.MESSAGE.CLEAR:o.a.destroy()}C.readed=!0}Object(i.useEffect)((function(){return L===v.DOC_STATUS.loading?(n.a.destroy(),g.c||n.a.loading(c.a.createElement("span",{"data-testid":"loading"},__("正在加载")),0)):L===v.DOC_STATUS.published?(n.a.destroy(),n.a.success(c.a.createElement("span",{"data-testid":"loading"},__("内容发布成功")),3)):L===v.DOC_STATUS.loaded&&n.a.destroy(),function(){n.a.destroy()}}),[L]),Object(i.useEffect)((function(){n.a.destroy()}),[N]);var z,H,W,Y=!1,K="";if(j&&!j.readed)switch(j.code){case v.ERROR_CODE.INIT_FAILED:K="network"===j.type?G:c.a.createElement("div",{className:_,"data-testid":"load-doc-fail-view"},c.a.createElement("p",{className:E},c.a.createElement(s.default,null)," ",__("文档加载失败")),404===j.status?c.a.createElement(c.a.Fragment,null,c.a.createElement("p",{className:O,"data-testid":"doc-not-found"},__("文档已被删除或无访问权限")),c.a.createElement("p",{className:k},c.a.createElement(a.a,{href:l?"/".concat(l.namespace,"/").concat(h.slug):"/dashboard"},__("退出编辑")))):c.a.createElement(c.a.Fragment,null,c.a.createElement("p",{className:O,"data-testid":"doc-load-error"},__("你可以尝试重新加载，或者退出编辑")),c.a.createElement("p",{className:k},c.a.createElement(a.a,{href:l?"/".concat(l.namespace,"/").concat(h.slug):"/dashboard"},__("退出编辑")),404!==j.status&&R))),Y=!0;break;case v.ERROR_CODE.SAVE_FAILED:W=j.message,K=c.a.createElement("div",{className:_,"data-testid":"save-failed-error-view"},c.a.createElement("p",{className:E},c.a.createElement(s.default,null)," ",__("文档保存失败")),c.a.createElement("p",{className:O},F(W)),c.a.createElement("p",{className:O},__("本次编辑的内容已经保存至离线缓存")),c.a.createElement("p",{className:k},I)),Y=!0;break;case v.ERROR_CODE.PUBLISH_FAILED:K=function(e){return c.a.createElement("div",{className:_,"data-testid":"publish-failed-error-view"},c.a.createElement("p",{className:E},c.a.createElement(s.default,null)," ",__("文档发布失败")),c.a.createElement("p",{className:O},F(e)),c.a.createElement("p",{className:O},__("本次编辑的内容已经保存至离线缓存")),c.a.createElement("p",{className:k},I))}(j.message),Y=!0;break;case v.ERROR_CODE.LOCKED_BY_COLLAB:H=j.lock.collab_members,K=c.a.createElement("div",{className:_,"data-testid":"locked-by-collab-error-view"},c.a.createElement("p",{className:E},c.a.createElement(s.default,null)," ",__("{user} 正在与其他人编辑该文档",{user:H[0].name})),c.a.createElement("p",{className:O},__("当前网络无法进入协同编辑，请检查网络后刷新重试")),c.a.createElement("p",{className:k},R)),Y=!0;break;case v.ERROR_CODE.LOCKED_BY_COLLAB_DISCONNECT:K=function(e){return c.a.createElement("div",{className:_,"data-testid":"locked-by-collab-disconnect-error-view"},c.a.createElement("p",{className:E},c.a.createElement(s.default,null)," ",__("{user} 正在与其他人编辑该文档",{user:e[0].name})),c.a.createElement("p",{className:O},__("当前网络已断开实时同步，请检查网络后刷新页面，重新加入协同")))}(j.lock.collab_members),Y=!0;break;case v.ERROR_CODE.LOCKED_BY_SELF_COLLAB:K=U,Y=!0;break;case v.ERROR_CODE.LOCKED_BY_OTHER:z=j.lock.locker,K=c.a.createElement("div",{className:_,"data-testid":"locked-by-other-error-view"},c.a.createElement("p",{className:E},c.a.createElement(s.default,null)," ",__("{user} 正在编辑该文档",{user:z.name})),c.a.createElement("p",{className:O},__("请等待对方完成编辑后，再进行编辑")),c.a.createElement("p",{className:k},c.a.createElement(a.a,{href:l?"/".concat(l.namespace,"/").concat(h.slug):"/dashboard"},__("退出编辑")))),Y=!0;break;case v.ERROR_CODE.LOCKED_BY_DESKTOP:K=B,Y=!0;break;case v.ERROR_CODE.LOCKED_BY_VERSIONCONFLICT:K=q,Y=!0;break;case v.ERROR_CODE.LOCK_FAILED:K=function(e){return c.a.createElement("div",{className:_,"data-testid":"lock-failed-error-view"},c.a.createElement("p",{className:E},c.a.createElement(s.default,null)," ",__("无法获得单人编辑权限")),c.a.createElement("p",{className:O},F(e)),c.a.createElement("p",{className:O},__("为避免编辑出错，请检查后重试")),c.a.createElement("p",{className:k},R))}(j.message),Y=!0;break;case v.ERROR_CODE.DOC_DELETED:K=function(e){return c.a.createElement("div",{className:_,"data-testid":"doc-deleted-view"},c.a.createElement("p",{className:E},c.a.createElement(s.default,null)," ",__("当前文档已被 {user} 删除",{user:e.body.user.name})),c.a.createElement("p",{className:O},__("你可以通过知识库的 回收站 找到此篇文档")),c.a.createElement("p",{className:k},I))}(j.data),Y=!0;break;case v.ERROR_CODE.DOC_NOT_EXIST:K=c.a.createElement("div",{className:_,"data-testid":"publish-failed-error-view"},c.a.createElement("p",{className:E},c.a.createElement(s.default,null)," ",__("文档保存失败")),c.a.createElement("p",{className:O},__("文档不存在或者已经被删除")),c.a.createElement("p",{className:k},I)),Y=!0;break;case v.ERROR_CODE.DOC_SAVE_CONFLICT:K=c.a.createElement("div",{className:_,"data-testid":"publish-failed-error-view"},c.a.createElement("p",{className:E},c.a.createElement(s.default,null)," ",__("文档保存冲突")),c.a.createElement("p",{className:O},__("文档已被修改，此次保存将保存到历史版本，请重新加载并基于最新文档进行编辑")),c.a.createElement("p",{className:k},R)),Y=!0;break;case v.ERROR_CODE.CACHE_FAILED:K=c.a.createElement("div",{className:_,"data-testid":"cache-failed-view"},c.a.createElement("p",{className:E},c.a.createElement(s.default,null)," ",__("自动保存提醒")),c.a.createElement("p",{className:O},__("本地自动缓存失败，请记得及时手动保存")," ",p.ua.macos?"Cmd + S":"Ctrl + S"),c.a.createElement("p",{className:k},I)),Y=!0;break;case v.ERROR_CODE.CONTENT_UNREADY:K=c.a.createElement("div",{className:_,"data-testid":"content-unready"},c.a.createElement("p",{className:E},c.a.createElement(s.default,null)," ",__("保存提醒")),c.a.createElement("p",{className:O},__("检测有尚未上传完成的文件，请检查确认后再关闭页面！")),c.a.createElement("p",{className:k},I)),Y=!0;break;case v.ERROR_CODE.DATA_ERROR:K=c.a.createElement("div",{className:_,"data-testid":"data-error-view"},c.a.createElement("p",{className:E},c.a.createElement(f.default,null)," ",__("数据异常")),c.a.createElement("p",{className:O},__("检测到异常数据，请将本次修改部分备份后，刷新页面重新编辑")),c.a.createElement("p",{className:k},I)),Y=!0;break;case v.ERROR_CODE.COLLAB_DATA_INIT_ERROR:K=c.a.createElement("div",{className:_,"data-testid":"collab-data-init-error-view"},c.a.createElement("p",{className:E},c.a.createElement(f.default,null)," ",__("协同数据初始化异常")),c.a.createElement("p",{className:O},__("协同数据存在异常，请刷新页面重新编辑")),c.a.createElement("p",{className:k},I)),Y=!0;break;case v.ERROR_CODE.RENDER_FAILED:K=g.g&&"markdown"===(h.origin_format||h.format)?c.a.createElement("div",{className:_,"data-testid":"render-failed-view-desktop-markdown"},c.a.createElement("p",{className:S},c.a.createElement(d.default,{width:22,height:22})," ",__("抱歉，桌面端暂不支持 Markdown 文档编辑器")),c.a.createElement("p",{className:k},c.a.createElement(a.a,{onClick:function(){return window.__setEditMode(!1)}},__("取消")),c.a.createElement(a.a,{type:"primary",onClick:function(){window.YuqueDesktopAppJSBridge.openExternalLink(window.location.href),window.__setEditMode(!1)}},__("去网页编辑")))):c.a.createElement("div",{className:_,"data-testid":"render-failed-view"},c.a.createElement("p",{className:E},c.a.createElement(s.default,null)," ",__("渲染失败")),c.a.createElement("p",{className:O},__("数据存在异常，可刷新重试，或反馈区留言")),c.a.createElement("p",{className:k},R)),Y=!0;break;case v.ERROR_CODE.COMMAND_ERROR:n.a.destroy(),n.a.error(c.a.createElement("span",{"data-testid":j.code},__("出现异常错误，可刷新重试"))),j.readed=!0}return K?c.a.createElement("div",{"data-testid":"mask",className:m()(b,A({},x,Y))},c.a.createElement("div",{className:w},K)):null}L.propTypes={netStatus:l.a.string,docStatus:l.a.string,collabUsers:l.a.array,book:l.a.object,doc:l.a.object.isRequired,error:l.a.object,wfMessage:l.a.object,onReload:l.a.func,onClear:l.a.func};t.a=L},3789:function(e,t,r){"use strict";r(37);var n=r(10),o=r(0),a=r(64),i=r.n(a),c=r(282),u=r(3356),l=r(3780),s=r(790),f=r(1004),d=r(289),p=i()("useBroadcastChannel");function h(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};Object(o.useEffect)((function(){var n=e.current;if(n)return n.addEventListener(t,r),function(){return n.removeEventListener(t,r)}}),[e,t,r])}var m=r(22);function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function v(){v=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof b?t:b,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:A(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",g={};function b(){}function w(){}function _(){}var E={};l(E,i,(function(){return this}));var O=Object.getPrototypeOf,S=O&&O(O(N([])));S&&S!==r&&n.call(S,i)&&(E=S);var k=_.prototype=b.prototype=Object.create(E);function x(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==y(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(y(t)+" is not iterable")}return w.prototype=_,o(k,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(j.prototype),l(j.prototype,c,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(k),l(k,u,"Generator"),l(k,i,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){w(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function w(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==y(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===y(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function E(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){_(a,n,o,i,c,"next",e)}function c(e){_(a,n,o,i,c,"throw",e)}i(void 0)}))}}function O(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return S(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var k=i()("editor:doc:vm");t.a=function(e){var t,r,a,i,y=e.doc,g=e.docDomain,w=e.book,_=e.group,S=e.dispatch,x=e.onPublishSuccessRedirect,j=e.me,A=e.readerEditMode,L=void 0!==A&&A,T=e.matchCondition,C=void 0===T?window.appData.matchCondition||{}:T,P=e.currentDocSlug,N=C.useEditorTileRendering,R=C.useEditorTileRenderingForOT,I=C.editType,D=void 0===I?"":I,M=D.includes("Collab")?u.b.COLLAB:u.b.LOCK,F=O(Object(o.useState)(!1),2),G=F[0],U=F[1],B=O(Object(o.useState)(!1),2),q=B[0],V=B[1],z=O(Object(o.useState)(!1),2),H=z[0],W=z[1],Y=O(Object(o.useState)(null),2),K=Y[0],Q=Y[1],Z=O(Object(o.useState)(!1),2),J=Z[0],X=Z[1],$=O(Object(o.useState)(null),2),ee=$[0],te=$[1],re=O(Object(o.useState)([]),2),ne=re[0],oe=re[1],ae=O(Object(o.useState)(M),2),ie=ae[0],ce=ae[1],ue=O(Object(o.useState)(null),2),le=ue[0],se=ue[1],fe=O(Object(o.useState)(u.a.loading),2),de=fe[0],pe=fe[1],he=O(Object(o.useState)(""),2),me=he[0],ye=he[1],ve=O(Object(o.useState)(y.title),2),ge=ve[0],be=ve[1],we=(t="sync_doc_title_".concat(y.id),r=function(e){return S({type:"doc/update",payload:{title:e.data}})},h(i=Object(o.useRef)("undefined"!=typeof window&&"BroadcastChannel"in window?new BroadcastChannel("".concat(t,"-channel")):null),"message",r),h(i,"messageerror",a),Object(o.useCallback)((function(e){var t;null==i||null===(t=i.current)||void 0===t||t.postMessage(e),p("postMessage",e)}),[i])),_e=Object(f.a)(ge),Ee=Object(f.a)(w.toc);Object(o.useEffect)((function(){return E(v().mark((function e(){var t,r,n;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=_e.current,!L||y.title===t||y.slug!==P||!t){e.next=7;break}return r=Ee.current,n=r.map((function(e){return e.url===P?b(b({},e),{},{title:t}):e})),S({type:"book/updateToc",payload:n}),e.next=7,Object(d.updateMeta)({id:y.id,title:t});case 7:case"end":return e.stop()}}),e)})))}),[P]);var Oe=Object(o.useMemo)((function(){return k("create workflow instance"),new l.a({me:j,doc:y,docDomain:g,book:w,group:_,dispatch:S,mode:M,scene:m.g?u.c.DESKTOP:u.c.WEB,onPublishSuccessRedirect:x})}),[]),Se=Object(o.useMemo)((function(){return s.a.getEditorTheme(y,w)}),[y,w]),ke=function(){var e=E(v().mark((function e(t){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Oe.save(t||u.h.USER_SAVE);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xe=function(){var e=E(v().mark((function e(t){var r,n,o;return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k("on publish:",t),e.next=3,Oe.publish(t);case 3:if(void 0!==(n=e.sent)){e.next=6;break}return e.abrupt("return");case 6:o=L?b({published_at:new Date,is_fake_published_at:!0},(null===(r=y.contributors)||void 0===r?void 0:r.length)>0?{}:{contributors:[j]}):{},"string"==typeof n&&(o.content=n),S({type:"doc/update",payload:b(b({},o),{},{content_modified:!1})});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),je=function(e){if(k("editable change",e),W(e),e){var t=Oe.isDocContentEmpty();k("empty doc, show wizard view:",t),V(t)}else V(!1)},Ae=function(e){e===u.a.saved&&Q(new Date),pe(e)},Le=function(){var e=E(v().mark((function e(t){return v().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Oe.on(u.i.editableChange,je),Oe.on(u.i.error,te),Oe.on(u.i.collabUsersChange,oe),Oe.on(u.i.editModeChange,ce),Oe.on(u.i.message,se),Oe.on(u.i.docStatusChange,Ae),Oe.on(u.i.netStatusChange,ye),Oe.on(u.i.saveTitle,(function(e){k("title change to:",e),S("Doclet"!==g?{type:"doc/update",payload:{title:e}}:{type:"template/update",payload:{name:e}})})),e.next=10,Oe.start(t);case 10:"Doc"===y.type&&window.dispatchEvent(new CustomEvent("GetDocWordCount"));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return{state:{historyView:G,wizardView:q,editable:H,editorLoaded:J,docStatus:de,docTitle:ge},getWorkflow:function(){return Oe},getTheme:function(){return Se},getOpenEditorConfig:function(){return Oe.getOpenEditorConfig()},useTemplate:function(e){V(!1),Oe.useTemplate(e)},start:Le,onEditableChange:je,onSave:ke,onPublish:xe,buildStatusProps:function(){return{book:w,doc:y,error:ee,wfMessage:le,docStatus:de,onReload:function(){Oe.cache(),Oe.start()},onClear:function(){Oe.clearError()}}},buildHistoryProps:function(){return{docId:y.id,doc:y,docDomain:g,onCancel:function(){U(!1)},onRevert:function(e){Oe.isOnlyOneEditSession()?(n.a.success(__("文档恢复成功")),Oe.revert(e),U(!1)):0!==ne.length?n.a.error(__("有其他用户正在编辑该文档，恢复可能会导致对方编辑的内容丢失，请联系他们退出编辑后再进行恢复")):n.a.error(__("你同时打开了多个浏览器窗口编辑该文档，请关闭其它窗口再进行恢复"))}}},buildEditorProps:function(){return{docTitle:ge,doc:y,docDomain:g,book:w,group:_,theme:Se,editable:H,openEditorConfig:Oe.getOpenEditorConfig(),onSave:ke,onPublish:xe,onEditorLoaded:function(e){L&&(Object(c.e)(y.id),Object(c.c)(y.id,y.type)),Oe.onEditorLoaded(e),X(!0)},onSaveTitle:Oe.onSaveTitle,onTitleChange:function(e){be(e),we(e)},getDefaultSuggestions:Oe.getDefaultSuggestions,onMentionSearch:Oe.onMentionSearch,onConnnectError:function(){ye("offline")},onThemeChange:Oe.saveDocTheme,onContentChange:function(e){Oe.onContentChange(e);var t=!e&&Oe.isDocContentEmpty();V(t),"Doc"===y.type&&window.dispatchEvent(new CustomEvent("GetDocWordCount"))},isDefaultTitle:function(e){return Oe.isDefaultTitle(e)},onMiniEditorExpandChange:Oe.onMiniEditorExpandChange,useEditorTileRendering:N,useEditorTileRenderingForOT:R,focusOnLoaded:!0,editType:D}},buildHeadProps:function(){return{pageReady:H&&de!==u.a.loading,editable:H,publishing:de===u.a.publishing||!!Oe.publishing,saving:de===u.a.saving||!!Oe.saving,savedAt:K,docStatus:de,collabUsers:ie===u.b.COLLAB?ne:null,showTitle:!!y.title,shortDocTitle:window.appData.isDocCollaborator,publish:xe,save:ke,showHistory:"Table"!==y.type&&function(){U(!0)},netStatus:me,getSummary:Oe.getSummary,getWordCount:Oe.getWordCount,onDeleted:function(){Oe.deleteDoc()},errorStatus:ee}},buildH5EditorProps:function(){return{doc:y,book:w,group:_,onChange:function(e){Oe.onContentChange(e)},getDefaultSuggestions:Oe.getDefaultSuggestions,onMentionSearch:Oe.onMentionSearch,onLoad:function(e){Oe.onEditorLoaded(e),X(!0)},onAutoSave:function(){ke(u.h.AUTO)},onSave:ke,onPublish:xe,meta:s.a.getEditorMeta(y),openEditorConfig:Oe.getOpenEditorConfig()}}}}},3792:function(e,t,r){var n=r(3793),o=function(e){var t="",r=Object.keys(e);return r.forEach((function(o,a){var i=e[o];(function(e){return/[height|width]$/.test(e)})(o=n(o))&&"number"==typeof i&&(i+="px"),t+=!0===i?o:!1===i?"not "+o:"("+o+": "+i+")",a<r.length-1&&(t+=" and ")})),t};e.exports=function(e){var t="";return"string"==typeof e?e:e instanceof Array?(e.forEach((function(r,n){t+=o(r),n<e.length-1&&(t+=", ")})),t):o(e)}},3793:function(e,t){e.exports=function(e){return e.replace(/[A-Z]/g,(function(e){return"-"+e.toLowerCase()})).toLowerCase()}},3806:function(e,t,r){"use strict";var n=r(3813),o=r.n(n),a=r(3814),i=r.n(a),c=r(3397),u=r.n(c),l=r(3759),s=r.n(l),f=r(1467),d=r.n(f),p=r(1383),h=r.n(p),m=r(818);function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){x(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function b(){b=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof g?t:g,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:A(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",v={};function g(){}function w(){}function _(){}var E={};l(E,i,(function(){return this}));var O=Object.getPrototypeOf,S=O&&O(O(N([])));S&&S!==r&&n.call(S,i)&&(E=S);var k=_.prototype=g.prototype=Object.create(E);function x(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==y(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===v)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(y(t)+" is not iterable")}return w.prototype=_,o(k,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(j.prototype),l(j.prototype,c,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(k),l(k,u,"Generator"),l(k,i,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),v}},t}function w(e){return function(e){if(Array.isArray(e))return _(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return _(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function E(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function O(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){E(a,n,o,i,c,"next",e)}function c(e){E(a,n,o,i,c,"throw",e)}i(void 0)}))}}function S(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,j(n.key),n)}}function k(e,t,r){return t&&S(e.prototype,t),r&&S(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function x(e,t,r){return(t=j(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function j(e){var t=function(e,t){if("object"!==y(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===y(t)?t:String(t)}var A=k((function e(t){var r=this,n=t.tagProxy;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),x(this,"isLongTag",(function(e){return e&&e.length>m.MAX_SHOW_TEXT_LENGTH})),x(this,"getShowText",(function(e){return"".concat(e.slice(0,m.MAX_SHOW_TEXT_LENGTH),"...")})),x(this,"createTag",h()(function(){var e=O(b().mark((function e(t){var n,o,a,i;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.currentTags,o=t.docId,a=d()(t.title)){e.next=4;break}return e.abrupt("return");case 4:if(m.TAG_RULES_REG.test(a)){e.next=6;break}return e.abrupt("return",{error:__("标签只能输入中文、数字、字母、-_@#/ 等符号")});case 6:if(!(a.length>m.MAX_LENGTH)){e.next=8;break}return e.abrupt("return",{error:__("标签最多{length}字",{length:m.MAX_LENGTH})});case 8:if(!s()(n,(function(e){return e.title===a}))){e.next=10;break}return e.abrupt("return",{error:__("不允许添加重复的标签")});case 10:return e.next=12,r.tagProxy.create({docId:o,title:a});case 12:if(!(i=e.sent)||!i.id){e.next=15;break}return e.abrupt("return",{data:[].concat(w(n),[i])});case 15:return e.abrupt("return",{error:__("标签新增失败")});case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),200)),x(this,"getSuggest",function(){var e=O(b().mark((function e(t){var n;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.tagProxy.suggest(t);case 2:return n=e.sent,e.abrupt("return",u()(n,(function(e){return{value:e.title}})));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),x(this,"destroy",function(){var e=O(b().mark((function e(t,n){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.tagProxy.destroy(t);case 2:return e.sent&&i()(n,(function(e){return e.id===t.id})),e.abrupt("return",w(n));case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),x(this,"arrangeResultTags",(function(e,t,r){var n=r.reduce((function(e,t){return g(g({},e),{},x({},t.title,t.count))}),{});return u()(e,(function(e){var r=e.tags.split(",").filter((function(e){return o()(t,e)<0})),a=function(e,t){return n[t]-n[e]},i=[].concat(w(t.sort(a)),w(r.sort(a)));return g(g({},e),{},{tags:i.map((function(e){return{title:e}}))})}))})),x(this,"tagsToString",(function(e){var t=e.tags,r=void 0===t?[]:t;return g(g({},e),{},{tags:r.join(",")})})),x(this,"findDocs",function(){var e=O(b().mark((function e(t,n){var o;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.tagProxy.findDocs(r.tagsToString(t));case 2:return o=e.sent,e.abrupt("return",r.arrangeResultTags(o,t.tags,n.tagGroup));case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),x(this,"countDocs",function(){var e=O(b().mark((function e(t){var n;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.tagProxy.countDocs(r.tagsToString(t));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.tagProxy=n}));t.a=A},3812:function(e,t,r){"use strict";r(60);var n=r(14),o=r(0),a=r.n(o),i=r(2),c=r.n(i);function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var s=function(e){var t=u(Object(o.useState)(!1),2),r=t[0],i=t[1],c=u(Object(o.useState)(e.title||__("无标题")),2),l=c[0],s=c[1];Object(o.useEffect)((function(){e.title!==l&&s(e.title||__("无标题"))}),[e.title]);var f=function(){var t=l||__("无标题");e.saveTitle(t),s(t),i(!1)};return r?a.a.createElement(n.a,{className:"lark-editor-header-title-input",autoFocus:!0,type:"text",value:l,onChange:function(e){s(e.target.value)},onFocus:function(e){r&&e.target.select()},onBlur:f,onPressEnter:f}):a.a.createElement("span",{className:"name-title",title:l,onClick:function(){i(!0)}},l)};s.propTypes={title:c.a.string.isRequired,saveTitle:c.a.func.isRequired},t.a=s},3813:function(e,t,r){var n=r(656),o=r(1198),a=Math.max;e.exports=function(e,t,r){var i=null==e?0:e.length;if(!i)return-1;var c=null==r?0:o(r);return c<0&&(c=a(i+c,0)),n(e,t,c)}},3814:function(e,t,r){var n=r(268),o=r(3815);e.exports=function(e,t){var r=[];if(!e||!e.length)return r;var a=-1,i=[],c=e.length;for(t=n(t,3);++a<c;){var u=e[a];t(u,a,e)&&(r.push(u),i.push(a))}return o(e,i),r}},3815:function(e,t,r){var n=r(827),o=r(206),a=Array.prototype.splice;e.exports=function(e,t){for(var r=e?t.length:0,i=r-1;r--;){var c=t[r];if(r==i||c!==u){var u=c;o(c)?a.call(e,c,1):n(e,c)}}return e}},3816:function(e,t,r){"use strict";r.d(t,"a",(function(){return S})),r.d(t,"c",(function(){return k}));r(37);var n=r(10),o=r(0),a=r.n(o),i=r(2),c=r.n(i),u=r(454),l=r.n(u),s=r(3634),f=r.n(s),d=r(3779),p=r(790),h=r(3356);function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function y(){y=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof b?t:b,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:A(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",v="completed",g={};function b(){}function w(){}function _(){}var E={};l(E,i,(function(){return this}));var O=Object.getPrototypeOf,S=O&&O(O(N([])));S&&S!==r&&n.call(S,i)&&(E=S);var k=_.prototype=b.prototype=Object.create(E);function x(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==m(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===v){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?v:p,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=v,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(m(t)+" is not iterable")}return w.prototype=_,o(k,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(j.prototype),l(j.prototype,c,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(k),l(k,u,"Generator"),l(k,i,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function v(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){w(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function w(e,t,r){return(t=E(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,E(n.key),n)}}function E(e){var t=function(e,t){if("object"!==m(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==m(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===m(t)?t:String(t)}var O=new(r(3572).a),S=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.doc=r.doc,this.getContent=r.getContent,this.workflow=r.workflow,this.engine=r.workflow?r.workflow.engine:r.engine,this._title=this.doc&&this.doc.title,this.getTitle=function(){return t._title},O.saveToServer||(this.getTitle=r.getTitle||function(){return this.doc?this.doc.title:null}),this.change=l()(this.change,300),this.onMessage=d.onMessage,this.MESSAGE_TYPES=d.MESSAGE_TYPES,"off"===O.extraConfig.message&&n.a.config({top:-9999})}var t,r,o,a,i;return t=e,r=[{key:"_postContentMessage",value:function(e,t){if(t||(t={status:"success",message:"ok"}),t.id=this.doc.slug,"success"===t.status)return this._getEmbedData().then((function(r){t.data=b(b({},r),t.data||{}),Object(d.postMessage)(e,t)}));Object(d.postMessage)(e,t)}},{key:"_getEmbedData",value:(a=y().mark((function e(){var t,r,n,o,a,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.engine){e.next=3;break}return e.next=3,this.engine.onBeforeSave();case 3:return t=this.getContent({fullHTML:O.fullHTML}),r=t.content,n=t.html,o=t.thumbnail,a=this.getTitle(),i={id:this.doc.slug,slug:this.doc.slug,title:a},"Sheet"===this.doc.type||"Table"===this.doc.type?(i.thumbnail=o,i.lakesheet=r):(i.lake=r,i.html=n),e.abrupt("return",i);case 8:case"end":return e.stop()}}),e,this)})),i=function(){var e=this,t=arguments;return new Promise((function(r,n){var o=a.apply(e,t);function i(e){v(o,r,n,i,c,"next",e)}function c(e){v(o,r,n,i,c,"throw",e)}i(void 0)}))},function(){return i.apply(this,arguments)})},{key:"publish",value:function(e){this._postContentMessage(d.MESSAGE_TYPES.PUBLISH_CALLBACK,e)}},{key:"save",value:function(e){this._postContentMessage(d.MESSAGE_TYPES.SAVE_CALLBACK,e)}},{key:"saveTitle",value:function(e){this._title=e,this._postContentMessage(d.MESSAGE_TYPES.SAVE_TITLE_CALLBACK,{data:{data:e},status:"success"})}},{key:"changeTitle",value:function(e,t){this._title=e,t&&this._postContentMessage(d.MESSAGE_TYPES.TITLE_CHANGE_CALLBACK,{data:{data:e},status:"success"})}},{key:"loadCallback",value:function(){Object(d.postMessage)(d.MESSAGE_TYPES.LOAD_CALLBACK)}},{key:"getValueCallback",value:function(){this._postContentMessage(d.MESSAGE_TYPES.GET_VALUE_CALLBACK)}},{key:"unlockCallback",value:function(){this._postContentMessage(d.MESSAGE_TYPES.UNLOCK_CALLBACK)}},{key:"resetCallback",value:function(){this._postContentMessage(d.MESSAGE_TYPES.RESET_CALLBACK)}},{key:"change",value:function(){this._postContentMessage(d.MESSAGE_TYPES.CHANGE_CALLBACK)}},{key:"fullScreen",value:function(e){Object(d.postMessage)(d.MESSAGE_TYPES.FULLSCREEN_CALLBACK,e)}},{key:"resize",value:function(e){Object(d.postMessage)(d.MESSAGE_TYPES.RESIZE_CALLBACK,e)}},{key:"onDocLoaded",value:function(e){Object(d.postMessage)(d.MESSAGE_TYPES.DOC_LOADED_CALLBACK,e)}},{key:"onHashChange",value:function(e){Object(d.postMessage)("hashchange",{newURL:e.newURL,oldURL:e.oldURL,href:location.href})}},{key:"connect",value:function(e){var t=this;e.on(h.i.error,(function(e){t.onError(e)})),e.on(h.i.docStatusChange,(function(e){t.onDocStatusChanged(e)})),e.on(h.i.saveTitle,(function(e){t.saveTitle({data:e,state:"success",message:"ok"})})),e.on(h.i.change,(function(){O.onchange&&t.change()})),e.on(h.i.miniExpand,(function(e){t.fullScreen(e)}))}},{key:"onDocStatusChanged",value:function(e){e===h.a.saved?this.save({status:"success",message:"ok",data:{save_type:"user"}}):e===h.a.published?this.publish():e===h.a.loaded&&this.onDocLoaded()}},{key:"onError",value:function(e){e&&e.code===h.d.PUBLISH_FAILED&&this.publish({status:"error",message:e.message})}}],r&&_(t.prototype,r),o&&_(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function k(e){var t=e.backgroundColor,r=e.autoHeight,n=e.bodyBackgroundColor,a=e.toolbarBackgroundColor;Object(o.useEffect)((function(){var e="";if(n&&(e+="\n        .lake-max-editor-wrapper-content .lake-max-editor-content {\n          background-color: ".concat(f()(n),";\n        }\n        .lake-max-editor-wrapper-content .lake-content-editor {\n          border: 0 none;\n          box-shadow: none;\n        }\n      ")),a&&(e+="\n        .lake-toolbar {\n          background-color: ".concat(f()(a),";\n        }\n      ")),t&&(e+="\n        #content,\n        .lake-content-editor,\n        .lake-title-editor .ant-input {\n          background-color: ".concat(f()(t),"\n        }\n      ")),r||(e+="\n        .lake-mini-editor .lake-content-editor-core {\n          height: calc(100vh - 40px);\n          min-height: calc(100vh - 40px);\n          overflow-y: auto;\n        }\n      "),e){var o=document.createElement("style");document.head.appendChild(o),o.type="text/css",o.appendChild(document.createTextNode(e))}}),[])}function x(e){var t=e.doc,r=e.publish,i=e.setContent,c=e.getContent,u=e.insertContent,l=e.getTitle,s=e.getContainer,f=e.autoHeight,h=(e.fullScreen,e.onLoad),m=e.workflow,y=e.engine,v=e.backgroundColor,g=e.bodyBackgroundColor,b=e.toolbarBackgroundColor,w=Object(o.useRef)(null),_=s(),E=Object(o.useRef)(null),O=Object(o.useMemo)((function(){return new S({doc:t,getContent:c,getTitle:l})}),[t,c,l]);return k({autoHeight:f,backgroundColor:v,bodyBackgroundColor:g,toolbarBackgroundColor:b}),Object(o.useEffect)((function(){Object(d.onMessage)((function(e){var t=e.type,o=e.message,a=e.options,c=void 0===a?{}:a;if(t===d.MESSAGE_TYPES.PUBLISH)r();else if(t===d.MESSAGE_TYPES.GET_VALUE)O.getValueCallback();else if(t===d.MESSAGE_TYPES.SET_VALUE)if("markdown"===c.format)try{p.a.convertMarkdownToLake(o).then((function(e){return i(e)}))}catch(e){n.a.error(__("初始化 Markdown 格式失败"))}else i(o);else if(t===d.MESSAGE_TYPES.SCROLL_TO){var l=document.querySelector(".lake-editor-scroll-container")||document.querySelector(".lake-content-editor-core");l?l.scrollTop=o:window.scrollTo(0,o)}else if(t===d.MESSAGE_TYPES.INSERT_VALUE)u(o);else if(t===d.MESSAGE_TYPES.UNLOCK)m&&m.exit({unlock:!0}).then((function(){O.unlockCallback()}));else if(t===d.MESSAGE_TYPES.RESET&&(y||m)){var s=(y||m).reset,f=function(e){s(e),O.resetCallback()};if("markdown"===c.format)try{p.a.convertMarkdownToLake(o).then((function(e){f(e)}))}catch(e){n.a.error(__("重置 Markdown 格式失败"))}else f(o)}})),O.loadCallback(),h(O),m&&O.connect(m)}),[]),Object(o.useEffect)((function(){if(_&&f){!function e(){w.current||(w.current=setTimeout((function(){w.current=null;var t=_.querySelector?_:_.current,r=t.querySelector(".lake-max-editor-content");if(r||(r=t.querySelector(".lake-content-editor")),r){var n=r.scrollHeight,o=document.querySelector(".lake-toolbar"),a=o?o.offsetHeight:0,i=document.querySelector(".lark-editor-header"),c=i?i.offsetHeight:0;E.current!==n&&(O.resize({height:a+c+n+60}),E.current=n)}e()}),300))}()}return function(){clearTimeout(w.current),w.current=null}}),[_,f]),a.a.createElement("span",null)}x.defaultProps={onLoad:function(){}},x.propTypes={doc:c.a.object,getContainer:c.a.func.isRequired,getContent:c.a.func.isRequired,getTitle:c.a.func,publish:c.a.func.isRequired,setContent:c.a.func.isRequired,autoHeight:c.a.bool,onLoad:c.a.func,insertContent:c.a.func.isRequired,engine:c.a.func.object},t.b=x},3825:function(e,t,r){"use strict";r.d(t,"a",(function(){return M}));r(37);var n=r(10),o=r(505),a=r(3335),i=r(790),c=r(709),u=r(708),l=r(79),s=r(426),f=r.n(s),d=r(3465),p=r.n(d),h=r(130);function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function y(){y=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof b?t:b,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:A(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",v="completed",g={};function b(){}function w(){}function _(){}var E={};l(E,i,(function(){return this}));var O=Object.getPrototypeOf,S=O&&O(O(N([])));S&&S!==r&&n.call(S,i)&&(E=S);var k=_.prototype=b.prototype=Object.create(E);function x(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==m(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===v){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?v:p,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=v,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(m(t)+" is not iterable")}return w.prototype=_,o(k,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(j.prototype),l(j.prototype,c,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(k),l(k,u,"Generator"),l(k,i,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function v(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}var g=function(){var e,t=(e=y().mark((function e(t){var r,n,o;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.completionId,n=t.feedback,r){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,h.webProxy.aiWriting.feedback({completion_id:r,feedback:n});case 5:return o=e.sent,e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){v(a,n,o,i,c,"next",e)}function c(e){v(a,n,o,i,c,"throw",e)}i(void 0)}))});return function(e){return t.apply(this,arguments)}}(),b=r(3750),w=r(3753);function _(e){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(e)}function E(){E=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:A(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var O=Object.getPrototypeOf,S=O&&O(O(N([])));S&&S!==r&&n.call(S,i)&&(w=S);var k=b.prototype=v.prototype=Object.create(w);function x(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==_(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(_(t)+" is not iterable")}return g.prototype=b,o(k,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(j.prototype),l(j.prototype,c,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(k),l(k,u,"Generator"),l(k,i,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function O(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function S(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){O(a,n,o,i,c,"next",e)}function c(e){O(a,n,o,i,c,"throw",e)}i(void 0)}))}}function k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?k(Object(r),!0).forEach((function(t){P(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function j(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,N(n.key),n)}}function A(e,t){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},A(e,t)}function L(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=C(e);if(t){var o=C(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===_(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return T(e)}(this,r)}}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function C(e){return C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},C(e)}function P(e,t,r){return(t=N(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function N(e){var t=function(e,t){if("object"!==_(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==_(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===_(t)?t:String(t)}function R(e){var t,r,n,o=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);o--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new I(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function I(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return I=function(e){this.s=e,this.n=e.next},I.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new I(e)}var D=function(){return Math.floor(1e7*Math.random())},M=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&A(e,t)}(d,e);var t,r,a,s=L(d);function d(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),P(T(e=s.call(this)),"msgList",[]),P(T(e),"sheet",void 0),P(T(e),"sheetId",void 0),P(T(e),"book",void 0),P(T(e),"isWaitingResponse",!1),P(T(e),"isInRequesting",!1),P(T(e),"isSheetEmpty",!0),P(T(e),"isToInsertStatus",!1),P(T(e),"userId",window.appData.me.id),P(T(e),"streamReqMethod",void 0),P(T(e),"abortReq",null),P(T(e),"notifyInnerDatasetUpdated",(function(t){e.notifyListener((function(e){var r;null===(r=e.onInnerDatasetUpdated)||void 0===r||r.call(e,t)}))})),P(T(e),"initSheet",(function(t){var r;t?(e.sheet=t,d.sheetIns=t):d.sheetIns&&(e.sheet=d.sheetIns),null!==(r=e.sheet)&&void 0!==r&&r.AI&&(e.isSheetEmpty=e.sheet.AI.isEmptySheet())})),P(T(e),"updateStreamMsg",(function(t,r,n,o){if(t){if(n){var a=o?e.msgList.findIndex((function(e){return e.msgId===o})):-1;-1!==a?e.msgList[a]=x(x({},e.msgList[a]),{},{msgId:t,content:r,isClientId:!1,isComplete:!0}):e.msgList.push({msgId:t,type:b.e.ai,content:r,isClientId:!1,isComplete:!0}),e.isInRequesting=!1}else{var i=e.msgList.findIndex((function(e){return e.msgId===t}));-1===i?e.msgList.push({msgId:t,type:b.e.ai,content:r,clientId:t,isClientId:!0}):e.msgList[i].content=r}e.isWaitingResponse=!1,e.notifyInnerDatasetUpdated({needScroll:!0,scrollImmediately:!0})}})),P(T(e),"_updateHttpResult",(function(t){if(e.isInRequesting){if(e.msgList.push({msgId:t.completion_id,type:b.e.ai,content:t.result,isComplete:!0}),!t.result)throw new Error(b.d.modelError);return e.isWaitingResponse=!1,e.isInRequesting=!1,e.notifyInnerDatasetUpdated({needScroll:!0,scrollImmediately:!0}),!0}})),P(T(e),"_updateStreamResult",(function(t,r){return t instanceof Error?{success:!1,error:b.d.netError}:(t.completion_id||r.id||(r.id=D()),"infosec_error"===t.error_code&&(r.text="",e.updateStreamMsg(r.id,r.text,!0,r.id)),t.error||t.error_code?{success:!1,error:b.d.modelError}:(t.result&&(r.text=t.end?t.result:r.text+t.result),t.end&&(e.updateStreamMsg(t.completion_id,t.result||r.text||"",!0,r.id),r.id=t.completion_id,!r.text)?{success:!1,error:b.d.modelError}:{success:!0,streamResult:r}))})),P(T(e),"_updateId",(function(t,r){if(r){var n=e.msgList.findIndex((function(e){return e.msgId===r}));-1!==n&&(e.msgList[n]=x(x({},e.msgList[n]),{},{msgId:t,isClientId:!1,isComplete:!0}))}})),P(T(e),"callGenerateSheet",function(){var t=S(E().mark((function t(r){var o,a,i,c,u,l,s,f,d,p,h,m,y,v,g,w,_,O,S,k,x=arguments;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=!(x.length>1&&void 0!==x[1])||x[1],!e.isInRequesting){t.next=3;break}return t.abrupt("return");case 3:if(e.isWaitingResponse=!0,e.isInRequesting=!0,e.msgList.push({msgId:D(),type:b.e.user,content:r}),e.notifyInnerDatasetUpdated({needScroll:!0}),a=null,i=null,c=function(){a&&window.clearTimeout(a),i&&window.clearTimeout(i),a=null,i=null},t.prev=10,!o){t.next=63;break}u=e.streamReqMethod({content:r,type:b.a.generateSheet,contextId:e.sheetId,stream:!0,http:!0}),l=u.request,s=u.abort,e.abortReq=s,f=0,d={text:"",textIndex:0,id:void 0},a=window.setTimeout((function(){a=null;var t,r=d.id;-1!==(t=r?e.msgList.findIndex((function(e){return e.msgId===r})):e.msgList.length-1)&&(e.msgList[t].isComplete=!0,e.notifyInnerDatasetUpdated({needScroll:!1}))}),18e4),i=window.setInterval((function(){if(e.isInRequesting){if(d.textIndex<=d.text.length){var t=d.text.slice(0,d.textIndex++);e.updateStreamMsg(d.id,t,!1)}}else c()}),60),p=!1,h=!1,t.prev=20,y=R(l);case 22:return t.next=24,y.next();case 24:if(!(p=!(v=t.sent).done)){t.next=43;break}if(g=v.value,!(f>2e3)){t.next=28;break}return t.abrupt("break",43);case 28:if(e.isInRequesting){t.next=32;break}return c(),g.completion_id&&e._updateId(g.completion_id,d.id),t.abrupt("return");case 32:if((w=e._updateStreamResult(g,d)).success){t.next=35;break}throw new Error(w.error);case 35:if(d=w.streamResult,!g.end){t.next=39;break}return c(),t.abrupt("return",!0);case 39:f++;case 40:p=!1,t.next=22;break;case 43:t.next=49;break;case 45:t.prev=45,t.t0=t.catch(20),h=!0,m=t.t0;case 49:if(t.prev=49,t.prev=50,!p||null==y.return){t.next=54;break}return t.next=54,y.return();case 54:if(t.prev=54,!h){t.next=57;break}throw m;case 57:return t.finish(54);case 58:return t.finish(49);case 59:e.updateStreamMsg(d.id,d.text,!0,d.id),c(),t.next=69;break;case 63:return _=e.streamReqMethod({content:r,type:b.a.generateSheet,contextId:e.sheetId}),O=_.request,S=_.abort,e.abortReq=S,t.next=67,O;case 67:k=t.sent,e._updateHttpResult(k);case 69:t.next=79;break;case 71:return t.prev=71,t.t1=t.catch(10),null!==t.t1&&void 0!==t.t1&&t.t1.message&&b.f.includes(t.t1.message)?n.a.error(b.c[t.t1.message]):n.a.error(b.c.netError),e.isWaitingResponse=!1,e.isInRequesting=!1,e.notifyInnerDatasetUpdated({needScroll:!1}),c(),t.abrupt("return",!1);case 79:case"end":return t.stop()}}),t,null,[[10,71],[20,45,49,59],[50,,54,58]])})));return function(e){return t.apply(this,arguments)}}()),P(T(e),"stopGenerate",(function(t){var r,n,o;e.isWaitingResponse=!1,e.isInRequesting=!1,null===(r=(n=e).abortReq)||void 0===r||r.call(n),-1!==(o=t?e.msgList.findIndex((function(e){return e.msgId===t})):e.msgList.length-1)&&(e.msgList[o].isComplete=!0,e.notifyInnerDatasetUpdated({needScroll:!1}))})),P(T(e),"getMsgById",(function(t){return e.msgList.find((function(e){return e.msgId===t}))})),P(T(e),"callFeedback",function(){var t=S(E().mark((function t(r,a){var i,c;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r.isClientId){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,g({feedback:a,completionId:r.msgId});case 5:null!=(i=t.sent)&&i.success&&-1!==(c=e.msgList.findIndex((function(e){return e.msgId===r.msgId})))&&(e.msgList[c].feedback=a,e.notifyInnerDatasetUpdated({needScroll:!1})),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),a!==o.FEEDBACK_TYPE.POSITIVE_USE&&n.a.error(__("网络异常，请稍后重试"));case 12:case"end":return t.stop()}}),t,null,[[2,9]])})));return function(e,r){return t.apply(this,arguments)}}()),P(T(e),"insertSheet",(function(t){if(e.sheet){var r=e.getMsgById(t),n=null==r?void 0:r.content;n&&(e.sheet.command.execute("insertFromMd",n),e.callFeedback(r,o.FEEDBACK_TYPE.POSITIVE_USE))}})),P(T(e),"findInsertPosition",(function(t){var r;if(e.sheet){var n=e.getMsgById(t),a=null==n?void 0:n.content;a&&(null===(r=e.sheet.AI)||void 0===r||r.gotoInsert(a),e.isToInsertStatus=!0,e.notifyInnerDatasetUpdated({needScroll:!1}),e.callFeedback(n,o.FEEDBACK_TYPE.POSITIVE_USE))}})),P(T(e),"setSheetDataEmptyStatus",(function(t){e.isSheetEmpty=t,e.notifyInnerDatasetUpdated({needScroll:!1})})),P(T(e),"_createSheet",function(){var t=S(E().mark((function t(r,a){var u,s,d,h,m,y,v,g;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(u=e.getMsgById(r),(s=null==u?void 0:u.content)&&void 0!==(null==a?void 0:a.id)){t.next=4;break}return t.abrupt("return");case 4:if(d=Object(w.a)(s)){t.next=7;break}return t.abrupt("return");case 7:return h={data:d.data,colCount:26,rowCount:200,rows:{},columns:{},filter:{},id:"",index:0,mergeCells:{},name:"Sheet1",selections:{activeCol:0,activeRow:0,row:0,col:0,rowCount:1,colCount:1},vStore:{}},(m=f()(b.b)).sheet=p.a.deflate(JSON.stringify([h]),{to:"string"}),y="Sheet",v={title:c.a.getDefaultTitle(i.a.adapterDocType(y)),type:i.a.adapterDocType(y),format:i.a.getDefaultFormat(y),book_id:a.id,body_draft:JSON.stringify(m),status:l.STATUS.draft,insert_to_catalog:!0,action:"prependChild",target_uuid:null},t.next=14,i.a.createDoc(v,(function(){return n.a.error(__("网络异常，请稍后重试"))}));case 14:return g=t.sent,e.callFeedback(u,o.FEEDBACK_TYPE.POSITIVE_USE),t.abrupt("return",g);case 17:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()),P(T(e),"createSheet",function(){var t=S(E().mark((function t(r,n){var o;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._createSheet(r,n);case 2:return o=t.sent,t.next=5,Object(u.c)("/".concat(n.user.login,"/").concat(n.slug,"/").concat(o.slug,"/edit"));case 5:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()),P(T(e),"createSheetInBook",function(){var t=S(E().mark((function t(r){var n;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.book){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e._createSheet(r,e.book);case 4:return n=t.sent,t.next=7,Object(u.c)("/".concat(e.book.namespace,"/").concat(n.slug,"/edit"));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),P(T(e),"endInsertStatus",(function(){e.isToInsertStatus&&(e.isToInsertStatus=!1,e.notifyInnerDatasetUpdated({needScroll:!1}))})),e.initSheet(),e}return t=d,(r=[{key:"setStreamReqMethod",value:function(e){this.streamReqMethod=e}},{key:"destroySheet",value:function(){this.sheet=null,d.sheetIns=null}}])&&j(t.prototype,r),a&&j(t,a),Object.defineProperty(t,"prototype",{writable:!1}),d}(a.b);P(M,"sheetIns",void 0)},3831:function(e,t,r){"use strict";r(3198);var n=r(3636),o=(r(381),r(132)),a=(r(178),r(68)),i=(r(37),r(10)),c=r(0),u=r.n(c),l=r(2),s=r.n(l),f=r(654),d=r(1619),p=r(454),h=r.n(p),m=r(818),y="Tag-module_wrapper_hMv3z",v="Tag-module_add_2EgPb";function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}function b(){b=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:A(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function w(){}function _(){}var E={};l(E,i,(function(){return this}));var O=Object.getPrototypeOf,S=O&&O(O(N([])));S&&S!==r&&n.call(S,i)&&(E=S);var k=_.prototype=v.prototype=Object.create(E);function x(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==g(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(g(t)+" is not iterable")}return w.prototype=_,o(k,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:w,configurable:!0}),w.displayName=l(_,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(j.prototype),l(j.prototype,c,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(k),l(k,u,"Generator"),l(k,i,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function w(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function _(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){w(a,n,o,i,c,"next",e)}function c(e){w(a,n,o,i,c,"throw",e)}i(void 0)}))}}function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return O(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var S=h()((function(e,t){t(e)}),400),k=function(e){var t=e.docId,r=e.group,n=e.tagBiz,o=e.onChange,a=E(Object(c.useState)([]),2),u=a[0],l=a[1],s=E(Object(c.useState)([]),2),f=s[0],d=s[1],p=E(Object(c.useState)(""),2),h=p[0],m=p[1],y=E(Object(c.useState)(!1),2),v=y[0],g=y[1];function w(e,t){return O.apply(this,arguments)}function O(){return(O=_(b().mark((function e(r,a){var c,s,f;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.createTag({title:r,currentTags:u,docId:t});case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0={};case 5:if(c=e.t0,s=c.error,f=c.data,!s){e.next=12;break}if(i.a.error(s),"blur"===a){e.next=12;break}return e.abrupt("return");case 12:g(!1),m(""),d([]),f&&(l(f),o(f));case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(){return(S=_(b().mark((function e(r){var a;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.destroy({docId:t,id:r},u);case 2:a=e.sent,l(a),o(a);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(){return(k=_(b().mark((function e(o){var a;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getSuggest({target:r.login,query:o,docId:t});case 2:a=e.sent,d(a);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(){return(x=_(b().mark((function e(t){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(13!==(t.keyCode||t.which)){e.next=6;break}return t.preventDefault(),t.stopPropagation(),e.next=6,w(t.target.value);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return{state:{tagsArray:u,suggestOptions:f,showInput:v,inputValue:h},setTagsArray:l,deleteTag:function(e){return S.apply(this,arguments)},createTag:w,getSuggest:function(e){return k.apply(this,arguments)},setInputShowStatus:g,handleKeydown:function(e){return x.apply(this,arguments)},setInputValue:m}},x=function(e){var t=e.tagsArray,r=e.group,n=e.editable,i=e.deleteTag;return t.map((function(e){var t=e.title,c=e.id;return u.a.createElement(o.a,{className:"doc-tag",key:c},u.a.createElement("a",{className:"tag-title",target:"_blank","data-desktoptarget":"_blank",href:"/r/".concat(r.login,"/tags?tag=").concat(encodeURIComponent(t))},t),n&&u.a.createElement(a.a,{title:__("确认删除标签"),onConfirm:function(){i(c)},okText:__("确认"),cancelText:__("取消"),placement:"bottom"},u.a.createElement(f.default,{style:{marginLeft:4},width:8})))}))},j=function(e){var t=e.tags,r=e.editable,o=e.docId,a=e.group,i=e.tagBiz,l=e.onChange,s=k({docId:o,group:a,tagBiz:i,onChange:l}),f=s.state,p=f.tagsArray,h=f.showInput,g=f.suggestOptions,b=f.inputValue,w=s.getSuggest,_=s.deleteTag,E=s.setInputShowStatus,O=s.handleKeydown,j=s.setTagsArray,A=s.setInputValue,L=s.createTag,T=(p?p.length:0)>=m.MAX_COUNT,C=r&&!h&&!T,P=r&&h;Object(c.useEffect)((function(){j(t),l(t)}),[j,t]);var N=u.a.createElement(x,{tagsArray:p,group:a,editable:r,deleteTag:_,tagBiz:i});return r?u.a.createElement("div",{className:y,"data-testid":"editable-tag"},N,C&&u.a.createElement("span",{className:v,onClick:function(){return E(!0)},"data-testid":"edit-btn"},u.a.createElement(d.default,null)),P&&u.a.createElement(n.a,{"data-testid":"tag-suggest",defaultActiveFirstOption:!1,className:"doc-tag-auto-complete",autoFocus:!0,options:g,onChange:function(e){A(e),S(e,w)},onSelect:L,style:{width:"200px"},backfill:!0,value:b,onBlur:function(e){L(e.target.value,"blur")},onInputKeyDown:O})):u.a.createElement("div",{className:y,"data-testid":"only-read-tag"},N)};j.useViewModel=k,j.propTypes={tags:s.a.array.isRequired,docId:s.a.number,editable:s.a.bool,group:s.a.object,tagBiz:s.a.object,onChange:s.a.func},j.defaultProps={onChange:function(){}};t.a=j},3837:function(e,t,r){"use strict";r(41);var n=r(9),o=(r(60),r(14)),a=(r(186),r(45)),i=r(0),c=r.n(i),u=r(2),l=r.n(u),s=r(79),f=r(3831),d=r(3806),p=r(1210),h=r(1514),m=r(320),y=r(790),v=r(158),g=r(50),b=(r(139),r(44)),w=(r(151),r(29)),_=(r(229),r(34));function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach((function(t){k(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function k(e,t,r){return t=function(e){var t=function(e,t){if("object"!==E(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==E(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===E(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function x(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return j(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return j(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var A=function(e){var t=e.value,r=e.contributors,n=e.onChange,a=x(Object(i.useState)(t.showAuthorOption),2),u=a[0],l=a[1],f=x(Object(i.useState)(t.showAuthorId),2),d=f[0],p=f[1],h=x(Object(i.useState)(t.showAuthorCustomText),2),m=h[0],y=h[1],v=function(t){n&&"function"==typeof n&&n(S(S({},e.value),t))};return c.a.createElement(b.a,{gutter:16},c.a.createElement(w.a,{span:10},c.a.createElement(_.a,{"data-testid":"show-author-option-selector",value:u,onChange:function(e){l(Number(e));var t=Number(e);v({showAuthorOption:e,showAuthorId:t!==s.SHOW_AUTHOR_OPTION.specific_user?0:d,showAuthorCustomText:t!==s.SHOW_AUTHOR_OPTION.custom_text?"":m})},getPopupContainer:function(e){return e.parentNode}},c.a.createElement(_.a.Option,{value:s.SHOW_AUTHOR_OPTION.all},__("显示所有编辑者")),c.a.createElement(_.a.Option,{"data-testid":"show-author-option-selector-user",value:s.SHOW_AUTHOR_OPTION.specific_user,disabled:r.length<=1},__("显示指定编辑者")),c.a.createElement(_.a.Option,{"data-testid":"show-author-option-selector-hide",value:s.SHOW_AUTHOR_OPTION.hide},__("不显示编辑者")),c.a.createElement(_.a.Option,{"data-testid":"show-author-option-selector-text",value:s.SHOW_AUTHOR_OPTION.custom_text},__("自定义")))),u===s.SHOW_AUTHOR_OPTION.specific_user&&c.a.createElement(w.a,{span:14},c.a.createElement(_.a,{"data-testid":"show-author-option-user-selector",value:d,onChange:function(e){p(Number(e)),v({showAuthorId:e})},placeholder:__("选择编辑者")},r.map((function(e){return c.a.createElement(_.a.Option,{value:e.id,key:String(e.id)},e.name)})))),u===s.SHOW_AUTHOR_OPTION.custom_text&&c.a.createElement(w.a,{span:14},c.a.createElement(o.a,{"data-testid":"show-author-option-custom-input",value:m,type:"text",autoComplete:"off",maxLength:20,placeholder:__("请输入（最多 20 个字符）"),onChange:function(e){var t=e.target.value;y(t),v({showAuthorCustomText:t})}})))};A.propTypes={value:l.a.shape({showAuthorCustomText:l.a.string,showAuthorId:l.a.number,showAuthorOption:l.a.number}).isRequired,contributors:l.a.array,onChange:l.a.func.isRequired};var L=A,T={tagWrapper:"DocMetaEdit-module_tagWrapper_H2QK1",tagTip:"DocMetaEdit-module_tagTip_ThFbG",cover:"DocMetaEdit-module_cover_JaV7l",coverPlaceholder:"DocMetaEdit-module_coverPlaceholder_c80Dd",coverActions:"DocMetaEdit-module_coverActions_CZ+Ed",btnRemoveCover:"DocMetaEdit-module_btnRemoveCover_RF2fK",btnRemoveCoverIcon:"DocMetaEdit-module_btnRemoveCoverIcon_ec2SG",moreBtn:"DocMetaEdit-module_moreBtn_c8CgD"};function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function P(){P=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(N([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==C(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(C(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function N(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function R(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){N(a,n,o,i,c,"next",e)}function c(e){N(a,n,o,i,c,"throw",e)}i(void 0)}))}}function I(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,B(n.key),n)}}function D(e,t){return D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},D(e,t)}function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=G(e);if(t){var o=G(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===C(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return F(e)}(this,r)}}function F(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function G(e){return G=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},G(e)}function U(e,t,r){return(t=B(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function B(e){var t=function(e,t){if("object"!==C(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==C(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===C(t)?t:String(t)}var q=a.a.Item,V=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&D(e,t)}(l,e);var t,r,i,u=M(l);function l(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),U(F(t=u.call(this,e)),"onSubmit",(function(e){e.preventDefault(),(0,t.props.form.validateFields)((function(e,r){e||t.handleUploadCover((function(){var e=t.state,n=e.showAuthorOptionData,o=e.description,a=e.cover,i={title:r.title,slug:r.slug,show_author_id:n.showAuthorId,public:t.state.public,custom_description:o,cover:a,custom_cover:a,show_author_option:n.showAuthorOption,show_author_custom_text:n.showAuthorCustomText};t.setState({submitting:!0},R(P().mark((function e(){return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.props.save(i);case 2:t.setState({submitting:!1});case 3:case"end":return e.stop()}}),e)}))))}))}))})),U(F(t),"handleUploadCover",(function(e){t.coverUploader.current?t.coverUploader.current.onSubmit().then((function(r){t.setState({cover:r||""},e)})):e()})),U(F(t),"onChangePermission",(function(e){t.setState({public:e})})),U(F(t),"handleChangeDesc",(function(e){t.setState({description:e.target.value})})),U(F(t),"showMore",(function(){var e;t.setState({showMore:!0});var r=t.props,n=r.doc,o=r.group,a=o&&o.abilities&&o.abilities.read_tag,i=null==n||null===(e=n.abilities)||void 0===e?void 0:e.update;(a||i)&&g.a.tags.find({docId:n.id}).then((function(e){t.setState({tags:e})}))})),U(F(t),"onAuthorShowOptionChange",(function(e){t.setState({showAuthorOptionData:e})}));var r=e.doc,n=y.a.getDocShowAuthorId(r),o=y.a.getDocShowAuthorOption(r),a=y.a.getDocShowAuthorCustomText(r);return t.state={public:r.public,cover:r.custom_cover||r.cover||"",description:null!=r.custom_description?r.custom_description:r.description||"",submitting:!1,showAuthorOptionData:{showAuthorId:n||void 0,showAuthorOption:o,showAuthorCustomText:a},showMore:!1,tags:[]},t.coverUploader=c.a.createRef(),t.tagBiz=new d.a({tagProxy:g.a.tags}),t}return t=l,(r=[{key:"componentDidMount",value:function(){var e=this;"function"==typeof this.props.getSummary&&this.props.getSummary((function(t){var r=t.summary,n=t.cover;e.props.doc.custom_description||e.setState({description:r}),e.props.doc.cover||""===e.props.doc.cover||e.setState({cover:n})})),this.props.hideMoreInfo||this.showMore()}},{key:"componentWillUnmount",value:function(){this.coverUploader=null}},{key:"shouldSubmitDisabled",value:function(){var e=this.state,t=e.showAuthorOptionData,r=t.showAuthorId,n=t.showAuthorOption,o=t.showAuthorCustomText,a=e.submitting,i=n===s.SHOW_AUTHOR_OPTION.specific_user&&!r||n===s.SHOW_AUTHOR_OPTION.custom_text&&!o;return a||i}},{key:"canEditDoc",value:function(){if(window.appData.sharePage)return!1;var e=this.props.doc;return"Thread"!==e.type&&e.abilities&&e.abilities.update}},{key:"renderTags",value:function(){var e=this.props,t=e.doc,r=e.group,n=this.state.tags,o=this.canEditDoc()&&t&&t.abilities&&t.abilities.destroy,a=o||n&&n.length,i=r&&"User"===r.type,u=__("标签用于管理，仅{desc}可见",{desc:i?__("自己"):v.a.memberTitle(r)});if(a)return c.a.createElement(q,null,c.a.createElement("div",{className:T.tagWrapper},c.a.createElement("p",{className:T.title},__("标签"),c.a.createElement("span",{className:T.tagTip},u)),c.a.createElement(f.a,{tags:n||[],editable:o,group:r,docId:t.id,tagBiz:this.tagBiz})))}},{key:"render",value:function(){var e=this.props,t=e.doc,r=e.book,i=e.hideMoreInfo,u=e.hideTitle,l=this.props.form.getFieldDecorator,s="/".concat(r.namespace,"/"),f={xs:{span:24},sm:{span:14}},d=t.contributors||[],m=this.state.showMore,y=!i||m;return c.a.createElement("div",{className:"doc-meta-edit"},c.a.createElement(a.a,{layout:"vertical"},!u&&c.a.createElement(q,{label:__("标题"),colon:!1,wrapperCol:f},l("title",{initialValue:t.title,rules:[{type:"string",required:!0,message:__("请输入标题")}]})(c.a.createElement(o.a,{type:"text",autoComplete:"off"}))),c.a.createElement(q,{label:__("摘要"),colon:!1},c.a.createElement(o.a.TextArea,{value:this.state.description,onChange:this.handleChangeDesc,autoSize:{minRows:3,maxRows:6},maxLength:150})),c.a.createElement(q,{label:__("封面"),colon:!1},c.a.createElement("div",{className:T.cover},c.a.createElement(h.a,{attachable_type:"Doc",attachable_id:t.id,cover:this.state.cover,ref:this.coverUploader,cropperCheckCrossOrigin:!1,cropperCrossOrigin:"anonymous"}))),y?c.a.createElement(c.a.Fragment,null,c.a.createElement(q,{label:__("作者"),colon:!1},c.a.createElement(L,{value:this.state.showAuthorOptionData,onChange:this.onAuthorShowOptionChange,contributors:d})),c.a.createElement(q,{label:__("路径"),colon:!1,wrapperCol:f},l("slug",{initialValue:t.slug,rules:[{type:"string",required:!0,pattern:/^[a-z0-9\-_\.]{2,190}$/,message:__("访问路径为 2～190 个字符，只能输入小写字母、数字、横线、下划线和点")}]})(c.a.createElement(o.a,{type:"text",addonBefore:s,autoComplete:"off"}))),this.renderTags()):c.a.createElement("div",{className:T.moreBtn,onClick:this.showMore},__("高级选项")," ",c.a.createElement(p.default,null)),c.a.createElement(n.a,{className:"doc-meta-edit-submit",type:"primary",onClick:this.onSubmit,disabled:this.shouldSubmitDisabled()},__("确定"))))}}])&&I(t.prototype,r),i&&I(t,i),Object.defineProperty(t,"prototype",{writable:!1}),l}(i.Component);V.propTypes={group:l.a.object.isRequired,book:l.a.object.isRequired,doc:l.a.object,save:l.a.func,getSummary:l.a.func,hideMoreInfo:l.a.bool,hideTitle:l.a.bool};t.a=Object(m.b)(a.a.create()(V),!0)},3850:function(e,t,r){"use strict";r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return p})),r.d(t,"a",(function(){return h}));var n=r(0),o=r(1213),a=r(3593),i=r(50),c=r(3853),u=r(1340);function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function s(){s=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function f(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var a=t&&t.prototype instanceof b?t:b,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:A(e,r,c)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",m="suspendedYield",y="executing",v="completed",g={};function b(){}function w(){}function _(){}var E={};f(E,i,(function(){return this}));var O=Object.getPrototypeOf,S=O&&O(O(N([])));S&&S!==r&&n.call(S,i)&&(E=S);var k=_.prototype=b.prototype=Object.create(E);function x(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,c){var u=p(e[o],e,a);if("throw"!==u.type){var s=u.arg,f=s.value;return f&&"object"==l(f)&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(f).then((function(e){s.value=e,i(s)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=h;return function(a,i){if(o===y)throw new Error("Generator is already running");if(o===v){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var l=p(t,r,n);if("normal"===l.type){if(o=n.done?v:m,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=v,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=p(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(l(t)+" is not iterable")}return w.prototype=_,o(k,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:w,configurable:!0}),w.displayName=f(_,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,f(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(j.prototype),f(j.prototype,c,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(d(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(k),f(k,u,"Generator"),f(k,i,(function(){return this})),f(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},t}function f(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function d(){var e=Object(o.a)();return Object(n.useEffect)((function(){return a.a.addListener({onVisibilityChanged:e})}),[]),{visibility:a.a.visibility,isExpanded:a.a.isExpanded,isInvisible:a.a.isInvisible,isCollapsed:a.a.isCollapsed}}var p=function(){var e=Object(o.a)();Object(n.useEffect)((function(){return a.a.addListener({onAssistantsChanged:e,onManifestsChanged:e})}),[])},h=function(){var e,t=(e=s().mark((function e(t,r){var n,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r?"destroy":"create",e.t0=n,e.next="destroy"===e.t0?4:"create"===e.t0?7:11;break;case 4:return e.next=6,i.a.groupAssistant.removeSuperSidebarProvider({assistant_id:t.id});case 6:return e.abrupt("return",a.a.removeAssistant(t.id));case 7:return e.next=9,i.a.mine.superSidebarProvider.create({type:u.a.GroupAssistant,target_id:t.id,target_type:u.d.ASSISTANT,priority:a.a.getLatestPriority()});case 9:return o=e.sent,e.abrupt("return",a.a.addAssistant(new c.a(o)));case 11:return e.abrupt("break",12);case 12:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){f(a,n,o,i,c,"next",e)}function c(e){f(a,n,o,i,c,"throw",e)}i(void 0)}))});return function(e,r){return t.apply(this,arguments)}}()},3851:function(e,t,r){"use strict";r(73);var n=r(31),o=(r(625),r(200)),a=(r(999),r(651)),i=(r(498),r(100)),c=r(0),u=r.n(c),l=r(2),s=r.n(l),f=r(64),d=r.n(f),p=r(480),h=r(82),m=r.n(h),y=r(5),v=r.n(y),g=r(3641),b=r(3635),w=r(3658),_=r(3601),E=r(3640),O=r(1451),S=(r(3179),r(3513)),k="Slider-module_slideTitle_jDMWk",x="Slider-module_slideContainer_5puOR";function j(e){var t=e.title,r=e.onChange,n=e.value,o=e.min,a=e.max,i=e.marks,l=e.className,s=e.valueMap,f=e.labelMap,d=e.unit,p=Object(c.useCallback)((function(e){r(s?s[e]:e)}),[s,r]);return u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{className:k},u.a.createElement("span",null,t)),u.a.createElement("div",{className:x},u.a.createElement(S.a,{className:l,onChange:p,min:o,max:a,value:f?f[n]:n,tooltipVisible:!1,marks:i})),u.a.createElement("div",null,n,d))}j.propTypes={title:l.PropTypes.string.required,onChange:l.PropTypes.func.required,value:l.PropTypes.number.required,min:l.PropTypes.number.required,max:l.PropTypes.number.required,marks:l.PropTypes.array.required,labelMap:l.PropTypes.object,valueMap:l.PropTypes.object,className:l.PropTypes.string,unit:l.PropTypes.string},j.defaultProps={unit:"px"};var A=r(46),L="Select-module_selectTitle_o273v",T="Select-module_selectOptions_iZn-b",C="Select-module_optionAction_KeaaB",P="Select-module_iconSvg_3tsh1",N="Select-module_optionActive_HTKqR",R="Select-module_optionTitle_ZbDCu";function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function D(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==I(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==I(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===I(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function M(e){var t=e.title,r=e.value,n=e.options,o=e.onChange;return u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{className:L},t),u.a.createElement("div",{className:T},n.map((function(e){return u.a.createElement("div",{key:e.value,className:v()(C,D({},N,r===e.value)),"data-aspm-click":e.asp||null,onClick:function(){o(e.value)}},u.a.createElement(A.a,{className:P,width:38,height:28,name:r===e.value?e.selectedIcon:e.icon}),u.a.createElement("div",{className:R},e.title))}))))}M.propTypes={title:l.PropTypes.string.required,value:l.PropTypes.number.required,options:l.PropTypes.array.required,onChange:l.PropTypes.func.required},M.defaultProps={};var F="Switch-module_switchTitle_WJKZB",G="Switch-module_switchContainer_Ajcua";function U(e){var t=e.title,r=e.onChange,n=e.defaultChecked;return u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{className:F},t),u.a.createElement("div",{className:G},u.a.createElement(a.a,{size:"small",onChange:r,defaultChecked:n})))}U.propTypes={title:l.PropTypes.string.required,value:l.PropTypes.number.required,defaultChecked:l.PropTypes.bool.required,onChange:l.PropTypes.func.required},U.defaultProps={};var B=r(50),q=r(120),V=r(790),z=r(320),H=r(508),W=r(968),Y=r.n(W),K=r(3700),Q="DocActionMore-module_wrap_le9aB",Z="DocActionMore-module_sceneItem_sDxCm",J="DocActionMore-module_checkbox_kHMEj",X="DocActionMore-module_selectItem_Ga0F3",$="DocActionMore-module_submenuSwitchItem_AK8z3",ee="DocActionMore-module_slideItem_zrnG8",te="DocActionMore-module_switchItem_vBijY",re="DocActionMore-module_infoItem_pGDVA",ne="DocActionMore-module_submenuContainer_mgSTF",oe="DocActionMore-module_submenuIcon_BidTJ",ae="DocActionMore-module_sceneAction_KTXPK",ie="DocActionMore-module_sceneTitle_GJRbH",ce="DocActionMore-module_switchTitle_oFkGc",ue="DocActionMore-module_switchDesc_pWX8R",le="DocActionMore-module_switchAction_Yfn-p",se="DocActionMore-module_infoContent_PBXyF",fe="DocActionMore-module_menuItemContainer_sQ4rU",de="DocActionMore-module_menuDescribe_g8JML",pe="DocActionMore-module_iconContainer_Jwqih",he="DocActionMore-module_menu_+zp+S",me="DocActionMore-module_iconBeta_hbg2z",ye=r(3672);function ve(e){return function(e){if(Array.isArray(e))return ge(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return ge(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ge(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ge(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var be=d()("doc:actionMenu"),we=function(e){var t=Object(ye.a)(e),r=t.cmd,c=t.sendAlimail,l=t.mailSending,s=t.typography,f=t.defaultFontSize,d=t.recordDocSetting,p=t.paragraphSpacing,h=t.reset,y=t.doAction,S=t.getEditorLayout,k=t.getWordCount,x=t.setSendAlimail,L=t.setMailSending,T=t.contextHolder,C=function(t,r){e.onSelect({key:t}),y(t,r),Object(H.a)("c34619.d69461",{create_type:t})},P=function(){return null},N=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.map((function(e,r){return"scene"===e.type?e.actions.length>0?(n=ve(e.actions),u.a.createElement(i.a.Item,{key:"scene",className:Z},n.map((function(e){return u.a.createElement("div",{key:e.cmd,scene:e.cmd,className:ae,"data-aspm-click":e.asp||null,onClick:function(){C(e.cmd)}},u.a.createElement(A.b,{name:e.sceneIcon,width:36,height:36}),u.a.createElement("div",{className:ie},e.title))})))):null:"select"===e.type?(l=ve((c=e).options),h="",c.cmd===q.a.DOC.document_typography.cmd?h=s:c.cmd===q.a.DOC.document_layout_select.cmd&&(h=S()),u.a.createElement(i.a.Item,{key:c.cmd,className:X,onClick:function(e){e.domEvent.stopPropagation()}},u.a.createElement(M,{title:c.title,options:l,value:h,onChange:function(e){return C(c.cmd,e)}}))):"switch"===e.type?t?function(e){var t=v()("doc-action-menu-item-".concat(e.cmd),$),r="";return e.cmd===q.a.DOC.document_paragraph_spacing.cmd&&(r=p===m.a.PARAGRAPH_SPACING.relax),u.a.createElement(i.a.Item,{key:e.cmd,className:t,"data-testid":"doc-action-submenu-item-".concat(e.cmd),onClick:function(e){e.domEvent.stopPropagation()}},u.a.createElement(U,{title:e.title,defaultChecked:r,onChange:function(t){C(e.cmd,t?m.a.PARAGRAPH_SPACING.relax:m.a.PARAGRAPH_SPACING.default)}}))}(e):function(e){var t=v()("doc-action-menu-item-".concat(e.cmd),te),r="";return e.cmd===q.a.DOC.document_layout.cmd&&(r=S()),u.a.createElement(i.a.Item,{key:e.cmd,className:t,"data-testid":"doc-action-menu-item-".concat(e.cmd),onClick:function(e){e.domEvent.stopPropagation()}},u.a.createElement("div",{className:ce},u.a.createElement("span",null,e.title),u.a.createElement("div",{className:ue},e.describe)),u.a.createElement(a.a,{onChange:function(t){C(e.cmd,t?m.a.VIEWPORT.adapt:m.a.VIEWPORT.fixed)},size:"small",defaultChecked:r===m.a.VIEWPORT.adapt,className:le}))}(e):"slider"===e.type?function(e){var t=v()("doc-action-menu-item-".concat(e.cmd),ee),r="",n="";return e.cmd===q.a.DOC.document_fontsize.cmd&&(n=s,r=f),u.a.createElement(i.a.Item,{key:e.cmd,className:t,"data-testid":"doc-action-menu-item-".concat(e.cmd),onClick:function(e){e.domEvent.stopPropagation()}},u.a.createElement(j,{className:n,title:e.title,min:e.min,max:e.max,value:r,marks:e.marks,labelMap:e.labelMap,valueMap:e.valueMap,onChange:function(t){return C(e.cmd,t)}}))}(e):"checkbox"===e.type?function(e){var t=v()("doc-action-menu-item-".concat(e.cmd),J),r=!1;return e.cmd===q.a.DOC.document_record_setting.cmd&&(r=d),u.a.createElement(i.a.Item,{key:e.cmd,className:t,"data-testid":"doc-action-menu-item-".concat(e.cmd),onClick:function(e){e.domEvent.stopPropagation()}},u.a.createElement(o.a,{checked:r,onChange:function(t){return C(e.cmd,t.target.checked)}},e.title))}(e):"submenu"===e.type?P(e):"divide"===e.cmd?u.a.createElement(i.a.Divider,{key:r,className:t?"menu-sub":""}):function(e){return u.a.createElement(i.a.Item,{key:e.cmd,className:"doc-action-menu-item-".concat(e.cmd),"data-testid":"doc-action-menu-item-".concat(e.cmd),onClick:function(){C(e.cmd)}},u.a.createElement("div",{className:fe,"data-aspm-click":e.asp||null},u.a.createElement("div",{className:pe},e.icon&&u.a.createElement(A.b,{name:e.icon,width:16})),e.tip_id?u.a.createElement(g.a,{tip_id:e.tip_id},e.title):e.title,e.isBeta&&u.a.createElement("span",{className:me},"Beta")))}(e);var n,c,l,h}));return r};P=function(e){var t=v()("doc-action-menu-item-".concat(e.cmd));return u.a.createElement(i.a.SubMenu,{key:e.cmd,popupClassName:Q,className:t,title:u.a.createElement("div",{className:ne,onClick:function(e){return e.stopPropagation()}},u.a.createElement("div",{className:fe,"data-aspm-click":e.asp||null},u.a.createElement("div",{className:pe},e.icon&&u.a.createElement(A.b,{name:e.icon,width:16})),e.tip_id?u.a.createElement(g.a,{tip_id:e.tip_id},e.title):e.title,e.isBeta&&u.a.createElement("span",{className:me},"Beta"),u.a.createElement(A.b,{className:oe,name:"arrow-right",width:16})),u.a.createElement("div",{className:de},e.describe)),onTitleClick:function(e){e.domEvent.stopPropagation()},"data-testid":"doc-action-menu-item-".concat(e.cmd)},N(e.subcmds,!0))};var R=e.book,I=e.className,D=e.doc,F=e.commandParams,G=e.commands;return be("render, currect action",r,F),u.a.createElement("div",{className:"".concat(Q," ").concat(I)},u.a.createElement(i.a,{className:he,selectable:!1,multiple:!0,mode:"vertical"},N(G),u.a.createElement(i.a.Divider,null),function(){var t,r,n=e.doc;return u.a.createElement(i.a.Item,{key:"info",className:re,onClick:function(e){e.domEvent.stopPropagation()}},u.a.createElement("div",{className:se},"Doc"===n.type?u.a.createElement("div",null,__("字数统计：{count}",{count:k()||0})):u.a.createElement("div",null,__("阅读数：{count}",{count:n.hits||0})),u.a.createElement("div",null,__(n.user?"{user} 创建于 {timer}":"创建于 {timer}",{user:null===(t=n.user)||void 0===t?void 0:t.name,timer:Y.a.format(n.created_at,{onlyDate:!0})})),u.a.createElement("div",null,__(n.last_editor?"{user} 更新于 {time}":"更新于 {time}",{user:null===(r=n.last_editor)||void 0===r?void 0:r.name,time:Y.a.format(n.content_updated_at)})),u.a.createElement("div",null,__("编辑者："),n.contributors.map((function(e){return e.name})).join("、"))))}()),T,r===q.a.DOC.export_doc.cmd&&u.a.createElement(_.a,{doc:D,bookId:R.id,onCancel:h,exportParams:F}),r===q.a.BOOK.export_book.cmd&&u.a.createElement(O.a,{visible:!0,book:R,exportParams:F,onCancel:h}),r===q.a.DOC.import_to_doc.cmd&&u.a.createElement(E.a,{book:R,formats:V.a.getImportFormats({multi:!1}),importType:m.a.IMPORT_TYPE.PARSE,onCancel:h,onSuccess:function(t){e.onCommandsExecuted({cmd:r,result:t})}}),r===q.a.DOC.import_to_book.cmd&&u.a.createElement(E.a,{book:R,importParams:F,formats:V.a.getImportFormats({multi:!0}),importType:m.a.IMPORT_TYPE.CREATE,onCancel:h,onSuccess:function(t){e.onCommandsExecuted({cmd:r,result:t})},group:window.appData.group}),r===q.a.DOC.save_as_template.cmd&&u.a.createElement(w.a,{visible:r===q.a.DOC.save_as_template.cmd,onCancel:h,modalTitle:__("另存为模板"),book:R,doc:e.doc,group:window.appData.group,organization:window.appData.organization,docletType:e.doc.type,onOpenTemplateSelector:function(){return y(q.a.DOC.create_from_template.cmd)},templateProxy:B.a.templates.v1,docProxy:B.a.docs,inEdit:e.inEdit}),r===q.a.DOC.save_published_as_version.cmd&&u.a.createElement(b.a,{doc:D,docDomain:"Doc",type:"published",onCancel:h,docVersionProxy:B.a.docVersions}),u.a.createElement(n.a,{width:500,visible:c,footer:null,closable:!l,maskClosable:!1,onCancel:function(){x(!1)}},c&&u.a.createElement(K.a,{onMailSended:function(){L(!1)},onMailSending:function(){L(!0)},doc:D})))};we.defaultProps={className:"",onSelect:function(){},onCommandsExecuted:function(){},commandParams:{}},we.propTypes={className:s.a.string,group:s.a.object.isRequired,book:s.a.object.isRequired,doc:s.a.object,commands:s.a.array.isRequired,commandParams:s.a.object,onSelect:s.a.func,onCommandsExecuted:s.a.func,dispatch:s.a.func,onSelectTemplate:s.a.func,inEdit:s.a.bool};t.a=Object(p.d)()(Object(z.b)(we))},3853:function(e,t,r){"use strict";r.d(t,"a",(function(){return A}));var n,o=r(1340),a=r(0),i=r.n(a),c=r(1253),u=r(280),l=r(46),s=r(3873),f=(r(529),function(e,t){var r={},n={exports:r};return function(e){return new Function("require","module","exports",e)}(t)(e,n,r),n.exports}),d=function(e){return e},p=(n=r(3885).shared||{},function(e){if(!(e in n))throw new Error("Could not require '".concat(e,"'. '").concat(e,"' does not exist in dependencies."));return n[e]}),h=d((function(e){return fetch(e).then((function(e){return e.text()})).then((function(e){return f(p,e)})).catch((function(e){throw e}))}));function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,w(n.key),n)}}function g(e,t,r){return t&&v(e.prototype,t),r&&v(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function b(e,t,r){return(t=w(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function w(e){var t=function(e,t){if("object"!==m(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==m(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===m(t)?t:String(t)}function _(){_=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof g?t:g,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:A(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",y="completed",v={};function g(){}function b(){}function w(){}var E={};l(E,i,(function(){return this}));var O=Object.getPrototypeOf,S=O&&O(O(N([])));S&&S!==r&&n.call(S,i)&&(E=S);var k=w.prototype=g.prototype=Object.create(E);function x(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==m(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function A(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===y){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=L(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?y:p,l.arg===v)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=y,n.method="throw",n.arg=l.arg)}}}function L(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,L(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(m(t)+" is not iterable")}return b.prototype=w,o(k,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:b,configurable:!0}),b.displayName=l(w,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,l(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(j.prototype),l(j.prototype,c,(function(){return this})),t.AsyncIterator=j,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new j(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},x(k),l(k,u,"Generator"),l(k,i,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),v}},t}var E=_().mark(S),O=_().mark(x);function S(){var e;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=0;case 1:return t.next=4,--e;case 4:t.next=1;break;case 6:case"end":return t.stop()}}),E)}var k=S();function x(){var e;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=0;case 1:return t.next=4,"a".concat(++e);case 4:t.next=1;break;case 6:case"end":return t.stop()}}),O)}var j=x(),A=function(){function e(t){var r=this;y(this,e),b(this,"id",void 0),b(this,"type",void 0),b(this,"label",void 0),b(this,"description",void 0),b(this,"icon",void 0),b(this,"priority",void 0),b(this,"hasWatermark",void 0),b(this,"target",void 0),b(this,"provider",void 0),b(this,"providerType",void 0);var n=s.a[t.type];this.id=t.id||k.next().value,this.priority=t.priority||j.next().value,this.type=t.type,this.label=this.getLabel(t.label,t.target)||n.label,this.description=t.description||n.description,this.icon=this.getIconNode(t.icon,t.target)||n.icon,this.hasWatermark=t.hasWatermark||n.hasWatermark,this.target=t.target;var a=t.Provider||n.Provider;"function"==typeof a&&(this.provider=new a,this.providerType=o.c.BUILTIN),"string"==typeof a&&(h(a).then((function(e){var t=e.default;r.provider=new t})).catch((function(e){console.error(e),r.provider=new L(e)})),this.providerType=o.c.REMOTE)}return g(e,[{key:"getIconNode",value:function(e,t){return t?i.a.createElement(c.a,{item:t,size:24}):Object(a.isValidElement)(e)?e:"string"!=typeof e?null:e.startsWith("icon-")?i.a.createElement(l.b,{name:e,size:22}):e.startsWith("http")?i.a.createElement(u.a,{src:e,style:{width:22,height:22}}):e}},{key:"getLabel",value:function(e,t){return null!=t&&t.name?t.name:null!=t&&t.title?null==t?void 0:t.title:e}}]),e}(),L=function(){function e(t){y(this,e),this.error=t}return g(e,[{key:"isEnable",value:function(){return!0}},{key:"initialize",value:function(){}},{key:"renderContent",value:function(){var e;return i.a.createElement("div",null,"ERROR: ",(null===(e=this.error)||void 0===e?void 0:e.toString())||"UNKNOWN ERROR")}}]),e}()},3859:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(0),o=r(480),a=r(158);function i(){var e,t=Object(o.f)((function(e){return{group:e.group,organization:e.organization}})),r=t.group,i=t.organization,c=(null==r?void 0:r.id)&&"Group"===(null==r?void 0:r.type),u=window.appData.homepageEnable,l=i&&i.id,s="/dashboard/org_wiki"===window.location.pathname&&(null==i||null===(e=i.abilities)||void 0===e?void 0:e.read_wiki);return Object(n.useMemo)((function(){return u?{isInGarden:!0}:c&&!a.a.isPublication(r)?{isInGroup:!0}:s?{isInOrgWiki:!0}:l?{}:{isInPersonal:!0}}),[c,s,u,l])}},3860:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n=function(e){return e.home="home",e.search="search",e.readDoc="readDoc",e.feedbackList="feedbackList",e.webview="webview",e}({})},3873:function(e,t,r){"use strict";r.d(t,"a",(function(){return Ac})),r.d(t,"c",(function(){return Lc})),r.d(t,"b",(function(){return Tc})),r.d(t,"d",(function(){return Cc}));var n=r(149),o=r.n(n),a=r(1340),i=r(0),c=r.n(i),u=r(3335),l=r(46),s=r(329),f=(r(178),r(68)),d=r(5),p=r.n(d),h=r(12),m=r.n(h),y=r(1837),v=r(1213),g="index-module_content_f7nmD",b="index-module_group_msIEh",w="index-module_item_BqLFr",_="index-module_selected_Fpmdr",E="index-module_title_aYyk7",O="index-module_date_4YA3i",S="index-module_delete_D1lhr";function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function x(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==k(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==k(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===k(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function j(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return A(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return A(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var L=function(e){var t=e.context,r=e.datasource,n=j(Object(i.useState)(0),2),o=n[0],a=n[1],u=Object(v.a)(),l=r.conversationList,s=Object(i.useMemo)((function(){var e=[],t=[],r=[],n=m()(),o=m()().subtract(1,"day");return l.forEach((function(a){var i=m()(a.created_at);i.isSame(n,"day")?e.push(a):i.isSame(o,"day")?t.push(a):r.push(a)})),[{label:__("今天"),list:e},{label:__("昨天"),list:t},{label:__("之前"),list:r,fullDate:!0}]}),[l,l.length]);return Object(i.useEffect)((function(){return r.addListener({onConversationsUpdated:u,onDatasetUpdated:u})}),[]),l.length?c.a.createElement("div",{className:g},s.filter((function(e){return e.list.length})).map((function(t){return c.a.createElement("div",null,c.a.createElement("span",{className:b},t.label),t.list.map((function(n){var i=n.id,u=n.title,l=n.updated_at,s=i===r.conversationId,d=u||__("未命名会话");s&&(d="".concat(__("[当前会话]")," ").concat(d));var h=m()(l).format(t.fullDate?"YY/MM/DD":"HH:mm"),v=o===i;return c.a.createElement("div",{className:p()(w,x({},_,s)),onClick:function(t){var n=null==t?void 0:t.target;null!=n&&n.closest(".".concat(S))||null==n||!n.closest(".".concat(E))||(r.switchConversation(i),e.context.closeDrawer())}},c.a.createElement("span",{className:E},d),!v&&c.a.createElement("span",{className:O},h),c.a.createElement(f.a,{title:__("确认删除该问答记录？"),okText:__("删除"),onConfirm:function(){r.deleteConversation(i),a(0)},onCancel:function(){return a(0)},onVisibleChange:function(e){a(e?i:0)}},c.a.createElement("span",null,c.a.createElement(y.default,{className:S,style:v?{display:"block"}:void 0}))))})))}))):t.sidebarRender.renderEmpty()},T=function(e){var t=e.context,r=e.children;return Object(i.cloneElement)(r,{onClick:function(){return t.renderDrawer({content:c.a.createElement(L,e),title:c.a.createElement(s.a,{variant:"title"},__("历史记录"))})}})},C={footer:"index-module_footer_0qNEF",functors:"index-module_functors_yg5fg",newTopic:"index-module_newTopic_3uhId"},P=function(e){var t=e.context,r=e.datasource,n=t.sidebarRender,o=Object(i.useRef)();return c.a.createElement("div",{className:C.footer},n.renderInput({ref:o,className:C.input,placeholder:__("来问我呀，雀雀很高兴为你服务！"),onEnter:function(e){r.commitPrompt(e,(function(){var e,t;null===(e=o.current)||void 0===e||e.clear(),null===(t=o.current)||void 0===t||t.focus()}))},extra:c.a.createElement("div",{className:C.functors},c.a.createElement("div",{className:C.newTopic,onClick:function(){return r.createConversation()}},c.a.createElement(l.b,{name:"comment-bubble",size:16}),__("新话题")),c.a.createElement(T,{context:t,datasource:r},c.a.createElement(s.a,{ml:16,type:"iconButton"},c.a.createElement(l.b,{name:"time-outlined",size:16}))))}))},N=(r(1397),r(1402)),R=(r(143),r(67)),I=r(377),D=r(1617),M=r(1873),F="ReadRefRender-module_container_QyZQu",G="ReadRefRender-module_header_NZqZ0",U="ReadRefRender-module_iframeContainer_yNj8i",B="ReadRefRender-module_iframe_NYZTp",q="ReadRefRender-module_skeletonContainer_gmMKj",V="ReadRefRender-module_newTabButton_GvL5g";function z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return H(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return H(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function W(e){var t=e.datasource,r=Object(v.a)(),n=Object(i.useRef)(null),o=t.selectedReference,a=z(Object(i.useState)(!0),2),c=a[0],u=a[1],l=Object(I.a)().isDarkMode;return Object(i.useEffect)((function(){return t.addListener({onSelectedReferenceChange:r})}),[t]),Object(i.useEffect)((function(){var e,t=function(){u(!1)};return null===(e=n.current)||void 0===e||e.addEventListener("load",t),function(){var e;null===(e=n.current)||void 0===e||e.removeEventListener("load",t)}}),[o]),null!=o&&o.url?React.createElement("div",{className:p()(F)},React.createElement(s.a,{className:G},React.createElement(s.a,{variant:"headline4",type:"iconButton",onClick:function(){return t.setSelectedReference(null)}},React.createElement(D.default,null)),React.createElement(s.a,{variant:"headline4",ml:16,maxWidth:200,noWrap:!0,title:null==o?void 0:o.title},null==o?void 0:o.title),React.createElement(R.a,{title:__("新窗口打开"),placement:"bottom"},React.createElement("a",{href:o.url,target:"_blank",className:V},React.createElement(M.default,{name:"new-tab-outlined",width:16,height:16})))),React.createElement("div",{className:U},c&&React.createElement("div",{className:q},React.createElement(N.a,{active:!0}),React.createElement(N.a,{active:!0}),React.createElement(N.a,{active:!0})),React.createElement("iframe",{ref:n,className:B,style:{display:c?"none":"block"},src:null==o?void 0:o.url.replace(/#.*/g,(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t[0];return"?from=ai&view=doc_embed&theme=".concat(l?"dark":"default","&assistant=true").concat(n)}))}))):null}var Y=r(505),K=r(130),Q=(r(37),r(10)),Z=r(3565),J=r(1013),X=r(519);function $(e){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$(e)}function ee(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function te(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==$(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==$(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===$(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function re(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return ne(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ne(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}function ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var oe={",":"，",".":"。",";":"；",":":"："},ae=/[,.;:]/,ie=[" ","\n","\t"],ce=[].concat(ie,["-","_","(",")","?","!","+","*","/","[","]","{","]","=",".",",",":",";"]);function ue(e){if(Number.isNaN(e))return!0;return e>=97&&e<=122||e>=65&&e<=90||e>=48&&e<=57||ce.includes(String.fromCharCode(e))}function le(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.completion=function(e){if(!e)return e;for(var t="";e.length;){var r=e.match(ae),n=null==r?void 0:r.index;if(!n){t+=e;break}var o=e.charAt(n),a=e.charCodeAt(n-1),i=e.charCodeAt(n+1),c=ue(a),u=ue(i);t+=e.substring(0,n),e=e.substring(n+1),c&&u?(t+=o,!e.length||","!==o&&";"!==o||ie.includes(String.fromCharCode(i))||(t+=" ")):t+=oe[o]||o}return t}(e.completion);var o=e.completion,a=e.reference,i=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(r),!0).forEach((function(t){te(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ee(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e),c=[];null==a||null===(r=a.chunks)||void 0===r||r.forEach((function(e){var t,r;null===(t=e.extras)||void 0===t||null===(r=t.externalRefs)||void 0===r||r.forEach((function(e){"image"===e.type&&e.url&&c.push(e.url)}))})),i.images=c,i.isValid=function(e){if(!e)return!1;for(var t=0,r=["无法回答该问题","知识库没有提供足够的相关信息","我只能回答知识库相关的问题"];t<r.length;t++){var n=r[t];if(e.indexOf(n)>=0)return!1}return!0}(o);try{var u,l,s=n?[]:function(e){if(e){var t=/(\d+\.) /g;if(e.match(t)){var r,n="",o=0,a=0,i=[],c=/^(\d+)\./,u=re(e.split(t));try{for(u.s();!(r=u.n()).done;){var l=r.value;if(l=l.trim()){var s=l.match(c);if(s&&s.length>=2){var f=parseInt(s[1],10);if(!f||f<=0)return;if(a>0&&f!==a+1)return;n&&i.push(n),++o,a=f,n="".concat(l," ")}else n+=l}}}catch(e){u.e(e)}finally{u.f()}return""!==n&&i.push(n),o>=2&&i.length>=2?i:void 0}}}(o);null!==(u=s)&&void 0!==u&&u.length||(s=function(e){if(e){var t=e.trimStart(),r=t.split("- ").filter((function(e){return e.length>0}));if(!(r.length<2)){var n=["。","，","；","：","】","、","！","？","…","……","』","」",".",",",";",":","]","!","?","~"],o=1,a=[],i=function(e){a.push("".concat(o,". ").concat(e)),++o};return r.forEach((function(e,o){if(a.length){var c=r[o-1].trim(),u=c.charAt(c.length-1);n.includes(u)||function(e){try{return!/[^\u4e00-\u9fa5]/.test(e)}catch(e){}return!1}(u)?i(e):a[a.length-1]+="- ".concat(e)}else t.startsWith("- ")?i(e):a.push(e)})),o>1?a:void 0}}}(o)),null!==(l=s)&&void 0!==l&&l.length&&(i.paragraphs=s)}catch(e){}return i.msgId||(i.msgId=Object(Z.a)({userId:null==t?void 0:t.id,type:i.type||J.b.AIAnswer,id:i.id})),i}function se(e){return se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},se(e)}function fe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function de(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fe(Object(r),!0).forEach((function(t){Oe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function pe(e){return function(e){if(Array.isArray(e))return he(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return he(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return he(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function me(){me=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==se(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(se(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function ye(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function ve(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){ye(a,n,o,i,c,"next",e)}function c(e){ye(a,n,o,i,c,"throw",e)}i(void 0)}))}}function ge(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Se(n.key),n)}}function be(e,t){return be=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},be(e,t)}function we(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Ee(e);if(t){var o=Ee(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===se(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _e(e)}(this,r)}}function _e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ee(e){return Ee=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ee(e)}function Oe(e,t,r){return(t=Se(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Se(e){var t=function(e,t){if("object"!==se(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==se(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===se(t)?t:String(t)}function ke(e){var t,r,n,o=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);o--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new xe(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function xe(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return xe=function(e){this.s=e,this.n=e.next},xe.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new xe(e)}var je=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&be(e,t)}(s,e);var t,r,n,o,a,i,c,u,l=we(s);function s(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return Oe(_e(e=l.call.apply(l,[this].concat(r))),"_conversation",void 0),Oe(_e(e),"_conversationList",[]),Oe(_e(e),"_completions",[]),Oe(_e(e),"_replying",!1),Oe(_e(e),"req",void 0),Oe(_e(e),"selectedReference",void 0),Oe(_e(e),"setSelectedReference",(function(t){e.selectedReference=t,e.notifyListener((function(e){var t;return null===(t=e.onSelectedReferenceChange)||void 0===t?void 0:t.call(e)}))})),e}return t=s,r=[{key:"conversationId",get:function(){var e;return(null===(e=this._conversation)||void 0===e?void 0:e.id)||0}},{key:"conversationList",get:function(){return this._conversationList}},{key:"completions",get:function(){return this._completions}},{key:"user",get:function(){var e;return(null===(e=window.appData)||void 0===e?void 0:e.me)||{}}},{key:"userId",get:function(){var e;return(null===(e=this.user)||void 0===e?void 0:e.id)||0}},{key:"buildSystemMessage",value:function(){return{id:0,prompt:"",completion:"",type:J.b.System,timestamp:Date.now(),msgId:this.buildMsgId(J.b.System)}}},{key:"setReq",value:function(e){this.req=e}},{key:"isLatestCompletion",value:function(e){var t;if(null===(t=this._completions)||void 0===t||!t.length)return!1;if(e.prompt)return!1;var r=this._completions[this._completions.length-1];return(null==r?void 0:r.id)===e.id}},{key:"initConversation",value:(u=ve(me().mark((function e(){var t,r,n,o,a,i,c,u;return me().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getConversationList();case 2:if(t=e.sent,r=[],n=t.conversations||[],this.updateConversationList(n),!n.length){e.next=15;break}return a=n[0],e.next=10,K.webProxy.conversation.findOne({id:a.id});case 10:i=e.sent,this._conversation=a,r=(null==i||null===(o=i.conversation)||void 0===o?void 0:o.completions)||[],e.next=20;break;case 15:return e.next=17,this.reqCreateConversation();case 17:c=e.sent,u=c.conversation,this._conversation=u;case 20:r.unshift(this.buildSystemMessage()),this.updateCompletions(r);case 22:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"updateConversationList",value:function(e){this._conversationList=e||[],this.notifyListener((function(e){var t;return null===(t=e.onConversationsUpdated)||void 0===t?void 0:t.call(e)}))}},{key:"updateCompletions",value:function(e){var t=this;this._completions=e?e.map((function(e){return le(e,t.user||{})})):[],this.notifyDatasetUpdatedInternal(!1)}},{key:"switchConversation",value:(c=ve(me().mark((function e(t){var r,n,o;return me().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==this.conversationId){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,K.webProxy.conversation.findOne({id:t});case 4:r=e.sent,n=null==r?void 0:r.conversation,this._conversation=n,(o=(null==n?void 0:n.completions)||[]).unshift(this.buildSystemMessage()),this.updateCompletions(o);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"createConversation",value:(i=ve(me().mark((function e(){var t,r;return me().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.reqCreateConversation();case 2:t=e.sent,r=t.conversation,this._conversation=r,this._completions=[this.buildSystemMessage()],this.updateConversationList([r].concat(pe(this._conversationList))),this.notifyDatasetUpdatedInternal();case 8:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"deleteConversation",value:(a=ve(me().mark((function e(t){var r,n;return me().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K.webProxy.conversation.deleteConversation({id:t});case 2:if(null!=(r=e.sent)&&r.success){e.next=5;break}return e.abrupt("return",!1);case 5:return n=this._conversationList.filter((function(e){return e.id!==t})),this.updateConversationList(n),t===this.conversationId&&(n.length>0?this.switchConversation(n[0].id):this.createConversation()),this.notifyDatasetUpdatedInternal(),e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"notifyDatasetUpdatedInternal",value:function(e){this.notifyDatasetUpdated({scrollImmediately:!e})}},{key:"pushCompletion",value:function(e){this._completions.push(e),this.notifyDatasetUpdatedInternal(!0)}},{key:"setReplying",value:function(e){e!==this._replying&&(this._replying=e)}},{key:"buildMsgId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.b.SelfQuestion;return Object(Z.a)({type:e,userId:this.userId})}},{key:"commitPrompt",value:(o=ve(me().mark((function e(t,r){var n,o,a,i,c,u,l,s,f,d,p;return me().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}return e.abrupt("return");case 2:if(!this._replying){e.next=5;break}return Q.a.info(__("我正在回答上一个问题，请等一等")),e.abrupt("return");case 5:this.setReplying(!0),null==r||r(),n=Date.now(),o=this.conversationId,this._conversation&&!this._conversation.title&&(this._conversation.title=t),this.pushCompletion({id:0,msgId:this.buildMsgId(),conversation_id:o,type:J.b.SelfQuestion,prompt:t,feedback:Y.FEEDBACK_TYPE.UNKNOWN,completion:"",created_at:new Date,updated_at:new Date,timestamp:n}),e.prev=11,a=this.req({conversation_id:o,prompt:t,stream:!0,type:J.b.AIAnswer}),i=a.request,c=!1,u=!1,e.prev=15,s=ke(i);case 17:return e.next=19,s.next();case 19:if(!(c=!(f=e.sent).done)){e.next=25;break}(d=f.value).type!==J.b.AIAnswer?this.handleDataSync(d):this.handleStreamSync(d);case 22:c=!1,e.next=17;break;case 25:e.next=31;break;case 27:e.prev=27,e.t0=e.catch(15),u=!0,l=e.t0;case 31:if(e.prev=31,e.prev=32,!c||null==s.return){e.next=36;break}return e.next=36,s.return();case 36:if(e.prev=36,!u){e.next=39;break}throw l;case 39:return e.finish(36);case 40:return e.finish(31);case 41:e.next=50;break;case 43:if(e.prev=43,e.t1=e.catch(11),p=__("抱歉刚刚走神了，请再问一次哦"),429===e.t1.status&&(p=__("提问过于频繁，请稍候再试")),e.t1.code!==X.ErrorCode.InfosecError){e.next=49;break}return e.abrupt("return",this.handerOnInfosecScanFailed(e.t1.data));case 49:this.pushCompletion({conversation_id:o,id:0,prompt:"",feedback:Y.FEEDBACK_TYPE.UNKNOWN,completion:p,created_at:new Date,updated_at:new Date,timestamp:n,msgId:this.buildMsgId(J.b.AIAnswer)});case 50:return e.prev=50,this.setReplying(!1),e.finish(50);case 53:case"end":return e.stop()}}),e,this,[[11,43,50,53],[15,27,31,41],[32,,36,40]])}))),function(e,t){return o.apply(this,arguments)})},{key:"buildCompletion",value:function(e,t,r){var n=r.status,o=r.message,a=new Date(t);return{id:t,conversation_id:this.conversationId,status:n,type:e,prompt:"",completion:o,created_at:a,updated_at:a,timestamp:t}}},{key:"getCompletionMap",value:function(){var e={};return this._completions.forEach((function(t){e["".concat(t.msgId,"_").concat(t.type)]=t})),e}},{key:"handleDataSync",value:function(e){var t=e.msgId,r=void 0===t?"":t,n=e.type,o=e.action,a=e.conversationId,i=e.timestamp,c=e.payload;if(a===this.conversationId){var u=this.getCompletionMap(),l="".concat(r,"_").concat(n);if(o===J.e.Delete)delete u[l];else{var s=this.buildCompletion(n,i,c),f=!0;if([J.e.Update,J.e.Insert].includes(o)){var d=u[l];d&&i<d.timestamp&&(console.warn("-- msg will not replace: ".concat(r,", old = ").concat(d.timestamp,", new = ").concat(e.timestamp)),f=!1)}f&&(s.msgId=r,s.timestamp=i,u[l]=s)}this._completions=Object.values(u),this.notifyDatasetUpdatedInternal(!0)}}},{key:"handleStreamSync",value:function(e){var t="".concat(e.msgId,"_").concat(e.type),r=this.getCompletionMap(),n=r[t],o=le(de(de({},e.payload),{},{msgId:e.msgId,type:e.type}),this.user,!e.end);o.timestamp=e.timestamp,o.typewriter=!e.end,o.prompt&&(o.prompt=""),n?n.completion=o.completion:r[t]=o,e.end&&(r[t]=o),this._completions=Object.values(r),this.notifyDatasetUpdatedInternal()}},{key:"handerOnInfosecScanFailed",value:function(e){var t="".concat(e.msgId,"_").concat(e.type),r=this.getCompletionMap(),n=r[t];n&&delete r[t],n||((n=le(de(de({},e.payload),{},{msgId:e.msgId,type:e.type}),this.user)).prompt=""),this._completions=Object.values(r),this.notifyDatasetUpdatedInternal(),n.completion=J.d.infosecScanFailed,n.typewriter=!1,r[t]=n,this._completions=Object.values(r),this.notifyDatasetUpdatedInternal()}}],r&&ge(t.prototype,r),n&&ge(t,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(u.b);function Ae(e){return Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ae(e)}function Le(){Le=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==Ae(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(Ae(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function Te(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function Ce(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Te(a,n,o,i,c,"next",e)}function c(e){Te(a,n,o,i,c,"throw",e)}i(void 0)}))}}function Pe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Fe(n.key),n)}}function Ne(e,t){return Ne=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ne(e,t)}function Re(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=De(e);if(t){var o=De(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Ae(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ie(e)}(this,r)}}function Ie(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function De(e){return De=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},De(e)}function Me(e,t,r){return(t=Fe(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Fe(e){var t=function(e,t){if("object"!==Ae(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Ae(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Ae(t)?t:String(t)}var Ge=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ne(e,t)}(u,e);var t,r,n,o,a,i,c=Re(u);function u(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return Me(Ie(e=c.call.apply(c,[this].concat(r))),"_assistant",void 0),Me(Ie(e),"type",__("领域专家")),e}return t=u,r=[{key:"name",get:function(){var e;return null===(e=this._assistant)||void 0===e?void 0:e.title}},{key:"currentAssistant",get:function(){return this._assistant}},{key:"reqCreateConversation",value:(i=Ce(Le().mark((function e(){return Le().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K.webProxy.conversation.create({type:Y.CONVERSATION_TYPE.GROUP_ASSISTANT,assistant_id:this._assistant.id});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"getConversationList",value:(a=Ce(Le().mark((function e(){return Le().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K.webProxy.conversation.list({type:Y.CONVERSATION_TYPE.GROUP_ASSISTANT,assistant_id:this._assistant.id});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"switchAssistant",value:(o=Ce(Le().mark((function e(t){var r;return Le().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&(null===(r=this._assistant)||void 0===r?void 0:r.id)!==(null==t?void 0:t.id)){e.next=2;break}return e.abrupt("return");case 2:this._assistant=t,this.initConversation();case 4:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})}],r&&Pe(t.prototype,r),n&&Pe(t,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(je),Ue=(r(785),r(424)),Be=(r(498),r(100)),qe=r(3593),Ve=r(181),ze=r(50),He="index-module_hoverShowOperation_8Q6U1",We="index-module_images_TDzet",Ye="index-module_image_rLyh0",Ke="index-module_textWrapper_wNpBV";function Qe(e){return Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qe(e)}function Ze(){Ze=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==Qe(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(Qe(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function Je(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function Xe(e){if(null!=e&&e.length){var t=[];return e.forEach((function(e){var r,n=function(e){var t=e.showTitle,r=e.chunkTitle,n=e.title,o=e.content;return t?r?"《".concat(t,"》- ").concat(r):"《".concat(t,"》"):n||o}(e),o=e.type===J.c.Note?"".concat(window.location.origin,"/r/note"):window.location.origin,a=null!==(r=e.url)&&void 0!==r&&r.startsWith("/")?"".concat(o).concat(e.url):e.url||"";t.find((function(e){return e.title===n&&e.url===a}))||t.push({title:n,url:a,type:"Doc"})})),t}}function $e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if(null!=e&&e.length){var r=[];return e.forEach((function(e){var n=e.bookName||"",o=e.bookSlug||"",a=r.find((function(e){return e.name===n&&e.slug===o}));n&&o&&!a&&r.push({name:n,slug:o,prompt:t,type:"Book"})})),r}}var et=function(e){var t,r,n=e.conversationId,o=e.pair,a=e.context,c=e.datasource,u=e.assistantSubjectUrl,l=a.sidebarRender,s=o.paragraphs||[o.completion||""],f=Object(v.a)(),d=Object(i.useMemo)((function(){var e,t;return{refs:Xe(null==o||null===(e=o.reference)||void 0===e?void 0:e.chunks),refBooks:$e(null===(t=o.reference)||void 0===t?void 0:t.chunks,o.prompt||o.encrypt_prompt)}}),[null==o||null===(t=o.reference)||void 0===t?void 0:t.chunks]),p=Object(i.useRef)(null),h=Object(i.useRef)(null),m=function(){var e=o.images;return null!=e&&e.length?React.createElement("div",{className:We,ref:h},e.map((function(t,r){return React.createElement("div",{className:Ye,key:r,style:{backgroundImage:"url(".concat(t,")")},onClick:function(){var t=e.map((function(e){return{src:e,msrc:e}}));Object(Ve.getImageBrowser)().open(t,r)}})}))):null},y=function(){var e,t=(e=Ze().mark((function e(t,r){return Ze().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.feedback===t&&(t=Y.FEEDBACK_TYPE.UNKNOWN),e.next=3,ze.a.conversation.feedback({conversation_id:n,completion_id:o.id,feedback:t});case 3:e.sent.success&&(o.feedback=t,f()),null==r||r();case 6:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Je(a,n,o,i,c,"next",e)}function c(e){Je(a,n,o,i,c,"throw",e)}i(void 0)}))});return function(e,r){return t.apply(this,arguments)}}(),g=React.createElement(React.Fragment,null,React.createElement("div",{className:Ke,ref:p},l.renderText({text:s,typewriter:!!o.typewriter})),o.isValid&&(null==m?void 0:m()),o.isValid&&l.renderReferences({reference:{title:__("信息来源："),refs:d.refs},onSelected:c.setSelectedReference}),o.isValid&&l.renderReferences({reference:{title:__("答案不准确？去知识库内搜索："),refs:d.refBooks},onSelected:c.setSelectedReference})),b=c.isLatestCompletion(o);return o.id&&o.status===J.a.SUCCESS&&(r=l.renderOperation({scrollToBottom:b?a.scrollToBottom:void 0,operation:{feedback:o.feedback,feedbackCallback:y,copy:function(){return o.completion||""},createNote:function(){return function(e){var t,r,n=(null===(t=p.current)||void 0===t?void 0:t.outerHTML)||"",a=(null===(r=h.current)||void 0===r?void 0:r.outerHTML)||"",i="".concat(n).concat(a).concat(function(e){if(null==e||!e.length)return"";try{return["<p>".concat(__("信息来源："),"</p>"),"<ul>"].concat(e.map((function(e){return'<li><a href="'.concat(e.url,'">').concat(e.title,"</a></li>")}))).concat(["</ul>","<p></p>"]).join("")}catch(e){}return""}(d.refs));e.setDocument(""),e.execCommand("insertCard","yuque",{src:u,mode:"card"}),(o.prompt||(null==o?void 0:o.encrypt_prompt))&&(e.execCommand("breakLine"),e.execCommand("paste",{types:["text/lake"],getData:function(){return"问题：".concat(o.prompt||(null==o?void 0:o.encrypt_prompt))}})),e.execCommand("breakLine"),e.execCommand("paste",{types:["text/lake"],getData:function(){return i}}),e.execCommand("breakLine")}}}})),l.renderFrame({className:b?void 0:He,style:{marginBottom:r?0:24},children:g,bottomExtra:r})};var tt=r(3592),rt=r(3647),nt="index-module_pair_DUICx",ot="index-module_addFAQ_a1hU8",at=function(e){var t=e.context,r=e.datasource,n=e.faqHook,o=e.assistantSubjectUrl,a=t.sidebarRender,c=r.conversationId,u=r.completions,s=Object(v.a)();!function(e){var t=Object(rt.b)({type:tt.a.GROUP_ASSISTANT.CONVERSATION,source:"conversation-panel",reqFn:ze.a.ai.aiAssistantCompletion,enableReject:!0});Object(i.useEffect)((function(){e.setReq(t)}),[e])}(r),Object(i.useEffect)((function(){return qe.a.addListener({onActivateAssistantChanged:s})}),[]);return c?React.createElement(React.Fragment,null,u.map((function(i){var u=i.prompt&&a.renderText({text:i.prompt});return React.createElement("div",{className:nt,key:i.msgId?"".concat(i.msgId,"_").concat(i.type):i.id},i.prompt&&a.renderFrame({fromUser:!0,children:null!=n&&n.ability?React.createElement(Ue.a,{overlayClassName:ot,trigger:"click",content:React.createElement(Be.a,null,React.createElement(R.a,{title:__("添加到常用问题")},React.createElement(l.b,{size:16,name:"PinOutlined",onClick:function(){return null==n?void 0:n.addFAQ(i.prompt)}})))},u):u}),function(n){var i=n.type,u=n.completion;return i===J.b.System?a.renderFrame({fromUser:!1,children:null!=e&&e.renderSystemCompletion?e.renderSystemCompletion():null}):i===J.b.Generating||i===J.b.Searching?u?a.renderProgress({progresses:[{status:n.status,text:u}]}):null:i===J.b.SelfQuestion?null:React.createElement(et,{conversationId:c,pair:n,context:t,datasource:r,assistantSubjectUrl:o})}(i))}))):a.renderLoading()},it=r(1202),ct=r(3746);function ut(e){return ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ut(e)}function lt(e){return function(e){if(Array.isArray(e))return gt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||vt(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function st(){st=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==ut(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(ut(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function ft(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function dt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ft(Object(r),!0).forEach((function(t){pt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ft(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function pt(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==ut(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==ut(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===ut(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ht(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function mt(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){ht(a,n,o,i,c,"next",e)}function c(e){ht(a,n,o,i,c,"throw",e)}i(void 0)}))}}function yt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||vt(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vt(e,t){if(e){if("string"==typeof e)return gt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?gt(e,t):void 0}}function gt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var bt=r(1382),wt="index-module_faqList_KRCmF",_t="index-module_linkBtn_E6y2F",Et="index-module_text_njtBQ",Ot="index-module_icon_0cltR",St=function(e){var t=e.commitPrompt,r=e.hook,n=r.data,o=r.removeFAQ,a=r.ability;return null!=n&&n.length?React.createElement("div",{className:wt},n.map((function(e,r){return React.createElement("div",{className:_t,key:r},React.createElement(bt.a,{className:Et,variant:"link",onClick:function(){return t(e.prompt)}},e.prompt),a&&o&&React.createElement(R.a,{title:__("移除该问题")},React.createElement(bt.a,{className:Ot,component:l.b,componentProps:{name:"nopin-outlined",size:16},onClick:function(){return o(e.id)}})))}))):null};function kt(e){var t,r=e.datasource,n=e.context,o=function(e,t){var r,n=Object(ct.b)(),o={};"group"===t?o.groupId=null==e?void 0:e.id:"assistant"===t&&(o.assistantId=null==e?void 0:e.id);var a=yt(Object(i.useState)([]),2),c=a[0],u=a[1],l=Object(it.a)(ze.a.groupAssistant.listFAQ),s=Object(it.a)(ze.a.groupAssistant.listAssistantFAQ),f=Object(it.a)(ze.a.groupAssistant.addFAQ),d=Object(it.a)(ze.a.groupAssistant.removeFAQ),p=function(){var e=mt(st().mark((function e(t){return st().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.request(dt(dt({},o),{},{promptId:t}));case 3:e.sent.success&&(u(c.filter((function(e){return e.id!==t}))),Q.a.success(__("已成功移除问题"))),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),Q.a.error(__("移除失败"));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),h=function(){var e=mt(st().mark((function e(t){var r;return st().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.request(dt(dt({},o),{},{prompt:t}));case 3:(r=e.sent)&&(u([].concat(lt(c),[r])),Q.a.success(__("已添加"))),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),Q.a.error(__("添加失败"));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),m=function(){var r=mt(st().mark((function r(){var n;return st().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(null!=e&&e.id){r.next=3;break}return u([]),r.abrupt("return");case 3:if("group"!==t){r.next=9;break}return r.next=6,l.request({id:null==e?void 0:e.id});case 6:n=r.sent,r.next=13;break;case 9:if("assistant"!==t){r.next=13;break}return r.next=12,s.request({assistantId:null==e?void 0:e.id});case 12:n=r.sent;case 13:u(n||[]);case 14:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}();return Object(i.useEffect)((function(){m()}),[null==e?void 0:e.id]),{loading:"assistant"===t?s.loading:l.loading,data:c,removeFAQ:p,addFAQ:h,listFAQ:m,ability:"assistant"!==t&&((null==n?void 0:n.is_admin)||(null==e||null===(r=e.abilities)||void 0===r?void 0:r.manage))}}(r.currentAssistant,"assistant"),a=n.sidebarRender;return c.a.createElement(at,{datasource:r,context:n,faqHook:o,renderSystemCompletion:function(){return c.a.createElement(c.a.Fragment,null,a.renderText({text:[c.a.createElement(s.a,{variant:"headline4",mb:12},__("👋🏻 你好，我是「{name}」问答助手",{name:r.name})),__("我可以就{name}领域的内容帮你做索引、概括、问答。{faq}",{name:null==r?void 0:r.name,faq:o.data.length?__("或许你想问："):""})]}),c.a.createElement(St,{hook:o,commitPrompt:function(e){return r.commitPrompt(e)}}))},assistantSubjectUrl:"".concat(window.location.origin,"/").concat(null===(t=r.currentAssistant)||void 0===t?void 0:t.login)})}function xt(e){return xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xt(e)}function jt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,a=void 0,a=function(e,t){if("object"!==xt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==xt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===xt(a)?a:String(a)),n)}var o,a}function At(e,t){return At=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},At(e,t)}function Lt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Tt(e);if(t){var o=Tt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===xt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Tt(e){return Tt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Tt(e)}var Ct=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&At(e,t)}(a,e);var t,r,n,o=Lt(a);function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),o.apply(this,arguments)}return t=a,(r=[{key:"isEnable",value:function(e){return!(!e.target&&!e.assistant)}},{key:"createDatasource",value:function(){return new Ge}},{key:"initialize",value:function(e){var t=e.target||e.assistant;this.datasource.switchAssistant(t)}},{key:"destroy",value:function(){}},{key:"onContextDataChanged",value:function(e){var t=e.target||e.assistant;this.datasource.switchAssistant(t)}},{key:"renderContent",value:function(e){return c.a.createElement(kt,{context:e,datasource:this.datasource})}},{key:"renderFooter",value:function(e){return c.a.createElement(P,{context:e,datasource:this.datasource})}},{key:"renderExtra",value:function(){return c.a.createElement(W,{datasource:this.datasource})}},{key:"renderDisable",value:function(e){return e.sidebarRender.renderDisable({title:__("暂无可用的 AI 功能")})}}])&&jt(t.prototype,r),n&&jt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(u.c);function Pt(e){return Pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pt(e)}function Nt(){Nt=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==Pt(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(Pt(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function Rt(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function It(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Rt(a,n,o,i,c,"next",e)}function c(e){Rt(a,n,o,i,c,"throw",e)}i(void 0)}))}}function Dt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,a=void 0,a=function(e,t){if("object"!==Pt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Pt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===Pt(a)?a:String(a)),n)}var o,a}function Mt(e,t){return Mt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Mt(e,t)}function Ft(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Gt(e);if(t){var o=Gt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Pt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Gt(e){return Gt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Gt(e)}var Ut=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Mt(e,t)}(c,e);var t,r,n,o,a,i=Ft(c);function c(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),i.apply(this,arguments)}return t=c,r=[{key:"reqCreateConversation",value:(a=It(Nt().mark((function e(){return Nt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K.webProxy.conversation.create({type:Y.CONVERSATION_TYPE.USER_ASSISTANT,group_id:this.user.id,scope:{user_id:this.user.id}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getConversationList",value:(o=It(Nt().mark((function e(){return Nt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K.webProxy.conversation.list({type:Y.CONVERSATION_TYPE.USER_ASSISTANT,group_id:this.user.id});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})}],r&&Dt(t.prototype,r),n&&Dt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(je);function Bt(e){return Bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bt(e)}function qt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,a=void 0,a=function(e,t){if("object"!==Bt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Bt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===Bt(a)?a:String(a)),n)}var o,a}function Vt(e,t){return Vt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Vt(e,t)}function zt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Ht(e);if(t){var o=Ht(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Bt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function Ht(e){return Ht=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ht(e)}var Wt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Vt(e,t)}(a,e);var t,r,n,o=zt(a);function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),o.apply(this,arguments)}return t=a,r=[{key:"createDatasource",value:function(){return new Ut}},{key:"isEnable",value:function(){var e;return!(null===(e=window.appData.settings)||void 0===e||!e.user_assistant_enabled)}},{key:"initialize",value:function(){this.datasource.initConversation()}},{key:"destroy",value:function(){}},{key:"renderContent",value:function(e){return c.a.createElement(at,{context:e,datasource:this.datasource,renderSystemCompletion:function(){return e.sidebarRender.renderText({text:[c.a.createElement(s.a,{variant:"headline4",mb:12},__("👋🏻 你好，我是个人知识管理助手")),__("你可以向我提问，我会根据你所有的个人知识库和小记做出解答，从而帮助你更好的消化和利用你积累的知识。")]})}})}},{key:"renderFooter",value:function(e){return c.a.createElement(P,{context:e,datasource:this.datasource})}},{key:"renderExtra",value:function(){return c.a.createElement(W,{datasource:this.datasource})}},{key:"renderDisable",value:function(e){return e.sidebarRender.renderDisable({title:__("暂无可用的 AI 功能")})}}],r&&qt(t.prototype,r),n&&qt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(u.c),Yt=function(e){return e.translate="translate",e.explain="explain",e.summary="summary",e}({});function Kt(e){return Kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kt(e)}function Qt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||Jt(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Zt(e){return function(e){if(Array.isArray(e))return Xt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Jt(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Jt(e,t){if(e){if("string"==typeof e)return Xt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Xt(e,t):void 0}}function Xt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function $t(){$t=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==Kt(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(Kt(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function er(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function tr(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){er(a,n,o,i,c,"next",e)}function c(e){er(a,n,o,i,c,"throw",e)}i(void 0)}))}}function rr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ur(n.key),n)}}function nr(e,t){return nr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},nr(e,t)}function or(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=ir(e);if(t){var o=ir(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Kt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ar(e)}(this,r)}}function ar(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ir(e){return ir=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ir(e)}function cr(e,t,r){return(t=ur(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ur(e){var t=function(e,t){if("object"!==Kt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Kt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Kt(t)?t:String(t)}function lr(e){var t,r,n,o=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);o--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new sr(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function sr(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return sr=function(e){this.s=e,this.n=e.next},sr.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new sr(e)}var fr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&nr(e,t)}(h,e);var t,r,n,o,a,i,c,u,l,s,f,d,p=or(h);function h(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return cr(ar(e=p.call.apply(p,[this].concat(r))),"_msgList",[]),cr(ar(e),"_conversation",void 0),cr(ar(e),"_conversationList",[]),cr(ar(e),"_isInRequesting",!1),cr(ar(e),"_lastMsgId",void 0),cr(ar(e),"_doc",void 0),cr(ar(e),"_engine",void 0),cr(ar(e),"_linkDetail",void 0),cr(ar(e),"streamReq",void 0),cr(ar(e),"explainDoc",function(){var t=tr($t().mark((function t(r){var n,o,a;return $t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._isInRequesting){t.next=3;break}return Q.a.info(__("我正在回答上一个问题，请等一等")),t.abrupt("return");case 3:n=window.__engine,o=r||(null==n?void 0:n.getDocument("text/plain")),a=r?"概括内容":"速读本文",e._isInRequesting=!0,e.pushMsg({msgId:e.buildMsgId(),type:J.b.SelfQuestion,content:a,completion_id:0}),o||e.pushMsg({msgId:e.buildMsgId(),type:J.b.SelfQuestion,content:"文档内未提取出内容，请换一篇文档重试",completion_id:0}),e.callStream({contextId:e.conversationId,content:"".concat(o.replace(/\n+/g,"\n")).slice(0,X.AIReadingMaxContent*X.AIReadingMaxRound),stream:!0,type:X.AIReadingType.explainDoc,question:a});case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e}return t=h,r=[{key:"doc",get:function(){return this._doc}},{key:"engine",get:function(){return this._engine}},{key:"isInRequesting",get:function(){return this._isInRequesting}},{key:"msgList",get:function(){return this._msgList||[]}},{key:"conversationId",get:function(){var e;return(null===(e=this._conversation)||void 0===e?void 0:e.id)||0}},{key:"conversationList",get:function(){return this._conversationList}},{key:"linkDetail",get:function(){return this._linkDetail||""}},{key:"user",get:function(){var e;return(null===(e=window.appData)||void 0===e?void 0:e.me)||{}}},{key:"userId",get:function(){var e;return(null===(e=this.user)||void 0===e?void 0:e.id)||0}},{key:"buildMsgId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.b.SelfQuestion;return Object(Z.a)({type:e,userId:this.userId})}},{key:"setReq",value:function(e){this.streamReq=e}},{key:"notifyDatasetUpdatedInternal",value:function(e){this.notifyDatasetUpdated({scrollImmediately:!e})}},{key:"pushMsg",value:function(e){this._msgList.push(e),this._lastMsgId=e.msgId,this.notifyDatasetUpdatedInternal(!0)}},{key:"updateConversationList",value:function(e){this._conversationList=e||[],this.notifyListener((function(e){var t;return null===(t=e.onConversationsUpdated)||void 0===t?void 0:t.call(e)}))}},{key:"isYuqueLink",value:function(e){try{var t=new URL(e),r=t.pathname,n=t.hostname;if(!["lark.alibaba.net","yuque.alibaba-inc.com","aliyuque.antfin.com","yuque-ali-pre.antfin-inc.com","yuque.antfin-inc.com","yuque.antfin.com","yuque.antfin-inc.com","yuque-pre.antfin-inc.com","lark.alipay.net"].includes(n))return!1;var o=r.split("/");return!o[0]&&4===o.length}catch(e){return!1}}},{key:"setLinkDetail",value:function(e){this._linkDetail=e,this.notifyDatasetUpdatedInternal(!0)}},{key:"initConversion",value:(d=tr($t().mark((function e(){var t,r,n,o,a,i,c,u,l=this;return $t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K.webProxy.conversation.list({group_id:0,type:Y.CONVERSATION_TYPE.READ_ASSISTANT});case 2:if(t=e.sent,r=Zt(this._msgList),this._msgList=[],n=t.conversations||[],this.updateConversationList(n),!n.length){e.next=16;break}return i=n[0],e.next=11,K.webProxy.conversation.findOne({id:i.id});case 11:c=e.sent,this._conversation=i,null==c||null===(o=c.conversation)||void 0===o||null===(a=o.completions)||void 0===a||a.forEach((function(e){l._msgList.push({msgId:l.buildMsgId(),type:J.b.SelfQuestion,content:e.prompt,completion_id:e.id}),l._msgList.push({msgId:l.buildMsgId(),type:J.b.AIAnswer,content:e.completion,completion_id:e.id})})),e.next=20;break;case 16:return e.next=18,K.webProxy.conversation.create({group_id:0,type:Y.CONVERSATION_TYPE.READ_ASSISTANT});case 18:u=e.sent,this._conversation=null==u?void 0:u.conversation;case 20:r.length&&r.forEach((function(e){l._msgList.push(e)})),this.notifyDatasetUpdatedInternal(!0);case 22:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"callStream",value:(f=tr($t().mark((function e(t){var r,n,o,a,i,c,u,l,s,f;return $t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this.streamReq(t),n=r.request,o=r.abort,this.pushMsg({msgId:this.buildMsgId(),type:J.b.AIAnswer,content:"",completion_id:n.completion_id,stream:!0}),a=!1,i=!1,e.prev=4,u=lr(n);case 6:return e.next=8,u.next();case 8:if(!(a=!(l=e.sent).done)){e.next=24;break}if(s=l.value,f=this._msgList[this._msgList.length-1],s.error_code!==X.ErrorCode.InfosecError){e.next=18;break}return o(),f.content=J.d.infosecScanFailed,f.typewriter=!1,this._isInRequesting=!1,this.notifyDatasetUpdatedInternal(!0),e.abrupt("return");case 18:s.end?f.completion_id=s.completion_id:f.content+=s.result,f.typewriter=!s.end,this.notifyDatasetUpdatedInternal(!0);case 21:a=!1,e.next=6;break;case 24:e.next=30;break;case 26:e.prev=26,e.t0=e.catch(4),i=!0,c=e.t0;case 30:if(e.prev=30,e.prev=31,!a||null==u.return){e.next=35;break}return e.next=35,u.return();case 35:if(e.prev=35,!i){e.next=38;break}throw c;case 38:return e.finish(35);case 39:return e.finish(30);case 40:this._isInRequesting=!1,this.notifyDatasetUpdatedInternal(!0);case 42:case"end":return e.stop()}}),e,this,[[4,26,30,40],[31,,35,39]])}))),function(e){return f.apply(this,arguments)})},{key:"askDoc",value:(s=tr($t().mark((function e(t){var r,n;return $t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isInRequesting){e.next=3;break}return Q.a.info(__("我正在回答上一个问题，请等一等")),e.abrupt("return");case 3:if(this._linkDetail||!this.isYuqueLink(t)){e.next=6;break}return this.addLinkCard(t),e.abrupt("return");case 6:r=window.__engine,this._linkDetail?(n=this._linkDetail,this.setLinkDetail("")):n=null==r?void 0:r.getDocument("text/plain"),this._isInRequesting=!0,this.pushMsg({msgId:this.buildMsgId(),type:J.b.SelfQuestion,content:t,completion_id:0}),n||this.pushMsg({msgId:this.buildMsgId(),type:J.b.SelfQuestion,content:"文档内未提取出内容，请换一篇文档重试",completion_id:0}),this.callStream({contextId:this.conversationId,content:"".concat(n.replace(/\n+/g,"\n")).slice(0,X.AIReadingMaxContent),stream:!0,type:X.AIReadingType.askDoc,question:t});case 12:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"switchConversation",value:(l=tr($t().mark((function e(t){var r,n,o,a,i=this;return $t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==this.conversationId){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,K.webProxy.conversation.findOne({id:t});case 4:o=e.sent,a=null==o?void 0:o.conversation,this._conversation=a,this._msgList=[],null==o||null===(r=o.conversation)||void 0===r||null===(n=r.completions)||void 0===n||n.forEach((function(e){i._msgList.push({msgId:i.buildMsgId(),type:J.b.SelfQuestion,content:e.prompt,completion_id:e.id}),i._msgList.push({msgId:i.buildMsgId(),type:J.b.AIAnswer,content:e.completion,completion_id:e.id})})),this.notifyDatasetUpdatedInternal();case 10:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"deleteConversation",value:(u=tr($t().mark((function e(t){var r,n;return $t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K.webProxy.conversation.deleteConversation({id:t});case 2:if(null!=(r=e.sent)&&r.success){e.next=5;break}return e.abrupt("return",!1);case 5:return n=this._conversationList.filter((function(e){return e.id!==t})),this.updateConversationList(n),t===this.conversationId&&(n.length>0?this.switchConversation(n[0].id):this.createConversation()),this.notifyDatasetUpdatedInternal(),e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"createConversation",value:(c=tr($t().mark((function e(){var t,r;return $t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K.webProxy.conversation.create({group_id:0,type:Y.CONVERSATION_TYPE.READ_ASSISTANT});case 2:t=e.sent,r=t.conversation,this._conversation=r,this._msgList=[],this.notifyDatasetUpdatedInternal();case 7:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"isLatestCompletion",value:function(e){var t;return!(this._isInRequesting||null===(t=this._msgList)||void 0===t||!t.length)&&e.type!==J.b.SelfQuestion&&this._lastMsgId===e.msgId}},{key:"initDoc",value:function(e,t){this._doc=e,this._engine=t}},{key:"readLink",value:function(e){this._isInRequesting?Q.a.info(__("我正在回答上一个问题，请等一等")):this.isYuqueLink(e)?this.addLinkCard(e):(this.pushMsg({msgId:this.buildMsgId(),type:J.b.SelfQuestion,content:e,completion_id:0}),this.pushMsg({msgId:this.buildMsgId(),type:J.b.AIAnswer,content:"这个链接暂时还不能阅读哦，换个文档链接试试吧～",completion_id:0}))}},{key:"sendData",value:function(e){if(this._isInRequesting)Q.a.info(__("我正在回答上一个问题，请等一等"));else{var t=this._msgList[this.msgList.length-1];(null==t?void 0:t.type)===J.b.Operate?t.content=e:this._msgList.push({msgId:this.buildMsgId(),type:J.b.Operate,content:e,completion_id:0}),this.notifyDatasetUpdatedInternal(!0)}}},{key:"contentOperate",value:(i=tr($t().mark((function e(t,r){var n,o;return $t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:cr(n={},Yt.explain,{type:X.AIReadingType.explainContent,question:"解释选区"}),cr(n,Yt.translate,{type:X.AIReadingType.translate,question:"翻译选区"}),cr(n,Yt.summary,{type:X.AIReadingType.summary,question:"总结选区"}),o=n[r],this._isInRequesting=!0,this.pushMsg({msgId:this.buildMsgId(),type:J.b.SelfQuestion,content:o.question,completion_id:0}),this.callStream({contextId:this.conversationId,content:"".concat(t.replace(/\n+/g,"\n")).slice(0,X.AIReadingMaxContent),stream:!0,type:o.type,question:o.question});case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"getQuestion",value:(a=tr($t().mark((function e(){var t,r,n,o,a,i=this;return $t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isInRequesting){e.next=3;break}return Q.a.info(__("我正在回答上一个问题，请等一等")),e.abrupt("return");case 3:return t=window.__engine,r=null==t?void 0:t.getDocument("text/plain"),this._isInRequesting=!0,this.pushMsg({msgId:this.buildMsgId(),type:J.b.SelfQuestion,content:"提出问题",completion_id:0}),r||this.pushMsg({msgId:this.buildMsgId(),type:J.b.SelfQuestion,content:"文档内未提取出内容，请换一篇文档重试",completion_id:0}),e.next=10,K.webProxy.ai.readAssistantCompletion({content:"".concat(r.replace(/\n+/g,"\n")).slice(0,X.AIReadingMaxContent),type:X.AIReadingType.makeQuestion});case 10:n=e.sent,this._isInRequesting=!1,(o=n.result)||this.pushMsg({msgId:this.buildMsgId(),type:J.b.SelfQuestion,content:"文档内未提取出内容，请换一篇文档重试",completion_id:0}),(a=o.split("\n").map((function(e){return e.replace(/(1|2|3)\./,"").trim()}))).length||this.pushMsg({msgId:this.buildMsgId(),type:J.b.SelfQuestion,content:"文档内未提取出内容，请换一篇文档重试",completion_id:0}),a.forEach((function(e,t){i._msgList.push({msgId:i.buildMsgId(),type:J.b.AIQuestion,content:e,completion_id:0,index:t})})),this.notifyDatasetUpdatedInternal(!0);case 18:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"addLinkCard",value:(o=tr($t().mark((function e(t){var r,n,o,a,i,c,u,l,s,f;return $t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=new URL(t),o=n.pathname,a=o.split("/"),i=Qt(a,4),c=i[1],u=i[2],l=i[3],e.next=6,K.webProxy.docs.getDocTextBySlug({group_slug:c,book_slug:u,slug:l},{ignoreGlobalMessage:!0});case 6:s=e.sent,r=s.content,e.next=15;break;case 10:return e.prev=10,e.t0=e.catch(0),this.pushMsg({msgId:this.buildMsgId(),type:J.b.SelfQuestion,content:t,completion_id:0}),this.pushMsg({msgId:this.buildMsgId(),type:J.b.AIAnswer,content:"这个链接暂时还不能阅读哦，换个文档链接试试吧～",completion_id:0}),e.abrupt("return");case 15:(null==(f=this._msgList[this.msgList.length-1])?void 0:f.type)===J.b.LinkOperate?(f.content=t,f.docText=r):this._msgList.push({msgId:this.buildMsgId(),type:J.b.LinkOperate,docText:r,content:t,completion_id:0}),this.notifyDatasetUpdatedInternal(!0);case 18:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(e){return o.apply(this,arguments)})}],r&&rr(t.prototype,r),n&&rr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),h}(u.b),dr=(r(41),r(9)),pr="index-module_content_4ue1d",hr="index-module_group_Px9BA",mr="index-module_item_cL7YZ",yr="index-module_selected_a6f7E",vr="index-module_title_+vfE0",gr="index-module_date_oAU7D",br="index-module_delete_vfPSs";function wr(e){return wr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wr(e)}function _r(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==wr(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==wr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===wr(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Er(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Or(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Or(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Or(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Sr=function(e){var t=e.context,r=e.datasource,n=Er(Object(i.useState)(0),2),o=n[0],a=n[1],u=Object(v.a)(),l=r.conversationList,s=Object(i.useMemo)((function(){var e=[],t=[],r=[],n=m()(),o=m()().subtract(1,"day");return l.forEach((function(a){var i=m()(a.created_at);i.isSame(n,"day")?e.push(a):i.isSame(o,"day")?t.push(a):r.push(a)})),[{label:__("今天"),list:e},{label:__("昨天"),list:t},{label:__("之前"),list:r,fullDate:!0}]}),[l,l.length]);return Object(i.useEffect)((function(){return r.addListener({onConversationsUpdated:u,onDatasetUpdated:u})}),[]),l.length?c.a.createElement("div",{className:pr},s.filter((function(e){return e.list.length})).map((function(t){return c.a.createElement("div",null,c.a.createElement("span",{className:hr},t.label),t.list.map((function(n){var i=n.id,u=n.title,l=n.created_at,s=i===r.conversationId,d=u||__("未命名会话");s&&(d="".concat(__("[当前会话]")," ").concat(d));var h=m()(l).format(t.fullDate?"YY/MM/DD":"HH:mm"),v=o===i;return c.a.createElement("div",{className:p()(mr,_r({},yr,s)),onClick:function(t){var n=null==t?void 0:t.target;null!=n&&n.closest(".".concat(br))||!(null!=n&&n.closest(".".concat(vr))||n.className===vr)||(r.switchConversation(i),e.context.closeDrawer())}},c.a.createElement("span",{className:vr},d),!v&&c.a.createElement("span",{className:gr},h),c.a.createElement(f.a,{title:__("确认删除该问答记录？"),okText:__("删除"),onConfirm:function(){r.deleteConversation(i),a(0)},onCancel:function(){return a(0)},onVisibleChange:function(e){a(e?i:0)}},c.a.createElement("span",null,c.a.createElement(y.default,{className:br,style:v?{display:"block"}:void 0}))))})))}))):t.sidebarRender.renderEmpty()},kr=function(e){var t=e.context,r=e.children;return Object(i.cloneElement)(r,{onClick:function(){return t.renderDrawer({content:c.a.createElement(Sr,e),title:c.a.createElement(s.a,{variant:"title"},__("历史记录"))})}})},xr="index-module_footer_jw1IR",jr="index-module_functors_16rZ+",Ar="index-module_newTopic_8u1qA",Lr="index-module_actionContainer_XneMd",Tr="index-module_action_nakS7";function Cr(e){return Cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cr(e)}function Pr(){Pr=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==Cr(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(Cr(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function Nr(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}var Rr=function(e){var t,r,n=e.context,o=e.dataSource,a=n.sidebarRender,c=Object(i.useRef)();return React.createElement(React.Fragment,null,React.createElement("div",{className:Lr},React.createElement(dr.a,{className:Tr,onClick:function(e){var t,r;null===(t=e.target)||void 0===t||null===(r=t.parentNode)||void 0===r||r.blur(),o.explainDoc()}},React.createElement(s.a,null,__("速读本文"))),React.createElement(dr.a,{className:Tr,onClick:function(e){var t,r;null===(t=e.target)||void 0===t||null===(r=t.parentNode)||void 0===r||r.blur(),o.getQuestion()}},React.createElement(s.a,null,__("提出问题")))),React.createElement("div",{className:xr},a.renderInput({className:"readAssistantInput",ref:c,placeholder:null!=o&&o.linkDetail?"".concat(__("对链接内容提问"),"："):__("对本文进行提问："),onEnter:(t=Pr().mark((function e(t){var r,n;return Pr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.askDoc(t),null===(r=c.current)||void 0===r||r.clear(),null===(n=c.current)||void 0===n||n.focus();case 3:case"end":return e.stop()}}),e)})),r=function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(e){Nr(a,n,o,i,c,"next",e)}function c(e){Nr(a,n,o,i,c,"throw",e)}i(void 0)}))},function(e){return r.apply(this,arguments)}),extra:React.createElement("div",{className:jr},React.createElement("div",{className:Ar,onClick:function(){return o.createConversation()}},React.createElement(l.b,{name:"comment-bubble",size:16}),__("新话题")),React.createElement(kr,{context:n,datasource:o},React.createElement(s.a,{ml:16,type:"iconButton"},React.createElement(l.b,{name:"time-outlined",size:16}))))})))},Ir="guide-module_guide_JOtFA",Dr="guide-module_title_4PJjv",Mr=function(e){var t=e.sidebarRender;return React.createElement("div",null,t.renderFrame({fromUser:!1,children:React.createElement("div",{className:Ir},t.renderText({text:[React.createElement("div",{className:Dr},"👋🏻 你好，我是阅读助手"),"我可以阅读本文，帮助你总结页面的文档，为你提供有用的信息"],style:{padding:0}}))}))},Fr="item-module_content_L0Hrd",Gr="item-module_aiQuestion_+OKa7",Ur="item-module_aiQuestionItem_AMMMt",Br="item-module_item_kWNBu",qr="item-module_hoverShowOperation_a5Flh",Vr="item-module_operate_NGu9q",zr="item-module_operateContent_aZ77N",Hr="item-module_tip_kxcv5",Wr="item-module_footer_hvhKk",Yr="item-module_btn_Vdjmb";function Kr(e){return Kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kr(e)}function Qr(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==Kr(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Kr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Kr(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Zr(){Zr=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==Kr(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(Kr(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function Jr(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}var Xr=function(e){var t,r,n=e.context,o=e.msg,a=e.dataSource,i=e.isInRequesting,c=Object(v.a)(),u=function(){var e,t=(e=Zr().mark((function e(t,r){return Zr().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.feedback===t&&(t=Y.FEEDBACK_TYPE.UNKNOWN),e.next=3,ze.a.conversation.feedback({conversation_id:a.conversationId,completion_id:o.completion_id,feedback:t});case 3:e.sent.success&&(o.feedback=t,c()),null==r||r();case 6:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Jr(a,n,o,i,c,"next",e)}function c(e){Jr(a,n,o,i,c,"throw",e)}i(void 0)}))});return function(e,r){return t.apply(this,arguments)}}(),l=n.sidebarRender,s=a.isLatestCompletion(o);if(!o.content)return null;o.type!==J.b.AIAnswer||i||(r=l.renderOperation({operation:{feedback:o.feedback,feedbackCallback:o.completion_id?u:void 0,copy:function(){return o.content||""},createNote:function(){return o.content}}}));var f=o.content?React.createElement("div",{className:Fr},l.renderText({text:o.content,typewriter:!!o.typewriter})):null;return o.type===J.b.LinkOperate&&(f=React.createElement("div",{className:zr},React.createElement("p",{className:Hr},__("链接"),"："),o.content,React.createElement("div",{className:Wr},React.createElement("p",{className:Hr},__("针对链接"),"："),React.createElement("div",{className:Vr},React.createElement("span",{className:Yr,onClick:function(){a.explainDoc(o.docText)}},__("概括内容")),React.createElement("span",{className:Yr,onClick:function(){a.setLinkDetail(o.docText),setTimeout((function(){var e=document.querySelector(".readAssistantInput textarea");null==e||e.focus()}),100)}},__("对链接内容提问")))))),o.type===J.b.Operate&&(f=React.createElement("div",{className:zr},React.createElement("p",{className:Hr},__("选区原文"),"："),o.content,React.createElement("div",{className:Wr},React.createElement("p",{className:Hr},__("针对选区"),"："),React.createElement("div",{className:Vr},React.createElement("span",{className:Yr,onClick:function(){a.contentOperate(o.content,Yt.explain)}},__("解释")),React.createElement("span",{className:Yr,onClick:function(){a.contentOperate(o.content,Yt.translate)}},__("中英互译")),React.createElement("span",{className:Yr,onClick:function(){a.contentOperate(o.content,Yt.summary)}},__("摘要")))))),o.type===J.b.AIQuestion&&(f=React.createElement("div",{className:p()(Fr,Gr),onClick:function(){a.askDoc(o.content)}},l.renderText({text:o.content}))),React.createElement("div",null,0===o.index&&o.type===J.b.AIQuestion&&l.renderProgress({progresses:[{status:1,text:__("如果你正在评审本文，你可以询问这些问题：")}],style:{marginBottom:"18px"}}),l.renderFrame({className:p()(Br,(t={},Qr(t,qr,!s),Qr(t,Vr,o.type===J.b.Operate),Qr(t,Ur,o.type===J.b.AIQuestion),t)),style:{marginBottom:r?12:24},fromUser:o.type===J.b.SelfQuestion,children:f,bottomExtra:r}))},$r=function(e){var t,r,n=e.context,o=e.dataSource,a=n.sidebarRender,u=o.msgList,l=o.isInRequesting,s=Object(v.a)();function f(){return c.a.createElement("div",null,a.renderProgress({progresses:[{status:0,text:__("正在根据本篇文档匹配答案...")}],style:{marginBottom:"18px"}}))}return Object(i.useEffect)((function(){return o.addListener({onDatasetUpdated:s})}),[]),t=o,r=Object(rt.b)({type:tt.a.READ_ASSISTANT.CONVERSATION,source:"conversation-panel",reqFn:ze.a.ai.readAssistantCompletion,enableReject:!0,disable:!window.appData.canUseAiReading}),Object(i.useEffect)((function(){t.setReq(r)}),[t]),c.a.createElement("div",null,c.a.createElement(Mr,{sidebarRender:a}),u.map((function(e,t){var r=t===u.length-1&&l&&e.stream,a=t===u.length-1&&l&&!e.stream;return c.a.createElement("div",{key:e.msgId},!!r&&f(),c.a.createElement(Xr,{context:n,msg:e,dataSource:o,isInRequesting:l}),a&&f())})))};function en(e){return function(e){if(Array.isArray(e))return tn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return tn(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tn(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var rn=function(e){var t,r=e.context,n=Object(it.a)(ze.a.events.mine);Object(i.useEffect)((function(){var e;n.request({limit:10,offset:0,type:"User",userId:null===(e=window.appData.me)||void 0===e?void 0:e.id})}),[]);var o=n.data&&null!==(t=n.data)&&void 0!==t&&t.length?n.data.filter((function(e){return"Doc"===e.subject_type&&e.subject})).map((function(e){return React.createElement("a",{target:"_blank",href:"/go/doc/".concat(e.subject.id,"#airead")},"🔗 ",e.actor_name,"：",e.subject.title)})):[React.createElement("a",{target:"_blank",href:"https://yuque.antfin.com/middleware/sofa4/upgrade_from_sofa3"},"🔗 SOFA3/SOFA4 到 SOFA4+JDK8 指南")];return r.sidebarRender.renderDisable({title:__("👋🏻 你好，我是阅读助手"),desc:[__("🆙 我可以帮你总结全文，你也可以向我提问。划词后点击「AI」也会触发 AI 功能哦~"),__("👇 点击下面文档快速体验一下")].concat(en(n.loading?[]:o))})};function nn(e){return nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nn(e)}function on(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,a=void 0,a=function(e,t){if("object"!==nn(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==nn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===nn(a)?a:String(a)),n)}var o,a}function an(e,t){return an=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},an(e,t)}function cn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=un(e);if(t){var o=un(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===nn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function un(e){return un=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},un(e)}var ln=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&an(e,t)}(a,e);var t,r,n,o=cn(a);function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),o.apply(this,arguments)}return t=a,(r=[{key:"createDatasource",value:function(){return new fr}},{key:"isEnable",value:function(e){return!("lake"!==e.doc.format||!window.appData.canUseAiReading)}},{key:"initialize",value:function(){this.datasource.initConversion()}},{key:"destroy",value:function(){}},{key:"onContextDataChanged",value:function(){}},{key:"renderContent",value:function(e){return c.a.createElement($r,{context:e,dataSource:this.datasource})}},{key:"renderFooter",value:function(e){return c.a.createElement(Rr,{context:e,dataSource:this.datasource})}},{key:"renderDisable",value:function(e){return c.a.createElement(rn,{context:e})}}])&&on(t.prototype,r),n&&on(t,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(u.c);function sn(e){return sn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sn(e)}function fn(){fn=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==sn(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(sn(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function dn(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function pn(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){dn(a,n,o,i,c,"next",e)}function c(e){dn(a,n,o,i,c,"throw",e)}i(void 0)}))}}function hn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,wn(n.key),n)}}function mn(e,t){return mn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},mn(e,t)}function yn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=gn(e);if(t){var o=gn(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===sn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return vn(e)}(this,r)}}function vn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function gn(e){return gn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},gn(e)}function bn(e,t,r){return(t=wn(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function wn(e){var t=function(e,t){if("object"!==sn(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==sn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===sn(t)?t:String(t)}function _n(e){var t,r,n,o=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);o--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new En(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function En(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return En=function(e){this.s=e,this.n=e.next},En.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new En(e)}var On=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&mn(e,t)}(p,e);var t,r,n,o,a,i,c,u,l,s,f,d=yn(p);function p(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return bn(vn(e=d.call.apply(d,[this].concat(r))),"_msgList",[]),bn(vn(e),"_conversation",void 0),bn(vn(e),"_conversationList",[]),bn(vn(e),"_isInRequesting",!1),bn(vn(e),"streamReq",void 0),e}return t=p,r=[{key:"isInRequesting",get:function(){return this._isInRequesting}},{key:"msgList",get:function(){return this._msgList||[]}},{key:"conversationId",get:function(){var e;return(null===(e=this._conversation)||void 0===e?void 0:e.id)||0}},{key:"conversationList",get:function(){return this._conversationList}},{key:"user",get:function(){var e;return(null===(e=window.appData)||void 0===e?void 0:e.me)||{}}},{key:"userId",get:function(){var e;return(null===(e=this.user)||void 0===e?void 0:e.id)||0}},{key:"buildMsgId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.b.SelfQuestion;return Object(Z.a)({type:e,userId:this.userId})}},{key:"setReq",value:function(e){this.streamReq=e}},{key:"notifyDatasetUpdatedInternal",value:function(e){this.notifyDatasetUpdated({scrollImmediately:!e})}},{key:"pushMsg",value:function(e){this._msgList.push(e),this.notifyDatasetUpdatedInternal(!0)}},{key:"updateConversationList",value:function(e){this._conversationList=e||[],this.notifyListener((function(e){var t;return null===(t=e.onConversationsUpdated)||void 0===t?void 0:t.call(e)}))}},{key:"initConversion",value:(f=pn(fn().mark((function e(){return fn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._msgList=[],this.notifyDatasetUpdatedInternal(!0);case 2:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"callStream",value:(s=pn(fn().mark((function e(t){var r,n,o,a,i,c,u,l,s,f;return fn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this.streamReq(t),n=r.request,o=r.abort,this.pushMsg({msgId:this.buildMsgId(),type:J.b.AIAnswer,content:"",completion_id:n.completion_id,stream:!0}),a=!1,i=!1,e.prev=4,u=_n(n);case 6:return e.next=8,u.next();case 8:if(!(a=!(l=e.sent).done)){e.next=24;break}if(s=l.value,f=this._msgList[this._msgList.length-1],s.error_code!==X.ErrorCode.InfosecError){e.next=18;break}return o(),f.content=J.d.infosecScanFailed,f.typewriter=!1,this._isInRequesting=!1,this.notifyDatasetUpdatedInternal(!0),e.abrupt("return");case 18:s.end?f.completion_id=s.completion_id:f.content+=s.result,f.typewriter=!s.end,this.notifyDatasetUpdatedInternal(!0);case 21:a=!1,e.next=6;break;case 24:e.next=30;break;case 26:e.prev=26,e.t0=e.catch(4),i=!0,c=e.t0;case 30:if(e.prev=30,e.prev=31,!a||null==u.return){e.next=35;break}return e.next=35,u.return();case 35:if(e.prev=35,!i){e.next=38;break}throw c;case 38:return e.finish(35);case 39:return e.finish(30);case 40:this._isInRequesting=!1,this.notifyDatasetUpdatedInternal(!0);case 42:case"end":return e.stop()}}),e,this,[[4,26,30,40],[31,,35,39]])}))),function(e){return s.apply(this,arguments)})},{key:"switchConversation",value:(l=pn(fn().mark((function e(t){var r,n,o,a,i=this;return fn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==this.conversationId){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,K.webProxy.conversation.findOne({id:t});case 4:o=e.sent,a=null==o?void 0:o.conversation,this._conversation=a,this._msgList=[],null==o||null===(r=o.conversation)||void 0===r||null===(n=r.completions)||void 0===n||n.forEach((function(e){i._msgList.push({msgId:i.buildMsgId(),type:J.b.SelfQuestion,content:e.prompt,completion_id:e.id}),i._msgList.push({msgId:i.buildMsgId(),type:J.b.AIAnswer,content:e.completion,completion_id:e.id})})),this.notifyDatasetUpdatedInternal();case 10:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"deleteConversation",value:(u=pn(fn().mark((function e(t){var r,n;return fn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K.webProxy.conversation.deleteConversation({id:t});case 2:if(null!=(r=e.sent)&&r.success){e.next=5;break}return e.abrupt("return",!1);case 5:return n=this._conversationList.filter((function(e){return e.id!==t})),this.updateConversationList(n),t===this.conversationId&&(n.length>0?this.switchConversation(n[0].id):this.createConversation()),this.notifyDatasetUpdatedInternal(),e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"createConversation",value:(c=pn(fn().mark((function e(){return fn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._msgList=[];case 1:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"sendMsg",value:(i=pn(fn().mark((function e(t){return fn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._msgList.length?this.getOutline(t):this.getDetail(t);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getDetail",value:(a=pn(fn().mark((function e(t){var r;return fn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isInRequesting){e.next=3;break}return Q.a.info(__("我正在回答上一个问题，请等一等")),e.abrupt("return");case 3:return this.pushMsg({msgId:this.buildMsgId(),type:J.b.SelfQuestion,content:t,completion_id:0}),this._isInRequesting=!0,e.next=7,K.webProxy.aiWriting.completion({content:t,type:X.AIWritingType.generateOutlineQuestion,stream:!1});case 7:r=e.sent,this._isInRequesting=!1,this.pushMsg({msgId:this.buildMsgId(),type:J.b.AIAnswer,content:r.result,completion_id:r.completion_id});case 10:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"getOutline",value:(o=pn(fn().mark((function e(t){var r,n,o;return fn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._isInRequesting=!0,this.pushMsg({msgId:this.buildMsgId(),type:J.b.SelfQuestion,content:t,completion_id:0}),r=this._msgList[0],n="".concat(r.content,"，基于这个主题，我还要补充一些内容：").concat(t),e.next=6,K.webProxy.aiWriting.completion({content:n,type:X.AIWritingType.generateOutline,stream:!1});case 6:o=e.sent,this._isInRequesting=!1,this.pushMsg({msgId:this.buildMsgId(),type:J.b.Operate,content:o.result,completion_id:o.completion_id});case 9:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"insertDoc",value:function(e){var t=e.split("\n").map((function(e){return(e=e.trim()).startsWith("- ")?"<h3>".concat(e.replace("- ",""),"</h3>"):"<h2>".concat(e.split(". ")[1],"</h2>")}));window.__engine.setDocument("text/html",t.filter((function(e){return!e.includes("undefined")})).join("\n"))}}],r&&hn(t.prototype,r),n&&hn(t,n),Object.defineProperty(t,"prototype",{writable:!1}),p}(u.b),Sn="index-module_content_qjFF4",kn="index-module_group_M-nBm",xn="index-module_item_y6S9y",jn="index-module_selected_Ubiwb",An="index-module_title_yy3Hg",Ln="index-module_date_3PcOY",Tn="index-module_delete_pKQM9";function Cn(e){return Cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cn(e)}function Pn(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==Cn(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Cn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Cn(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Nn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Rn(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Rn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Rn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var In=function(e){var t=e.context,r=e.datasource,n=Nn(Object(i.useState)(0),2),o=n[0],a=n[1],u=Object(v.a)(),l=r.conversationList,s=Object(i.useMemo)((function(){var e=[],t=[],r=[],n=m()(),o=m()().subtract(1,"day");return l.forEach((function(a){var i=m()(a.created_at);i.isSame(n,"day")?e.push(a):i.isSame(o,"day")?t.push(a):r.push(a)})),[{label:__("今天"),list:e},{label:__("昨天"),list:t},{label:__("之前"),list:r,fullDate:!0}]}),[l,l.length]);return Object(i.useEffect)((function(){return r.addListener({onConversationsUpdated:u,onDatasetUpdated:u})}),[]),l.length?c.a.createElement("div",{className:Sn},s.filter((function(e){return e.list.length})).map((function(t){return c.a.createElement("div",null,c.a.createElement("span",{className:kn},t.label),t.list.map((function(n){var i=n.id,u=n.title,l=n.created_at,s=i===r.conversationId,d=u||__("未命名会话");s&&(d="".concat(__("[当前会话]")," ").concat(d));var h=m()(l).format(t.fullDate?"YY/MM/DD":"HH:mm"),v=o===i;return c.a.createElement("div",{className:p()(xn,Pn({},jn,s)),onClick:function(t){var n=null==t?void 0:t.target;null!=n&&n.closest(".".concat(Tn))||!(null!=n&&n.closest(".".concat(An))||n.className===An)||(r.switchConversation(i),e.context.closeDrawer())}},c.a.createElement("span",{className:An},d),!v&&c.a.createElement("span",{className:Ln},h),c.a.createElement(f.a,{title:__("确认删除该问答记录？"),okText:__("删除"),onConfirm:function(){r.deleteConversation(i),a(0)},onCancel:function(){return a(0)},onVisibleChange:function(e){a(e?i:0)}},c.a.createElement("span",null,c.a.createElement(y.default,{className:Tn,style:v?{display:"block"}:void 0}))))})))}))):t.sidebarRender.renderEmpty()},Dn=function(e){var t=e.context,r=e.children;return Object(i.cloneElement)(r,{onClick:function(){return t.renderDrawer({content:c.a.createElement(In,e),title:c.a.createElement(s.a,{variant:"title"},__("历史记录"))})}})},Mn="index-module_footer_tdOu3",Fn="index-module_functors_J00xc",Gn="index-module_newTopic_3TTSN";function Un(e){return Un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Un(e)}function Bn(){Bn=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==Un(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(Un(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function qn(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}var Vn=function(e){var t,r,n=e.context,o=e.dataSource,a=n.sidebarRender,c=Object(i.useRef)();return React.createElement(React.Fragment,null,React.createElement("div",{className:Mn},a.renderInput({ref:c,placeholder:"",onEnter:(t=Bn().mark((function e(t){var r,n;return Bn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null===(r=c.current)||void 0===r||r.clear(),null===(n=c.current)||void 0===n||n.focus(),o.sendMsg(t);case 3:case"end":return e.stop()}}),e)})),r=function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(e){qn(a,n,o,i,c,"next",e)}function c(e){qn(a,n,o,i,c,"throw",e)}i(void 0)}))},function(e){return r.apply(this,arguments)}),extra:React.createElement("div",{className:Fn},React.createElement("div",{className:Gn,onClick:function(){return o.createConversation()}},React.createElement(l.b,{name:"comment-bubble",size:16}),__("新话题")),React.createElement(Dn,{context:n,datasource:o},React.createElement(s.a,{ml:16,type:"iconButton"},React.createElement(l.b,{name:"time-outlined",size:16}))))})))},zn="guide-module_guide_9ROIO",Hn="guide-module_title_l-+MF",Wn=function(e){var t=e.sidebarRender;return React.createElement("div",null,t.renderFrame({fromUser:!1,children:React.createElement("div",{className:zn},t.renderText({text:[React.createElement("div",{className:Hn},"👋🏻 你好，我是大纲助手"),"我可以生成大纲"],style:{padding:0}}))}))},Yn="item-module_content_z-UPZ",Kn="item-module_footer_rn4W2",Qn="item-module_operate_s5dfE",Zn="item-module_btn_19orB",Jn="item-module_item_UuG90";function Xn(e){return Xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xn(e)}function $n(){$n=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==Xn(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(Xn(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function eo(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}var to=function(e){var t,r=e.context,n=e.msg,o=e.dataSource,a=e.isInRequesting,i=Object(v.a)(),c=function(){var e,t=(e=$n().mark((function e(t,r){return $n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.feedback===t&&(t=Y.FEEDBACK_TYPE.UNKNOWN),e.next=3,ze.a.conversation.feedback({conversation_id:o.conversationId,completion_id:n.completion_id,feedback:t});case 3:e.sent.success&&(n.feedback=t,i()),null==r||r();case 6:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){eo(a,n,o,i,c,"next",e)}function c(e){eo(a,n,o,i,c,"throw",e)}i(void 0)}))});return function(e,r){return t.apply(this,arguments)}}(),u=r.sidebarRender;if(!n.content)return null;n.type===J.b.SelfQuestion||a||(t=u.renderOperation({operation:{feedback:n.feedback,feedbackCallback:n.completion_id?c:void 0,copy:function(){return n.content||""},createNote:function(){return n.content}}}));var l=n.content?React.createElement("div",{className:Yn},u.renderText({text:n.content,typewriter:!!n.typewriter}),n.type===J.b.Operate&&React.createElement("div",{className:Kn},React.createElement("div",{className:Qn},React.createElement("span",{className:Zn,onClick:function(){o.insertDoc(n.content)}},"插入文章")))):null;return React.createElement("div",null,u.renderFrame({className:p()(Jn),style:{marginBottom:t?12:24},fromUser:n.type===J.b.SelfQuestion,children:l,bottomExtra:t}))},ro=function(e){var t=e.context,r=e.dataSource,n=t.sidebarRender,o=r.msgList,a=r.isInRequesting,u=Object(v.a)();function l(){return c.a.createElement("div",null,n.renderProgress({progresses:[{status:0,text:"正在生成内容"}],style:{marginBottom:"18px"}}))}return Object(i.useEffect)((function(){return r.addListener({onDatasetUpdated:u})}),[]),c.a.createElement("div",null,c.a.createElement(Wn,{sidebarRender:n}),o.map((function(e,n){var i=n===o.length-1&&a&&e.stream,u=n===o.length-1&&a&&!e.stream;return c.a.createElement("div",{key:e.msgId},!!i&&l(),c.a.createElement(to,{context:t,msg:e,dataSource:r,isInRequesting:a}),u&&l())})))};function no(e){return no="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},no(e)}function oo(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,a=void 0,a=function(e,t){if("object"!==no(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==no(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===no(a)?a:String(a)),n)}var o,a}function ao(e,t){return ao=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ao(e,t)}function io(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=co(e);if(t){var o=co(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===no(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function co(e){return co=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},co(e)}var uo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ao(e,t)}(a,e);var t,r,n,o=io(a);function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),o.apply(this,arguments)}return t=a,(r=[{key:"createDatasource",value:function(){return new On}},{key:"isEnable",value:function(e){return!0}},{key:"initialize",value:function(){this.datasource.initConversion()}},{key:"destroy",value:function(){}},{key:"onContextDataChanged",value:function(){}},{key:"renderContent",value:function(e){return c.a.createElement(ro,{context:e,dataSource:this.datasource})}},{key:"renderFooter",value:function(e){return c.a.createElement(Vn,{context:e,dataSource:this.datasource})}}])&&oo(t.prototype,r),n&&oo(t,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(u.c),lo=r(3825);function so(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return fo(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return fo(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fo(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var po=function(e,t){var r=so(Object(i.useState)(0),2),n=r[0],o=r[1];return Object(i.useEffect)((function(){return t.addListener({onInnerDatasetUpdated:function(t){var r=t||{},n=r.needScroll,a=r.scrollImmediately;o((function(e){return e+1})),n&&e.scrollToBottom(a)}})}),[]),{updateFlag:n}};function ho(e){return ho="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ho(e)}function mo(){mo=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==ho(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(ho(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function yo(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}var vo=function(e){var t,r,n=e.context,o=e.dataSource,a=n.sidebarRender,c=o.isInRequesting,u=(po(n,o).updateFlag,Object(i.useRef)());return React.createElement("div",{className:"sheet-ai-footer"},o.isInRequesting?React.createElement("div",{className:"sheet-ai-footer-menu"},React.createElement(dr.a,{className:"sheet-ai-stop-btn",onClick:function(){return o.stopGenerate()}},React.createElement("span",{className:"sheet-ai-stop-icon"}),__("停止"))):null,a.renderInput({ref:u,className:"sheet-ai-footer-input",placeholder:c?__("生成中..."):__("描述想生成的表格内容和目的，让雀雀帮你生成"),disabled:c,onEnter:(t=mo().mark((function e(t){var r,n;return mo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c){e.next=2;break}return e.abrupt("return");case 2:o.callGenerateSheet(t),null===(r=u.current)||void 0===r||r.clear(),null===(n=u.current)||void 0===n||n.focus();case 5:case"end":return e.stop()}}),e)})),r=function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(e){yo(a,n,o,i,c,"next",e)}function c(e){yo(a,n,o,i,c,"throw",e)}i(void 0)}))},function(e){return r.apply(this,arguments)})}))},go=r(1874),bo=r(1875),wo=r(1435),_o=r(3753),Eo=r(3750),Oo=function(e){var t=e.msgRef,r=e.tableId;return{copy:function(){var e=document.createRange(),n=window.getSelection();if(n&&t.current){var o=t.current.querySelector("#".concat(r));if(o){var a=o.cloneNode(!0),i=document.createElement("div");i.className="sheet-ai-copy-block",i.style.position="fixed",i.style.top="0",i.style.clip="rect(0, 0, 0, 0)",document.body.appendChild(i),i.appendChild(a),e.selectNodeContents(a),n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy")}catch(e){}finally{i.remove(),n.removeAllRanges()}}}}}};function So(e){return So="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},So(e)}function ko(){ko=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==So(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(So(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function xo(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}var jo=function(e){var t=e.sidebarRender,r=e.msg,n=e.dataSource,o=e.isLast,a=e.isVisibleInModal,u=e.setModalVisible,l=e.setModalContent,s=e.context,f=e.gotoCreateSheet,d=n.insertSheet,h=n.callFeedback,m=n.findInsertPosition,y=n.isSheetEmpty,v=n.isToInsertStatus,g=n.book,b=n.createSheetInBook,w=Object(i.useRef)(null),_="table_".concat(r.msgId),E=function(e,t){var r=null,n=null,o={colCount:0,preTextEle:e||"",afterTextEle:n,tableEle:null};if(!e)return o;if(!e.match(_o.b))return o;try{var a=Object(_o.a)(e);if(!a)return o;var i=a.data,u=a.beforeText,l=a.afterText,s=a.colCount;u&&(r=u.split("\n").map((function(e,t){return e?c.a.createElement("div",{key:t},e):null})));var f=[],d=[];return Object.keys(i).forEach((function(e,t){var r=i[e],n=Object.keys(r).length;0!==t?d.push(c.a.createElement("tr",{key:t},Object.keys(r).map((function(e,t){return c.a.createElement("td",{key:t},r[e].value||"")})),Array(s-n).fill(0).map((function(e,t){return c.a.createElement("td",{key:t})})))):f.push(c.a.createElement("tr",{key:t},Object.keys(r).map((function(e,t){return c.a.createElement("th",{key:t},r[e].value||"")})),Array(s-n).fill(0).map((function(e,t){return c.a.createElement("th",{key:t})}))))})),l&&(n=l.split("\n").map((function(e,t){return e?c.a.createElement("div",{key:t},e):null}))),{colCount:a.colCount,preTextEle:r,afterTextEle:n,tableEle:f.length||d.length?c.a.createElement("table",{id:t},c.a.createElement("thead",null,f),c.a.createElement("tbody",null,d)):null}}catch(e){return o}}(r.content,_),O=E.colCount,S=E.preTextEle,k=E.afterTextEle,x=E.tableEle,j={width:O<=3?"100%":"".concat(100*O,"px")},A=function(){var e,t=(e=ko().mark((function e(t,n){return ko().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h(r,t);case 2:null==n||n();case 3:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){xo(a,n,o,i,c,"next",e)}function c(e){xo(a,n,o,i,c,"throw",e)}i(void 0)}))});return function(e,r){return t.apply(this,arguments)}}(),L=function(e){var t=Object(i.useRef)(e);t.current=Object(i.useMemo)((function(){return e}),[e]);var r=Object(i.useRef)();return r.current||(r.current=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t.current.apply(this,r)}),r.current}((function(){a&&l({tableEle:x,msg:r})}));Object(i.useEffect)((function(){L()}),[r.content,r.msgId,r.isClientId,r.isComplete,r.feedback]);var T=Oo({msgRef:w,tableId:_}).copy,C=r.type===Eo.e.ai?c.a.createElement("div",{className:p()("sheet-ai-msg-operate",o?"last-msg":"")},r.isClientId?null:t.renderOperation({scrollToBottom:o?s.scrollToBottom:void 0,operation:{feedbackCallback:A,feedback:r.feedback}})):null,P=null;return r.isComplete&&(P=n.sheet?y?c.a.createElement(dr.a,{className:"sheet-ai-table-operate-btn",icon:c.a.createElement(go.default,{className:"sheet-ai-table-operate-icon"}),onClick:function(){return d(r.msgId)}},__("插入表格")):c.a.createElement(dr.a,{className:p()("sheet-ai-table-operate-btn",v?"sheet-ai-table-insert-cursor":""),icon:c.a.createElement(go.default,{className:"sheet-ai-table-operate-icon"}),onClick:function(){return m(r.msgId)}},__("插入到指定位置")):c.a.createElement(dr.a,{className:p()("sheet-ai-table-operate-btn"),icon:c.a.createElement(go.default,{className:"sheet-ai-table-operate-icon"}),onClick:function(){return void 0===(null==g?void 0:g.id)?f(r.msgId):b(r.msgId)}},__("以此新建表格"))),c.a.createElement("div",{className:"sheet-ai-msg-item",ref:w},t.renderFrame({style:{marginBottom:24},fromUser:r.type===Eo.e.user,children:c.a.createElement("div",{className:"sheet-ai-msg"},S,x?c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"sheet-ai-msg-table-wrapper"},c.a.createElement("div",{className:"sheet-ai-msg-scroll"},c.a.createElement("div",{className:p()("sheet-ai-msg-table",O>3?"sheet-ai-table-right-shadow":""),style:j},x)),c.a.createElement("div",{className:"sheet-ai-msg-table-icon",onClick:function(){u(!0),l({tableEle:x,msg:r})}},c.a.createElement(bo.default,null))),r.isComplete?c.a.createElement("div",{className:"sheet-ai-table-operate"},c.a.createElement(dr.a,{className:"sheet-ai-table-operate-btn",icon:c.a.createElement(wo.default,{className:"sheet-ai-table-operate-icon"}),onClick:function(){T(),n.callFeedback(r,Y.FEEDBACK_TYPE.POSITIVE_USE)}},__("复制表格")),P):null):null,k),bottomExtra:C}))},Ao=(r(73),r(31)),Lo=r(3877),To=r(280);function Co(e){return Co="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Co(e)}function Po(){Po=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==Co(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(Co(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function No(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}var Ro=function(e){var t=e.sidebarRender,r=e.modalContent,n=e.visible,o=e.dataSource,a=e.onClose,u=o.isSheetEmpty,l=o.isToInsertStatus,s=o.insertSheet,f=o.findInsertPosition,d=o.callFeedback,h=r.tableEle,m=r.msg,y=Object(i.useRef)(null),v=function(){var e,t=(e=Po().mark((function e(t,r){return Po().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d(m,t);case 2:null==r||r();case 3:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){No(a,n,o,i,c,"next",e)}function c(e){No(a,n,o,i,c,"throw",e)}i(void 0)}))});return function(e,r){return t.apply(this,arguments)}}(),g="table_".concat((null==m?void 0:m.msgId)||""),b=Oo({msgRef:y,tableId:g}).copy;return m?c.a.createElement(Ao.a,{className:"sheet-ai-table-maxview",visible:n,onOk:function(){return a(!1)},onCancel:function(){return a(!1)},footer:null,width:850},c.a.createElement("div",{ref:y},c.a.createElement("div",{className:"logo"},c.a.createElement(To.a,{src:Lo.b,darkAlpha:.7,className:"icon"}),c.a.createElement("div",{className:"title"},__("雀雀 AI"))),h,c.a.createElement("div",{className:"sheet-ai-table-operate"},m.isComplete?c.a.createElement(c.a.Fragment,null,c.a.createElement(dr.a,{className:"sheet-ai-table-operate-btn",icon:c.a.createElement(wo.default,{className:"sheet-ai-table-operate-icon"}),onClick:function(){b(),a(!1),o.callFeedback(m,Y.FEEDBACK_TYPE.POSITIVE_USE)}},__("复制表格")),u?c.a.createElement(dr.a,{className:"sheet-ai-table-operate-btn",icon:c.a.createElement(go.default,{className:"sheet-ai-table-operate-icon"}),onClick:function(){a(!1),s(m.msgId)}},__("插入表格")):c.a.createElement(dr.a,{className:p()("sheet-ai-table-operate-btn",l?"sheet-ai-table-insert-cursor":""),icon:c.a.createElement(go.default,{className:"sheet-ai-table-operate-icon"}),onClick:function(){a(!1),f(m.msgId)}},__("插入到指定位置"))):null),m.isClientId?null:c.a.createElement("div",{className:"sheet-ai-table-maxview-footer"},t.renderOperation({operation:{feedbackCallback:v,feedback:m.feedback}})))):null},Io=r(1414);function Do(e){return Do="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Do(e)}function Mo(){Mo=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==Do(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(Do(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function Fo(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function Go(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Uo(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Uo(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Uo(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Bo="sheetAiGuide",qo=[{title:"项目计划表",ques:"做一个项目计划表，用于跟踪和管理项目，包含任务、所属项目、负责人、优先级、截止时间、状态"},{title:"个人记账表",ques:"做一张个人记账表，用于记录支出和收入的金额、分类、支付来源"},{title:"哲学书单",ques:"帮我生成一张哲学必读书单，附豆瓣评分"},{title:"活动预算",ques:"帮我做一个产品地推活动的预算表，包含预算类别、金额、环节、负责人"},{title:"需求池",ques:"帮我生成一个需求列表，用于管理需求池和进展"},{title:"资产管理表",ques:"帮我生成一张硬件资产管理表"}],Vo=function(e){var t=e.sidebarRender,r=e.dataSource,n=Go(Object(i.useState)("1"===window.localStorage.getItem(Bo)),2),o=n[0],a=n[1],c=function(){var e,t=(e=Mo().mark((function e(t){return Mo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.callGenerateSheet(t);case 2:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Fo(a,n,o,i,c,"next",e)}function c(e){Fo(a,n,o,i,c,"throw",e)}i(void 0)}))});return function(e){return t.apply(this,arguments)}}();return React.createElement("div",null,t.renderFrame({fromUser:!1,children:React.createElement("div",{className:"sheet-ai-guide"},o?React.createElement("div",{className:"sheet-ai-guide-close",onClick:function(){a(!1),window.localStorage.setItem(Bo,"1")}},React.createElement(Io.default,null)):null,t.renderText({text:[React.createElement("div",{className:"sheet-ai-guide-title",key:0},"👋🏻 ",__("你好，我是你的表格助手")),__("输入描述，让雀雀帮你轻松生成表格"),__("你可以对我说：生成一个什么内容的表格，以达到什么目的，包含什么信息")],style:{padding:0}}),React.createElement("div",null,__("示例"),"："),React.createElement("div",{className:"sheet-ai-example-area"},qo.map((function(e,t){return React.createElement("span",{key:t,className:"sheet-ai-example-item",onClick:function(){return c(e.ques)}},e.title)}))))}))},zo=r(267),Ho=Object(zo.b)((function(){return Promise.all([r.e(0),r.e(1),r.e(3),r.e(8),r.e(1285)]).then(r.bind(null,4091))}),{suspense:!0}),Wo=function(e){var t,r=e.visible,n=e.onClose,o=e.onBookSelect;return React.createElement(Ao.a,{className:"sheet-ai-table-maxview",visible:r,onOk:function(){return n(!1)},onCancel:function(){return n(!1)},footer:null,width:520},React.createElement("div",{style:{fontSize:"16px"}},"新建表格"),React.createElement(Ho,{organization:null===(t=window.appData)||void 0===t?void 0:t.organization,onBookSelect:o}))};function Yo(e){return Yo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yo(e)}function Ko(){Ko=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==Yo(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(Yo(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function Qo(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function Zo(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Jo(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Jo(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Jo(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Xo=function(e){var t,r,n=e.context,o=e.dataSource,a=n.sidebarRender,c=o.msgList,u=o.isWaitingResponse,l=o.createSheet;po(n,o).updateFlag;t=o,r=Object(rt.b)({type:tt.a.SHEET_ASSISTANT.CONVERSATION,source:"sheet-assistant",reqFn:ze.a.ai.sheetCompletion}),Object(i.useEffect)((function(){t.setStreamReqMethod(r)}),[]);var s=Zo(Object(i.useState)(!1),2),f=s[0],d=s[1],p=Zo(Object(i.useState)({tableEle:null,msg:null}),2),h=p[0],m=p[1],y=Zo(Object(i.useState)(!1),2),v=y[0],g=y[1],b=Object(i.useRef)(null),w=Object(i.useCallback)((function(e){b.current=e,g(!0)}),[]),_=function(){var e,t=(e=Ko().mark((function e(t){return Ko().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b.current){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,l(b.current,t);case 4:b.current=null,g(!1);case 6:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Qo(a,n,o,i,c,"next",e)}function c(e){Qo(a,n,o,i,c,"throw",e)}i(void 0)}))});return function(e){return t.apply(this,arguments)}}();return React.createElement("div",null,React.createElement(Vo,{sidebarRender:a,dataSource:o}),c.map((function(e,t){var r,i,u=t===c.length-1;return e.content?React.createElement("div",{key:e.msgId},React.createElement(jo,{sidebarRender:a,msg:e,dataSource:o,isLast:u,isVisibleInModal:f&&((null===(r=h.msg)||void 0===r?void 0:r.msgId)===e.msgId||(null===(i=h.msg)||void 0===i?void 0:i.msgId)===e.clientId),context:n,setModalVisible:d,setModalContent:m,gotoCreateSheet:w})):null})),u?React.createElement("div",null,a.renderProgress({progresses:[{status:0,text:"".concat(__("生成中，请稍后"),"...")}]})):null,React.createElement(Ro,{sidebarRender:a,modalContent:h,visible:f,dataSource:o,onClose:d}),v?React.createElement(Wo,{visible:v,onClose:g,onBookSelect:_}):null)};function $o(e){return $o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$o(e)}function ea(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,a=void 0,a=function(e,t){if("object"!==$o(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==$o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===$o(a)?a:String(a)),n)}var o,a}function ta(e,t){return ta=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ta(e,t)}function ra(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=na(e);if(t){var o=na(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===$o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function na(e){return na=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},na(e)}var oa=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ta(e,t)}(a,e);var t,r,n,o=ra(a);function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),o.apply(this,arguments)}return t=a,r=[{key:"createDatasource",value:function(){return new lo.a}},{key:"isEnable",value:function(e){var t,r;return!(null===(t=window.appData)||void 0===t||null===(r=t.settings)||void 0===r||!r.enable_sheet_ai)}},{key:"initialize",value:function(e){"lakesheet"===e.doc.format&&(this.datasource.sheetId=e.doc.id)}},{key:"destroy",value:function(){}},{key:"onContextDataChanged",value:function(e){var t,r=e.doc,n=e.book;null!=e&&null!==(t=e.me)&&void 0!==t&&t.id&&(this.datasource.userId=e.me.id),this.datasource.book={id:null==n?void 0:n.id,namespace:null==n?void 0:n.namespace},"lakesheet"===r.format&&(this.datasource.sheetId=r.id,r.editMode&&this.datasource.initSheet())}},{key:"renderContent",value:function(e){return c.a.createElement(Xo,{context:e,dataSource:this.datasource})}},{key:"renderFooter",value:function(e){return c.a.createElement(vo,{context:e,dataSource:this.datasource})}},{key:"renderDisable",value:function(e){return e.sidebarRender.renderDisable({title:__("👋🏻 你好，我是表格助手"),desc:[__("请输入描述，雀雀能帮你轻松生成表格。"),__("📊 我将在你编辑表格时为你提供服务，如果你想尝试一下，就去创建一个表格文档吧。")]})}}],r&&ea(t.prototype,r),n&&ea(t,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(u.c),aa="guide-module_guide_Q2dKD",ia="guide-module_title_XHBD9",ca=function(e){var t=e.sidebarRender;return React.createElement("div",null,t.renderFrame({fromUser:!1,children:React.createElement("div",{className:aa},t.renderText({text:[React.createElement("div",{className:ia},"👋🏻 你好，我是文档评审助手"),"点击下方「预评审此篇 PRD 文档」即可获得评审建议"],style:{padding:0}}))}))},ua=(r(139),r(44)),la=(r(321),r(95)),sa="user",fa="ai",da="item-module_content_D9-qO",pa="item-module_level_PDZyh",ha="item-module_high_In2hT",ma="item-module_mid_nWR7P",ya="item-module_low_So0Gh",va="item-module_feedbackDivider_JiBmt",ga="item-module_feedbackBtn_2HlEa",ba="item-module_feedbackActive_QEnWI",wa="item-module_fullWidth_kL4qV",_a=function(e){return e.LOW="LOW",e.MID="MID",e.HIGH="HIGH",e.NONE="NONE",e}({});function Ea(e){return Ea="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ea(e)}function Oa(){return Oa=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Oa.apply(this,arguments)}function Sa(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==Ea(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Ea(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Ea(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ka(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return xa(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xa(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xa(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var ja=function(e){var t=e.eventId,r=e.strategyCode,n=e.onFeedback,o=ka(Object(i.useState)(Y.FEEDBACK_TYPE.UNKNOWN),2),a=o[0],u=o[1];return t&&r?c.a.createElement("div",null,c.a.createElement(la.a,{className:va}),c.a.createElement(ua.a,{justify:"space-between"},c.a.createElement(dr.a,{className:p()(ga,Sa({},ba,a===Y.FEEDBACK_TYPE.POSITIVE)),onClick:function(){a!==Y.FEEDBACK_TYPE.POSITIVE&&(u(Y.FEEDBACK_TYPE.POSITIVE),n(t,r,!0))}},"👍🏻 有用"),c.a.createElement(dr.a,{className:p()(ga,Sa({},ba,a===Y.FEEDBACK_TYPE.NEGATIVE)),onClick:function(){a!==Y.FEEDBACK_TYPE.NEGATIVE&&(u(Y.FEEDBACK_TYPE.NEGATIVE),n(t,r,!1))}},"👎🏻 没用"))):null},Aa=function(e){var t,r=e.sidebarRender,n=e.msg,o=e.dataSource,a=Object(i.useMemo)((function(){return ja}),[n]);return c.a.createElement("div",null,r.renderFrame({style:{marginBottom:24},className:n.level?wa:"",fromUser:n.type===sa,children:c.a.createElement("div",{className:p()(da,(t={},Sa(t,ha,n.level===_a.HIGH),Sa(t,ma,n.level===_a.MID),Sa(t,ya,n.level===_a.LOW),Sa(t,pa,n.level),t))},n.content,c.a.createElement(a,Oa({},n,{onFeedback:o.feedbackCallback})))}))},La=function(e){var t=e.context,r=e.dataSource,n=t.sidebarRender,o=r.msgList,a=r.isInRequesting;return c.a.createElement("div",null,c.a.createElement(ca,{sidebarRender:n}),o.map((function(e){return c.a.createElement("div",{key:e.msgId},c.a.createElement(Aa,{sidebarRender:n,msg:e,dataSource:r}))})),a?c.a.createElement("div",null,n.renderProgress({progresses:[{status:0,text:"生成中，请稍后..."}]})):null)},Ta={footer:"index-module_footer_Cmmo4",functors:"index-module_functors_nqFyc",item:"index-module_item_YWccm"};function Ca(e){return Ca="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ca(e)}function Pa(){Pa=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==Ca(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(Ca(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function Na(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function Ra(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Na(a,n,o,i,c,"next",e)}function c(e){Na(a,n,o,i,c,"throw",e)}i(void 0)}))}}var Ia=function(e){var t=e.context,r=e.dataSource,n=Object(i.useMemo)((function(){return e=r.preReviewDoc.bind(r,t.contextData.doc),n=!1,Ra(Pa().mark((function t(){var r,o,a,i=arguments;return Pa().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=2;break}return t.abrupt("return");case 2:for(n=!0,t.prev=3,r=i.length,o=new Array(r),a=0;a<r;a++)o[a]=i[a];return t.next=7,e.apply(this,o);case 7:return t.prev=7,n=!1,t.finish(7);case 10:case"end":return t.stop()}}),t,this,[[3,,7,10]])})));var e,n}),[r,t.contextData.doc]),o=[{label:__("预评审此篇 PRD 文档"),onClick:n}];return c.a.createElement("div",{className:Ta.footer},c.a.createElement("div",{className:Ta.functors},o.map((function(e,t){var r=e.label,n=e.onClick,a=c.a.createElement("div",{className:Ta.item,key:r,onClick:n},c.a.createElement("span",{className:Ta.label},r));return c.a.createElement(c.a.Fragment,null,a,t<o.length-1&&c.a.createElement("div",{className:Ta.divider}))}))))},Da=r(362);function Ma(e){return Ma="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ma(e)}function Fa(){Fa=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==Ma(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(Ma(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function Ga(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ua(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ga(Object(r),!0).forEach((function(t){Va(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ga(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ba(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function qa(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,za(n.key),n)}}function Va(e,t,r){return(t=za(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function za(e){var t=function(e,t){if("object"!==Ma(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Ma(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Ma(t)?t:String(t)}var Ha=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Va(this,"msgHistory",[]),Va(this,"type",void 0),this.type=t,this.msgHistory=r}var t,r,n,o,a;return t=e,r=[{key:"say",value:(o=Fa().mark((function e(t){var r,n=arguments;return Fa().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=n.length>1&&void 0!==n[1]?n[1]:{}).delay){e.next=4;break}return e.next=4,Object(Da.a)(r.delay);case 4:this._pushMsg(Ua({msgId:Math.floor(1e7*Math.random()),type:this.type,content:t},r));case 5:case"end":return e.stop()}}),e,this)})),a=function(){var e=this,t=arguments;return new Promise((function(r,n){var a=o.apply(e,t);function i(e){Ba(a,r,n,i,c,"next",e)}function c(e){Ba(a,r,n,i,c,"throw",e)}i(void 0)}))},function(e){return a.apply(this,arguments)})},{key:"_pushMsg",value:function(e){this.msgHistory.push(e)}}],r&&qa(t.prototype,r),n&&qa(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Wa(e){return Wa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wa(e)}function Ya(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Za(n.key),n)}}function Ka(e,t,r){return t&&Ya(e.prototype,t),r&&Ya(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Qa(e,t,r){return(t=Za(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Za(e){var t=function(e,t){if("object"!==Wa(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Wa(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Wa(t)?t:String(t)}var Ja=Ka((function e(t,r){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Qa(this,"msgHistory",void 0),Qa(this,"sessionId",void 0),Qa(this,"ai",void 0),Qa(this,"user",void 0),Qa(this,"isWaitingAIResponse",!1),this.sessionId=t,this.msgHistory=new Proxy([],{set:function(e,t,o){if("length"===t){var a=e[e.length-1];a.type===sa&&(n.isWaitingAIResponse=!0),a.type===fa&&(n.isWaitingAIResponse=!1),null==r||r()}return Reflect.set(e,t,o)}}),this.ai=new Ha(fa,this.msgHistory),this.user=new Ha(sa,this.msgHistory)}));function Xa(e){return Xa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xa(e)}function $a(){$a=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==Xa(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(Xa(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function ei(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function ti(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){ei(a,n,o,i,c,"next",e)}function c(e){ei(a,n,o,i,c,"throw",e)}i(void 0)}))}}function ri(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ci(n.key),n)}}function ni(e,t){return ni=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ni(e,t)}function oi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=ii(e);if(t){var o=ii(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Xa(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ai(e)}(this,r)}}function ai(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ii(e){return ii=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ii(e)}function ci(e){var t=function(e,t){if("object"!==Xa(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Xa(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Xa(t)?t:String(t)}var ui=new Map,li=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ni(e,t)}(c,e);var t,r,n,o,a,i=oi(c);function c(){var e,t,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);for(var o=arguments.length,a=new Array(o),u=0;u<o;u++)a[u]=arguments[u];return e=i.call.apply(i,[this].concat(a)),t=ai(e),n=void 0,(r=ci(r="session"))in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,e}return t=c,r=[{key:"msgList",get:function(){return this.session.msgHistory}},{key:"isInRequesting",get:function(){return this.session.isWaitingAIResponse}},{key:"initialize",value:function(e){var t=e.doc,r=e.book,n="".concat(r.id,"-").concat(t.id),o=ui.get(n);if(!o)return this.session=new Ja(n,this.notifyDatasetUpdated.bind(this,{scrollImmediately:!0})),void ui.set(n,this.session);this.session=o}},{key:"preReviewDoc",value:(a=ti($a().mark((function e(t){var r,n,o,a,i,c,u,l,s;return $a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.session,e.prev=1,e.next=4,r.user.say("预评审此篇 PRD 文档");case 4:if(!(null==(n=window.__engine)?void 0:n.kernel.queryCommandValue("isEmpty"))){e.next=11;break}return e.next=9,r.ai.say("当前是空白文档，不可预评审。",{delay:500});case 9:e.next=24;break;case 11:return(a=null==n?void 0:n.kernel.queryCommandValue("textInfo")).images=(null===(o=a.images)||void 0===o?void 0:o.filter((function(e){return e.src})))||[],e.next=15,ze.a.preReview.preReviewDoc({id:t.id,docInfo:a},{ignoreGlobalMessage:!0});case 15:if(i=e.sent,c=i.eventId,u=i.riskResultCode,l=i.decisionResult,0!==(s=null==l?void 0:l.flatMap((function(e){return null==e?void 0:e.strategyResultList}))).length&&"NO_NEED_DECISION"!==u){e.next=22;break}return e.next=21,r.ai.say("暂无评审建议",{delay:500});case 21:return e.abrupt("return",e.sent);case 22:return e.next=24,s.reduce((function(e,t){return e.then((function(){return r.ai.say(React.createElement("div",null,React.createElement("h3",null,"PASS"!==t.riskResult?t.riskPoint:"不涉及".concat(t.riskPoint)),React.createElement("h4",null,"判断依据："),React.createElement("p",{dangerouslySetInnerHTML:{__html:t.riskInference}}),React.createElement("h4",null,"评审建议："),React.createElement("p",{dangerouslySetInnerHTML:{__html:t.riskSuggest}})),{eventId:c,strategyCode:t.strategyCode,level:"PASS"!==t.riskResult?t.riskLevel:_a.NONE,delay:500})}))}),Promise.resolve());case 24:e.next=30;break;case 26:return e.prev=26,e.t0=e.catch(1),e.next=30,r.ai.say(e.t0.message,{delay:500});case 30:case"end":return e.stop()}}),e,this,[[1,26]])}))),function(e){return a.apply(this,arguments)})},{key:"feedbackCallback",value:(o=ti($a().mark((function e(t,r,n){return $a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ze.a.preReview.feedback({eventId:t,strategyCode:r,result:n});case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return o.apply(this,arguments)})}],r&&ri(t.prototype,r),n&&ri(t,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(u.b),si=new li;function fi(e){return fi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fi(e)}function di(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,a=void 0,a=function(e,t){if("object"!==fi(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==fi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===fi(a)?a:String(a)),n)}var o,a}function pi(e,t){return pi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},pi(e,t)}function hi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=mi(e);if(t){var o=mi(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===fi(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function mi(e){return mi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},mi(e)}var yi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pi(e,t)}(a,e);var t,r,n,o=hi(a);function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),o.apply(this,arguments)}return t=a,(r=[{key:"isEnable",value:function(e){var t;return(null===(t=appData.settings)||void 0===t?void 0:t.enable_review_assistant)&&"Doc"===e.doc.type}},{key:"createDatasource",value:function(){return si}},{key:"initialize",value:function(e){this.datasource.initialize(e)}},{key:"onContextDataChanged",value:function(e){this.datasource.initialize(e)}},{key:"renderContent",value:function(e){return c.a.createElement(La,{context:e,dataSource:this.datasource})}},{key:"renderFooter",value:function(e){return c.a.createElement(Ia,{context:e,dataSource:this.datasource})}}])&&di(t.prototype,r),n&&di(t,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(u.c),vi=r(1624),gi=[{label:__("远景写实"),prompt:"远景，写实材料风格，HDRI，4K，细腻，美感，",example:"宏大场面，如海边灯塔、繁华城市的路灯等"},{label:__("近距静物"),prompt:"焦距35mm，细腻，商用，写实照片，简洁，",example:"静物突出，背景模糊，如窗台前有一本书和一杯茶；一只手在翻书"},{label:__("宏大场面插画"),prompt:"未来派，4k，科幻，插画，",example:"太空空间站，海边城市"},{label:__("水墨中式"),prompt:"水墨画，中国风，淡雅，美感，",example:"中国风，诗人在高山上站立、亭台楼阁等"},{label:__("油画静物"),prompt:"油画，窗台前，书桌上，美感，细腻，温暖，",example:"油画风格的静物，如几本书、一瓶花灯"},{label:__("油画景物"),prompt:"油画，美感，细腻，开阔，颜色饱和度低，",example:"油画风格的景物，如花园、海边"},{label:__("水彩动植物"),prompt:"淡水彩画风格，纯白背景，快乐，平和，温暖，",example:"淡水彩，如两只猫咪，小猴子、哈士奇狗等"}],bi="index-module_content_RuR-k",wi="index-module_group_AdqgB",_i="index-module_item_Zufrr",Ei="index-module_selected_r-C71",Oi="index-module_title_-kRF3",Si="index-module_date_vExF5",ki="index-module_delete_aJjwk";function xi(e){return xi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xi(e)}function ji(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==xi(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==xi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===xi(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ai(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Li(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Li(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Li(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Ti=function(e){var t=e.context,r=e.datasource,n=Ai(Object(i.useState)(0),2),o=n[0],a=n[1],u=Object(v.a)(),l=r.conversationList,s=Object(i.useMemo)((function(){var e=[],t=[],r=[],n=m()(),o=m()().subtract(1,"day");return l.forEach((function(a){var i=m()(a.created_at);i.isSame(n,"day")?e.push(a):i.isSame(o,"day")?t.push(a):r.push(a)})),[{label:__("今天"),list:e},{label:__("昨天"),list:t},{label:__("之前"),list:r,fullDate:!0}]}),[l,l.length]);return Object(i.useEffect)((function(){return r.addListener({onConversationsUpdated:u,onDatasetUpdated:u})}),[]),l.length?c.a.createElement("div",{className:bi},s.filter((function(e){return e.list.length})).map((function(t){return c.a.createElement("div",{key:t.label},c.a.createElement("span",{className:wi},t.label),t.list.map((function(n,i){var u=n.id,l=n.title,s=n.created_at,d=u===r.conversationId,h=l||__("未命名会话");d&&(h="".concat(__("[当前会话]")," ").concat(h));var v=m()(s).format(t.fullDate?"YY/MM/DD":"HH:mm"),g=o===u;return c.a.createElement("div",{key:i,className:p()(_i,ji({},Ei,d)),onClick:function(t){var n=null==t?void 0:t.target;null!=n&&n.closest(".".concat(ki))||null==n||!n.closest(".".concat(Oi))||(r.switchConversation(u),e.context.closeDrawer())}},c.a.createElement("span",{className:Oi},h),!g&&c.a.createElement("span",{className:Si},v),c.a.createElement(f.a,{title:__("确认删除该问答记录？"),okText:__("删除"),onConfirm:function(){r.deleteConversation(u),a(0)},onCancel:function(){return a(0)},onVisibleChange:function(e){a(e?u:0)}},c.a.createElement("span",null,c.a.createElement(y.default,{className:ki,style:g?{display:"block"}:void 0}))))})))}))):t.sidebarRender.renderEmpty()},Ci=function(e){var t=e.context,r=e.children;return Object(i.cloneElement)(r,{onClick:function(){return t.renderDrawer({content:c.a.createElement(Ti,e),title:c.a.createElement(s.a,{variant:"title"},__("历史记录"))})}})},Pi="index-module_footer_9rf5j",Ni="index-module_functors_ZgddP",Ri="index-module_newTopic_d7xtS",Ii="index-module_actionContainer_gVn9J",Di="index-module_buttonContainer_rB7vG",Mi="index-module_action_HBjn+",Fi="index-module_pagination_kO7pU",Gi="index-module_arrow_bGPvm";function Ui(e){return Ui="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ui(e)}function Bi(){Bi=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==Ui(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(Ui(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function qi(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function Vi(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return zi(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zi(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zi(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Hi=function(e){var t,r,n=e.context,o=e.dataSource,a=n.sidebarRender,c=Object(i.useRef)(),u=[],f=Object(i.useRef)(null),d=Vi(Object(i.useState)([0]),2),p=d[0],h=d[1],m=gi.map((function(e){var t=e.label,r=e.prompt,n=Object(i.useRef)(null),o=React.createElement(dr.a,{className:Mi,onClick:function(){var e,t;null===(e=c.current)||void 0===e||e.setValue(r),null===(t=c.current)||void 0===t||t.focus()}},React.createElement(s.a,null,t));return u.push(n),React.createElement("div",{key:t,ref:n},o)})),y=Vi(Object(i.useState)(m),2),v=y[0],g=y[1],b=Vi(Object(i.useState)(0),2),w=b[0],_=b[1];return Object(i.useEffect)((function(){var e,t=[0],r=(null===(e=f.current)||void 0===e?void 0:e.offsetWidth)||0;u.reduce((function(e,n,o){var a,i=(null===(a=n.current)||void 0===a?void 0:a.offsetWidth)||0;return e+i>r?(t.push(o),i):e+i}),0),t.push(gi.length),h(t)}),[gi]),Object(i.useEffect)((function(){var e=p[w],t=p[w+1];g(m.slice(e,t))}),[w,p]),React.createElement(React.Fragment,null,React.createElement("div",{className:Ii},React.createElement("div",{className:Di,ref:f},v),React.createElement("div",{className:Fi},React.createElement(dr.a,{disabled:0===w,className:Gi,onClick:function(){return _(w-1)}},React.createElement(D.default,null)),React.createElement(dr.a,{disabled:w===p.length-2,className:Gi,onClick:function(){return _(w+1)}},React.createElement(vi.default,null)))),React.createElement("div",{className:Pi},a.renderInput({ref:c,disabled:o.isInRequesting,placeholder:__("来问我呀，雀雀很高兴为你服务！"),onEnter:(t=Bi().mark((function e(t){var r,n;return Bi().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.isInRequesting||(o.generateImage(t),null===(r=c.current)||void 0===r||r.clear(),null===(n=c.current)||void 0===n||n.focus());case 1:case"end":return e.stop()}}),e)})),r=function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(e){qi(a,n,o,i,c,"next",e)}function c(e){qi(a,n,o,i,c,"throw",e)}i(void 0)}))},function(e){return r.apply(this,arguments)}),extra:React.createElement("div",{className:Ni},React.createElement("div",{className:Ri,onClick:function(){return o.createConversation()}},React.createElement(l.b,{name:"comment-bubble",size:16}),__("新话题")),React.createElement(Ci,{context:n,datasource:o},React.createElement(s.a,{ml:16,type:"iconButton"},React.createElement(l.b,{name:"time-outlined",size:16}))))})))},Wi=function(e){var t=e.sidebarRender,r=t.renderText({text:[React.createElement(bt.a,{variant:"headline4",mb:12},__("👋🏻 你好，我是创意助手")),__("选择我擅长的风格，再给我一些文字描述，我就可以快速作画。如果画得没能让你满意，请复制问题，修改描述后再次尝试。")]});return React.createElement("div",null,t.renderFrame({fromUser:!1,children:r}))},Yi=r(3881),Ki=r(3382),Qi="item-module_imageProgress_N4ZAy",Zi="item-module_image_ak71a",Ji="item-module_content_jxden",Xi="item-module_hoverShowOperation_sfBGq",$i="item-module_lastShowOperation_I1OyL";function ec(){ec=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==rc(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(rc(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function tc(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function rc(e){return rc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rc(e)}var nc=function(e){var t,r=e.msg,n=e.context,o=e.dataSource,a=n.sidebarRender,c=Object(v.a)(),u=r.type!==J.b.AIAnswer?r.content:JSON.parse(r.content),l="object"===rc(u),s=Object(i.useRef)(null),f=l?null===(t=u.afts_urls)||void 0===t?void 0:t[0]:"",d=o.isLatestCompletion(r),p=l&&f?React.createElement("div",{ref:s,onClick:function(){var e=[{src:f,msrc:f}];Object(Yi.getImageBrowser)().open(e,0)}},React.createElement("img",{className:Zi,src:f,onLoad:function(){return n.scrollToBottom(!0)}})):React.createElement("div",{className:Ji},l?__("作为一个人工智能语言模型，这个问题超出我目前的学习范围了，您可以问我其他问题，我将尽力为您解答"):u),h=function(){var e,t=(e=ec().mark((function e(t,n){return ec().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.feedback===t&&(t=Y.FEEDBACK_TYPE.UNKNOWN),e.next=3,ze.a.conversation.feedback({conversation_id:o.conversationId,completion_id:r.completion_id,feedback:t});case 3:e.sent.success&&(r.feedback=t,c()),null==n||n();case 6:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){tc(a,n,o,i,c,"next",e)}function c(e){tc(a,n,o,i,c,"throw",e)}i(void 0)}))});return function(e,r){return t.apply(this,arguments)}}(),m={feedback:r.feedback,feedbackCallback:h,copy:function(){var e=window.getSelection(),t=document.createRange();return e&&s.current&&(e.rangeCount>0&&e.removeAllRanges(),t.selectNode(s.current),e.addRange(t),document.execCommand("copy"),Q.a.success(__("已复制到剪贴板")),e.removeAllRanges()),""},createNote:function(){return function(e){var t,r=Object(Ki.htmlToLake)(null===(t=s.current)||void 0===t?void 0:t.innerHTML);e.setDocument(""),e.execCommand("paste",{types:["text/lake"],getData:function(){return r.value}}),e.execCommand("breakLine")}}},y=l&&f?a.renderOperation({customize:!0,operation:m,scrollToBottom:d?n.scrollToBottom:void 0}):null;return React.createElement(React.Fragment,null,l&&f?React.createElement("div",{className:Qi},a.renderProgress({progresses:[{status:1,text:__("已为你完成作画")}]})):null,React.createElement("div",null,a.renderFrame({className:d?$i:Xi,fromUser:r.type===J.b.SelfQuestion,bottomExtra:y,children:p})))},oc=function(e){var t=e.context,r=e.dataSource,n=t.sidebarRender,o=r.msgList,a=r.isInRequesting,u=Object(v.a)();return Object(i.useEffect)((function(){return r.addListener({onDatasetUpdated:u})}),[]),c.a.createElement("div",null,c.a.createElement(Wi,{sidebarRender:n}),o.map((function(e){return c.a.createElement("div",{key:e.msgId},c.a.createElement(nc,{msg:e,context:t,dataSource:r}))})),a?c.a.createElement("div",null,n.renderProgress({progresses:[{status:0,text:__("生成中，请稍后...")}]})):null)};function ac(e){return ac="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ac(e)}function ic(){ic=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==ac(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(ac(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function cc(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function uc(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){cc(a,n,o,i,c,"next",e)}function c(e){cc(a,n,o,i,c,"throw",e)}i(void 0)}))}}function lc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,mc(n.key),n)}}function sc(e,t){return sc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},sc(e,t)}function fc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=pc(e);if(t){var o=pc(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===ac(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return dc(e)}(this,r)}}function dc(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pc(e){return pc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},pc(e)}function hc(e,t,r){return(t=mc(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function mc(e){var t=function(e,t){if("object"!==ac(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==ac(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===ac(t)?t:String(t)}var yc=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&sc(e,t)}(s,e);var t,r,n,o,a,i,c,u,l=fc(s);function s(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return hc(dc(e=l.call.apply(l,[this].concat(r))),"_msgList",[]),hc(dc(e),"_lastMsgId",void 0),hc(dc(e),"_conversation",void 0),hc(dc(e),"_conversationList",[]),hc(dc(e),"_isInRequesting",!1),e}return t=s,r=[{key:"msgList",get:function(){return this._msgList||[]}},{key:"conversationId",get:function(){var e;return(null===(e=this._conversation)||void 0===e?void 0:e.id)||0}},{key:"conversationList",get:function(){return this._conversationList}},{key:"user",get:function(){var e;return(null===(e=window.appData)||void 0===e?void 0:e.me)||{}}},{key:"userId",get:function(){var e;return(null===(e=this.user)||void 0===e?void 0:e.id)||0}},{key:"isInRequesting",get:function(){return this._isInRequesting}},{key:"notifyDatasetUpdatedInternal",value:function(e){this.notifyDatasetUpdated({scrollImmediately:!e})}},{key:"pushMsg",value:function(e){this._msgList.push(e),this._lastMsgId=e.msgId,this.notifyDatasetUpdatedInternal(!0)}},{key:"updateConversationList",value:function(e){this._conversationList=e||[],this.notifyListener((function(e){var t;return null===(t=e.onConversationsUpdated)||void 0===t?void 0:t.call(e)}))}},{key:"buildMsgId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.b.SelfQuestion;return Object(Z.a)({type:e,userId:this.userId})}},{key:"initConversion",value:(u=uc(ic().mark((function e(){var t,r,n,o,a,i,c,u=this;return ic().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K.webProxy.conversation.list({group_id:0,type:Y.CONVERSATION_TYPE.PAINT_ASSISTANT});case 2:if(t=e.sent,this._msgList=[],r=t.conversations||[],this.updateConversationList(r),!r.length){e.next=15;break}return a=r[0],e.next=10,K.webProxy.conversation.findOne({id:a.id});case 10:i=e.sent,this._conversation=a,null==i||null===(n=i.conversation)||void 0===n||null===(o=n.completions)||void 0===o||o.forEach((function(e){u.pushMsg({msgId:u.buildMsgId(),type:J.b.SelfQuestion,content:e.prompt,completion_id:e.id}),u.pushMsg({msgId:u.buildMsgId(),type:J.b.AIAnswer,content:e.completion,completion_id:e.id,feedback:e.feedback})})),e.next=19;break;case 15:return e.next=17,K.webProxy.conversation.create({group_id:0,type:Y.CONVERSATION_TYPE.PAINT_ASSISTANT});case 17:c=e.sent,this._conversation=null==c?void 0:c.conversation;case 19:this.notifyDatasetUpdatedInternal(!0);case 20:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"createConversation",value:(c=uc(ic().mark((function e(){var t;return ic().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K.webProxy.conversation.create({group_id:0,type:Y.CONVERSATION_TYPE.PAINT_ASSISTANT});case 2:t=e.sent,this._conversation=null==t?void 0:t.conversation,this._msgList=[],this.notifyDatasetUpdatedInternal();case 6:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"generateImage",value:(i=uc(ic().mark((function e(t){var r;return ic().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._isInRequesting=!0,this.pushMsg({msgId:this.buildMsgId(),type:J.b.SelfQuestion,content:t,completion_id:0}),e.prev=2,e.next=5,K.webProxy.ai.textToImage({conversation_id:this.conversationId,prompt:t},{useOriginResp:!0});case 5:r=e.sent,this._isInRequesting=!1,this.pushMsg({msgId:this.buildMsgId(J.b.AIAnswer),type:J.b.AIAnswer,content:JSON.stringify(r.result),completion_id:r.completion_id}),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),this._isInRequesting=!1,this.pushMsg({msgId:this.buildMsgId(J.b.System),type:J.b.System,content:__("根据已知内容，无法回答该问题"),completion_id:0});case 14:case"end":return e.stop()}}),e,this,[[2,10]])}))),function(e){return i.apply(this,arguments)})},{key:"switchConversation",value:(a=uc(ic().mark((function e(t){var r,n,o,a,i=this;return ic().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==this.conversationId){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,K.webProxy.conversation.findOne({id:t});case 4:o=e.sent,a=null==o?void 0:o.conversation,this._conversation=a,this._msgList=[],null==o||null===(r=o.conversation)||void 0===r||null===(n=r.completions)||void 0===n||n.forEach((function(e){i.pushMsg({msgId:i.buildMsgId(),type:J.b.SelfQuestion,content:e.prompt,completion_id:e.id}),i.pushMsg({msgId:i.buildMsgId(),type:J.b.AIAnswer,content:e.completion,completion_id:e.id,feedback:e.feedback})})),this.notifyDatasetUpdatedInternal();case 10:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"deleteConversation",value:(o=uc(ic().mark((function e(t){var r,n;return ic().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K.webProxy.conversation.deleteConversation({id:t});case 2:if(null!=(r=e.sent)&&r.success){e.next=5;break}return e.abrupt("return",!1);case 5:return n=this._conversationList.filter((function(e){return e.id!==t})),this.updateConversationList(n),t===this.conversationId&&(n.length>0?this.switchConversation(n[0].id):this.createConversation()),this.notifyDatasetUpdatedInternal(),e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"isLatestCompletion",value:function(e){var t;return!(this._isInRequesting||null===(t=this._msgList)||void 0===t||!t.length)&&e.type!==J.b.SelfQuestion&&this._lastMsgId===e.msgId}}],r&&lc(t.prototype,r),n&&lc(t,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(u.b);function vc(e){return vc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vc(e)}function gc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,a=void 0,a=function(e,t){if("object"!==vc(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==vc(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===vc(a)?a:String(a)),n)}var o,a}function bc(e,t){return bc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},bc(e,t)}function wc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=_c(e);if(t){var o=_c(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===vc(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function _c(e){return _c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_c(e)}var Ec,Oc,Sc,kc=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&bc(e,t)}(a,e);var t,r,n,o=wc(a);function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),o.apply(this,arguments)}return t=a,r=[{key:"createDatasource",value:function(){return new yc}},{key:"isEnable",value:function(e){var t;return null===(t=window.appData.settings)||void 0===t?void 0:t.enable_painting_ai}},{key:"initialize",value:function(){this.datasource.initConversion()}},{key:"destroy",value:function(){}},{key:"onContextDataChanged",value:function(){}},{key:"renderContent",value:function(e){return React.createElement(oc,{context:e,dataSource:this.datasource})}},{key:"renderFooter",value:function(e){return React.createElement(Hi,{context:e,dataSource:this.datasource})}},{key:"renderDisable",value:function(e){return e.sidebarRender.renderDisable({title:__("👋🏻 你好，我是创意助手"),desc:[__("选择我擅长的风格，再给我一些文字描述，我就可以快速作画。如果画得没能让你满意，请复制问题，修改描述后再次尝试。"),__("🙇 很抱歉！当前助手在此页面不可用，请在右侧切换其他助手")]})}}],r&&gc(t.prototype,r),n&&gc(t,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(u.c);function xc(e){return xc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xc(e)}function jc(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==xc(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==xc(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===xc(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Ac=(jc(Sc={},a.a.GroupAssistant,{type:a.a.GroupAssistant,label:__("领域专家助手"),description:__("我会帮你将知识库里的内容做概括、索引，并在团队范围内问答你的问题。"),icon:"icon-ai-team",hasWatermark:!0,disableUnpin:!1,Provider:Ct}),jc(Sc,a.a.UserAssistant,{type:a.a.UserAssistant,label:__("个人知识管理助手"),description:__("你可以向我提问，我将依据你的知识库和笔记为你回答，帮助你高效利用你的知识积累。"),icon:"icon-ai-person-qa",hasWatermark:!0,disableUnpin:!0,Provider:Wt}),jc(Sc,a.a.ReadAssistant,{type:a.a.ReadAssistant,label:__("阅读助手"),description:__("我可以帮你快速概括文档内容，并可针对字、词、句做解释、翻译、摘要总结等。"),icon:"icon-ai-read",hasWatermark:!0,disableUnpin:!0,Provider:ln}),jc(Sc,a.a.SheetAssistant,{type:a.a.SheetAssistant,label:__("表格助手"),icon:"icon-ai-table",description:__("你可以跟我说一段文字描述，我会帮你快捷生成表格内容，并可以快速插入文档中。"),hasWatermark:!0,disableUnpin:!0,Provider:oa}),jc(Sc,a.a.PaintAssistant,{type:a.a.PaintAssistant,label:__("创意助手"),icon:"icon-ai-pic",description:__("我可以根据你的描述作画，请先选择我擅长的风格，再修改、补充描述，我会画的更好哦。"),hasWatermark:!0,disableUnpin:!0,Provider:kc}),jc(Sc,a.a.ReviewAssistant,{type:a.a.ReviewAssistant,label:__("评审助手"),icon:"icon-ai-review",description:__("我可以帮你在蚂蚁内网环境下，预评审PRD文档的隐私安全风险，帮你提前自查。"),hasWatermark:!0,disableUnpin:!1,Provider:yi}),jc(Sc,a.a.CodeFuseAssistant,{type:a.a.CodeFuseAssistant,label:"研发助手",icon:"icon-ai-debug",description:"我可以根据需求文字描述自动生成代码、解释代码的含义、为代码片段添加注释、自动生成测试用例代码等。",hasWatermark:!0,disableUnpin:!1,Provider:null===(Ec=window.appData.settings)||void 0===Ec?void 0:Ec.codefuse_assistant_provider_url}),jc(Sc,a.a.OutlineAssistant,{type:a.a.OutlineAssistant,label:"大纲助手",icon:"icon-ai-review",description:"我可以帮你生成大纲",hasWatermark:!0,disableUnpin:!1,Provider:uo}),jc(Sc,a.a.ThirdPartyAssistant,{type:a.a.ThirdPartyAssistant,label:"开发助手",icon:"icon-ai-debug",description:"这是一个只在开发中使用的助手。",hasWatermark:!0,disableUnpin:!0,Provider:(null===(Oc=window.appData.settings)||void 0===Oc?void 0:Oc.debug_assistant_provider_url)||"http://127.0.0.1"}),Sc),Lc=o()(Ac,[a.a.UserAssistant,a.a.ReadAssistant,a.a.SheetAssistant,a.a.PaintAssistant,a.a.ReviewAssistant,a.a.OutlineAssistant,a.a.CodeFuseAssistant].filter(Cc)),Tc=o()(Ac,[a.a.UserAssistant,a.a.ReadAssistant,a.a.SheetAssistant,a.a.PaintAssistant,a.a.ReviewAssistant,a.a.CodeFuseAssistant,a.a.ThirdPartyAssistant,a.a.OutlineAssistant].filter(Cc));function Cc(e){var t,r,n,o,i,c,u,l,s;switch(e){case a.a.UserAssistant:return window.appData.isYuque&&1===(null===(t=window.appData.zone)||void 0===t?void 0:t.id)&&(null===(r=window.appData.settings)||void 0===r?void 0:r.user_assistant_enabled);case a.a.GroupAssistant:return 1===(null===(n=window.appData.zone)||void 0===n?void 0:n.id);case a.a.BookAssistant:return 1===(null===(o=window.appData.zone)||void 0===o?void 0:o.id);case a.a.PaintAssistant:return 1===(null===(i=window.appData.zone)||void 0===i?void 0:i.id)&&(null===(c=window.appData.settings)||void 0===c?void 0:c.enable_painting_ai);case a.a.ReviewAssistant:return null===(u=window.appData.settings)||void 0===u?void 0:u.enable_review_assistant;case a.a.CodeFuseAssistant:return null===(l=window.appData.settings)||void 0===l?void 0:l.enable_codefuse_assistant;case a.a.ThirdPartyAssistant:return null===(s=window.appData.settings)||void 0===s?void 0:s.enable_debug_assistant;case a.a.OutlineAssistant:return window.appData.canUseAiOutline;default:return!0}}},3874:function(e,t,r){"use strict";r.r(t),r.d(t,"Affix",(function(){return a.a})),r.d(t,"Anchor",(function(){return c})),r.d(t,"AutoComplete",(function(){return u.a})),r.d(t,"Alert",(function(){return l.a})),r.d(t,"Avatar",(function(){return s.a})),r.d(t,"BackTop",(function(){return f.a})),r.d(t,"Badge",(function(){return d.a})),r.d(t,"Breadcrumb",(function(){return p.a})),r.d(t,"Button",(function(){return h.a})),r.d(t,"Calendar",(function(){return y})),r.d(t,"Card",(function(){return v.a})),r.d(t,"Collapse",(function(){return g.a})),r.d(t,"Carousel",(function(){return b.a})),r.d(t,"Cascader",(function(){return w.a})),r.d(t,"Checkbox",(function(){return _.a})),r.d(t,"Col",(function(){return E.a})),r.d(t,"Comment",(function(){return S})),r.d(t,"ConfigProvider",(function(){return k.a})),r.d(t,"DatePicker",(function(){return x.a})),r.d(t,"Descriptions",(function(){return j.a})),r.d(t,"Divider",(function(){return A.a})),r.d(t,"Dropdown",(function(){return L.a})),r.d(t,"Drawer",(function(){return T.a})),r.d(t,"Empty",(function(){return C.a})),r.d(t,"Form",(function(){return P.a})),r.d(t,"Grid",(function(){return R})),r.d(t,"Input",(function(){return I.a})),r.d(t,"InputNumber",(function(){return D.a})),r.d(t,"Layout",(function(){return M.a})),r.d(t,"List",(function(){return F.a})),r.d(t,"message",(function(){return G.a})),r.d(t,"Menu",(function(){return U.a})),r.d(t,"Mentions",(function(){return q})),r.d(t,"Modal",(function(){return V.a})),r.d(t,"Statistic",(function(){return z.a})),r.d(t,"notification",(function(){return H.a})),r.d(t,"PageHeader",(function(){return Y})),r.d(t,"Pagination",(function(){return K.a})),r.d(t,"Popconfirm",(function(){return Q.a})),r.d(t,"Popover",(function(){return Z.a})),r.d(t,"Progress",(function(){return J.a})),r.d(t,"Radio",(function(){return X.a})),r.d(t,"Rate",(function(){return ee})),r.d(t,"Result",(function(){return re})),r.d(t,"Row",(function(){return ne.a})),r.d(t,"Select",(function(){return oe.a})),r.d(t,"Skeleton",(function(){return ae.a})),r.d(t,"Slider",(function(){return ie.a})),r.d(t,"Space",(function(){return ce.a})),r.d(t,"Spin",(function(){return ue.a})),r.d(t,"Steps",(function(){return le.a})),r.d(t,"Switch",(function(){return se.a})),r.d(t,"Table",(function(){return fe.a})),r.d(t,"Transfer",(function(){return de.a})),r.d(t,"Tree",(function(){return pe.a})),r.d(t,"TreeSelect",(function(){return he.a})),r.d(t,"Tabs",(function(){return me.a})),r.d(t,"Tag",(function(){return ye.a})),r.d(t,"TimePicker",(function(){return ve.a})),r.d(t,"Timeline",(function(){return ge.a})),r.d(t,"Tooltip",(function(){return be.a})),r.d(t,"Typography",(function(){return we.a})),r.d(t,"Upload",(function(){return _e.a})),r.d(t,"version",(function(){return Oe})),r.d(t,"Image",(function(){return Se.a})),r.d(t,"Segmented",(function(){return ke.a})),r.d(t,"Cropper",(function(){return xe.a})),r.d(t,"Sortable",(function(){return je.a})),r.d(t,"Synopsis",(function(){return Ke})),r.d(t,"LegacyForm",(function(){return Qe.a}));var n=r(0),o=r.n(n),a=(r(3211),r(3673)),i=(r(3233),r(1576)),c=(r(3212),i.a),u=r(3636),l=r(711),s=r(3321),f=r(3704),d=r(3482),p=r(3360),h=r(9),m=(r(90),r(1227),r(1434),r(1466),r(2929)),y=(r(3213),m.a),v=r(33),g=r(3653),b=r(3687),w=r(1436),_=r(200),E=r(29),O=(r(3234),r(1572)),S=(r(3214),O.a),k=r(631),x=r(269),j=r(3755),A=r(95),L=r(319),T=r(3617),C=r(1525),P=r(23),N=(r(1255),r(977)),R=(r(3215),N.a),I=r(14),D=r(243),M=r(975),F=r(954),G=r(10),U=r(100),B=(r(3235),r(1574)),q=(r(3216),B.a),V=r(31),z=r(468),H=r(1509),W=(r(3236),r(1573)),Y=(r(3217),W.a),K=r(1523),Q=r(68),Z=r(424),J=r(1241),X=r(40),$=(r(3237),r(1575)),ee=(r(3218),$.a),te=(r(3238),r(1577)),re=(r(3219),te.a),ne=r(44),oe=r(34),ae=r(1402),ie=r(3513),ce=r(712),ue=r(138),le=r(3690),se=r(651),fe=r(42),de=r(1248),pe=r(1337),he=r(3679),me=r(296),ye=r(132),ve=r(3749),ge=r(3637),be=r(67),we=r(815),_e=r(203),Ee=(r(3232),r(1578)),Oe=(r(3220),Ee.a),Se=r(972),ke=r(1519),xe=r(1327),je=r(3588),Ae=r(58),Le=r.n(Ae),Te=r(3886),Ce=r.n(Te),Pe=r(83),Ne=r.n(Pe),Re=r(175),Ie=r.n(Re),De=r(2),Me=r.n(De),Fe=r(5),Ge=r.n(Fe),Ue=r(426),Be=r.n(Ue),qe={scrollTop:function(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},offset:function(e){if(!e.getClientRects().length)return{top:0,left:0};var t=e.getBoundingClientRect(),r=e.ownerDocument.defaultView;return{top:t.top+r.pageYOffset,left:t.left+r.pageXOffset}}},Ve=(r(3221),"undefined"!=typeof navigator?navigator.userAgent:""),ze=/yuque-desktop\/[\d.]+/i.test(Ve);function He(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return We(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return We(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}function We(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ye(e){var t,r,a=e.contents,i=void 0===a?[]:a,c=e.current,u=e.withHeader,l=e.offsetTop,s=e.enableProgressBar,f=e.onClickItem,d=Object(n.useRef)(null),p=(t=i,r=Object(n.useRef)(),Object(n.useEffect)((function(){r.current=t}),[t]),r.current),h=Object(n.useState)([]),m=Ie()(h,2),y=m[0],v=m[1],g=Object(n.useState)(-1),b=Ie()(g,2),w=b[0],_=b[1],E=Object(n.useMemo)((function(){return function(e){for(var t=[],r=e.length-1;r>=0;r--){for(var n=!1,o=r-1;o>=0&&1!==e.depth;o--)if(e[o].depth<e[r].depth){var a={id:r,pid:o,title:e[r].html,key:e[r].id,data:e[r]};t.unshift(a),n=!0;break}if(!n){var i={id:r,pid:-1,title:e[r].html,key:e[r].id,data:e[r]};t.unshift(i)}}return t}(i)}),[i]);return Object(n.useEffect)((function(){v((function(e){var t,r=[],n=null,o=He(i.keys());try{var a=function(){var o=t.value,a=!1,c=!0;if(p&&p.length>0){var u=i[o].id,l=p.findIndex((function(e){return e.id===u}));-1!=l?(a=e[l].collapsed,c=e[l].display):n=o}for(var s=!1,f=o+1;f<i.length&&!(i[f].depth<=i[o].depth);f++)if(i[f].depth>i[o].depth&&i[f].text){s=!0;break}var d={collapsible:s,collapsed:a,display:c};r.push(d)};for(o.s();!(t=o.n()).done;)a()}catch(e){o.e(e)}finally{o.f()}if(n){for(var c=[n],u=E[n].pid;-1!==u;)c.push(u),r[u].collapsed=!1,r[u].display=!0,u=E[u].pid;for(var l=n+1;l<i.length&&!(-1!==E[n].pid&&i[l].depth<=i[E[n].pid].depth);l++)r[l].collapsible&&!r[l].collapsed&&c.includes(E[l].pid)&&c.push(l);var s,f=He(E.keys());try{for(f.s();!(s=f.n()).done;){var d=s.value;c.includes(E[d].pid)&&(r[d].display=!0)}}catch(e){f.e(e)}finally{f.f()}}return r}))}),[i]),Object(n.useEffect)((function(){if(y.length>0&&c<y.length)if(-1===c||y[c].display)_(c);else{for(var e=E[c].pid;!y[e].display;)e=E[e].pid;_(e)}else _(-1)}),[E,c,y]),Object(n.useEffect)((function(){return e.autoAdjustPosition&&c>0&&w&&function(e){var t=e.querySelector(".larkui-synopsis-item-active");if(t){var r=e.scrollHeight-e.clientHeight,n=e.clientHeight,o=0;t.offsetTop>n?(o=(o=t.offsetTop-n/2+t.clientHeight/2+16)>=r?r:o,e.scrollTop=o):t.offsetTop>e.clientHeight/2?(o=t.offsetTop+16-e.clientHeight/2+t.clientHeight/2,e.scrollTop=o):e.scrollTop=0}}(d.current),function(){}}),[c,e.autoAdjustPosition,e.height,w]),o.a.createElement("div",{className:"larkui-synopsis-wrap ".concat(e.className),style:e.style,ref:d,"data-testid":"larkui-synopsis"},o.a.createElement("ul",{className:"larkui-synopsis"},i.map((function(e,t){var r={};return ze||(r.href="#".concat(encodeURIComponent(e.id))),y[t]&&y[t].display&&o.a.createElement("li",{className:Ge()({"larkui-synopsis-item":!0,"larkui-synopsis-item-active":w===t,"larkui-synopsis-progress-bar":s,"larkui-synopsis-progress-bar-highlighted":w===t&&s}),key:t},o.a.createElement("span",{className:Ge()(Ne()({"larkui-synopsis-item-collapsible-link":y[t].collapsible,"larkui-synopsis-item-link":!y[t].collapsible},"larkui-synopsis-item-link-".concat(e.depth),!0))},y[t].collapsible&&o.a.createElement("a",{onClick:function(e){!function(e,t,r){var n=Be()(y);n[t].collapsed=!n[t].collapsed;for(var o=t+1;o<i.length&&!(i[o].depth<=i[t].depth);o++){var a=E[o],c=n[o];if(!a||!c)break;if(a.pid!==t)if(r){for(var u=a.pid,l=!1;u!==t&&-1!==u;)y[u].collapsed&&(l=!0),u=E[u].pid;c.display=!l&&!y[a.pid].collapsed}else c.display=!1;else c.display=r}v(n)}(0,t,!y[t+1].display)}},o.a.createElement(Ce.a,{rotate:y[t].collapsed?270:0,style:{fontSize:"10px",margin:"5px",color:"#8c8c8c"}})),o.a.createElement("a",Le()({onClick:function(t){!function(e,t){if(e.preventDefault(),f)f({event:e,id:t});else if(ze){var r=document.getElementById(t);if(!r)return;r.scrollIntoView(!0)}else{var n=qe.scrollTop(),o=encodeURIComponent(t);window.location.hash=o;var a=document.getElementById(o);if(!a)return;if(a.scrollIntoView(),u){var i=qe.scrollTop();i<n&&window.scrollTo(0,i-60)}else if(l>0){var c=qe.scrollTop();window.scrollTo(0,c-l)}}}(t,e.id)}},r,{title:e.text}),o.a.createElement("span",null,e.text))))}))))}Ye.defaultProps={offsetTop:0},Ye.propTypes={className:Me.a.string,style:Me.a.object,contents:Me.a.array.isRequired,current:Me.a.number,height:Me.a.number,autoAdjustPosition:Me.a.bool,withHeader:Me.a.bool,offsetTop:Me.a.number,enableProgressBar:Me.a.bool,onClickItem:Me.a.func};var Ke=Ye,Qe=r(45)},3877:function(e,t,r){"use strict";r.d(t,"b",(function(){return f})),r.d(t,"a",(function(){return d}));var n=r(0),o=r.n(n),a=r(280),i=r(1213),c=r(3602),u=r(3593),l="index-module_superSidebarEntry_AgJRF",s="index-module_icon_GwSVd",f="https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*iyYFT5l53_EAAAAAAAAAAAAADvuFAQ/original",d=function(){var e=Object(i.a)();Object(n.useEffect)((function(){return u.a.addListener({onVisibilityChanged:e})}),[]);var t=u.a.isExpanded,r=Object(c.b)().rightSidebarWidth;return t?null:o.a.createElement("div",{className:"".concat(l," yuque-super-sidebar-entry"),style:{right:r+24}},o.a.createElement(a.a,{src:f,darkAlpha:.7,className:s,onClick:function(){t?u.a.switchCollapsed():u.a.switchExpand()}}))}},3878:function(e,t,r){"use strict";var n=r(0),o=r.n(n),a=r(377),i="index-module_wrapperBg_h50iC",c="index-module_area1_36tPA",u="index-module_area2_MaV53",l="index-module_area3_z6y4G",s="index-module_area4_R4Klj";function f(){return Object(a.a)().isDarkMode?null:o.a.createElement("div",{className:i},o.a.createElement("div",{className:c}),o.a.createElement("div",{className:u}),o.a.createElement("div",{className:l}),o.a.createElement("div",{className:s}))}t.a=Object(n.memo)(f)},3885:function(e,t,r){e.exports={shared:{react:r(0),"react-dom":r(57),antd:r(1515),"@alipay/larkui":r(3874),classnames:r(5)}}},3886:function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=(n=r(3887))&&n.__esModule?n:{default:n};t.default=o,e.exports=o},3887:function(e,t,r){"use strict";var n=r(119),o=r(135);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(700)),i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var c=a?Object.getOwnPropertyDescriptor(e,i):null;c&&(c.get||c.set)?Object.defineProperty(n,i,c):n[i]=e[i]}n.default=e,r&&r.set(e,n);return n}(r(0)),c=n(r(3888)),u=n(r(1192));function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}var s=function(e,t){return i.createElement(u.default,(0,a.default)((0,a.default)({},e),{},{ref:t,icon:c.default}))};s.displayName="CaretDownFilled";var f=i.forwardRef(s);t.default=f},3888:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M840.4 300H183.6c-19.7 0-30.7 20.8-18.5 35l328.4 380.8c9.4 10.9 27.5 10.9 37 0L858.9 335c12.2-14.2 1.2-35-18.5-35z"}}]},name:"caret-down",theme:"filled"}},3898:function(e,t,r){"use strict";r(785);var n=r(424),o=r(0),a=r.n(o),i=r(2),c=r.n(i),u=r(480),l=r(5),s=r.n(l),f=r(46),d=r(320),p=r(267),h={navigation:"index-module_navigation_uXN0h",triggerIcon:"index-module_triggerIcon_qjqIF",navigationPopoverOverlay:"index-module_navigationPopoverOverlay_h0IVJ"},m=Object(p.b)((function(){return Promise.all([r.e(0),r.e(1),r.e(2),r.e(3),r.e(1303)]).then(r.bind(null,5647))}),{suspense:!0}),y=function(e){var t=e.trigger;return a.a.createElement(n.a,{type:"menu",className:h.navigation,getPopupContainer:function(e){return e.parentNode},trigger:t,overlayClassName:h.navigationPopoverOverlay,placement:"bottomLeft",content:a.a.createElement(m,{isNavigation:!0}),arrowPointAtCenter:!0,mouseLeaveDelay:.3},a.a.createElement("a",{className:s()(h.trigger),"data-testid":"dropdown-navigation","data-aspm-click":"nav_navigation.d1"},a.a.createElement(f.b,{name:"nav-menu",className:h.triggerIcon,width:12})))};y.defaultProps={trigger:"hover"},y.propTypes={trigger:c.a.string};t.a=Object(u.d)((function(e){return e}))(Object(d.b)(y))},3912:function(e,t,r){"use strict";r(143);var n=r(67),o=(r(279),r(138)),a=(r(41),r(9)),i=r(0),c=r.n(i),u=r(2),l=r.n(u),s=r(3578),f=r(1407),d=r(3301),p=r(46),h=r(3356),m=r(709),y=r(320),v=r(3627),g=r(22),b=r(282),w=(r(73),r(31)),_=(r(60),r(14)),E=(r(37),r(10)),O=(r(186),r(45)),S=r(480),k=r(1514),x=r(50),j="DocSummaryInfo-module_modal_WEf3n",A="DocSummaryInfo-module_btnSubmit_-ZmDs";function L(e){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L(e)}function T(){T=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new P(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(N([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==L(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(L(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=N,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:N(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function C(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function P(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){C(a,n,o,i,c,"next",e)}function c(e){C(a,n,o,i,c,"throw",e)}i(void 0)}))}}function N(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,G(n.key),n)}}function R(e,t){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},R(e,t)}function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=M(e);if(t){var o=M(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===L(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return D(e)}(this,r)}}function D(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M(e){return M=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},M(e)}function F(e,t,r){return(t=G(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function G(e){var t=function(e,t){if("object"!==L(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==L(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===L(t)?t:String(t)}var U=O.a.create,B=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&R(e,t)}(i,e);var t,r,n,o=I(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),F(D(t=o.call(this,e)),"updateDocInfo",P(T().mark((function e(){var r,n,o,a;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.props,n=r.doc,o=r.dispatch,e.next=3,x.a.docs.updateMeta({id:n.id,custom_cover:t.state.cover,custom_description:t.state.description});case 3:return a=e.sent,e.abrupt("return",o({type:"doc/update",payload:{custom_cover:a.custom_cover,custom_description:a.custom_description}}));case 5:case"end":return e.stop()}}),e)})))),F(D(t),"onSubmit",(function(e){e.preventDefault(),t.coverUploader&&(t.setState({submitting:!0}),t.coverUploader.current.onSubmit().then((function(e){t.setState({cover:e||""},(function(){t.updateDocInfo().then((function(){t.setState({submitting:!1}),t.props.onOk()}))}))})).catch((function(e){E.a.error(e.message),t.setState({submitting:!1})})))})),F(D(t),"handleChangeSummary",(function(e){t.setState({description:e.target.value})})),t.state={submitting:!1,error:"",cover:e.doc.cover||"",description:e.doc.custom_description||""},t.coverUploader=c.a.createRef(),t}return t=i,(r=[{key:"componentDidMount",value:function(){var e=this;"function"==typeof this.props.getSummary&&this.props.getSummary((function(t){var r=t.summary,n=t.cover;e.props.doc.custom_description||e.setState({description:r}),e.props.doc.cover||e.setState({cover:n})}))}},{key:"componentWillUnmount",value:function(){this.coverUploader=null}},{key:"render",value:function(){var e=this.props,t=e.visible,r=e.children,n=e.doc;return c.a.createElement(w.a,{className:j,visible:t,title:__("发布"),footer:null,onCancel:this.props.onCancel,maskClosable:!1,width:608},c.a.createElement(O.a,null,this.state.error&&c.a.createElement("div",{className:"has-error"},c.a.createElement("p",{className:"ant-legacy-form-explain"},__("出错了"))),c.a.createElement(O.a.Item,{label:__("封面"),colon:!1},c.a.createElement(k.a,{attachable_type:"Doc",attachable_id:n.id,cover:this.state.cover,ref:this.coverUploader})),c.a.createElement(O.a.Item,{colon:!1,label:c.a.createElement("span",null,__("摘要"),c.a.createElement("span",{className:"tip"},__("（150字内）")))},c.a.createElement(_.a.TextArea,{autoSize:{minRows:3},maxLength:"150",value:this.state.description,onChange:this.handleChangeSummary})),c.a.createElement(O.a.Item,null,c.a.createElement(a.a,{type:"primary",className:A,disabled:this.state.submitting,onClick:this.onSubmit},__("发布")),r)))}}])&&N(t.prototype,r),n&&N(t,n),Object.defineProperty(t,"prototype",{writable:!1}),i}(i.PureComponent);B.propTypes={visible:l.a.bool.isRequired,doc:l.a.object.isRequired,getSummary:l.a.func.isRequired,onCancel:l.a.func.isRequired,onOk:l.a.func.isRequired,dispatch:l.a.func.isRequired,children:l.a.node};var q=Object(S.d)((function(e){return e}))(U()(B));function V(e){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},V(e)}function z(){z=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==V(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(V(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function H(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function W(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){H(a,n,o,i,c,"next",e)}function c(e){H(a,n,o,i,c,"throw",e)}i(void 0)}))}}function Y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,$(n.key),n)}}function K(e,t){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},K(e,t)}function Q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=J(e);if(t){var o=J(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===V(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Z(e)}(this,r)}}function Z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function J(e){return J=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},J(e)}function X(e,t,r){return(t=$(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $(e){var t=function(e,t){if("object"!==V(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==V(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===V(t)?t:String(t)}var ee=h.e.publish.key.join(),te=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&K(e,t)}(l,e);var t,r,i,u=Q(l);function l(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return X(Z(e=u.call.apply(u,[this].concat(r))),"state",{modalVisible:!1}),X(Z(e),"ref",c.a.createRef()),X(Z(e),"bindHotkeys",(function(){Object(s.a)(ee,e.readyToPublish)})),X(Z(e),"readyToPublish",function(){var t=W(z().mark((function t(r){var n,o,a,i;return z().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=e.props,a=o.doc,i=o.book,null===(n=e.ref.current)||void 0===n||n.focus(),!i||!i.enable_auto_publish){t.next=6;break}return t.next=5,e.onPublish(r);case 5:case 9:case 13:case 17:return t.abrupt("return");case 6:if(e.props.editMode||!a.published_at){t.next=10;break}return t.next=9,e.onPublish(r);case 10:if(!e.props.editMode||!a.published_at||a.is_fake_published_at){t.next=14;break}return t.next=13,e.onPublish(r);case 14:if(!window.appData.isDocCollaborator){t.next=18;break}return t.next=17,e.onPublish(r);case 18:if(!e.shouldInitDocInfo()){t.next=21;break}return e.setState({modalVisible:!0}),t.abrupt("return");case 21:return t.next=23,e.onPublish(r);case 23:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),X(Z(e),"onPublish",function(){var t=W(z().mark((function t(r){var n,o,a,i,c,u,l;return z().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.props,o=n.book,a=n.doc,i=n.history,t.next=3,e.props.onsubmit();case 3:if(!e.props.editMode){t.next=12;break}if(g.g||(null===(c=window)||void 0===c||c.__setEditMode(!1),Object(b.a)("start","publish")),!g.g){t.next=8;break}return null!=r&&r.enterReadMode&&(Object(v.b)("save",a.slug,!0),null===(u=window)||void 0===u||u.__setEditMode(!1),Object(b.a)("start","enterReadmode")),t.abrupt("return");case 8:l="/".concat(o.namespace,"/").concat(a.slug),"lakesheet"===a.format&&(l="/".concat(o.namespace,"/").concat(a.slug).concat(window.location.hash)),window.sessionStorage.setItem("readerEditModeChange",1),i.replace(l);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),X(Z(e),"onCancelModal",(function(){e.setState({modalVisible:!1})})),X(Z(e),"getVisibilityTip",(function(){var t=e.props,r=t.group,n=t.book,o=t.doc,a=__("公开知识库发布后，所有人可见；私密知识库发布后，团队成员及协作者可见。"),i=m.a.getTypeText(o.type),c=o.published_at?__("更新#action_tip"):__("发布#action_tip");return"User"===r.type?0===o.public?a=__("该{type}是私密状态，{action}后仅自己、协作者可见。",{type:i,action:c}):1===n.public?a=__("该{type}属于公开知识库，{action}后所有人可见。",{type:i,action:c}):0===n.public&&(a=__("该{type}属于私密知识库，{action}后仅自己、协作者可见。",{type:i,action:c})):0===o.public?a=__("该{type}是私密状态，{action}后仅团队成员、协作者可见。",{type:i,action:c}):1===n.public?a=__("该{type}属于公开知识库，{action}后所有人可见。",{type:i,action:c}):0===n.public&&(a=__("该{type}属于私密知识库，{action}后团队成员及协作者可见。",{type:i,action:c})),a})),X(Z(e),"shouldInitDocInfo",(function(){var t=e.props,r=t.book,n=t.doc;return!(!r||"Column"!==r.layout||"Doc"!==n.type||n.published_at)})),X(Z(e),"renderPublishButton",(function(){var t=e.props,r=t.docStatus,n=t.publishing,o=t.disabled;return c.a.createElement(a.a,{"data-testid":"doc-publish-button",id:"lake-doc-publish-button",type:g.g&&r===d.DOC_STATUS.published?"default":"primary",onClick:e.readyToPublish,onTouchEnd:e.readyToPublish,disabled:o,ref:e.ref},n&&c.a.createElement("span",{className:"larkicon"},c.a.createElement(f.default,null)),c.a.createElement("span",{className:"text"},g.g&&r===d.DOC_STATUS.published?__("已发布"):e.getActionText()))})),X(Z(e),"renderAutoPublishButton",(function(){var t=e.props,r=t.publishing,i=t.disabled,u=t.saving,l=u?__("正在更新中"):__("已开启自动发布，内容将自动更新至阅读页面，亦可手动点击更新"),s=c.a.createElement(p.b,{className:"publish-loading-icon",name:"publish-loading-icon",width:16,height:16});return c.a.createElement(n.a,{title:l,placement:"bottom",arrowPointAtCenter:!0,overlayStyle:u?void 0:{width:148}},c.a.createElement(a.a,{"data-testid":"doc-exit-edit-button",id:"lake-doc-publish-button",onClick:e.readyToPublish,onTouchEnd:e.readyToPublish,disabled:i,ref:e.ref},u||r?c.a.createElement(o.a,{indicator:s}):c.a.createElement("span",{className:"text"},__("更新"))))})),e}return t=l,(r=[{key:"componentDidMount",value:function(){this.bindHotkeys()}},{key:"componentDidUpdate",value:function(e){this.props.errorStatus&&this.props.errorStatus!==e.errorStatus&&this.onCancelModal()}},{key:"componentWillUnmount",value:function(){s.a.unbind(ee)}},{key:"getTipTitle",value:function(){var e=this.props.doc,t="";return t="Sheet"===e.type?e.published_at?__("更新这个表格"):__("发布这个表格"):e.published_at?__("更新这篇文档"):__("发布这篇文档"),"".concat(t," (").concat(h.e.publish.title,")")}},{key:"getActionText",value:function(){return this.props.doc.published_at?__("更新"):__("发布")}},{key:"render",value:function(){return window.__readyToPublish=this.readyToPublish,this.props.book&&this.props.book.enable_auto_publish?this.renderAutoPublishButton():this.shouldInitDocInfo()?c.a.createElement("span",null,this.renderPublishButton(),this.state.modalVisible&&c.a.createElement(q,{"data-testid":"doc-summary-info",visible:this.state.modalVisible,onCancel:this.onCancelModal,onOk:this.onPublish,getSummary:this.props.getSummary})):this.renderPublishButton()}}])&&Y(t.prototype,r),i&&Y(t,i),Object.defineProperty(t,"prototype",{writable:!1}),l}(i.PureComponent);te.propTypes={group:l.a.object.isRequired,book:l.a.object.isRequired,me:l.a.object.isRequired,doc:l.a.object.isRequired,loading:l.a.bool.isRequired,disabled:l.a.bool,publishing:l.a.bool.isRequired,saving:l.a.bool,onsubmit:l.a.func.isRequired,getSummary:l.a.func,history:l.a.object,docStatus:l.a.string};t.a=Object(y.b)(te)},3917:function(e,t,r){"use strict";r.r(t),r.d(t,"OtherMenuContext",(function(){return ht}));r(3185);var n=r(3617),o=(r(3180),r(3482)),a=(r(143),r(67)),i=(r(37),r(10)),c=r(0),u=r.n(c),l=r(64),s=r.n(l),f=r(480),d=r(35),p=r(2),h=r.n(p),m=r(61),y=r(261),v=r.n(y),g=r(12),b=r.n(g),w=r(300),_=r.n(w),E=r(1209),O=r.n(E),S=r(5),k=r.n(S),x=r(46),j=r(280),A=r(1513),L=r(116),T=r(3760),C=(r(60),r(14)),P=r(426),N=r.n(P),R=r(1730),I=r(1871),D=r(1729),M=r(1877),F={list:"index-module_list_c9F2W",content:"index-module_content_fgebc",title:"index-module_title_EjsRx",link:"index-module_link_AN9DG",group:"index-module_group_uqS8H",groupName:"index-module_groupName_Ig7hY",titleItem:"index-module_titleItem_nAGB6",groupText:"index-module_groupText_gP4vU",item:"index-module_item_eJhnq",itemKey:"index-module_itemKey_9S182",itemMarkdown:"index-module_itemMarkdown_MfJ0X",hotkeyName:"index-module_hotkeyName_9l1WM",bold:"index-module_bold_YYrtr",italic:"index-module_italic_QVtB8",strikethrough:"index-module_strikethrough_pe3vq",underline:"index-module_underline_ZOyDi",h1:"index-module_h1_qJ2JJ",h2:"index-module_h2_pdhHd",h3:"index-module_h3_Of72+",h4:"index-module_h4_itEIw",blockquotes:"index-module_blockquotes_2eZhV",icon:"index-module_icon_Zvmgx",cmd:"index-module_cmd_zlq9e",cardInfo:"index-module_cardInfo_PehAT",noneOpacity:"index-module_noneOpacity_wj9mj",cardInfoTip:"index-module_cardInfoTip_N8XcC"};function G(e){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(e)}function U(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function B(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?U(Object(r),!0).forEach((function(t){q(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function q(e,t,r){return t=function(e){var t=function(e,t){if("object"!==G(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==G(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===G(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function V(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return z(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return z(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var H=C.a.Search,W={cmd:v.a.mac?"Cmd":"Ctrl",Command:v.a.mac?"Cmd":"Ctrl",Option:v.a.mac?"Opt":"Alt",opt:v.a.mac?"Opt":"Alt",shift:"Shift",left:u.a.createElement(R.default,{style:{transform:"rotate(180deg)"}}),right:u.a.createElement(R.default,null),up:u.a.createElement(I.default,null),down:u.a.createElement(D.default,null),"@":u.a.createElement(M.default,{className:F.cmd,width:14}),190:".",188:",",49:"1"};x.b.propTypes={icon:h.a.string};var Y=function(e){return u.a.createElement("div",{className:F.hotkeyName},e.text)},K={text:h.a.string.isRequired,name:h.a.string};function Q(e){return e&&e.length?e.map((function(e,t){return"+"===e?u.a.createElement("span",{key:t},"+"):u.a.createElement("kbd",{key:t},W[e]||e)})):null}function Z(e){var t=e.config,r=e.className,n=e.showHelpLink,o=e.enableMarkdown,a=V(Object(c.useState)(""),2),i=a[0],l=a[1],s=N()(t);if(i){var f=i.toLowerCase().trim();s=s.map((function(e){var t;return e.children=null===(t=e.children)||void 0===t?void 0:t.filter((function(e){var t,r,n;return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().contains(f))||(null===(r=e.text)||void 0===r?void 0:r.toLowerCase().contains(f))||(null===(n=e.keywords)||void 0===n?void 0:n.find((function(e){return e.toLowerCase().contains(f)})))})),e})).filter((function(e){return 0!==e.children.length}))}return u.a.createElement("div",{className:"".concat(F.list," ").concat(r)},u.a.createElement("div",{className:"".concat(F.content," hotkey-content"),"data-testid":"hotkey"},u.a.createElement("div",{className:"".concat(F.title," hotkey-title")},__("快捷键"),n&&u.a.createElement("a",{className:F.link,href:"https://www.yuque.com/yuque/gpvawt/shortcut",target:"_blank"},__("查看更多"))),u.a.createElement("div",{className:F.search},u.a.createElement(H,{value:i,onChange:function(e){l(e.target.value)},placeholder:__("输入功能关键字搜索")})),s.map((function(e,t){return u.a.createElement("div",{className:"".concat(F.group," hotkey-group"),key:e.text||t},e.text&&u.a.createElement("div",{className:F.groupName},u.a.createElement("span",{className:F.groupText},e.text),o&&u.a.createElement("span",{className:F.titleItem},__("快捷键")),o&&u.a.createElement("span",{className:F.titleItem},__("Markdown"))),e.children.map((function(e,t){return u.a.createElement("div",{className:"".concat(F.item," hotkey-item"),key:e.name||t},u.a.createElement("div",{className:F.cardInfo},e.icon&&u.a.createElement(x.b,{className:"".concat(e.noneOpacity?" ".concat(F.noneOpacity):""),name:e.icon,width:16}),u.a.createElement(Y,e)),u.a.createElement("div",{className:F.itemKey,"data-testid":e.name},Q(e.keys)),o&&u.a.createElement("div",{className:F.itemMarkdown,"data-testid":e.markdown},Q(e.markdown)))})))}))))}Y.propTypes=K,Z.KEYS=W,Z.defaultProps={showHelpLink:!1},Z.propTypes={className:h.a.string,showHelpLink:h.a.bool,enableMarkdown:h.a.bool,config:h.a.arrayOf(h.a.shape({text:h.a.string,children:h.a.arrayOf(h.a.shape(B(B({},K),{},{keys:h.a.array,icon:h.a.string})))}))};var J=Z,X=r(3733),$=(r(3726),r(3730),r(3607),r(3729),X.b),ee=r(3602),te=r(320),re=r(3593),ne=r(3905),oe=r(174),ae=r(3570),ie=r(50),ce=r(22),ue=r(267),le=r(3850),se=r(1344),fe=(r(73),r(31)),de=(r(41),r(9)),pe=(r(3204),r(3690)),he=(r(139),r(44)),me=(r(151),r(29)),ye=r(659),ve=r(377),ge=r(1004),be={ownerHelpModal:"OwnerHelp-module_ownerHelpModal_m25Mz",stepWrapper:"OwnerHelp-module_stepWrapper_dqbv7",firstStepContentWrapper:"OwnerHelp-module_firstStepContentWrapper_q54Bi",title:"OwnerHelp-module_title_zgbAm",titleInDark:"OwnerHelp-module_titleInDark_mzTQV",firstStepContent:"OwnerHelp-module_firstStepContent_xgUc8",firstStepContentLeft:"OwnerHelp-module_firstStepContentLeft_K3QdR",firstIconWrapper:"OwnerHelp-module_firstIconWrapper_1FB9n",contentWrapper:"OwnerHelp-module_contentWrapper_7xaAR",contentTitle:"OwnerHelp-module_contentTitle_rkfHB",contentIcon:"OwnerHelp-module_contentIcon_ZSmIu",content:"OwnerHelp-module_content_Apbyk",scendStepContent:"OwnerHelp-module_scendStepContent_I9djQ",thirdStepContent:"OwnerHelp-module_thirdStepContent_r-Wln",titleImg:"OwnerHelp-module_titleImg_Aqsy2",fourthStepContent:"OwnerHelp-module_fourthStepContent_XEewF",bgImg:"OwnerHelp-module_bgImg_YdosR",desc:"OwnerHelp-module_desc_yYk2g",commonContentWrapper:"OwnerHelp-module_commonContentWrapper_D2wQx",link:"OwnerHelp-module_link_-ZleH",linkIcon:"OwnerHelp-module_linkIcon_ehsgD",stepsAction:"OwnerHelp-module_stepsAction_36ZbX",defaultIcon:"OwnerHelp-module_defaultIcon_u6t7T",defaultIconActive:"OwnerHelp-module_defaultIconActive_r9Z4H",finishIcon:"OwnerHelp-module_finishIcon_6OqJ5"};function we(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _e(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _e(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Ee=[{icon:"icon-introductionspace",color:"@blue-3",title:__("空间"),content:__("知识协同的最大容器，一个空间就相当于一个企业或一个组织。")},{icon:"icon-introductionpublicarea",color:"@cyan-3",title:__("公共区"),content:__("空间的门户，面向全体成员开放，存放可供全员查看和学习的内容。")},{icon:"icon-introductionteam",color:"@orange-3",title:__("团队"),content:__("团队可以圈定特定的成员，用于完成不同的项目或事项的协作。")},{icon:"icon-introductionbook",color:"@purple-3",title:__("知识库"),content:__("知识管理的最小单元，像书一样，可将多篇文档结构化地呈现和管理。")}],Oe=[{url:"https://www.yuque.com/yuque/rvzzxz/yz2ag6bc30rbpalu#s1zef",imgUrl:"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*hrTzSbccZRUAAAAAAAAAAAAADvuFAQ/original",darkImgUrl:"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*6pvISK4szqsAAAAAAAAAAAAADvuFAQ/original",title:__("企业知识库"),content:__("企业知识结构化管理，搭建企业 wiki，用知识为员工赋能。")},{url:"https://www.yuque.com/yuque/rvzzxz/yz2ag6bc30rbpalu#cX5Sr",imgUrl:"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*TSXfRYYt7zMAAAAAAAAAAAAADvuFAQ/original",darkImgUrl:"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*ERxLT5CaGDQAAAAAAAAAAAAADvuFAQ/original",title:__("产研协作"),content:__("清晰的项目文档和便捷的任务管理，让项目协作更加有序和高效。")},{url:"https://www.yuque.com/yuque/rvzzxz/yz2ag6bc30rbpalu#TNAEu",imgUrl:"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*TF6hSpK8XZIAAAAAAAAAAAAADvuFAQ/original",darkImgUrl:"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*PLyPSKNwCosAAAAAAAAAAAAADvuFAQ/original",title:__("部门协作"),content:__("周报月报集中呈现，团队动态一目了然，工作进度高效对焦。")},{url:"https://www.yuque.com/yuque/rvzzxz/yz2ag6bc30rbpalu#xNRgj",imgUrl:"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*XdO8SpGwFKkAAAAAAAAAAAAADvuFAQ/original",darkImgUrl:"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*KCypTZ-08UMAAAAAAAAAAAAADvuFAQ/original",title:__("新人培训"),content:__("新人知识系统性学习，统一培训不再依赖口口相传，快速上手不慌张。")}],Se=[{title:__("邀请需要协作的伙伴加入空间，可在空间通讯录中进行管理"),imgUrl:"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*FyzNTJouH8YAAAAAAAAAAAAADvuFAQ/original",darkImgUrl:"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*Oke9SYNCuVsAAAAAAAAAAAAADvuFAQ/original",link:"/r/organizations/dashboard/contacts#inviteUserToken",linkText:__("立即邀请")},{title:__("在空间内，可以选定特定成员创建多个团队进行协作。"),imgUrl:"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*kazIRIYWSt0AAAAAAAAAAAAADvuFAQ/original",darkImgUrl:"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*73M2SLi3wVIAAAAAAAAAAAAADvuFAQ/original",link:"https://www.yuque.com/yuque/rvzzxz/bteh5g",linkText:__("了解权限设置")}],ke=[{title:__("对空间内的信息、成员、安全等进行设置和管理"),imgUrl:"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*4EuMQ7o2CHcAAAAAAAAAAAAADvuFAQ/original",darkImgUrl:"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*CYWqS6vbIdgAAAAAAAAAAAAADvuFAQ/original",link:"/r/organizations/dashboard",linkText:__("前往空间管理")},{title:__("开展日常工作、创作和团队协作"),imgUrl:"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*iZIORIEQgacAAAAAAAAAAAAADvuFAQ/original",darkImgUrl:"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*L0KsS6nNxr0AAAAAAAAAAAAADvuFAQ/original",link:"/dashboard",linkText:__("前往工作台")}],xe=function(e){var t,r=e.visible,n=e.onCancel,o=e.readOwnerHelpTip,a=e.setTransitionMenuVisible,i=we(Object(c.useState)(oe.a.get(T.OWNER_HELP_GUIDE_CURRENT)||0),2),u=i[0],l=i[1],s=Object(ge.a)(u),f=we(Object(c.useState)(Number(oe.a.get(T.OWNER_HELP_GUIDE_CURRENT))||0),2),p=f[0],h=f[1],m=Object(ge.a)(p),y=Object(d.useHistory)(),v=Object(ge.a)(r),g=Object(ve.a)().isDarkMode,b=[{defaultIcon:React.createElement("div",{className:be.defaultIcon},"1"),defaultIconActive:React.createElement("div",{className:be.defaultIconActive},"1"),finishIcon:React.createElement("div",{className:be.finishIcon},React.createElement(x.b,{name:"icon-introductioncheck",size:16})),title:__("了解语雀空间"),content:React.createElement("div",{className:be.firstStepContentWrapper},React.createElement("p",{className:g?be.titleInDark:be.title},__("了解核心概念")),React.createElement("div",{className:be.firstStepContent},React.createElement("div",{className:be.firstStepContentLeft},Ee.map((function(e){return React.createElement("div",{className:be.contentWrapper},React.createElement("p",{className:be.contentTitle},React.createElement("div",{className:be.firstIconWrapper,style:{background:ye.themeToken[e.color]}},React.createElement(x.b,{className:be.contentIcon,name:e.icon,size:16})),e.title),React.createElement("p",{className:be.content},e.content))}))),React.createElement("div",null,React.createElement("img",{src:g?"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*c5mcTJA5jaIAAAAAAAAAAAAADvuFAQ/original":"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*6Tx1TY5fXIMAAAAAAAAAAAAADvuFAQ/original",width:380}))))},{defaultIcon:React.createElement("div",{className:be.defaultIcon},"2"),defaultIconActive:React.createElement("div",{className:be.defaultIconActive},"2"),finishIcon:React.createElement("div",{className:be.finishIcon},React.createElement(x.b,{name:"icon-introductioncheck",size:16})),title:__("空间使用案例"),content:React.createElement("div",{className:be.scendStepContent},React.createElement("p",{className:g?be.titleInDark:be.title},__("不同的团队和场景如何使用语雀空间")),React.createElement(he.a,{gutter:16},Oe.map((function(e){return React.createElement(me.a,{span:12},React.createElement("a",{href:e.url,target:"_blank",className:be.contentWrapper},React.createElement("div",null,React.createElement("img",{src:g?e.darkImgUrl:e.imgUrl,width:120,height:120})),React.createElement("div",null,React.createElement("p",{className:be.contentTitle},e.title),React.createElement("p",{className:be.content},e.content))))}))))},{defaultIcon:React.createElement("div",{className:be.defaultIcon},"3"),defaultIconActive:React.createElement("div",{className:be.defaultIconActive},"3"),finishIcon:React.createElement("div",{className:be.finishIcon},React.createElement(x.b,{name:"icon-introductioncheck",size:16})),title:__("邀请成员协作"),content:React.createElement("div",{className:be.thirdStepContent},React.createElement("p",{className:be.title},__("邀请成员加入空间协作"),React.createElement("img",{className:be.titleImg,style:{height:"36px",width:"170px"},src:g?"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*_XNPSbCrbDUAAAAAAAAAAAAADvuFAQ/original":"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*GlFuR5Yt_ocAAAAAAAAAAAAADvuFAQ/original",width:170,height:36})),React.createElement(he.a,{gutter:16},Se.map((function(e){return React.createElement(me.a,{span:12},React.createElement("a",{className:be.commonContentWrapper,href:e.link,target:"_blank"},React.createElement("div",null,React.createElement("img",{src:g?e.darkImgUrl:e.imgUrl,width:372,height:156})),React.createElement("p",{className:be.contentTitle},e.title),React.createElement("p",{className:be.link},e.linkText,React.createElement(x.b,{className:be.linkIcon,name:"next-page",size:16}))))}))))},{defaultIcon:React.createElement("div",{className:be.defaultIcon},"4"),defaultIconActive:React.createElement("div",{className:be.defaultIconActive},"4"),finishIcon:React.createElement("div",{className:be.finishIcon},React.createElement(x.b,{name:"icon-introductioncheck",size:16})),title:__("开启协同之旅"),content:React.createElement("div",{className:be.fourthStepContent},React.createElement("p",{className:be.title},__("恭喜你完成了对空间的初步了解"),React.createElement("img",{className:be.titleImg,src:g?"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*fgCNTZx5aFUAAAAAAAAAAAAADvuFAQ/original":"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*84d-RYC0OugAAAAAAAAAAAAADvuFAQ/original",width:32})),React.createElement("p",{className:be.desc},__("和成员一起开启协同之旅吧～")),React.createElement("img",{src:g?"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*Sg9hTJHEdnQAAAAAAAAAAAAADvuFAQ/original":"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*FjKgTqYbxWsAAAAAAAAAAAAADvuFAQ/original",width:270,className:be.bgImg}),React.createElement(he.a,{gutter:16},ke.map((function(e){return React.createElement(me.a,{span:12},React.createElement("a",{className:be.commonContentWrapper,href:e.link,target:"_blank"},React.createElement("div",null,React.createElement("img",{src:g?e.darkImgUrl:e.imgUrl,width:372,height:156})),React.createElement("p",{className:be.contentTitle},e.title),React.createElement("p",{className:be.link},e.linkText,React.createElement(x.b,{className:be.linkIcon,name:"next-page",size:16}))))}))))}],w=function(){if(!(s.current>=b.length-1)){var e=Number(s.current)+1;l(e),e>m.current&&h(e)}},_=function(){s.current<=0||l(Number(s.current)-1)},E=function(e){v.current&&(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e.key)||[37,38,39,40].includes(e.keyCode))&&("ArrowLeft"!==e.key&&"ArrowUp"!==e.key&&37!==e.keyCode&&38!==e.keyCode||_(),"ArrowRight"!==e.key&&"ArrowDown"!==e.key&&39!==e.keyCode&&40!==e.keyCode||w())},O=function(){oe.a.set(T.OWNER_HELP_GUIDE_CURRENT,p),n()};return Object(c.useEffect)((function(){return r&&(y.push({pathname:y.location.pathname,search:"?firstGoToOrg=0"}),window.addEventListener("keyup",E),o(),a(!1)),function(){window.removeEventListener("keyup",E)}}),[r]),React.createElement(fe.a,{keyboard:!0,onCancel:O,width:920,footer:null,visible:r,destroyOnClose:!0,className:be.ownerHelpModal,closeIcon:React.createElement(x.b,{name:"close",size:16})},React.createElement(React.Fragment,null,React.createElement("div",{className:be.stepWrapper},React.createElement(pe.a,{current:u,size:"small"},b.map((function(e,t){return React.createElement(pe.a.Step,{key:e.title,title:e.title,icon:(oe.a.get(T.NEVER_SHOW_OWNER_HELP)?Number(m.current)>=Number(t):Number(m.current)>Number(t))?e.finishIcon:t===Number(s.current)?e.defaultIconActive:e.defaultIcon})})))),React.createElement("div",{className:"steps-content"},null===(t=b[u])||void 0===t?void 0:t.content),React.createElement("div",{className:be.stepsAction},React.createElement("div",{className:be.actionLeft},0===s.current&&React.createElement("a",{href:"https://www.yuque.com/yuque/rvzzxz/nrpo0b",target:"_blank"},__("查看详细上手步骤")),1===s.current&&React.createElement("a",{href:"https://www.yuque.com/yuque/rvzzxz/yz2ag6bc30rbpalu",target:"_blank"},__("查看详细介绍"))),React.createElement("div",null,Number(s.current)>0&&React.createElement(de.a,{type:"default",style:{margin:"0 12px"},onClick:function(){return _()}},__("上一步")),Number(s.current)<b.length-1&&React.createElement(de.a,{type:"default",onClick:function(){return w()}},__("下一步")),Number(s.current)===b.length-1&&React.createElement(de.a,{type:"primary",onClick:function(){var e;oe.a.set(T.NEVER_SHOW_OWNER_HELP,!0);var t=null===(e=window.appData.organization)||void 0===e?void 0:e.id;Object(L.spmClick)("c320771.d345650",{organization_id:t}),O()}},__("完成上手，不再显示"))))))},je=r(3860),Ae="index-module_wrapper_rXlLC",Le="index-module_enableAssistantWrapper_t8Z2V",Te="index-module_visibleWrapper_eqxge",Ce="index-module_pageWrapper_jWyja",Pe="index-module_page_EfLhi",Ne="index-module_visiblePage_snlOt",Re="index-module_hiddenPage_P9+co";function Ie(e){return Ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ie(e)}function De(e,t,r){return t=function(e){var t=function(e,t){if("object"!==Ie(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Ie(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Ie(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Me(e){return function(e){if(Array.isArray(e))return Ue(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Ge(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||Ge(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ge(e,t){if(e){if("string"==typeof e)return Ue(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ue(e,t):void 0}}function Ue(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Be=Object(ue.b)((function(){return r.e(1171).then(r.bind(null,5661))}),{suspense:!0}),qe=Object(ue.b)((function(){return r.e(1172).then(r.bind(null,5680))}),{suspense:!0}),Ve=Object(ue.b)((function(){return r.e(1275).then(r.bind(null,5681))}),{suspense:!0}),ze=Object(ue.b)((function(){return r.e(1214).then(r.bind(null,5682))}),{suspense:!0}),He=Object(ue.b)((function(){return r.e(1320).then(r.bind(null,5683))}),{suspense:!0});function We(e){var t,r=e.showInstruction,n=e.instructionOpen,o=e.handleGuideVisibleChange,a=e.setOpen,i=e.onCancelOwnerHelpModal,l=e.readOwnerHelpTip,s=e.visible,d=e.updateLogsDate,p=Fe(Object(c.useState)(je.a.home),2),h=p[0],m=p[1],y=Fe(Object(c.useState)([{page:je.a.home}]),2),v=y[0],g=y[1],b=Fe(Object(c.useState)(!1),2),w=b[0],_=b[1],E=Object(c.useRef)(null),O=Object(c.useRef)(s),S=Object(f.f)((function(e){return e.group})),x=Object(le.b)().isInvisible;s&&!O.current&&(O.current=!0);var j=Object(c.useMemo)((function(){var e=56+(x?48:78);return s?{maxHeight:"min(calc(100% - ".concat(e,"px), 668px)"),bottom:"".concat(e,"px")}:{bottom:"".concat(e,"px")}}),[s,x]),A={push:function(e){m(e.page),g([].concat(Me(v),[e]))},replace:function(e){m(e.page);var t=Me(v);t.splice(t.length-1,1,e),g(t)},goBack:function(){var e=Me(v);e.pop();var t=e[e.length-1];m((null==t?void 0:t.page)||je.a.home),g(e)}},L=function(){o(!1)},T=function(){o(!1),_(!0)},C=function(){o(!1),a(!0)};return Object(se.a)(E,(function(){return o(!1)})),Object(c.useEffect)((function(){n&&s&&o(!1)}),[n,s]),u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{ref:E},u.a.createElement("div",{style:j,className:k()(Ae,(t={},De(t,Te,s),De(t,Le,S.enableAssistant),t))},u.a.createElement("div",{className:Ce},v.map((function(e,t){var n,o=e.page===je.a.home,a=e.page===h;return u.a.createElement("div",{className:k()(Pe,(n={},De(n,Ne,a&&!o),De(n,Re,!a&&!o),n)),key:t},function(e){if(!O.current)return null;switch(e.page){case je.a.home:return u.a.createElement(Be,{assistantHistory:A,showInstruction:r,updateLogsDate:d,closeAssistant:L,showOwnerHelp:T,openIntroduce:C});case je.a.search:return u.a.createElement(qe,{assistantHistory:A,params:e.params});case je.a.readDoc:return u.a.createElement(Ve,{assistantHistory:A,params:e.params});case je.a.feedbackList:return u.a.createElement(ze,{assistantHistory:A,params:e.params});case je.a.webview:return u.a.createElement(He,{assistantHistory:A,params:e.params});default:return null}}(e))})))),e.children),w&&u.a.createElement(xe,{setTransitionMenuVisible:o,visible:w,onCancel:function(){_(!1),i()},readOwnerHelpTip:l}))}var Ye=Object(c.memo)(Object(c.forwardRef)(We)),Ke={entry:"index-module_entry_2-+WM",groupEntry:"index-module_groupEntry_mInTP",guidelines:"index-module_guidelines_Wh9gN",dropdownTrigger:"index-module_dropdownTrigger_bAACL",iconWrapper:"index-module_iconWrapper_VADJO",botIcon:"index-module_botIcon_vUTks",dropdownTriggerHidden:"index-module_dropdownTriggerHidden_bWGTw",robotWrapper:"index-module_robotWrapper_yISQ+",dropdownTriggerVisible:"index-module_dropdownTriggerVisible_OJwhU",arrowDownWrapper:"index-module_arrowDownWrapper_QjN5Y",wrapper:"index-module_wrapper_NMasE",hotkeysPanel:"index-module_hotkeysPanel_2mTMq",ownerTipContent:"index-module_ownerTipContent_yf5zk",closeTipIcon:"index-module_closeTipIcon_CW71T",ownerHelpTooltip:"index-module_ownerHelpTooltip_X5HO3",guideTipParentContent:"index-module_guideTipParentContent_7+YzV",unfinishedTipContent:"index-module_unfinishedTipContent_2ZA83",move:"index-module_move_EI9li",tipContent:"index-module_tipContent_cqZnc",arrow:"index-module_arrow_87E2W",introduce:"index-module_introduce_r4-Jz",noviceTip:"index-module_noviceTip_rOKJF",noviceTipClose:"index-module_noviceTipClose_dnvRp"};function Qe(e){return Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qe(e)}function Ze(){Ze=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==Qe(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(Qe(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function Je(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function Xe(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Je(a,n,o,i,c,"next",e)}function c(e){Je(a,n,o,i,c,"throw",e)}i(void 0)}))}}function $e(e){return function(e){if(Array.isArray(e))return et(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return et(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return et(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function et(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function tt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function rt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tt(Object(r),!0).forEach((function(t){ut(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function nt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,lt(n.key),n)}}function ot(e,t){return ot=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ot(e,t)}function at(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=ct(e);if(t){var o=ct(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Qe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return it(e)}(this,r)}}function it(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ct(e){return ct=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ct(e)}function ut(e,t,r){return(t=lt(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function lt(e){var t=function(e,t){if("object"!==Qe(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Qe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Qe(t)?t:String(t)}b.a.extend(_.a);var st=new s.a("sys:sitetip"),ft={whiteSpace:"nowrap"},dt={siteTip:window.appData.activityTip||window.appData.siteTip||null,readTip:window.appData.readTip||null},pt=v.a.safari,ht=Object(c.createContext)({ref:Object(c.createRef)(),styles:Ke}),mt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ot(e,t)}(d,e);var t,r,c,l,s,f=at(d);function d(e){var t,r,n,o,a,c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),ut(it(c=f.call(this,e)),"showGuide",(function(){return"#guide"===window.location.hash||!c.props.guide.readTip[c.orgWikiTipId]&&c.isFresh&&c.state.isOrgWikiPagePathname})),ut(it(c),"_sidebarChangedListener",{onRightSidebarWidth:function(e){c.setState({rightSidebarWidth:e})}}),ut(it(c),"_superSidebarListener",{onVisibilityChanged:function(){c.props.dispatch({type:"view/update",payload:{hasSuperSidebar:re.a.isExpanded}})}}),ut(it(c),"showHotkeys",(function(e){191===e.keyCode&&(m.ua.macos?e.metaKey:e.ctrlKey)&&e.altKey&&c.showView("hotkeys"),27===e.keyCode&&c.hideView("hotkeys")})),ut(it(c),"initModalVisible",(function(){var e=c.hasUnreadTip();st("init, has read tip: ",e);var t=O.a.parse(window.location.search).toast,r="#open_site_tip"===window.location.hash;if(t)switch(t){case"group_migrate":i.a.success(__("团队已成功迁入空间"));break;case"group_upgrade":i.a.success(__("团队已升级为空间"))}c.setState((function(t){return{views:rt(rt({},t.views),{},{tip:e&&c.props.defaultOpen||r})}}))})),ut(it(c),"hasUnreadTip",(function(){var e=c.state,t=e.readTip,r=e.siteTip;if(!r)return!1;var n=window.appData,o=n.locale,a=n.me,i=n.organization;if("zh-cn"!==o)return!1;if("0"===O.a.parse(window.location.search).site_tip)return!1;if(a&&b()(a.created_at).isSameOrAfter(r.created_at))return!1;if(i&&b()(i.created_at).isSameOrAfter(r.created_at))return!1;if(!t)return!0;var u=t[r.type]||0,l=Array.isArray(u)?Math.max.apply(Math,$e(u)):u;return r.id>l})),ut(it(c),"markSiteTipAsRead",(function(){var e=c.props.dispatch,t=c.state.siteTip,r=t.type;"#open_site_tip"===window.location.hash&&(window.location.hash=""),c.hasUnreadTip()?e({type:"proxy.web/mine.readTip",payload:{data:{id:t.id,type:r}}}).then((function(){c.hideView("tip"),c.setState((function(e){var n=e.readTip||{};return n[r]=t.id,rt(rt({},e),{},{readTip:rt({},n)})}))})):c.hideView("tip")})),ut(it(c),"shouldShowOwnerHelpTip",(function(){var e;return(null===(e=c.props.me)||void 0===e?void 0:e.id)&&!c.props.guide.readTip[c.tipId]})),ut(it(c),"readOwnerHelpTip",(function(){c.shouldShowOwnerHelpTip()&&ae.a.readMiniFeatureGuide({tip_id:c.tipId},c.props.dispatch),c.setState({ownerHelpTipShow:!1})})),ut(it(c),"handleGuideVisibleChange",(function(e){var t=c.state.open;c.setState({ownerHelpTipShow:!1,dropdownVisible:e,isShowAssistantDot:!1,open:!e&&t});var r=b()(new Date).format("YYYY-MM-DD");oe.a.set(T.HAS_OPEN_ASSISTANT,r),c.shouldShowOwnerHelpTip()&&ae.a.readMiniFeatureGuide({tip_id:c.tipId},c.props.dispatch)})),ut(it(c),"handleVisibleChange",(function(e){e||(c.props.showInstruction&&!c.state.siteTip&&c.hideView("tip"),c.state.isOrgWikiPagePathname?c.props.guide.readTip[c.orgWikiTipId]||ae.a.readMiniFeatureGuide({tip_id:c.orgWikiTipId},c.props.dispatch):c.props.guide.readTip[c.groupTipId]||ae.a.readMiniFeatureGuide({tip_id:c.groupTipId},c.props.dispatch))})),ut(it(c),"handleServiceVisibleChange",(function(e){c.setState({serviceDropdownVisible:e})})),ut(it(c),"showModal",(function(){c.hasUnreadTip()||c.showView("tip")})),ut(it(c),"onModalCancel",(function(){c.transitionMenuRef.current&&c.transitionMenuRef.current.onRead(),c.setState({views:{tip:!1}})})),ut(it(c),"onCancelOwnerHelpModal",(function(){oe.a.get(T.OWNER_HELP_GUIDE_CURRENT)<=3&&!oe.a.get(T.NEVER_SHOW_OWNER_HELP)&&(c.setState({unfinishedGuideTip:!0}),setTimeout((function(){c.setState({unfinishedGuideTip:!1})}),1500))})),ut(it(c),"enableMarkdown",(function(e){return e.find((function(e){return e.children.find((function(e){return e.markdown}))}))})),ut(it(c),"adapterWidth",(function(e){var t=c.enableMarkdown(e);return pt?t?524:384:t?484:344})),c.rootRef=u.a.createRef(),c.pageName=c.getPageName(),c.transitionMenuRef=u.a.createRef(),c.tipKey="owner_help_introduce_tip",c.tipId="".concat(c.tipKey,"_").concat(null===(t=e.me)||void 0===t?void 0:t.id),c.groupTipKey="feature_group_introduce",c.groupTipId="".concat(c.groupTipKey,"_").concat(null===(r=e.me)||void 0===r?void 0:r.id),c.orgWikiTipKey="feature_org_wiki_introduce",c.orgWikiTipId="".concat(c.orgWikiTipKey,"_").concat(null===(n=e.organization)||void 0===n?void 0:n.id),c.feature=ae.a.findFeatureGuide({tip_id:c.orgWikiTipKey,type:"custom"}),c.userCreateAt=new Date(null===(o=e.me)||void 0===o?void 0:o.created_at).getTime(),c.isFresh=c.feature&&new Date(c.feature.createdAt).getTime()>=c.userCreateAt,st("init use",{pageName:c.pageName,tipData:dt}),c.state={rightSidebarWidth:ee.a.rightSidebarWidth,siteTip:dt.siteTip,readTip:dt.readTip,views:{hotkeys:!1,tip:!1},dropdownVisible:!1,formGuideActive:!1,serviceDropdownVisible:!1,ownerHelpTipShow:!1,unfinishedGuideTip:!1,updateLogsDate:null,open:c.props.defaultOpen,isShowAssistantDot:!1,isOrgWikiPagePathname:"/dashboard/org_wiki"===(null===(a=window.location)||void 0===a?void 0:a.pathname)},c}return t=d,r=[{key:"componentDidMount",value:function(){var e,t=this;this.initModalVisible(),this.initIsShowAssistantDot(),document.addEventListener("keydown",this.showHotkeys),ee.a.addChangedListener(this._sidebarChangedListener),re.a.addListener(this._superSidebarListener),null===(e=this.props.history)||void 0===e||e.listen((function(e){var r,n=t.props,o=n.organization,a=n.guide,i=n.me,c="/dashboard/org_wiki"===e.pathname,u=!1,l=16731936e5,s=b()(null==i?void 0:i.created_at).isAfter(b()(l));c&&!a.readTip[t.orgWikiTipId]?u=!0:(!c&&(a.readTip[t.groupTipId]||!s)||c&&a.readTip[t.orgWikiTipId]||!c&&s)&&(u=!1),t.setState({open:u,isOrgWikiPagePathname:c});var f=window.location.pathname.includes("r/organizations/dashboard")||"/dashboard"===window.location.pathname,d=(null==o||null===(r=o.abilities)||void 0===r?void 0:r.destroy)&&o.user_id!==i.id;b()(null==o?void 0:o.created_at).isAfter(b()(l))&&f&&d&&!a.readTip[t.tipId]?t.setState({ownerHelpTipShow:!0}):t.setState({ownerHelpTipShow:!1})})),re.a.isExpanded!==this.props.view.hasSuperSidebar&&this.props.dispatch({type:"view/update",payload:{hasSuperSidebar:re.a.isExpanded}})}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.showHotkeys),ee.a.removeChangedListener(this._sidebarChangedListener),re.a.removeListener(this._superSidebarListener)}},{key:"initIsShowAssistantDot",value:(s=Xe(Ze().mark((function e(){var t,r,n,o;return Ze().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getIsShowUpdateLogsDot();case 2:r=window.appData.questionRecommend||{},n=r.type,o=r.id,(null===(t=window.appData.readTip)||void 0===t?void 0:t[n])===o||this.setState({isShowAssistantDot:!0});case 5:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"getIsShowUpdateLogsDot",value:(l=Xe(Ze().mark((function e(){var t,r,n;return Ze().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.appData.isYuque){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,ie.a.mine.getUpdateLogsInfo();case 5:if(null!=(t=e.sent)&&t.content_updated_at_ms){e.next=8;break}return e.abrupt("return");case 8:r=b()(null==t?void 0:t.content_updated_at_ms),n=oe.a.get(T.HAS_OPEN_ASSISTANT)||null,b()(n).isBefore(r,"day")&&this.setState({isShowAssistantDot:!0}),this.setState({updateLogsDate:r});case 13:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"showView",value:function(e){this.setState((function(t){var r=rt({},t.views);return r[e]=!0,{views:r}}))}},{key:"hideView",value:function(e){this.setState((function(t){var r=rt({},t.views);return r[e]=!1,{views:r}}))}},{key:"getPageName",value:function(){var e=this.props.page;return e&&(e.ctx||{}).pageName||null}},{key:"render",value:function(){var e,t=this,r=window.appData,i=r.isAssistant,c=r.me,l=!(null==c||!c.id),s=this.state.siteTip,f=this.props,d=f.hotKeys,p=f.disableHelpMenus,h=f.hidable,y=f.isEditor,v=!p&&l&&!i&&!ce.c&&!window.h5,g=!re.a.isInvisible,b=u.a.createElement(u.a.Fragment,null,d&&u.a.createElement("div",{className:Ke.dropdownTrigger,onClick:function(){t.showView("hotkeys")}},u.a.createElement(a.a,{overlayInnerStyle:ft,title:u.a.createElement("span",{style:ft},__("快捷键")+(m.ua.macos?"⌥ ⌘ ?":"Alt Ctrl ?"))},u.a.createElement("span",{className:Ke.icon},u.a.createElement(x.b,{name:"editor-shortcut",size:20})))),u.a.createElement(ht.Consumer,null,(function(e){var t=e.ref;return u.a.createElement("div",{ref:t})})),v&&u.a.createElement(Ye,{ref:this.transitionMenuRef,visible:this.state.dropdownVisible,showInstruction:this.props.showInstruction,handleGuideVisibleChange:this.handleGuideVisibleChange,onCancelOwnerHelpModal:this.onCancelOwnerHelpModal,setOpen:function(e){return t.setState({open:e})},updateLogsDate:this.state.updateLogsDate,readOwnerHelpTip:this.readOwnerHelpTip,instructionOpen:this.state.open},u.a.createElement(a.a,{visible:this.state.ownerHelpTipShow,overlayClassName:Ke.ownerHelpTooltip,placement:"left",color:"#2F81F4",getPopupContainer:function(e){return e.parentNode},title:u.a.createElement("div",{className:Ke.ownerTipContent},__("点击查看管理员上手引导"),u.a.createElement(x.b,{name:"close",size:16,className:Ke.closeTipIcon,onClick:this.readOwnerHelpTip}))},u.a.createElement("div",{className:k()(Ke.dropdownTrigger,Ke.guideTipParentContent,(e={},ut(e,Ke.dropdownTriggerHidden,!this.state.dropdownVisible),ut(e,Ke.dropdownTriggerVisible,this.state.dropdownVisible),e)),onClick:function(){Object(L.spmClick)("c311734.d325933"),t.handleGuideVisibleChange(!t.state.dropdownVisible)}},u.a.createElement(o.a,{dot:this.state.isShowAssistantDot,offset:[17,-10]},u.a.createElement("span",{className:k()(Ke.iconWrapper,Ke.arrowDownWrapper)},u.a.createElement(x.b,{name:"arrow-down",className:Ke.arrowDownIcon,width:20,height:20,color:"#fff"})),u.a.createElement("span",{className:k()(Ke.iconWrapper,Ke.robotWrapper)},u.a.createElement(j.a,{src:"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*SSJmRaVNucQAAAAAAAAAAAAADvuFAQ/original",darkSrc:"https://mdn.alipayobjects.com/huamei_0prmtq/afts/img/A*WNxeT6rtmQkAAAAAAAAAAAAADvuFAQ/original",className:Ke.botIcon}))),this.state.unfinishedGuideTip&&u.a.createElement("div",{className:Ke.unfinishedTipContent},u.a.createElement("div",{className:Ke.tipContent},__("点击可再次打开引导"),u.a.createElement("div",{className:Ke.arrow})))))),s&&u.a.createElement(A.a,{visible:this.state.views.tip,tip:s,read:this.markSiteTipAsRead,onCancel:this.onModalCancel}),this.state.open&&v&&u.a.createElement("div",{className:Ke.introduce},u.a.createElement($,{handleVisibleChange:function(e){t.setState({open:e}),t.handleVisibleChange(e)}})),d&&u.a.createElement(n.a,{closable:!0,width:this.adapterWidth(d),className:Ke.hotkeysPanel,placement:"right",mask:!1,onClose:function(){t.hideView("hotkeys")},visible:this.state.views.hotkeys},u.a.createElement(J,{config:d,enableMarkdown:this.enableMarkdown(d)})));return h?u.a.createElement(ne.a,{className:k()(Ke.wrapper,Ke.entry,ut({"side-tip-container":y},Ke.groupEntry,g)),ref:this.rootRef,testId:"site-tip",id:"siteTipGuide"},b):u.a.createElement("div",{className:Ke.wrapper,ref:this.rootRef,"data-testid":"site-tip",id:"siteTipGuide"},u.a.createElement("div",{className:k()(Ke.entry,ut({},Ke.groupEntry,g)),style:{position:"fixed",right:this.state.rightSidebarWidth+24}},b))}}],r&&nt(t.prototype,r),c&&nt(t,c),Object.defineProperty(t,"prototype",{writable:!1}),d}(u.a.Component);mt.defaultProps={defaultOpen:!0,showInstruction:!1},mt.propTypes={page:h.a.object,hotKeys:h.a.array,disableHelpMenus:h.a.bool,dispatch:h.a.func,hidable:h.a.bool,defaultOpen:h.a.bool,showInstruction:h.a.bool,isEditor:h.a.bool};t.default=Object(te.b)(Object(f.d)((function(e){return{page:e.page,guide:e.guide,me:e.me,organization:e.organization,group:e.group,view:e.view}}))(Object(d.withRouter)(mt)),!1)},3924:function(e,t,r){"use strict";var n=r(0);t.a=function(e,t){Object(n.useEffect)((function(){var r=new URLSearchParams(e.search);r.get("mode")&&(window.appData.useMode=r.get("mode"),t.push(e.pathname))}),[])}},3944:function(e,t,r){"use strict";r(73);var n=r(31),o=(r(143),r(67)),a=r(0),i=r.n(a),c=r(57),u=r(2),l=r.n(u),s=r(480),f=r(64),d=r.n(f),p=r(3635),h=r(1437),m=r(3724),y=r(46),v=r(3693),g=r(362),b=r(3898),w=r(709),_=r(3692),E=r(120),O=r(790),S=r(3356),k=r(3854),x=r(50),j=r(22),A=r(518),L=r(3912),T=r(3771),C=r(3837),P=(r(279),r(138)),N=r(281),R=r(320);function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function D(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(o=n.key,a=void 0,a=function(e,t){if("object"!==I(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==I(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===I(a)?a:String(a)),n)}var o,a}function M(e,t){return M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},M(e,t)}function F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=G(e);if(t){var o=G(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===I(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function G(e){return G=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},G(e)}var U=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&M(e,t)}(a,e);var t,r,n,o=F(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=o.call(this,e)).state={loading:!0,contributors:[],user:null,last_editor:null,wordCount:null},t.shouldShowWordCount="Doc"===e.doc.type,t}return t=a,(r=[{key:"componentDidMount",value:function(){var e=this,t=this.props,r=t.doc,n=t.book;if(this.shouldShowWordCount){var o=this.props.getWordCount();this.setState({wordCount:o})}this.props.dispatch({type:"proxy.web/docs.findOne",payload:{data:{id:r.slug,book_id:n.id,mode:"raw"}}}).then((function(t){e.setState({loading:!1,user:t.user,last_editor:t.last_editor})})),this.props.dispatch({type:"proxy.web/docs.contributors",payload:{data:{id:r.slug,book_id:n.id}}}).then((function(t){e.setState({contributors:t})}))}},{key:"render",value:function(){var e=this.props.doc;if(this.state.loading)return i.a.createElement(P.a,{justify:"block",className:"doc-insight-spin"});var t=this.state,r=t.user,n=t.last_editor,o=t.contributors;return i.a.createElement("div",{className:"doc-insight"},i.a.createElement("div",{className:"head"},__("统计信息")),i.a.createElement("div",{className:"meta"},this.shouldShowWordCount&&i.a.createElement("div",{className:"word-count"},i.a.createElement("span",{className:"num"},this.state.wordCount),i.a.createElement("span",{className:"desc"},__("字"))),i.a.createElement("ul",null,i.a.createElement("li",null,i.a.createElement("a",{href:"/".concat(r.login),className:"user"},r.name),i.a.createElement("span",null,__("创建于#middle")," "),i.a.createElement(N.a,{className:"time",time:e.created_at})),i.a.createElement("li",null,i.a.createElement("a",{href:"/".concat(n.login),className:"user"},n.name),i.a.createElement("span",null,__("最后编辑于")," "),i.a.createElement(N.a,{className:"time",time:e.content_updated_at})))),i.a.createElement("div",{className:"contributors"},i.a.createElement("h4",{className:"title"},__("编辑者")),i.a.createElement("ul",null,o.map((function(e,t){return i.a.createElement("li",{className:"user",key:r.id},i.a.createElement("a",{href:"/".concat(e.login),target:"_blank"},i.a.createElement("span",null,e.name)),t!==o.length-1&&__("、"))})))))}}])&&D(t.prototype,r),n&&D(t,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(a.PureComponent);U.propTypes={doc:l.a.object.isRequired,getWordCount:l.a.func.isRequired};var B=Object(s.d)((function(e){return e}))(Object(R.b)(U,!0)),q=r(3851),V=(r(785),r(424)),z=r(499),H={avatar:"EditorHeaderCollabUsers-module_avatar_humc6",name:"EditorHeaderCollabUsers-module_name_RmtES",sign:"EditorHeaderCollabUsers-module_sign_f2lq4",signInner:"EditorHeaderCollabUsers-module_signInner_UJ3E3",more:"EditorHeaderCollabUsers-module_more_x6mXq",moreUsers:"EditorHeaderCollabUsers-module_moreUsers_2uEpx"};function W(e){var t=e.user;return i.a.createElement("span",{className:H.avatar},i.a.createElement(z.a,{src:t.avatar_url,name:t.name,size:24}),t.color&&i.a.createElement("span",{className:H.sign},i.a.createElement("div",{className:H.signInner,style:{background:t.color}})))}function Y(e){var t=e.users,r=e.me,n=[],a=[];return t.length<=9?n=t.slice(0,t.length):(n=t.slice(0,9),a=t.slice(9)),i.a.createElement(i.a.Fragment,null,n.map((function(e){return i.a.createElement(o.a,{title:e.name,key:e.id},i.a.createElement("span",null,i.a.createElement(W,{user:e})))})),a.length>0&&i.a.createElement(V.a,{placement:"bottom",content:i.a.createElement("ul",{className:H.moreUsers},a.map((function(e){return i.a.createElement("li",{key:e.id},i.a.createElement(W,{user:e}),i.a.createElement("a",{href:"/".concat(e.login),className:H.name,target:"_blank"},e.name))})))},i.a.createElement("a",{className:"".concat(H.avatar," ").concat(H.more)},"+",a.length)),i.a.createElement(o.a,{title:0===t.length?__("语雀已支持多人同时编辑文档，当前编辑者的头像将显示在此"):__("我"),overlayStyle:{minWidth:"24px",width:0===t.length?"192px":"unset"}},i.a.createElement("span",null,i.a.createElement(W,{user:r}))))}Y.propTypes={users:l.a.array.isRequired,me:l.a.object.isRequired};var K=Y,Q=r(3812);r(3758);function Z(e){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Z(e)}function J(){J=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==Z(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(Z(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function X(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function $(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){X(a,n,o,i,c,"next",e)}function c(e){X(a,n,o,i,c,"throw",e)}i(void 0)}))}}function ee(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function te(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(r),!0).forEach((function(t){ce(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ee(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function re(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ue(n.key),n)}}function ne(e,t){return ne=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ne(e,t)}function oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=ie(e);if(t){var o=ie(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"===Z(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ae(e)}(this,r)}}function ae(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ie(e){return ie=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ie(e)}function ce(e,t,r){return(t=ue(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ue(e){var t=function(e,t){if("object"!==Z(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Z(t)?t:String(t)}var le=d()("editor:doc:head"),se=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ne(e,t)}(l,e);var t,r,a,u=oe(l);function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),ce(ae(t=u.call(this,e)),"handleKeyDownEvent",(function(e){!e.ctrlKey&&!e.metaKey||74!==e.keyCode||j.f||(e.preventDefault(),t.setState({showSearchModal:!0}))})),ce(ae(t),"saveMeta",(function(e,r){var n=t.props,o=n.doc,a=n.book,i={id:o.id},c=!1,u=function(){"function"==typeof r&&r(),t.setState({showMetaEdit:!1})};Object.keys(e).forEach((function(t){("custom_cover"===t&&e.custom_cover!==o.cover||void 0!==e[t]&&e[t]!==o[t])&&(c=!0,i[t]=e[t])})),c?(le("save meta:",i),t.props.dispatch({type:"proxy.web/docs.updateMeta",payload:{data:i}}).then((function(e){t.props.dispatch({type:"doc/update",payload:i}),t.props.dispatch({type:"book/update",payload:{toc:a.toc.map((function(e){return e.url===o.url||e.doc_id===o.id?te(te({},e),{},{title:i.title}):e})),docs:a.toc.map((function(e){return e.id===o.id?te(te({},e),{},{title:i.title}):e}))}}),u(),i.slug&&(window.location.href="/".concat(a.namespace,"/").concat(i.slug,"/edit"))})).catch((function(e){r(e)}))):u()})),ce(ae(t),"showStatics",(function(){t.setState({showStatics:!0})})),ce(ae(t),"showMetaEdit",(function(){t.setState({showMetaEdit:!0})})),ce(ae(t),"saveTitle",(function(e){t.saveMeta({title:e})})),ce(ae(t),"exec",function(){var e=$(J().mark((function e(r){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:le("exec: ".concat(r)),e.t0=r,e.next=e.t0===E.a.DOC.statics.cmd?4:e.t0===E.a.DOC.edit_meta.cmd||e.t0===E.a.DOC.edit_table_meta.cmd?6:e.t0===E.a.DOC.history.cmd?8:e.t0===E.a.DOC.save_editing_as_version.cmd?10:e.t0===E.a.DOC.save_as_template.cmd?14:17;break;case 4:return t.showStatics(),e.abrupt("break",18);case 6:return t.showMetaEdit(),e.abrupt("break",18);case 8:return t.props.showHistory(),e.abrupt("break",18);case 10:return e.next=12,t.props.save(S.h.USER_SAVE_AS_VERSION);case 12:return t.setState({showSaveAsVersion:!0}),e.abrupt("break",18);case 14:return e.next=16,t.props.save(S.h.USER_SAVE_AS_TEMPLATE);case 16:case 17:return e.abrupt("break",18);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),ce(ae(t),"getDisabledActions",(function(){var e=[];return window.appData.isDocCollaborator&&e.push(E.a.DOC.delete),e})),t.state={showMetaEdit:!1,showStatics:!1,showSaveAsVersion:!1,showSearchModal:!1},t.docTitleRef=i.a.createRef(),t}return t=l,(r=[{key:"componentDidMount",value:function(){this.props.editMode||window.addEventListener("keydown",this.handleKeyDownEvent,!1)}},{key:"componentWillUnmount",value:function(){this.props.editMode||window.removeEventListener("keydown",this.handleKeyDownEvent)}},{key:"isPublishEnabled",value:function(){var e=this.props,t=e.editable,r=e.publishing,n=e.loading;return t&&!r&&!n}},{key:"renderDocSaveTip",value:function(){var e=this.props.editMode,t=i.a.createElement("div",{className:"lark-editor-header-status"},i.a.createElement("div",{className:"lark-editor-save-tip"},i.a.createElement(T.a,{netStatus:this.props.netStatus,docStatus:this.props.docStatus,savedAt:this.props.savedAt,showHistory:this.props.showHistory}),i.a.createElement(y.b,{name:"cloud",width:16})));if(e){var r=document.getElementById("docSaveTipContainer");return r?Object(c.createPortal)(t,r):null}return i.a.createElement("div",{className:"lark-editor-header-status"},i.a.createElement("div",{className:"lark-editor-save-tip"},i.a.createElement(T.a,{netStatus:this.props.netStatus,docStatus:this.props.docStatus,savedAt:this.props.savedAt,showHistory:this.props.showHistory}),i.a.createElement(y.b,{name:"cloud",width:16})))}},{key:"renderEditorHeaderCollabUsers",value:function(){var e=this.props,t=e.me,r=e.editMode;if(e.collabUsers){var n=i.a.createElement("div",{className:"lark-editor-collab-users",style:r?{marginLeft:16}:{}},i.a.createElement(K,{users:this.props.collabUsers,me:t}));if(r){var o=document.getElementById("collabUsersContainer");return o?Object(c.createPortal)(n,o):null}return n}return null}},{key:"renderPublishButton",value:function(){var e=this.props,t=e.doc,r=e.book,n=e.me,o=e.group,a=e.pageReady,u=e.saving,l=e.publishing,s=e.publish,f=e.getSummary,d=e.errorStatus,p=e.editMode,h=e.history,m=e.docStatus,y=i.a.createElement(L.a,{doc:t,book:r,group:o,me:n,loading:!a,saving:u,title:w.a.getFormalTitle(t),disabled:!this.isPublishEnabled(),publishing:l,onsubmit:s,getSummary:f,errorStatus:d,editMode:p,history:h,docStatus:m});if(p){var v=document.getElementById("publishButtonContainer");return v?Object(c.createPortal)(y,v):null}return y}},{key:"isHideNavMode",value:function(){return Object(A.a)()}},{key:"render",value:function(){var e,t,r=this,a=this.props,c=a.organization,u=a.group,l=a.book,s=a.doc,f=a.shortDocTitle,d=a.me,S=a.editMode;return window.__editMode_show_history=function(){return r.exec(E.a.DOC.history.cmd)},i.a.createElement("div",{className:"lark-editor-header",type:s.type,style:S?{display:"none"}:{}},i.a.createElement("div",{className:"lark-editor-header-content"},!this.isHideNavMode()&&i.a.createElement("div",{className:"lark-editor-header-back"},i.a.createElement(b.a,{book:l,doc:s,group:u})),i.a.createElement("div",{className:"lark-editor-header-info",style:this.isHideNavMode()?{marginLeft:76}:{}},i.a.createElement("div",{className:"lark-editor-header-title",ref:this.docTitleRef},i.a.createElement(Q.a,{title:s.title,saveTitle:this.saveTitle}),i.a.createElement(w.b,{group:u,book:l,doc:s,organization:c,getPopupContainer:function(){return r.docTitleRef.current}})),i.a.createElement("div",{className:"lark-editor-header-crumb-status"},!this.isHideNavMode()&&i.a.createElement(i.a.Fragment,null,!f&&i.a.createElement(_.a,{group:u,book:l,noGroup:!1,showBookIcon:!1,disableClickOnIcon:!0}),!f&&i.a.createElement("span",{className:"split"},"|")),this.renderDocSaveTip())),i.a.createElement("div",{className:"lark-editor-header-action"},this.renderEditorHeaderCollabUsers(),(null===(e=s.abilities)||void 0===e?void 0:e.create_collaborator)&&i.a.createElement("div",{className:"lark-editor-header-action-item",style:{marginRight:14,paddingTop:5,cursor:"pointer"}},i.a.createElement(m.ShareButton,{shareViewType:"DOC",key:"collaborator-doc-".concat(s.id),targetResource:s,organization:c,book:l,group:u,canCollaborator:null===(t=s.abilities)||void 0===t?void 0:t.create_collaborator,onlyCollaborator:!0,me:d},i.a.createElement(o.a,{title:__("协作"),placement:"bottom"},i.a.createElement("span",{"data-testid":"doc-action-collaborate","data-aspm-click":"d225876"},i.a.createElement(y.b,{name:"nav-invite",width:20}))))),"Show"===s.type&&i.a.createElement("div",{className:"lark-editor-play-show"},i.a.createElement(k.a,null)),i.a.createElement("div",{className:"lark-editor-header-action-item"},this.renderPublishButton()),i.a.createElement("div",{className:"lark-editor-header-more","data-testid":"lark-editor-header-more"},i.a.createElement(h.a,{"data-testid":"doc-reader-more-actions",direction:"circle",iconWidth:20,content:i.a.createElement(q.a,{commands:O.a.adjustCommands(O.a.additionalActionsInEditPage(s)),disabledCommands:this.getDisabledActions(),book:l,doc:s,onSelect:function(e){var t=e.key;r.exec(t)},onCommandsExecuted:function(e){e.cmd===E.a.DOC.delete.cmd&&r.props.onDeleted()},inEdit:!0})})))),this.state.showMetaEdit&&i.a.createElement(n.a,{width:514,visible:!0,centered:!0,title:__("设置"),footer:null,onCancel:function(){r.setState({showMetaEdit:!1})},bodyStyle:{maxHeight:"90vh",overflow:"auto",paddingTop:16}},i.a.createElement(C.a,{doc:s,group:u,book:l,save:this.saveMeta,getSummary:this.props.getSummary,key:"doc-meta-edit-from-title"})),this.state.showStatics&&i.a.createElement(n.a,{width:384,visible:!0,footer:null,onCancel:function(){r.setState({showStatics:!1})}},i.a.createElement(B,{getWordCount:this.props.getWordCount})),this.state.showSaveAsVersion&&i.a.createElement(p.a,{doc:s,docDomain:"Doc",type:l.enable_auto_publish?"published":"draft",onCancel:function(){r.setState({showSaveAsVersion:!1})},docVersionProxy:x.a.docVersions}),this.state.showSearchModal&&i.a.createElement(v.default,{onCancel:$(J().mark((function e(){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(g.a)(500);case 2:r.setState({showSearchModal:!1});case 3:case"end":return e.stop()}}),e)}))),sence:"modal",subSence:"docEdit",visible:this.state.showSearchModal,forceDisplay:!0,jumpToNewPage:!0}))}}])&&re(t.prototype,r),a&&re(t,a),Object.defineProperty(t,"prototype",{writable:!1}),l}(a.PureComponent);se.defaultProps={collabUsers:null},se.propTypes={dispatch:l.a.func.isRequired,organization:l.a.object,group:l.a.object.isRequired,book:l.a.object.isRequired,doc:l.a.object.isRequired,me:l.a.object.isRequired,collabUsers:l.a.array,editing:l.a.bool,editable:l.a.bool,pageReady:l.a.bool.isRequired,publishing:l.a.bool.isRequired,saving:l.a.bool,savedAt:l.a.object,shortDocTitle:l.a.bool,save:l.a.func.isRequired,publish:l.a.func.isRequired,showHistory:l.a.func.isRequired,getWordCount:l.a.func,getSummary:l.a.func,onDeleted:l.a.func,netStatus:l.a.string,docStatus:l.a.string,editMode:l.a.bool,history:l.a.object};t.a=Object(s.d)((function(e){return{organization:e.organization,group:e.group,book:e.book,doc:e.doc,me:e.me}}))(se)},3968:function(e,t,r){"use strict";var n=r(0),o=r.n(n),a=r(35),i=r(3463),c=r(3301),u=r(57),l=r.n(u),s=r(2),f=r.n(s),d=r(480),p=r(5),h=r.n(p),m=r(454),y=r.n(m),v=r(702),g=r.n(v),b=r(149),w=r.n(b),_=r(225),E=r.n(_),O=r(3781),S=r(228),k=r(116),x=r(1471),j=r(1223),A=r(270),L=r(3462),T=r(3944),C=r(50),P={wordCount:"index-module_wordCount_Wzj9E"};function N(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return R(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return R(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function I(e){var t=e.doc,r=e.workflow,o=N(n.useState(0),2),a=o[0],i=o[1];n.useEffect((function(){i(t.word_count||0)}),[]);var c=n.useCallback(y()((function(){var e=r.getWordCount();i(e)}),3e3,{leading:!0}),[t]);return n.useEffect((function(){return window.addEventListener("GetDocWordCount",c,!1),function(){window.removeEventListener("GetDocWordCount",c,!1),c.cancel()}}),[]),n.createElement("div",{className:P.wordCount},a," ",__("字"))}var D=r(3789),M=r(3816),F={creationGuide:"CommonEditPage-module_creationGuide_AaTbI",guideWrapper:"CommonEditPage-module_guideWrapper_+9pCK",adaptMode:"CommonEditPage-module_adaptMode_Tq+Y+",editMode:"CommonEditPage-module_editMode_pYkEm"};function G(e){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(e)}function U(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==G(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==G(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===G(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function B(){return B=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},B.apply(this,arguments)}function q(){q=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,i=Object.create(a.prototype),c=new T(n||[]);return o(i,"_invoke",{value:x(e,r,c)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};l(w,i,(function(){return this}));var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,i)&&(w=E);var O=b.prototype=v.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(o,a,i,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==G(s)&&n.call(s,"__await")?t.resolve(s.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,o){r(e,n,t,o)}))}return a=a?a.then(o,o):o()}})}function x(t,r,n){var o=d;return function(a,i){if(o===h)throw new Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var u=j(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var l=f(t,r,n);if("normal"===l.type){if(o=n.done?m:p,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=m,n.method="throw",n.arg=l.arg)}}}function j(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,j(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function C(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(G(t)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new k(s(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),l(O,u,"Generator"),l(O,i,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=C,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function o(n,o){return c.type="throw",c.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;L(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function V(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return z(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return z(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function H(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function W(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){H(a,n,o,i,c,"next",e)}function c(e){H(a,n,o,i,c,"throw",e)}i(void 0)}))}}var Y=Object(n.lazy)((function(){return Promise.all([r.e(0),r.e(33),r.e(34),r.e(1206)]).then(r.bind(null,4905))})),K=Object(n.lazy)((function(){return Promise.all([r.e(0),r.e(33),r.e(1200)]).then(r.bind(null,4486))})),Q=window.self!==window.top;function Z(e){return A.TYPE_FORMAT_MAP[e.type]===A.FORMAT.LAKETABLE&&!window.appData.isDesktopApp}function J(e,t,r){return X.apply(this,arguments)}function X(){return(X=W(q().mark((function e(t,r,n){var o;return q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.docs.copy({doc_id:t.id,target_doc_id:r.id,only_draft:!0});case 2:if((o=e.sent).content=o.content||o.body_draft_asl||o.body_draft,!Z(o)){e.next=6;break}return e.abrupt("return",{title:n||o.title,content:o.content,type:A.FORMAT.LAKETABLE});case 6:return e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e,t,r,n){return ee.apply(this,arguments)}function ee(){return(ee=W(q().mark((function e(t,r,n,o){var a,i,c,u,l;return q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(j.k)(t.id);case 2:if(a=e.sent,i=A.FORMAT_TYPE_MAP[a.format],c=o||a.name,i!==r.type){e.next=13;break}if(a.format!==A.FORMAT.LAKETABLE&&!/<card.*name=\"dataTable\"/.test(a.doclet.body_asl)){e.next=11;break}return e.next=9,Object(j.c)(n,a,{docId:r.id});case 9:return u=e.sent,e.abrupt("return",{title:c,content:a.format===A.TYPE_FORMAT_MAP.Doc?u.body_draft_asl:u.body_draft});case 11:return Object(k.spmClick)(x.a.TEMPLATE_USAGE,{id:a.id,type:a.type,format:a.format,name:a.name,platform:"pc"}),e.abrupt("return",{title:c,content:a.format===A.TYPE_FORMAT_MAP.Doc?a.doclet.body_asl:a.doclet.body});case 13:return e.next=15,Object(j.c)(n,a);case 15:l=e.sent,window.open("/".concat(n.namespace,"/").concat(l.slug,"/edit"));case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e){var t,r,i=e.doc,u=e.book,s=e.group,f=e.header,d=e.editMode,p=e.dispatch,m=e.me,v=f||T.a,g=Object(n.useRef)(null),b=Object(a.useHistory)(),w=Object(a.useParams)().doc,_=Object(n.useRef)(!1),k=Object(D.a)({doc:i,book:u,group:s,dispatch:p,onPublishSuccessRedirect:window.appData.isYuqueMobileApp?function(e){return setTimeout((function(){window.location.replace(e)}),1e3)}:void 0,readerEditMode:d,matchCondition:d?(null==i||null===(t=i.readerEditModeData)||void 0===t?void 0:t.matchCondition)||{}:window.appData.matchCondition||{},currentDocSlug:w,me:m}),x=k.getOpenEditorConfig(),j=k.getWorkflow(),A=k.getTheme(),C=k.state,P=C.historyView,N=C.wizardView,R=C.editorLoaded,G=C.docTitle,z=k.buildEditorProps(),H=k.buildHistoryProps(),X=k.buildHeadProps(),ee=k.buildStatusProps();Object(n.useEffect)((function(){d&&!_.current&&(!0!==R||i.slug!==w||E()(i.body_asl)||(k.start(i),_.current=!0))}),[R,i,w]),Object(n.useEffect)((function(){d||!0!==R||k.start()}),[R]);var te=V(o.a.useState((function(){return window.innerHeight})),2),ne=te[0],oe=te[1];o.a.useEffect((function(){var e=y()((function(){oe(window.innerHeight)}),100);return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]),Object(n.useEffect)((function(){function e(){return(e=W(q().mark((function e(){return q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:d&&(j.save(c.SAVE_TYPE.AUTO),j.destroy());case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return function(){!function(){e.apply(this,arguments)}()}}),[d]);var ae=V(o.a.useState(26),2),ie=ae[0],ce=ae[1];Object(n.useEffect)((function(){if("Doc"===i.type&&N){var e,t=null===(e=g.current)||void 0===e?void 0:e.querySelector(".ne-engine :first-child");t&&t.offsetHeight&&ce(t.offsetHeight)}}),[N,i.type]);var ue=V(o.a.useState(50),2),le=ue[0],se=ue[1];o.a.useLayoutEffect((function(){"Doc"===i.type&&N&&setTimeout((function(){var e,t=null===(e=g.current)||void 0===e?void 0:e.querySelector(".ne-editor .lake-title-editor textarea:first-child");t&&t.offsetHeight&&se(t.offsetHeight)}),0)}),[G,N,i.type]),Object(L.a)(i.title,d);var fe=function(){var e=W(q().mark((function e(t){var r,n,o,a,c=arguments;return q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!(c.length>1&&void 0!==c[1])||c[1])){e.next=8;break}return e.next=4,$(t,i,u,G);case 4:if(r=e.sent){e.next=7;break}return e.abrupt("return");case 7:return e.abrupt("return",k.useTemplate(r));case 8:return e.next=10,J(t,i,G);case 10:n=e.sent,k.useTemplate(n),Z(n)&&(null==j||null===(o=j.engine)||void 0===o||null===(a=o.requestRecords)||void 0===a||a.call(o));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),de=e.layout||A.viewport||"fixed",pe=o.a.useMemo((function(){return 110+(le||50)+37+20+2*(ie||26)+16}),[le,ie]);return o.a.createElement("div",{id:"commonEditPage",className:h()("lark",e.className),"data-testid":"lock-based-doc-editor"},R&&o.a.createElement(re,{doc:i}),o.a.createElement("div",{className:h()("lark-editor","lark-editor-lake",{"lark-iframe-mode":Q,"lake-editor-adapt":"adapt"===de}),ref:g},!x.isServify&&l.a.createPortal(o.a.createElement(O.a,ee),document.querySelector("body")),x.showHeader&&o.a.createElement(v,B({},X,{editMode:d,history:b})),e.renderEditor(z)),"Doc"===i.type&&o.a.createElement(I,{doc:i,workflow:j}),P&&e.renderHistory(H),Q&&x.isEmbedMode&&j.isReady()&&o.a.createElement(M.b,{doc:i,getContainer:function(){return g},getContent:j.engine.getEditorContent,setContent:j.engine.setContent,getTitle:function(){return i.title},workflow:j,autoHeight:x.autoHeight,backgroundColor:x.backgroundColor,bodyBackgroundColor:x.bodyBackgroundColor,toolbarBackgroundColor:x.toolbarBackgroundColor,insertContent:function(e){j.engine.insertContent(e)},publish:k.onPublish}),!Q&&o.a.createElement(S.a,{noMessage:!0},o.a.createElement(n.Suspense,{fallback:o.a.createElement("div",null)},"Doc"===(null==i?void 0:i.type)?o.a.createElement("div",{className:h()(F.creationGuide,(r={},U(r,F.adaptMode,"adapt"===A.viewport),U(r,F.editMode,d),r)),style:{top:pe}},o.a.createElement(K,{className:F.guideWrapper,doc:i,height:ne-pe,book:u,group:s,visible:N,isFullWidth:"adapt"===A.viewport,onUseTemplate:fe})):o.a.createElement(Y,{currentDoc:i,viewport:A.viewport,visible:N,book:u,group:s,useTemplate:fe,requestRecords:j.engine&&j.engine.requestRecords}))))}function re(e){var t=e.doc,r=Object(n.useRef)(!1);return Object(n.useEffect)((function(){var e=document.querySelector(i.a)||document.querySelector(i.b),n=y()((function(e){r.current&&3!==e.eventPhase&&i.c.saveEditPosition(t.id)}),300);return null==e||e.addEventListener("scroll",n),function(){null==e||e.removeEventListener("scroll",n)}}),[t.id]),Object(n.useEffect)((function(){setTimeout((function(){r.current=!0}),1e3)}),[]),Object(n.useEffect)((function(){var e=function(){i.c.clearPosition()};return window.addEventListener("beforeunload",e),function(){window.removeEventListener("beforeunload",e)}}),[]),null}function ne(e){return e.editMode&&e.doc.readerEditModeData?o.a.createElement(te,e):e.editMode?o.a.createElement("span",{"data-testid":"readerEditModeData-null"}):o.a.createElement(te,e)}te.propTypes={doc:f.a.object.isRequired,book:f.a.object.isRequired,group:f.a.object.isRequired,layout:f.a.oneOf(["fixed","adapt"]),renderEditor:f.a.func.isRequired,renderHistory:f.a.func.isRequired,header:f.a.elementType,error:f.a.object,editMode:f.a.bool};t.a=Object(d.d)((function(e){return{book:e.book,doc:e.doc,group:e.group,me:e.me}}))(o.a.memo(ne,(function(e,t){var r=["book","doc","group","me","layout","editMode","error"];return g()(w.a.apply(void 0,[e].concat(r)),w.a.apply(void 0,[t].concat(r)))})))},3982:function(e,t,r){var n;(function(){"use strict";function r(e){return">"===e}function o(e){return"<"===e}function a(e){return/^\s+$/.test(e)}function i(e){var t=e.match(/^\s*<([^!>][^>]*)>\s*$/);return!!t&&t[1].trim().split(" ")[0]}function c(e){return/--\>$/.test(e)}var u,l=new RegExp("^<(iframe|object|math|svg|script|video|head|style|a)");function s(e){var t=u.exec(e);return t&&t[1]}function f(e,t){return e.substring(e.length-t.length-2)==="</"+t}function d(e){return/^\s*<[^>]+\/>\s*$/.test(e)}function p(e){return/^<img[\s>]/.test(e)||function(e){return!i(e)}(e)||s(e)||d(e)}function h(e){return{string:e,key:v(e)}}function m(e,t,r,n){this.segment=n,this.length=r,this.startInBefore=e+n.beforeIndex,this.startInAfter=t+n.afterIndex,this.endInBefore=this.startInBefore+this.length-1,this.endInAfter=this.startInAfter+this.length-1,this.segmentStartInBefore=e,this.segmentStartInAfter=t,this.segmentEndInBefore=this.segmentStartInBefore+this.length-1,this.segmentEndInAfter=this.segmentStartInAfter+this.length-1}function y(e){for(var t="char",n="",i="",u=[],l=0;l<e.length;l++){var d=e[l];switch(t){case"tag":var p=s(n);p?(t="atomic_tag",i=p,n+=d):/^<!--/.test(n)?(t="html_comment",n+=d):r(d)?(n+=">",u.push(h(n)),n="",t=a(d)?"whitespace":"char"):n+=d;break;case"atomic_tag":r(d)&&f(n,i)?(n+=">",u.push(h(n)),n="",i="",t="char"):n+=d;break;case"html_comment":c(n+=d)&&(n="",t="char");break;case"char":o(d)?(n&&u.push(h(n)),n="<",t="tag"):/\s/.test(d)?(n&&u.push(h(n)),n=d,t="whitespace"):/[\w\d\#@]/.test(d)?n+=d:/&/.test(d)?(n&&u.push(h(n)),n=d):(n+=d,u.push(h(n)),n="");break;case"whitespace":o(d)?(n&&u.push(h(n)),n="<",t="tag"):a(d)?n+=d:(n&&u.push(h(n)),n=d,t="char");break;default:throw new Error("Unknown mode "+t)}}return n&&u.push(h(n)),u}function v(e){var t=/^<img.*src=['"]([^"']*)['"].*>$/.exec(e);if(t)return'<img src="'+t[1]+'">';var r=/^<a.*href=['"]([^"']*)['"]/.exec(e);if(r)return'<a href="'+r[1]+'"></a>';var n=/^<object.*data=['"]([^"']*)['"]/.exec(e);if(n)return'<object src="'+n[1]+'"></object>';if(/^<(svg|math|video)[\s>]/.test(e)){var o=e.indexOf('data-uuid="');return-1!==o?e.slice(0,o)+e.slice(o+44):e}var a=/^<iframe.*src=['"]([^"']*)['"].*>/.exec(e);if(a)return'<iframe src="'+a[1]+'"></iframe>';var i=/<([^\s>]+)[\s>]/.exec(e);return i?"<"+i[1].toLowerCase()+">":e?e.replace(/(\s+|&nbsp;|&#160;)/g," "):e}function g(e){return e.reduce((function(e,t,r){return e[t.key]?e[t.key].push(r):e[t.key]=[r],e}),Object.create(null))}function b(){this._root=null}function w(e){for(var t=e.beforeTokens,r=e.afterMap,n=null,o=null,a=0;a<t.length;a++){var i=!1,c=t.length-a;if(o&&c<o.length)break;var u=t[a];if(" "!==u.key){n===a-1&&(i=!0);var l=r[u.key];l&&l.forEach((function(t){var r=o?o.length:0,n=_(e,a,t,r,i);n&&n.length>r&&(o=n)}))}else n=a}return o}function _(e,t,r,n,o){var a=e.beforeTokens,i=e.afterTokens,c=t+n,u=r+n;if(!(c>=a.length||u>=i.length)){if(n)if(a[c].key!==i[u].key)return;for(var l=!0,s=1,f=t+s,d=r+s;l&&f<a.length&&d<i.length;){a[f].key===i[d].key?(f=t+ ++s,d=r+s):l=!1}if(o&&t>0&&r>0){var p=a[t-1].key,h=i[r-1].key;" "===p&&" "===h&&(t--,r--,s++)}return new m(t,r,s,e)}}function E(e,t,r,n){return{beforeTokens:e,afterTokens:t,beforeMap:g(e),afterMap:g(t),beforeIndex:r,afterIndex:n}}function O(e){for(var t,r=new b,n=[e];n.length;)if((t=w(e=n.pop()))&&t.length){if(t.segmentStartInBefore>0&&t.segmentStartInAfter>0){var o=e.beforeTokens.slice(0,t.segmentStartInBefore),a=e.afterTokens.slice(0,t.segmentStartInAfter);n.push(E(o,a,e.beforeIndex,e.afterIndex))}var i=e.beforeTokens.slice(t.segmentEndInBefore+1),c=e.afterTokens.slice(t.segmentEndInAfter+1),u=e.beforeIndex+t.segmentEndInBefore+1,l=e.afterIndex+t.segmentEndInAfter+1;i.length&&c.length&&n.push(E(i,c,u,l)),r.add(t)}return r.toArray()}function S(e,t){if(!e)throw new Error("Missing beforeTokens");if(!t)throw new Error("Missing afterTokens");var r=0,n=0,o=[],a=E(e,t,0,0),i=O(a);i.push(new m(e.length,t.length,0,a));for(var c=0;c<i.length;c++){var u=i[c],l="none";r===u.startInBefore?n!==u.startInAfter&&(l="insert"):(l="delete",n!==u.startInAfter&&(l="replace")),"none"!==l&&o.push({action:l,startInBefore:r,endInBefore:"insert"!==l?u.startInBefore-1:null,startInAfter:n,endInAfter:"delete"!==l?u.startInAfter-1:null}),0!==u.length&&o.push({action:"equal",startInBefore:u.startInBefore,endInBefore:u.endInBefore,startInAfter:u.startInAfter,endInAfter:u.endInAfter}),r=u.endInBefore+1,n=u.endInAfter+1}var s=[],f={action:"none"};function d(t){return"equal"===t.action&&(t.endInBefore-t.startInBefore==0&&/^\s$/.test(e.slice(t.startInBefore,t.endInBefore+1)))}for(var p=0;p<o.length;p++){var h=o[p];d(h)&&"replace"===f.action||"replace"===h.action&&"replace"===f.action?(f.endInBefore=h.endInBefore,f.endInAfter=h.endInAfter):(s.push(h),f=h)}return s}function k(e){this.tokens=e,this.notes=e.reduce((function(e,t,r){e.notes.push({isWrappable:p(t),insertedTag:!1});var n=!d(t)&&i(t),o=e.tagStack[e.tagStack.length-1];return n&&(o&&"/"+o.tag===n?(e.notes[o.position].insertedTag=!0,e.tagStack.pop()):e.tagStack.push({tag:n,position:r})),e}),{notes:[],tagStack:[]}).notes}function x(e,t,r,n,o){var a=new k(t),i=" data-"+(n=n?n+"-":"")+'operation-index="'+r+'"';return o&&(i+=' class="'+o+'"'),a.combine((function(t){if(!t.isWrappable)return t.tokens.join("");var r=t.tokens.join("");return r.trim()?"<"+e+i+">"+r+"</"+e+">":""}),(function(t){var o=' data-diff-node="'+e+'"';return o+=" data-"+n+'operation-index="'+r+'"',t.replace(/>\s*$/,o+"$&")}))}b.prototype={add:function(e){var t,r,n={value:e,left:null,right:null},o=this._root;if(o)for(;;){var a=(t=o.value,(r=e).endInBefore<t.startInBefore&&r.endInAfter<t.startInAfter?-1:r.startInBefore>t.endInBefore&&r.startInAfter>t.endInAfter?1:0);if(-1===a){if(!o.left){o.left=n;break}o=o.left}else{if(1!==a)break;if(!o.right){o.right=n;break}o=o.right}}else this._root=n},toArray:function(){return function e(t,r){return t&&(e(t.left,r),r.push(t.value),e(t.right,r)),r}(this._root,[])}},k.prototype.combine=function(e,t){var r=this.notes,n=this.tokens.slice();return n.reduce((function(e,o,a){r[a].insertedTag&&(n[a]=t(n[a])),null===e.status&&(e.status=r[a].isWrappable);var i=r[a].isWrappable;return i!==e.status&&(e.list.push({isWrappable:e.status,tokens:n.slice(e.lastIndex,a)}),e.lastIndex=a,e.status=i),a===n.length-1&&e.list.push({isWrappable:e.status,tokens:n.slice(e.lastIndex,a+1)}),e}),{list:[],status:null,lastIndex:0}).list.map(e).join("")};var j={equal:function(e,t,r,n,o,a){return r.slice(e.startInAfter,e.endInAfter+1).reduce((function(e,t){return e+t.string}),"")},insert:function(e,t,r,n,o,a){return x("ins",r.slice(e.startInAfter,e.endInAfter+1).map((function(e){return e.string})),n,o,a)},delete:function(e,t,r,n,o,a){return x("del",t.slice(e.startInBefore,e.endInBefore+1).map((function(e){return e.string})),n,o,a)},replace:function(){return j.delete.apply(null,arguments)+j.insert.apply(null,arguments)}};function A(e,t,r,n,o){return r.reduce((function(r,a,i){return r+j[a.action](a,e,t,i,n,o)}),"")}function L(e,t,r,n,o){return e===t?e:(u=o?new RegExp("^<("+o.replace(/\s*/g,"").replace(/,/g,"|")+")"):l,A(e=y(e),t=y(t),S(e,t),n,r))}L.htmlToTokens=y,L.findMatchingBlocks=O,O.findBestMatch=w,O.createMap=g,O.createToken=h,O.createSegment=E,O.getKeyForToken=v,L.calculateOperations=S,L.renderOperations=A,void 0===(n=function(){return L}.apply(t,[]))||(e.exports=n)}).call(this)},3993:function(e,t,r){"use strict";var n=r(0),o=r.n(n),a=r(2),i=r.n(a),c=r(64),u=r.n(c),l=r(82),s=r.n(l),f=r(3982),d=r.n(f),p=new u.a("doc:diff"),h=function(e){return e.querySelector(".lake-engine")||e},m=function(e){for(var t=e.childNodes,r=0,n=t.length;r<n;r++){var o=t[r],a=!1;if(o.nodeType===Node.ELEMENT_NODE){if(["DEL","INS"].includes(o.tagName))a=!0;else o.querySelector("del,ins")&&(a=!0);o.classList.add(a?"doc-diff-paragraph-changed":"doc-diff-paragraph-unchanged")}}},y=function(e){return e?e.startsWith(s.a.HTML_DOCTYPE)?e.substring(s.a.HTML_DOCTYPE.length):e:""};function v(e){var t=e.head,r=e.base;t=y(t),r=y(r);var a=Object(n.useRef)(null),i=Object(n.useMemo)((function(){return d()(r,t,"html-diff",null,"iframe,video,a,em,strong,del,meta")}),[]);return p("head",t),p("base",r),Object(n.useEffect)((function(){if(a.current){var e=h(a.current);m(e)}}),[]),t===r?o.a.createElement("div",{className:"doc-diff","data-testid":"unchanged-view"},__("内容一致")):o.a.createElement("div",{"data-testid":"doc-diff",className:"doc-diff"},o.a.createElement("div",{"data-testid":"diff-view",dangerouslySetInnerHTML:{__html:i},ref:a}))}v.propTypes={base:i.a.string.isRequired,head:i.a.string.isRequired};t.a=v},3999:function(e,t,r){"use strict";r.r(t);var n=r(0),o=r.n(n),a=r(2),i=r.n(a),c=r(3993),u=r(3752),l=r(3703),s=r(267),f=r(50),d=Object(s.b)((function(){return Promise.all([r.e(4),r.e(5),r.e(6),r.e(0),r.e(1237)]).then(r.bind(null,2930))}),{suspense:!0});function p(e){return o.a.createElement("div",{className:l.a.fullscreenWrap},o.a.createElement(u.a,{doc:e.doc,docDomain:e.docDomain,readonly:e.readonly,renderVersion:function(t){return o.a.createElement(d,{key:"version-".concat(t.id),id:"version-".concat(t.id),content:t.content,genOutline:!1,genAnchor:!1,doc:t,meta:(r=e.doc,r?{skylark:{docID:r.id}}:{}),fallbackLake:!0,disableDynamicCardFunction:!0});var r},renderDiff:function(e,t){return o.a.createElement(c.a,{head:e.content_html,base:t.content_html})},onCancel:e.onCancel,onRevert:e.onRevert,onReverted:e.onReverted,docProxy:f.a.docs,docletProxy:f.a.doclets,docVersionProxy:f.a.docVersions,defaultCategory:e.defaultCategory,versionPublished:e.versionPublished}))}p.propTypes={doc:i.a.object.isRequired,onCancel:i.a.func.isRequired,docDomain:i.a.string,onRevert:i.a.func,onReverted:i.a.func,readonly:i.a.bool,defaultCategory:i.a.oneOf(["all","named_version"]),versionPublished:i.a.bool},t.default=p},4084:function(e,t,r){"use strict";var n=r(0),o=r.n(n),a=r(320);t.a=Object(a.b)((function(){return Object(n.useEffect)((function(){r.e(1325).then(r.bind(null,4563)),r.e(1325).then(r.bind(null,4564)),r.e(1325).then(r.bind(null,4565)),r.e(1325).then(r.bind(null,4566)),r.e(1325).then(r.bind(null,4567)),r.e(1325).then(r.bind(null,4568)),r.e(1325).then(r.bind(null,4569)),r.e(1325).then(r.bind(null,4570)),r.e(1325).then(r.bind(null,4571)),r.e(1325).then(r.bind(null,4572)),r.e(1325).then(r.bind(null,4573)),r.e(1325).then(r.bind(null,4574)),r.e(1325).then(r.bind(null,4575)),r.e(1325).then(r.bind(null,4576)),r.e(1325).then(r.bind(null,4577)),r.e(1325).then(r.bind(null,4578)),r.e(1325).then(r.bind(null,4579)),r.e(1325).then(r.bind(null,4580)),r.e(1325).then(r.bind(null,4581)),r.e(1325).then(r.bind(null,4582)),r.e(1325).then(r.bind(null,4583)),r.e(1325).then(r.bind(null,4584)),r.e(1325).then(r.bind(null,4585)),r.e(1325).then(r.bind(null,4586)),r.e(1325).then(r.bind(null,4587)),r.e(1325).then(r.bind(null,4588))})),o.a.createElement("span",null)}))},436:function(e,t,r){"use strict";t.a={option:"index-module_option_kIhZi",item:"index-module_item_THV+2",listItem:"index-module_listItem_SQDdc",localValue:"index-module_localValue_kC1GM",divider:"index-module_divider_NQlDz",disabledPin:"index-module_disabledPin_51pdP",searchIcon:"index-module_searchIcon_4m0J4",clearIcon:"index-module_clearIcon_6ZLcB",placeholder:"index-module_placeholder_oof15",title:"index-module_title_qC2JT",link:"index-module_link_p0IfA"}},4458:function(e,t,r){"use strict";r(37);var n=r(10),o=r(0),a=r.n(o),i=r(2),c=r.n(i),u=r(654),l="index-module_messageClose_2LMjD",s=function(e){var t=e.history;return Object(o.useEffect)((function(){var e=(t&&t.location&&t.location.query||{}).resource_id;if(e){var r,o=function(){r&&r(),window.history.replaceState({},document.title,window.location.pathname)},i=a.a.createElement("span",null,__("文件已转成语雀文件，原始文件请到 {history} 中查看。",{history:a.a.createElement("a",{onClick:function(){o(),window.open("/go/resource/".concat(e,"?history=1"),"_blank")}},__("历史版本"))}),a.a.createElement("span",{className:l,onClick:o},a.a.createElement(u.default,null)));r=n.a.warning(i,0)}}),[]),null};s.propTypes={history:c.a.object};t.a=s},468:function(e,t,r){"use strict";r(2963);var n=r(1263);r(1544);t.a=n.a},4781:function(e,t,r){"use strict";r.d(t,"a",(function(){return F}));var n=r(0),o=r.n(n),a=r(3358),i=r(3917),c=r(4458),u=r(4084),l=r(3924),s=r(3999),f=r(3856),d=r(3382);function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){y(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function y(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==p(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===p(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var v=[{icon:!1,keys:["E"],name:"edit",text:__("编辑文档")},{icon:!1,keys:["Command","Enter"],name:"publish",text:__("发布/更新")},{icon:!1,name:"hotkeyTips",keys:["opt","cmd","?"],text:__("快捷键面板")},{name:"save",keys:["cmd","S"],text:__("保存")}],g=[{type:"format",text:__("格式"),children:["formatPainter","clearFormat","h1","h2","h3","h4","h5","h6","paragraph","bold","italic","strikethrough","underline","fontsize","color","bgColor","sup","sub","alignmentLeft","alignmentCenter","alignmentRight","indent","outdent","lineHeight"]},{type:"insert",text:__("插入"),children:["card","orderedList","unorderedList","taskList","quote","math","code","codeblock","table","mention","link","image","hr","info","success","warning","danger","tips"]},{type:"table",text:__("表格"),children:["cellBgColor","mergeCell","verticalAlignTop","verticalAlignMiddle","verticalAlignBottom","toggleBorder"]},{type:"edit",text:__("编辑"),children:["undo","redo","save","paste","pasteText","openSearchPanel","openTranslatePanel","openLibrary","edit","publish","hotkeyTips"]}],b=v.reduce((function(e,t){return e[t.name]=t,e}),{});var w=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce((function(e,t){return e[t.name]=t,e}),{});return g.map((function(t){return{type:t.type,text:t.text,children:t.children.map((function(t){return b[t]||e[t]})).filter((function(e){return!!e})).map((function(e){return m(m({},e),{},{icon:!1===e.icon?null:"editor-".concat(e.name)})}))}})).filter((function(e){return Array.isArray(e.children)&&e.children.length}))}(d.Hotkeys),_=(w.filter((function(e){return"document"!==e.type})),r(3647)),E=r(3968),O=r(2),S=r.n(O),k=r(64),x=r.n(k),j=r(3633),A=r(267),L=r(951),T=r(22),C=r(790),P=r(3356),N=Object(A.b)((function(){return Promise.all([r.e(0),r.e(1),r.e(3),r.e(11),r.e(1236)]).then(r.bind(null,4648))}),{suspense:!0}),R=x()("editor:doc.ui");function I(e){var t=e.book,r=e.doc,a=e.group,i=e.theme,c=e.useEditorTileRendering,u=e.useEditorTileRenderingForOT,l=e.sidePanelManager,s=e.editType,f=e.editMode;R("render");var d=Object(n.useRef)(null),p=Object(L.b)();return o.a.createElement("div",{id:"lark-doc-edit-root",ref:d},o.a.createElement(N,{key:r.id,doc_id:r.id,doc:r,book:t,group:a,title:r.title,viewport:i.viewport,typography:i.typography,meta:C.a.getEditorMeta(r),onLoad:function(t,n){var o=new j.a(r,t,n);e.onEditorLoaded({engine:o})},onAutoSave:function(){e.onSave(P.h.AUTO)},onSave:e.onSave,onChange:e.onContentChange,onThemeChange:e.onThemeChange,onSaveTitle:e.onSaveTitle,onTitleChange:e.onTitleChange,getDefaultSuggestions:e.getDefaultSuggestions,onMentionSearch:e.onMentionSearch,useEditorTileRendering:c,useEditorTileRenderingForOT:u,fallbackLake:!0,hideThemeEditor:!0,globalSelectAll:e.globalSelectAll,focusOnLoaded:e.focusOnLoaded,placeholder:{tip:T.g&&!p?__("输入正文..."):__("直接输入正文，也可选择一个模板："),emptyParagraphTip:__("输入 / 唤起更多")},editMode:f,sidePanelManager:l,editType:s}))}I.defaultProps={globalSelectAll:!0},I.propTypes={doc:S.a.object.isRequired,book:S.a.object.isRequired,group:S.a.object.isRequired,theme:S.a.object.isRequired,onEditorLoaded:S.a.func,onSave:S.a.func,onSaveTitle:S.a.func,onTitleChange:S.a.func,onThemeChange:S.a.func,onContentChange:S.a.func,onPublish:S.a.func,getDefaultSuggestions:S.a.func,onMentionSearch:S.a.func,focusOnLoaded:S.a.bool,globalSelectAll:S.a.bool};var D=I;function M(){return M=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},M.apply(this,arguments)}function F(e){var t=e.history,r=(e.app,e.editMode),d=e.sidePanelManager,p=e.className;Object(l.a)(window.location,t),Object(f.a)("pagename","doc_edit"),Object(_.a)();var h=Object(n.useCallback)((function(e){return o.a.createElement(D,M({},e,{sidePanelManager:d,editMode:r}))}),[d,r]),m=Object(n.useCallback)((function(e){return o.a.createElement(s.default,e)}),[]);return r?o.a.createElement(o.a.Fragment,null,o.a.createElement(i.default,{hotKeys:w,hidable:!0,defaultOpen:!1,isEditor:!0}),o.a.createElement(E.a,{className:p,editMode:r,renderEditor:h,renderHistory:m,sidePanelManager:d})):o.a.createElement(a.a,{history:t,showSiteTip:!1,headless:!0},o.a.createElement(i.default,{hotKeys:w,hidable:!0,defaultOpen:!1,isEditor:!0}),o.a.createElement(E.a,{renderEditor:h,renderHistory:m}),o.a.createElement(c.a,{history:t}),o.a.createElement(u.a,null))}},5645:function(e,t,r){"use strict";r.r(t);var n=r(4781);t.default=function(e){return React.createElement(n.a,e)}},815:function(e,t,r){"use strict";r(2960);var n=r(1259);r(1346);t.a=n.a},954:function(e,t,r){"use strict";r(2899);var n=r(801),o=r(83),a=r.n(o),i=r(58),c=r.n(i),u=r(1206),l=r.n(u),s=r(86),f=r.n(s),d=r(137),p=r.n(d),h=r(0),m=r.n(h),y=r(2),v=r.n(y),g=r(5),b=r.n(g),w=r(84),_=r.n(w),E=r(175),O=r.n(E);var S=r(64),k=r.n(S)()("useInifiniteScroll"),x=function(e,t){var r,n,o,a,i,c,u=(r=!1,n=Object(h.useState)(r),o=O()(n,2),a=o[0],i=o[1],(c=Object(h.useRef)(a)).current=a,[a,i,Object(h.useCallback)((function(){return c.current}),[])]),s=O()(u,3),f=s[0],d=s[1],m=s[2],y=Object(h.useRef)(null);y.current=e;var v=Object(h.useCallback)(function(){var e=l()(p.a.mark((function e(t){var r,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=O()(t,1),n=r[0],!m()){e.next=3;break}return e.abrupt("return");case 3:if(null==n||!n.isIntersecting){e.next=12;break}return k("entry?.isIntersecting",null==n?void 0:n.isIntersecting),e.prev=5,d(!0),e.next=9,y.current();case 9:return e.prev=9,d(!1),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[5,,9,12]])})));return function(t){return e.apply(this,arguments)}}(),[y]);return{loading:f,refCallback:Object(h.useCallback)((function(e){k("ref",e);var r,n=null;if(e&&!n&&window.IntersectionObserver)return k("enter"),n=new IntersectionObserver(v,{threshold:(null==t?void 0:t.threshold)||.1,root:(null===(r=t.root)||void 0===r?void 0:r.current)||null}),k("observe",e),n.observe(e),function(){return n.unobserve(e)}}),[t.threshold])}},j=r(704),A=r(138),L=(r(1196),["className","emptyView","onLoadMore","dataSource","renderItem","loading","showLoadingMore","pagination","children","justify","customItem","loadOnScroll","listContainer"]);function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function C(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach((function(t){a()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var P=m.a.forwardRef((function(e,t){var r=e.className,o=e.emptyView,a=e.onLoadMore,i=e.dataSource,u=e.renderItem,s=e.loading,d=e.showLoadingMore,h=e.pagination,y=e.children,v=e.justify,g=e.customItem,w=e.loadOnScroll,_=e.listContainer,E=f()(e,L),O=e.loadMoreText,S=void 0===O?Object(j.a)("查看更多"):O,k=s;"boolean"==typeof k&&(k={spinning:k});var T=k&&k.spinning,P=x(l()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!w||!a){e.next=3;break}return e.next=3,a();case 3:case"end":return e.stop()}}),e)}))),{root:_}),N=P.loading,R=P.refCallback;w&&(S=Object(j.a)("到底了"));var I=i.length&&d?m.a.createElement("div",{className:"larkui-list-block-more"},T&&m.a.createElement(A.a,c()({justify:"block"},k)),!T&&m.a.createElement("a",{className:"larkui-list-block-more-btn",ref:R,onClick:function(e){e.preventDefault(),a&&a()}},N?Object(j.a)("加载中"):S)):null;if(T&&!I)return m.a.createElement("div",{className:b()("larkui-list","larkui-list-loading")},m.a.createElement(A.a,c()({justify:"block"},k)));var D=h;return D&&(D=h.total<=h.pageSize?null:C({showSizeChanger:!1},D)),m.a.createElement(n.b,c()({ref:t,className:b()(r,"larkui-list",{"larkui-list-justify-block":"block"===v}),loading:!1,loadMore:I,pagination:D,dataSource:i.length>0?i:e.emptyView?["empty"]:[],renderItem:function(e,t){if("empty"===e)return m.a.createElement("div",{className:"blankslate"},o);var r=u(e,t);return r?g?r:m.a.createElement(n.b.Item,{key:e.id},r):m.a.createElement("div",null)}},E),y)}));P.defaultProps={dataSource:[],loading:!1,showLoadingMore:!1,justify:"flex"},P.propTypes=C(C({},n.b.ListProps),{},{className:v.a.string,emptyView:v.a.node,onLoadMore:v.a.func,dataSource:v.a.array,renderItem:v.a.func,loading:v.a.oneOfType([v.a.bool,v.a.object]),showLoadingMore:v.a.bool,pagination:v.a.object,children:v.a.node,justify:v.a.oneOf(["block","flex"]),customItem:v.a.bool,loadOnScroll:v.a.bool,listContainer:v.a.node}),_()(P,n.b);t.a=P},968:function(e,t,r){e.exports=r(1200)},975:function(e,t,r){"use strict";r(2962);var n=r(1260);r(1354);t.a=n.a},98:function(e,t,r){"use strict";r.d(t,"e",(function(){return n})),r.d(t,"a",(function(){return o})),r.d(t,"c",(function(){return a})),r.d(t,"b",(function(){return i})),r.d(t,"d",(function(){return c}));var n=function(e){return e.activity="activity",e.announcement="announcement",e}({}),o=function(e){return e.normal="normal",e.qrCode="qrCode",e}({}),a=function(e){return e.mainButton="mainButton",e.viceButton="viceButton",e.otherButton="otherButton",e}({}),i=function(e){return e.none="none",e.icon="icon",e.bg="bg",e}({}),c=function(e){return e.open="open",e.href="href",e.close="close",e}({})}}]);